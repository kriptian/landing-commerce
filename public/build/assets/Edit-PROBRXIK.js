import{p as O,r,C as ae,a as n,o as l,b as w,u as c,h as ne,d as S,e,s as Q,g as k,v as C,f as u,F,i as W,t as x,m as J,K as L,j as H}from"./app-1McBFp1T.js";import{_ as le}from"./AuthenticatedLayout-D7Yb8bmF.js";import{_ as re}from"./Modal-GP-28cde.js";import{_ as ie}from"./AlertModal-DiQ7T1JD.js";import{_ as de}from"./SecondaryButton-B6YG8noK.js";import{D as ce}from"./DangerButton-CFlXY-dj.js";const ue={class:"font-semibold text-xl text-gray-800 leading-tight"},me={class:"py-12"},ve={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},ge={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ye={class:"p-6 text-gray-900"},_e=e("h3",{class:"text-lg font-medium"},"Editar Nombre",-1),he=["disabled"],be={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},fe={class:"p-6 text-gray-900"},xe={class:"flex items-center justify-between"},pe=e("h3",{class:"text-lg font-medium"},"Gestionar Subcategorías",-1),we={class:"flex items-center gap-2"},ke={class:"mt-4 border rounded-lg divide-y"},Ce={key:0,class:"text-sm text-gray-500"},je={key:1,class:"text-sm text-gray-500"},Ae={class:"flex justify-between items-center"},$e={class:"flex-1"},Ee={key:0,class:"flex items-center gap-2"},Se=["title","onClick"],Ve={key:0},Be={key:1},Ne={class:"font-medium"},Me={key:0,class:"text-xs bg-gray-100 text-gray-700 rounded px-2 py-0.5 align-middle"},Ue={key:1,class:"flex items-center gap-2"},Le=["onUpdate:modelValue"],De=["onClick"],Pe=["onClick"],Re={class:"flex items-center gap-2"},ze=["onClick"],Fe=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M16.862 3.487a2.25 2.25 0 113.182 3.182L9.428 17.284a3.75 3.75 0 01-1.582.992l-2.685.805a.75.75 0 01-.93-.93l.805-2.685a3.75 3.75 0 01.992-1.582L16.862 3.487z"}),e("path",{d:"M15.75 4.5l3.75 3.75"})],-1),He=[Fe],Te=["onClick"],Ge=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("rect",{x:"4",y:"3",width:"11",height:"15",rx:"2",ry:"2","stroke-width":"1.5"}),e("circle",{cx:"18",cy:"18",r:"3","stroke-width":"1.5"}),e("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M18 16.5v3M16.5 18h3"})],-1),qe=[Ge],Xe=["onClick"],Ke=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),Oe=[Ke],Qe={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2"},We=e("label",{class:"block text-xs text-gray-600 mb-1"},"Añadir Nueva Subcategoría",-1),Je={class:"flex items-center gap-2"},Ye=["onUpdate:modelValue"],Ze=["disabled","onClick"],Ie=["onClick"],et={key:0,class:"text-xs text-red-600 mt-1"},tt={key:1,class:"mt-2 pl-4 border-l"},st={key:0,class:"text-sm text-gray-500"},ot={class:"flex-1"},at={key:0},nt={key:1,class:"flex items-center gap-2"},lt=["onUpdate:modelValue"],rt=["onClick"],it=["onClick"],dt={class:"flex items-center gap-2"},ct=["onClick"],ut=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M16.862 3.487a2.25 2.25 0 113.182 3.182L9.428 17.284a3.75 3.75 0 01-1.582.992l-2.685.805a.75.75 0 01-.93-.93l.805-2.685a3.75 3.75 0 01.992-1.582L16.862 3.487z"}),e("path",{d:"M15.75 4.5l3.75 3.75"})],-1),mt=[ut],vt=["onClick"],gt=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),yt=[gt],_t={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2 w-full"},ht=e("label",{class:"block text-xs text-gray-600 mb-1"},"Nombre del subnivel",-1),bt={class:"flex items-center gap-2"},ft=["onUpdate:modelValue"],xt=["disabled","onClick"],pt={key:0,class:"text-xs text-red-600 mt-1"},wt=e("label",{class:"block font-medium text-sm text-gray-700"},"Añadir Nueva Subcategoría",-1),kt={class:"mt-2 flex items-center gap-2"},Ct=["disabled"],jt={key:0,class:"text-sm text-red-600 mt-2"},At={class:"p-6"},$t=e("h2",{class:"text-lg font-medium text-gray-900"}," ¿Querés eliminar esta subcategoría? ",-1),Et=e("p",{class:"mt-1 text-sm text-gray-600"}," Esta acción es irreversible y removerá la subcategoría seleccionada. ",-1),St={class:"mt-6 flex justify-end"},Dt={__name:"Edit",props:{category:Object},setup(V){const i=V,B=O({name:i.category.name}),m=O({name:""}),Y=()=>{B.put(route("admin.categories.update",{category:i.category.id}))},Z=()=>{const t=L("admin.categories.storeSubcategory",{parentCategory:i.category.id},`/admin/categories/${i.category.id}/subcategories`);m.post(t,{onSuccess:()=>{m.reset(),v()},preserveScroll:!0})},I=()=>{m.name=""},D=r(!1),j=r(null),N=()=>{D.value=!1,j.value=null},ee=()=>{j.value&&H.delete(route("admin.categories.destroy",{category:j.value}),{preserveScroll:!0,onSuccess:()=>{const t=j.value;N();const o=z.value;t&&(delete d.value[t],delete p.value[t],delete g.value[t],delete y.value[t],delete E.value[t]),o&&o!==i.category.id?f(o):v(),v()},onError:t=>{const o=z.value;o&&o!==i.category.id?f(o):v(),K.value=t&&(t.delete||t.message)||"Existen productos asociados a esta categoría y no se puede borrar.",U.value=!0},onFinish:()=>N()})},P=r(!1),h=r(i.category.children||[]),v=async()=>{try{P.value=!0;const t=L("admin.categories.children",{category:i.category.id},`/admin/categories/${i.category.id}/children`),o=await fetch(t);if(!o.ok)return;const s=await o.json();h.value=Array.isArray(s.data)?s.data:[]}finally{P.value=!1}};ae(()=>{v()});const p=r({}),g=r({}),A=r({}),y=r({}),te=t=>{p.value[t]=!p.value[t]},T=t=>{const o=(g.value[t]||"").trim();if(!o)return;A.value[t]=!0,y.value[t]=null;const s=L("admin.categories.storeSubcategory",{parentCategory:t},`/admin/categories/${t}/subcategories`);H.post(s,{name:o},{preserveScroll:!0,onSuccess:()=>{g.value[t]="",A.value[t]=!1,d.value[t]=!0,f(t),v()},onError:()=>{A.value[t]=!1,y.value[t]="No se pudo crear el subnivel"}})},se=t=>{g.value[t]="",y.value[t]=null,p.value[t]=!1},M=r({}),b=r({}),G=t=>{M.value[t.id]=!0,b.value[t.id]=t.name},$=t=>{M.value[t]=!1,b.value[t]=""},q=(t,o=null)=>{const s=(b.value[t]||"").trim();if(!s)return;const a=route("admin.categories.update",{category:t});if(window.axios){window.axios.post(a,{name:s,_method:"PUT"},{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(()=>{$(t),o&&o!==i.category.id?f(o):v()}).catch(()=>$(t));return}H.put(a,{name:s},{preserveScroll:!0,onSuccess:()=>{$(t),o&&o!==i.category.id?f(o):v()}})},d=r({}),R=r({}),E=r({}),f=async t=>{R.value[t]=!0;try{const o=L("admin.categories.children",{category:t},`/admin/categories/${t}/children`),s=await fetch(o);if(!s.ok)return;const a=await s.json();E.value[t]=Array.isArray(a.data)?a.data:[]}finally{R.value[t]=!1}},oe=async t=>{const o=!d.value[t];d.value[t]=o,o&&!Array.isArray(E.value[t])&&await f(t)},z=r(null),X=(t,o=null)=>{j.value=t,z.value=o,D.value=!0},U=r(!1),K=r("");return(t,o)=>(l(),n(F,null,[w(c(ne),{title:`Editar: ${V.category.name}`},null,8,["title"]),w(le,null,{header:S(()=>[e("h2",ue," Editando Categoría: "+x(V.category.name),1)]),default:S(()=>[e("div",me,[e("div",ve,[e("div",ge,[e("div",ye,[_e,e("form",{onSubmit:Q(Y,["prevent"]),class:"mt-4 flex items-center gap-4"},[k(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>c(B).name=s),type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,512),[[C,c(B).name]]),e("button",{type:"submit",disabled:c(B).processing,class:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700"}," Actualizar ",8,he)],32)])]),e("div",be,[e("div",fe,[e("div",xe,[pe,e("div",we,[e("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Expandir todo",onClick:o[1]||(o[1]=()=>{h.value.forEach(s=>d.value[s.id]=!0),h.value.forEach(s=>{Array.isArray(E.value[s.id])||f(s.id)})})},"+ "),e("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Colapsar todo",onClick:o[2]||(o[2]=()=>{h.value.forEach(s=>d.value[s.id]=!1)})},"− ")])]),e("div",ke,[P.value?(l(),n("p",Ce,"Cargando subcategorías…")):!h.value||h.value.length===0?(l(),n("p",je," Esta categoría aún no tiene subcategorías. ")):u("",!0),(l(!0),n(F,null,W(h.value,s=>(l(),n("div",{key:s.id,class:"p-3 hover:bg-gray-50"},[e("div",Ae,[e("div",$e,[M.value[s.id]?(l(),n("div",Ue,[k(e("input",{"onUpdate:modelValue":a=>b.value[s.id]=a,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,8,Le),[[C,b.value[s.id]]]),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-blue-500 text-white hover:bg-blue-600",title:"Guardar",onClick:a=>q(s.id,V.category.id)},"✔",8,De),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100",title:"Cancelar",onClick:a=>$(s.id)},"✖",8,Pe)])):(l(),n("div",Ee,[e("button",{type:"button",class:"w-6 h-6 inline-flex items-center justify-center rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100",title:d.value[s.id]?"Colapsar subniveles":"Expandir subniveles",onClick:a=>oe(s.id)},[d.value[s.id]?(l(),n("span",Be,"v")):(l(),n("span",Ve,">"))],8,Se),e("span",Ne,x(s.name),1),typeof s.children_count<"u"?(l(),n("span",Me,"("+x(s.children_count)+")",1)):u("",!0)]))]),e("div",Re,[e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:"Renombrar",onClick:a=>G(s)},He,8,ze),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded border border-green-500 text-green-600 hover:bg-green-50",title:"Añadir subnivel",onClick:a=>te(s.id)},qe,8,Te),e("button",{onClick:a=>X(s.id),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},Oe,8,Xe)])]),p.value[s.id]?(l(),n("div",Qe,[We,e("div",Je,[k(e("input",{"onUpdate:modelValue":a=>g.value[s.id]=a,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Ej: Baños"},null,8,Ye),[[C,g.value[s.id]]]),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",disabled:A.value[s.id],onClick:a=>T(s.id)},"✔",8,Ze),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:a=>se(s.id)},"✖",8,Ie)]),y.value[s.id]?(l(),n("p",et,x(y.value[s.id]),1)):u("",!0)])):u("",!0),d.value[s.id]?(l(),n("div",tt,[R.value[s.id]?(l(),n("p",st,"Cargando…")):u("",!0),(l(!0),n(F,null,W(E.value[s.id]||[],a=>(l(),n("div",{key:a.id,class:"py-1 flex justify-between items-center"},[e("div",ot,[M.value[a.id]?(l(),n("div",nt,[k(e("input",{"onUpdate:modelValue":_=>b.value[a.id]=_,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,8,lt),[[C,b.value[a.id]]]),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-blue-500 text-white hover:bg-blue-600",title:"Guardar",onClick:_=>q(a.id,s.id)},"✔",8,rt),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100",title:"Cancelar",onClick:_=>$(a.id)},"✖",8,it)])):(l(),n("div",at,x(a.name),1))]),e("div",dt,[e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:"Renombrar",onClick:_=>G(a)},mt,8,ct),e("button",{onClick:_=>X(a.id,s.id),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},yt,8,vt)]),p.value[a.id]?(l(),n("div",_t,[ht,e("div",bt,[k(e("input",{"onUpdate:modelValue":_=>g.value[a.id]=_,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Ej: Accesorios"},null,8,ft),[[C,g.value[a.id]]]),e("button",{type:"button",class:"bg-green-500 text-white font-bold py-1 px-3 rounded hover:bg-green-600",disabled:A.value[a.id],onClick:_=>T(a.id)},"Añadir",8,xt)]),y.value[a.id]?(l(),n("p",pt,x(y.value[a.id]),1)):u("",!0)])):u("",!0)]))),128))])):u("",!0)]))),128))]),e("form",{onSubmit:Q(Z,["prevent"]),class:"mt-6 border-t pt-4"},[wt,e("div",kt,[k(e("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>c(m).name=s),type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Nombre de la nueva subcategoría"},null,512),[[C,c(m).name]]),e("button",{type:"submit",disabled:c(m).processing,class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",title:"Añadir"},"✔",8,Ct),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:I,title:"Cancelar"},"✖")]),c(m).errors.name?(l(),n("p",jt,x(c(m).errors.name),1)):u("",!0)],32)])])])])]),_:1}),w(re,{show:D.value,onClose:N},{default:S(()=>[e("div",At,[$t,Et,e("div",St,[w(de,{onClick:N},{default:S(()=>[J("Cancelar")]),_:1}),w(ce,{class:"ms-3",onClick:ee},{default:S(()=>[J("Sí, eliminar")]),_:1})])])]),_:1},8,["show"]),w(ie,{show:U.value,type:"error",title:"No se puede eliminar",messages:[K.value],"primary-text":"Entendido",onPrimary:o[4]||(o[4]=s=>U.value=!1),onClose:o[5]||(o[5]=s=>U.value=!1)},null,8,["show","messages"])],64))}};export{Dt as default};
