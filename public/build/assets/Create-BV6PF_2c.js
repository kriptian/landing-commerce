import{A as te,r as S,z as oe,w as U,c as le,B as ne,b as d,d as c,e as f,u as n,h as ae,f as D,g as e,s as re,i as b,j as p,v as _,O as ie,k as T,m as z,t as v,F as y,l as w,C as P,n as de}from"./app-oUIW5Gez.js";import{_ as ce}from"./AuthenticatedLayout-lEWx1E9Q.js";import{_ as E}from"./AlertModal-CcpJFjPK.js";import{u as ue,S as me}from"./useSectionTour-DQEvad76.js";import"./Modal-DwpvmuMs.js";const pe=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear producto",-1),_e={class:"py-12"},he={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ge={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},fe={class:"p-6 text-gray-900"},be={class:"mb-4"},ve=e("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1),ye={class:"mb-4"},xe=e("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1),we={class:"p-4 border rounded-md bg-gray-50"},ke={class:"inline-flex items-center gap-2 mb-3 select-none"},Ce=e("span",{class:"font-semibold"},"Controlar inventario",-1),Se={key:0,class:"font-semibold text-gray-800 mb-2"},Ve={key:1,class:"text-xs text-gray-500 mb-4"},Ae={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Oe={for:"quantity",class:"block font-medium text-sm text-gray-700 flex items-center"},Te=["disabled"],$e={key:0,class:"mt-1 text-sm text-red-600"},Me={for:"alert",class:"block font-medium text-sm text-gray-700 flex items-center"},Ue=["disabled"],je={for:"purchase_price",class:"block font-medium text-sm text-gray-700 flex items-center"},Be=e("div",{class:"mt-4 mb-2"},[e("label",{class:"block font-medium text-sm text-gray-700"},"Categorías")],-1),De={class:"space-y-3"},ze=["onUpdate:modelValue","onChange"],Pe=e("option",{value:null},"Seleccione una categoría",-1),Ee=["value"],Ie={key:0,class:"mt-1 text-sm text-red-600"},qe={class:"mb-4"},Ne=e("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"Descripción Corta",-1),He={class:"mb-4"},Le=e("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"Descripción Larga",-1),Fe={class:"mb-4"},Re=e("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1),Qe={class:"mb-4"},Ge=e("label",{for:"gallery_files",class:"block font-medium text-sm text-gray-700"},"Imágenes de la Galería",-1),We=e("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1),Xe={class:"md:col-span-2 mt-6 border-t pt-6"},Ye=e("h3",{class:"text-lg font-medium text-gray-900"},"Variantes del Producto",-1),Je=e("p",{class:"text-sm text-gray-600 mb-4"}," Cada fila representa una combinación única. Si usás inventario, el stock total se suma automáticamente. ",-1),Ke={class:"mb-4 p-4 border rounded-md bg-gray-50"},Ze=e("h4",{class:"font-semibold text-gray-800 mb-2"},"Atributos de variantes",-1),es=e("p",{class:"text-xs text-gray-500 mb-3"},'Ejemplos: Nombre "Color" y Valores "Rojo, Verde, Azul". Podés agregar más filas como "Talla" con "S, M, L".',-1),ss={class:"space-y-2"},ts={class:"md:col-span-2"},os=e("label",{class:"block text-sm font-medium text-gray-700"},"Nombre",-1),ls=["onUpdate:modelValue"],ns={class:"md:col-span-3"},as=e("label",{class:"block text-sm font-medium text-gray-700"},"Valores (separados por coma)",-1),rs=["onUpdate:modelValue"],is={class:"md:col-span-5 flex items-center gap-2"},ds=["onClick","title","aria-label"],cs={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},us=e("path",{d:"M11 11V5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6z"},null,-1),ms=[us],ps={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},_s=e("path",{d:"M5 12a1 1 0 0 1 1-1h12a1 1 0 1 1 0 2H6a1 1 0 0 1-1-1z"},null,-1),hs=[_s],gs=["textContent"],fs={key:0,class:"md:col-span-5 grid grid-cols-1 md:grid-cols-5 gap-3 items-start"},bs={class:"md:col-span-2"},vs=e("label",{class:"block text-sm font-medium text-gray-700"},"Depende de",-1),ys=["onUpdate:modelValue"],xs=e("option",{value:""},"(sin dependencia)",-1),ws=["value","disabled"],ks={key:0,class:"md:col-span-3"},Cs=e("label",{class:"block text-sm font-medium text-gray-700"},"Permitir valores del hijo según el valor del padre",-1),Ss={class:"mt-2 space-y-3"},Vs={class:"text-xs font-semibold text-gray-700 mb-2"},As={class:"flex flex-wrap gap-3"},Os=["checked","onChange"],Ts=e("p",{class:"text-xs text-gray-500 mt-2"},"Si no seleccionas nada para un valor del padre, se permiten todos los valores del hijo.",-1),$s={class:"md:col-span-5 flex items-center gap-4"},Ms=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},[e("path",{d:"M11 11V5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6z"})],-1),Us=[Ms],js=e("span",{class:"text-xs md:hidden"},"Añadir",-1),Bs={class:"flex items-center gap-2"},Ds=["onClick"],zs=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},[e("path",{d:"M7 7h10l-1 12a2 2 0 0 1-2 2H10a2 2 0 0 1-2-2L7 7zm9-3a1 1 0 0 1 1 1v1H7V5a1 1 0 0 1 1-1h8zM9 5V4a3 3 0 0 1 3-3 3 3 0 0 1 3 3v1H9z"})],-1),Ps=[zs],Es=e("span",{class:"text-xs md:hidden"},"Quitar",-1),Is={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},qs=["disabled"],Ns=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M4 4a2 2 0 0 1 2-2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4zm9-1.5V7h4.5L13 2.5z"}),e("path",{d:"M8 13h8v2H8zM8 9h5v2H8z"})],-1),Hs=e("span",null,"Crear",-1),Ls=[Ns,Hs],Fs={key:0,class:"ml-3 text-sm text-red-600"},Rs=2*1024*1024,Js={__name:"Create",props:{categories:Array},setup(I){const q=I,N=te(),V=S(!!N?.props?.flash?.success),k=S(!1),$=S([]),{showTour:H,steps:L,handleTourComplete:F}=ue("products-create"),R=l=>{const t=Array.from(l?.target?.files||[]),r=[],s=[];for(const i of t){if(!(i?.type||"").startsWith("image/")){r.push(`${i.name}: no es una imagen válida.`);continue}if(i.size>Rs){r.push(`${i.name}: supera el límite de 2 MB.`);continue}s.push(i)}if(r.length){$.value=["Problemas con las imágenes seleccionadas:",...r],k.value=!0,l?.target&&(l.target.value=""),o.gallery_files=[];return}o.gallery_files=s},A=S([{options:q.categories,selected:null}]),Q=l=>{A.value.splice(l+1)},G=async l=>{const t=A.value[l].selected;if(Q(l),o.category_id=t,!t)return;const r=await fetch(route("admin.categories.children",t));if(!r.ok)return;const s=await r.json(),i=Array.isArray(s.data)?s.data:[];i.length>0&&A.value.push({options:i,selected:null})},o=oe({name:"",price:"",purchase_price:null,retail_price:null,track_inventory:!0,quantity:0,alert:null,category_id:null,short_description:"",long_description:"",specifications:"",gallery_files:[],variants:[],variant_attributes:[]});U(()=>o.track_inventory,l=>{l&&(o.retail_price=o.price)}),U(()=>o.price,l=>{o.track_inventory&&(o.retail_price=l)});const x=S([{name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}}]),W=()=>{x.value.push({name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}})},X=l=>{x.value.splice(l,1)},O=l=>String(l||"").split(",").map(t=>t.trim()).filter(Boolean);function Y(l,t,r){return(l.rulesSelected&&Array.isArray(l.rulesSelected[t])?l.rulesSelected[t]:[]).includes(r)}function J(l,t,r,s){const i=!!s?.target?.checked;l.rulesSelected||(l.rulesSelected={});const a=Array.isArray(l.rulesSelected[t])?[...l.rulesSelected[t]]:[],m=a.indexOf(r);i&&m===-1&&a.push(r),!i&&m!==-1&&a.splice(m,1),l.rulesSelected[t]=a}function K(l){l.__showDependency=!l.__showDependency,l.__showDependency||(l.dependsOn="",l.rulesSelected={},l.rules={})}const Z=le(()=>o.variants.length===0?Number(o.quantity)||0:o.variants.reduce((l,t)=>l+(Number(t.stock)||0),0));U(Z,l=>{o.variants.length>0&&(o.quantity=l)});const ee=()=>{try{const l=x.value.map(t=>({name:String(t.name||"").trim(),values:O(t.valuesText),dependsOn:String(t.dependsOn||"").trim(),rules:t.rules||{},rulesSelected:t.rulesSelected||{}})).filter(t=>t.name&&t.values.length>0);if(o.variant_attributes=l,l.length>0){let i=function(u){s.has(u.name)||(u.dependsOn&&t[u.dependsOn]&&i(t[u.dependsOn]),s.add(u.name),r.push(u))},m=function(u,h){if(u===r.length){a.push({...h});return}const g=r[u];let j=g.values;if(g.dependsOn){const C=h[g.dependsOn];if(C!=null){const M=g.rulesSelected?.[C]??g.rules?.[C]??[],B=Array.isArray(M)?M:O(M);B.length>0&&(j=g.values.filter(se=>B.includes(se)))}}for(const C of j)h[g.name]=C,m(u+1,h);delete h[g.name]};const t=Object.fromEntries(l.map(u=>[u.name,u])),r=[],s=new Set;l.forEach(i);const a=[];m(0,{}),o.variants=a.map(u=>({options_text:r.map(h=>`${h.name}:${u[h.name]}`).join(", "),price:"",purchase_price:null,stock:0,alert:null}))}}catch{}o.post(route("admin.products.store"),{preserveScroll:!0,onError:async()=>{await de();const l=[];for(const[s,i]of Object.entries(o.errors))s.startsWith("gallery_files.")&&String(i).includes("The gallery files.")?l.push("Una o más imágenes superan el tamaño máximo permitido (2 MB) o no son válidas."):s.startsWith("new_gallery_files.")?l.push("Una o más imágenes nuevas superan el tamaño máximo permitido (2 MB) o no son válidas."):l.push(String(i));$.value=l,k.value=l.length>0;const t=Object.keys(o.errors)[0],r=document.getElementById(t);r&&typeof r.scrollIntoView=="function"&&(r.scrollIntoView({behavior:"smooth",block:"center"}),r.focus?.())},onSuccess:()=>{V.value=!0,o.reset()}})};return(l,t)=>{const r=ne("InfoTip");return c(),d(y,null,[f(n(ae),{title:"Crear Producto"}),f(ce,null,{header:D(()=>[pe]),default:D(()=>[e("div",_e,[e("div",he,[e("div",ge,[e("div",fe,[e("form",{onSubmit:re(ee,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,[e("div",be,[ve,p(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=s=>n(o).name=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,n(o).name]])]),e("div",ye,[xe,p(e("input",{id:"price","onUpdate:modelValue":t[1]||(t[1]=s=>n(o).price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,n(o).price]])]),e("div",we,[e("label",ke,[p(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=s=>n(o).track_inventory=s),class:"rounded"},null,512),[[ie,n(o).track_inventory]]),Ce]),n(o).track_inventory?(c(),d("h4",Se,"Inventario y Precios")):b("",!0),n(o).track_inventory?(c(),d("p",Ve," Si creas variantes, estos totales se calcularán solos. ")):b("",!0),n(o).track_inventory?(c(),d("div",Ae,[e("div",null,[e("label",Oe,[T("Inventario (Total) "),f(r,{class:"ml-1 md:hidden",text:"Stock si no hay variantes. Con variantes, se suma automáticamente."})]),p(e("input",{id:"quantity","onUpdate:modelValue":t[3]||(t[3]=s=>n(o).quantity=s),type:"number",class:z(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(o).variants.length>0}]),disabled:n(o).track_inventory===!1||n(o).variants.length>0,title:"Stock si no hay variantes. Con variantes, se suma automáticamente."},null,10,Te),[[_,n(o).quantity]]),n(o).errors.quantity?(c(),d("p",$e,v(n(o).errors.quantity),1)):b("",!0)]),e("div",null,[e("label",Me,[T("Alerta (Opcional) "),f(r,{class:"ml-1 md:hidden",text:"Se considera bajo stock cuando cantidad ≤ alerta."})]),p(e("input",{id:"alert","onUpdate:modelValue":t[4]||(t[4]=s=>n(o).alert=s),type:"number",class:z(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(o).variants.length>0&&n(o).track_inventory}]),disabled:n(o).variants.length>0&&n(o).track_inventory,title:"Se considera bajo stock cuando cantidad ≤ alerta."},null,10,Ue),[[_,n(o).alert]])]),e("div",null,[e("label",je,[T("Precio de compra "),f(r,{class:"ml-1 md:hidden",text:"Costo de adquisición del producto."})]),p(e("input",{id:"purchase_price","onUpdate:modelValue":t[5]||(t[5]=s=>n(o).purchase_price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[_,n(o).purchase_price]])])])):b("",!0)]),Be,e("div",De,[(c(!0),d(y,null,w(A.value,(s,i)=>(c(),d("div",{key:i,class:"mb-1"},[p(e("select",{class:"block w-full rounded-md shadow-sm border-gray-300","onUpdate:modelValue":a=>s.selected=a,onChange:a=>G(i)},[Pe,(c(!0),d(y,null,w(s.options,a=>(c(),d("option",{key:a.id,value:a.id},v(a.name),9,Ee))),128))],40,ze),[[P,s.selected]])]))),128))]),n(o).errors.category_id?(c(),d("p",Ie,v(n(o).errors.category_id),1)):b("",!0)]),e("div",null,[e("div",qe,[Ne,p(e("textarea",{id:"short_description","onUpdate:modelValue":t[6]||(t[6]=s=>n(o).short_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[_,n(o).short_description]])]),e("div",He,[Le,p(e("textarea",{id:"long_description","onUpdate:modelValue":t[7]||(t[7]=s=>n(o).long_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[_,n(o).long_description]])]),e("div",Fe,[Re,p(e("input",{id:"specifications","onUpdate:modelValue":t[8]||(t[8]=s=>n(o).specifications=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"Alto: 2.30m,Ancho: 1.20m,..."},null,512),[[_,n(o).specifications]])]),e("div",Qe,[Ge,e("input",{id:"gallery_files",onInput:t[9]||(t[9]=s=>R(s)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),We])]),e("div",Xe,[Ye,Je,e("div",Ke,[Ze,es,e("div",ss,[(c(!0),d(y,null,w(x.value,(s,i)=>(c(),d("div",{key:`attr-${i}`,class:"grid grid-cols-1 md:grid-cols-5 gap-3 items-center"},[e("div",ts,[os,p(e("input",{"onUpdate:modelValue":a=>s.name=a,type:"text",placeholder:"Color",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,ls),[[_,s.name]])]),e("div",ns,[as,p(e("input",{"onUpdate:modelValue":a=>s.valuesText=a,type:"text",placeholder:"Rojo, Verde, Azul",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,rs),[[_,s.valuesText]])]),e("div",is,[e("button",{type:"button",class:"inline-flex items-center justify-center w-8 h-8 rounded-full border border-blue-200 text-blue-600 hover:bg-blue-50 hover:border-blue-300",onClick:a=>K(s),title:s.__showDependency?"Ocultar dependencia":"Configurar dependencia","aria-label":s.__showDependency?"Ocultar dependencia":"Configurar dependencia"},[s.__showDependency?(c(),d("svg",ps,hs)):(c(),d("svg",cs,ms))],8,ds),e("span",{class:"text-xs text-blue-600 md:hidden",textContent:v(s.__showDependency?"Ocultar":"Depend.")},null,8,gs)]),s.__showDependency?(c(),d("div",fs,[e("div",bs,[vs,p(e("select",{"onUpdate:modelValue":a=>s.dependsOn=a,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},[xs,(c(!0),d(y,null,w(x.value,(a,m)=>(c(),d("option",{key:`dep-${i}-${m}`,value:a.name,disabled:a===s||!a.name},v(a.name||"(sin nombre)"),9,ws))),128))],8,ys),[[P,s.dependsOn]])]),s.dependsOn?(c(),d("div",ks,[Cs,e("div",Ss,[(c(!0),d(y,null,w(O(x.value.find(a=>a.name===s.dependsOn)?.valuesText||""),a=>(c(),d("div",{key:`pv-${i}-${a}`,class:"border rounded p-2"},[e("div",Vs,[T(v(s.dependsOn)+" = ",1),e("strong",null,v(a),1)]),e("div",As,[(c(!0),d(y,null,w(O(s.valuesText),m=>(c(),d("label",{key:`cv-${i}-${a}-${m}`,class:"inline-flex items-center gap-1 text-sm"},[e("input",{type:"checkbox",checked:Y(s,a,m),onChange:u=>J(s,a,m,u),class:"rounded"},null,40,Os),e("span",null,v(m),1)]))),128))])]))),128))]),Ts])):b("",!0)])):b("",!0),e("div",$s,[e("div",{class:"flex items-center gap-2"},[e("button",{type:"button",class:"inline-flex items-center justify-center w-8 h-8 rounded-full border border-blue-200 text-blue-600 hover:bg-blue-50 hover:border-blue-300",onClick:W,title:"Añadir atributo","aria-label":"Añadir atributo"},Us),js]),e("div",Bs,[e("button",{type:"button",class:"inline-flex items-center justify-center w-8 h-8 rounded-full border border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300",onClick:a=>X(i),title:"Quitar atributo","aria-label":"Quitar atributo"},Ps,8,Ds),Es])])]))),128))])])]),e("div",Is,[e("button",{type:"submit",disabled:n(o).processing,class:"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow"},Ls,8,qs),Object.keys(n(o).errors).length?(c(),d("span",Fs,"Por favor corrige los campos marcados.")):b("",!0)])],32)])])])])]),_:1}),f(E,{show:V.value,type:"success",title:"¡Producto creado con éxito!","primary-text":"Entendido",onPrimary:t[10]||(t[10]=s=>V.value=!1),onClose:t[11]||(t[11]=s=>V.value=!1)},null,8,["show"]),f(E,{show:k.value,type:"error",title:"No pudimos guardar el producto",message:"Revisá los siguientes puntos:",messages:$.value,"primary-text":"Entendido",onPrimary:t[12]||(t[12]=s=>k.value=!1),onClose:t[13]||(t[13]=s=>k.value=!1)},null,8,["show","messages"]),f(me,{show:n(H),section:"products-create",steps:n(L),onComplete:n(F)},null,8,["show","steps","onComplete"])],64)}}};export{Js as default};
