import{p as O,r,C as ne,a,o as l,b as _,u,h as ae,d as S,e as t,s as Q,g as k,v as C,f as c,F,i as W,t as h,m as J,K as L,j as H}from"./app-Mfh2j4V1.js";import{_ as le}from"./AuthenticatedLayout-BU8UzRRX.js";import{_ as re}from"./Modal-CMAqVAiJ.js";import{_ as ie}from"./AlertModal-CmPnyBWU.js";import{_ as de}from"./SecondaryButton-DEsSyKrS.js";import{D as ue}from"./DangerButton-CAA7cS08.js";const ce={class:"font-semibold text-xl text-gray-800 leading-tight"},me={class:"py-12"},ve={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},ge={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ye={class:"p-6 text-gray-900"},be=["disabled"],fe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},xe={class:"p-6 text-gray-900"},pe={class:"flex items-center justify-between"},he={class:"flex items-center gap-2"},we={class:"mt-4 border rounded-lg divide-y"},_e={key:0,class:"text-sm text-gray-500"},ke={key:1,class:"text-sm text-gray-500"},Ce={class:"flex justify-between items-center"},je={class:"flex-1"},Ae={key:0,class:"flex items-center gap-2"},$e=["title","onClick"],Ee={key:0},Se={key:1},Ve={class:"font-medium"},Be={key:0,class:"text-xs bg-gray-100 text-gray-700 rounded px-2 py-0.5 align-middle"},Ne={key:1,class:"flex items-center gap-2"},Me=["onUpdate:modelValue"],Ue=["onClick"],Le=["onClick"],De={class:"flex items-center gap-2"},Pe=["onClick"],Re=["onClick"],ze=["onClick"],Fe={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2"},He={class:"flex items-center gap-2"},Te=["onUpdate:modelValue"],Ge=["disabled","onClick"],qe=["onClick"],Xe={key:0,class:"text-xs text-red-600 mt-1"},Ke={key:1,class:"mt-2 pl-4 border-l"},Oe={key:0,class:"text-sm text-gray-500"},Qe={class:"flex-1"},We={key:0},Je={key:1,class:"flex items-center gap-2"},Ye=["onUpdate:modelValue"],Ze=["onClick"],Ie=["onClick"],et={class:"flex items-center gap-2"},tt=["onClick"],st=["onClick"],ot={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2 w-full"},nt={class:"flex items-center gap-2"},at=["onUpdate:modelValue"],lt=["disabled","onClick"],rt={key:0,class:"text-xs text-red-600 mt-1"},it={class:"mt-2 flex items-center gap-2"},dt=["disabled"],ut={key:0,class:"text-sm text-red-600 mt-2"},ct={class:"p-6"},mt={class:"mt-6 flex justify-end"},pt={__name:"Edit",props:{category:Object},setup(V){const i=V,B=O({name:i.category.name}),m=O({name:""}),Y=()=>{B.put(route("admin.categories.update",{category:i.category.id}))},Z=()=>{const s=L("admin.categories.storeSubcategory",{parentCategory:i.category.id},`/admin/categories/${i.category.id}/subcategories`);m.post(s,{onSuccess:()=>{m.reset(),v()},preserveScroll:!0})},I=()=>{m.name=""},D=r(!1),j=r(null),N=()=>{D.value=!1,j.value=null},ee=()=>{j.value&&H.delete(route("admin.categories.destroy",{category:j.value}),{preserveScroll:!0,onSuccess:()=>{const s=j.value;N();const e=z.value;s&&(delete d.value[s],delete w.value[s],delete g.value[s],delete y.value[s],delete E.value[s]),e&&e!==i.category.id?p(e):v(),v()},onError:s=>{const e=z.value;e&&e!==i.category.id?p(e):v(),K.value=s&&(s.delete||s.message)||"Existen productos asociados a esta categoría y no se puede borrar.",U.value=!0},onFinish:()=>N()})},P=r(!1),f=r(i.category.children||[]),v=async()=>{try{P.value=!0;const s=L("admin.categories.children",{category:i.category.id},`/admin/categories/${i.category.id}/children`),e=await fetch(s);if(!e.ok)return;const o=await e.json();f.value=Array.isArray(o.data)?o.data:[]}finally{P.value=!1}};ne(()=>{v()});const w=r({}),g=r({}),A=r({}),y=r({}),te=s=>{w.value[s]=!w.value[s]},T=s=>{const e=(g.value[s]||"").trim();if(!e)return;A.value[s]=!0,y.value[s]=null;const o=L("admin.categories.storeSubcategory",{parentCategory:s},`/admin/categories/${s}/subcategories`);H.post(o,{name:e},{preserveScroll:!0,onSuccess:()=>{g.value[s]="",A.value[s]=!1,d.value[s]=!0,p(s),v()},onError:()=>{A.value[s]=!1,y.value[s]="No se pudo crear el subnivel"}})},se=s=>{g.value[s]="",y.value[s]=null,w.value[s]=!1},M=r({}),x=r({}),G=s=>{M.value[s.id]=!0,x.value[s.id]=s.name},$=s=>{M.value[s]=!1,x.value[s]=""},q=(s,e=null)=>{const o=(x.value[s]||"").trim();if(!o)return;const n=route("admin.categories.update",{category:s});if(window.axios){window.axios.post(n,{name:o,_method:"PUT"},{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(()=>{$(s),e&&e!==i.category.id?p(e):v()}).catch(()=>$(s));return}H.put(n,{name:o},{preserveScroll:!0,onSuccess:()=>{$(s),e&&e!==i.category.id?p(e):v()}})},d=r({}),R=r({}),E=r({}),p=async s=>{R.value[s]=!0;try{const e=L("admin.categories.children",{category:s},`/admin/categories/${s}/children`),o=await fetch(e);if(!o.ok)return;const n=await o.json();E.value[s]=Array.isArray(n.data)?n.data:[]}finally{R.value[s]=!1}},oe=async s=>{const e=!d.value[s];d.value[s]=e,e&&!Array.isArray(E.value[s])&&await p(s)},z=r(null),X=(s,e=null)=>{j.value=s,z.value=e,D.value=!0},U=r(!1),K=r("");return(s,e)=>(l(),a(F,null,[_(u(ae),{title:`Editar: ${V.category.name}`},null,8,["title"]),_(le,null,{header:S(()=>[t("h2",ce," Editando Categoría: "+h(V.category.name),1)]),default:S(()=>[t("div",me,[t("div",ve,[t("div",ge,[t("div",ye,[e[6]||(e[6]=t("h3",{class:"text-lg font-medium"},"Editar Nombre",-1)),t("form",{onSubmit:Q(Y,["prevent"]),class:"mt-4 flex items-center gap-4"},[k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>u(B).name=o),type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,512),[[C,u(B).name]]),t("button",{type:"submit",disabled:u(B).processing,class:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700"}," Actualizar ",8,be)],32)])]),t("div",fe,[t("div",xe,[t("div",pe,[e[7]||(e[7]=t("h3",{class:"text-lg font-medium"},"Gestionar Subcategorías",-1)),t("div",he,[t("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Expandir todo",onClick:e[1]||(e[1]=()=>{f.value.forEach(o=>d.value[o.id]=!0),f.value.forEach(o=>{Array.isArray(E.value[o.id])||p(o.id)})})},"+ "),t("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Colapsar todo",onClick:e[2]||(e[2]=()=>{f.value.forEach(o=>d.value[o.id]=!1)})},"− ")])]),t("div",we,[P.value?(l(),a("p",_e,"Cargando subcategorías…")):!f.value||f.value.length===0?(l(),a("p",ke," Esta categoría aún no tiene subcategorías. ")):c("",!0),(l(!0),a(F,null,W(f.value,o=>(l(),a("div",{key:o.id,class:"p-3 hover:bg-gray-50"},[t("div",Ce,[t("div",je,[M.value[o.id]?(l(),a("div",Ne,[k(t("input",{"onUpdate:modelValue":n=>x.value[o.id]=n,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,8,Me),[[C,x.value[o.id]]]),t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-blue-500 text-white hover:bg-blue-600",title:"Guardar",onClick:n=>q(o.id,V.category.id)},"✔",8,Ue),t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100",title:"Cancelar",onClick:n=>$(o.id)},"✖",8,Le)])):(l(),a("div",Ae,[t("button",{type:"button",class:"w-6 h-6 inline-flex items-center justify-center rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100",title:d.value[o.id]?"Colapsar subniveles":"Expandir subniveles",onClick:n=>oe(o.id)},[d.value[o.id]?(l(),a("span",Se,"v")):(l(),a("span",Ee,">"))],8,$e),t("span",Ve,h(o.name),1),typeof o.children_count<"u"?(l(),a("span",Be,"("+h(o.children_count)+")",1)):c("",!0)]))]),t("div",De,[t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:"Renombrar",onClick:n=>G(o)},[...e[8]||(e[8]=[t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M16.862 3.487a2.25 2.25 0 113.182 3.182L9.428 17.284a3.75 3.75 0 01-1.582.992l-2.685.805a.75.75 0 01-.93-.93l.805-2.685a3.75 3.75 0 01.992-1.582L16.862 3.487z"}),t("path",{d:"M15.75 4.5l3.75 3.75"})],-1)])],8,Pe),t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded border border-green-500 text-green-600 hover:bg-green-50",title:"Añadir subnivel",onClick:n=>te(o.id)},[...e[9]||(e[9]=[t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("rect",{x:"4",y:"3",width:"11",height:"15",rx:"2",ry:"2","stroke-width":"1.5"}),t("circle",{cx:"18",cy:"18",r:"3","stroke-width":"1.5"}),t("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M18 16.5v3M16.5 18h3"})],-1)])],8,Re),t("button",{onClick:n=>X(o.id),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},[...e[10]||(e[10]=[t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1)])],8,ze)])]),w.value[o.id]?(l(),a("div",Fe,[e[11]||(e[11]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Añadir Nueva Subcategoría",-1)),t("div",He,[k(t("input",{"onUpdate:modelValue":n=>g.value[o.id]=n,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Ej: Baños"},null,8,Te),[[C,g.value[o.id]]]),t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",disabled:A.value[o.id],onClick:n=>T(o.id)},"✔",8,Ge),t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:n=>se(o.id)},"✖",8,qe)]),y.value[o.id]?(l(),a("p",Xe,h(y.value[o.id]),1)):c("",!0)])):c("",!0),d.value[o.id]?(l(),a("div",Ke,[R.value[o.id]?(l(),a("p",Oe,"Cargando…")):c("",!0),(l(!0),a(F,null,W(E.value[o.id]||[],n=>(l(),a("div",{key:n.id,class:"py-1 flex justify-between items-center"},[t("div",Qe,[M.value[n.id]?(l(),a("div",Je,[k(t("input",{"onUpdate:modelValue":b=>x.value[n.id]=b,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,8,Ye),[[C,x.value[n.id]]]),t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-blue-500 text-white hover:bg-blue-600",title:"Guardar",onClick:b=>q(n.id,o.id)},"✔",8,Ze),t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100",title:"Cancelar",onClick:b=>$(n.id)},"✖",8,Ie)])):(l(),a("div",We,h(n.name),1))]),t("div",et,[t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:"Renombrar",onClick:b=>G(n)},[...e[12]||(e[12]=[t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M16.862 3.487a2.25 2.25 0 113.182 3.182L9.428 17.284a3.75 3.75 0 01-1.582.992l-2.685.805a.75.75 0 01-.93-.93l.805-2.685a3.75 3.75 0 01.992-1.582L16.862 3.487z"}),t("path",{d:"M15.75 4.5l3.75 3.75"})],-1)])],8,tt),t("button",{onClick:b=>X(n.id,o.id),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},[...e[13]||(e[13]=[t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1)])],8,st)]),w.value[n.id]?(l(),a("div",ot,[e[14]||(e[14]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Nombre del subnivel",-1)),t("div",nt,[k(t("input",{"onUpdate:modelValue":b=>g.value[n.id]=b,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Ej: Accesorios"},null,8,at),[[C,g.value[n.id]]]),t("button",{type:"button",class:"bg-green-500 text-white font-bold py-1 px-3 rounded hover:bg-green-600",disabled:A.value[n.id],onClick:b=>T(n.id)},"Añadir",8,lt)]),y.value[n.id]?(l(),a("p",rt,h(y.value[n.id]),1)):c("",!0)])):c("",!0)]))),128))])):c("",!0)]))),128))]),t("form",{onSubmit:Q(Z,["prevent"]),class:"mt-6 border-t pt-4"},[e[15]||(e[15]=t("label",{class:"block font-medium text-sm text-gray-700"},"Añadir Nueva Subcategoría",-1)),t("div",it,[k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>u(m).name=o),type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Nombre de la nueva subcategoría"},null,512),[[C,u(m).name]]),t("button",{type:"submit",disabled:u(m).processing,class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",title:"Añadir"},"✔",8,dt),t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:I,title:"Cancelar"},"✖")]),u(m).errors.name?(l(),a("p",ut,h(u(m).errors.name),1)):c("",!0)],32)])])])])]),_:1}),_(re,{show:D.value,onClose:N},{default:S(()=>[t("div",ct,[e[18]||(e[18]=t("h2",{class:"text-lg font-medium text-gray-900"}," ¿Querés eliminar esta subcategoría? ",-1)),e[19]||(e[19]=t("p",{class:"mt-1 text-sm text-gray-600"}," Esta acción es irreversible y removerá la subcategoría seleccionada. ",-1)),t("div",mt,[_(de,{onClick:N},{default:S(()=>[...e[16]||(e[16]=[J("Cancelar",-1)])]),_:1}),_(ue,{class:"ms-3",onClick:ee},{default:S(()=>[...e[17]||(e[17]=[J("Sí, eliminar",-1)])]),_:1})])])]),_:1},8,["show"]),_(ie,{show:U.value,type:"error",title:"No se puede eliminar",messages:[K.value],"primary-text":"Entendido",onPrimary:e[4]||(e[4]=o=>U.value=!1),onClose:e[5]||(e[5]=o=>U.value=!1)},null,8,["show","messages"])],64))}};export{pt as default};
