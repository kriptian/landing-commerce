import{L as N,r as y,p as O,c as w,w as B,a as n,o as i,b as h,u as o,h as F,d as V,e,s as T,f as u,g as c,v as m,M as D,n as x,t as p,F as f,i as k,x as G,k as L}from"./app-Do6XE_jz.js";import{_ as R}from"./AuthenticatedLayout-DGGfEP4p.js";import{_ as U}from"./AlertModal-BnFrfvfq.js";import"./Modal-CAijhAQw.js";const W=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear Nuevo Producto",-1),z={class:"py-12"},Q={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},X={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Y={class:"p-6 text-gray-900"},H={class:"mb-4"},J=e("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1),K={class:"mb-4"},Z=e("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1),ee={class:"p-4 border rounded-md bg-gray-50"},te={class:"inline-flex items-center gap-2 mb-3 select-none"},se=e("span",{class:"font-semibold"},"Controlar inventario",-1),oe=e("h4",{class:"font-semibold text-gray-800 mb-2"},"Inventario General",-1),le=e("p",{class:"text-xs text-gray-500 mb-4"}," Si creas variantes, estos totales se calcularán solos. ",-1),ae={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},re=e("label",{for:"quantity",class:"block font-medium text-sm text-gray-700"},"Inventario (Total)",-1),ne=["disabled"],ie={key:0,class:"mt-1 text-sm text-red-600"},de={key:1,class:"text-xs text-gray-500 mt-1"},ce=e("label",{for:"minimum_stock",class:"block font-medium text-sm text-gray-700"},"Mínimo en Stock",-1),me=["disabled"],ue={key:0,class:"mt-1 text-sm text-red-600"},pe={key:1,class:"text-xs text-gray-500 mt-1"},_e=e("label",{for:"alert",class:"block font-medium text-sm text-gray-700"},"Alerta (Opcional)",-1),ge=["disabled"],be=e("p",{class:"text-xs text-gray-500 mt-1"},"Para producto único. Con variantes, usá las alertas por variante.",-1),ye=e("div",{class:"mt-4 mb-2"},[e("label",{class:"block font-medium text-sm text-gray-700"},"Categorías")],-1),he={class:"space-y-3"},fe=["onUpdate:modelValue","onChange"],ve=e("option",{value:null},"Seleccione una categoría",-1),xe=["value"],ke={key:0,class:"mt-1 text-sm text-red-600"},we={class:"mb-4"},Ve=e("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"Descripción Corta",-1),Ue={class:"mb-4"},Ce=e("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"Descripción Larga",-1),Se={class:"mb-4"},Ae=e("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1),Me={class:"mb-4"},Pe=e("label",{for:"gallery_files",class:"block font-medium text-sm text-gray-700"},"Imágenes de la Galería",-1),$e=e("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1),je={class:"md:col-span-2 mt-6 border-t pt-6"},qe=e("h3",{class:"text-lg font-medium text-gray-900"},"Variantes del Producto",-1),Ee=e("p",{class:"text-sm text-gray-600 mb-4"}," Añadí cada combinación como una variante separada. ",-1),Ie={class:"hidden md:grid grid-cols-6 gap-4 mb-2 text-sm font-medium text-gray-600"},Ne=e("div",{class:"col-span-2"},"Opciones (ej: Color:Rojo)",-1),Oe=e("div",null,"Precio (Opcional)",-1),Be={key:0},Fe={key:1},Te={key:2},De={class:"md:col-span-2"},Ge=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Opciones",-1),Le=["onUpdate:modelValue"],Re=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Precio (Opcional)",-1),We=["onUpdate:modelValue"],ze={key:0},Qe=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Actual",-1),Xe=["onUpdate:modelValue"],Ye={key:0,class:"mt-1 text-sm text-red-600"},He={key:1},Je=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Mínimo",-1),Ke=["onUpdate:modelValue"],Ze={key:0,class:"mt-1 text-sm text-red-600"},et={key:2},tt=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Alerta (Opcional)",-1),st=["onUpdate:modelValue"],ot=["onClick"],lt={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},at=["disabled"],rt={key:0,class:"ml-3 text-sm text-red-600"},nt=2*1024*1024,pt={__name:"Create",props:{categories:Array},setup(C){const S=C,A=N(),g=y(!!A?.props?.flash?.success),_=y(!1),v=y([]),M=r=>{const l=Array.from(r?.target?.files||[]),s=[],d=[];for(const a of l){if(!(a?.type||"").startsWith("image/")){s.push(`${a.name}: no es una imagen válida.`);continue}if(a.size>nt){s.push(`${a.name}: supera el límite de 2 MB.`);continue}d.push(a)}if(s.length){v.value=["Problemas con las imágenes seleccionadas:",...s],_.value=!0,r?.target&&(r.target.value=""),t.gallery_files=[];return}t.gallery_files=d},b=y([{options:S.categories,selected:null}]),P=r=>{b.value.splice(r+1)},$=async r=>{const l=b.value[r].selected;if(P(r),t.category_id=l,!l)return;const s=await fetch(route("admin.categories.children",l));if(!s.ok)return;const d=await s.json(),a=Array.isArray(d.data)?d.data:[];a.length>0&&b.value.push({options:a,selected:null})},t=O({name:"",price:"",track_inventory:!0,quantity:0,minimum_stock:0,alert:null,category_id:null,short_description:"",long_description:"",specifications:"",gallery_files:[],variants:[]}),j=()=>{t.variants.push({options_text:"",price:"",stock:0,minimum_stock:1,alert:null})},q=r=>{t.variants.splice(r,1)},E=w(()=>t.variants.length===0?Number(t.quantity)||0:t.variants.reduce((r,l)=>r+(Number(l.stock)||0),0));B(E,r=>{t.variants.length>0&&(t.quantity=r)}),w(()=>t.variants.length===0?Number(t.minimum_stock)||0:t.variants.reduce((r,l)=>r+(Number(l.minimum_stock)||0),0));const I=()=>{t.post(route("admin.products.store"),{preserveScroll:!0,onError:async()=>{await L();const r=[];for(const[d,a]of Object.entries(t.errors))d.startsWith("gallery_files.")&&String(a).includes("The gallery files.")?r.push("Una o más imágenes superan el tamaño máximo permitido (2 MB) o no son válidas."):d.startsWith("new_gallery_files.")?r.push("Una o más imágenes nuevas superan el tamaño máximo permitido (2 MB) o no son válidas."):r.push(String(a));v.value=r,_.value=r.length>0;const l=Object.keys(t.errors)[0],s=document.getElementById(l);s&&typeof s.scrollIntoView=="function"&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.focus?.())},onSuccess:()=>{g.value=!0,t.reset()}})};return(r,l)=>(i(),n(f,null,[h(o(F),{title:"Crear Producto"}),h(R,null,{header:V(()=>[W]),default:V(()=>[e("div",z,[e("div",Q,[e("div",X,[e("div",Y,[e("form",{onSubmit:T(I,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,[e("div",H,[J,c(e("input",{id:"name","onUpdate:modelValue":l[0]||(l[0]=s=>o(t).name=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[m,o(t).name]])]),e("div",K,[Z,c(e("input",{id:"price","onUpdate:modelValue":l[1]||(l[1]=s=>o(t).price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[m,o(t).price]])]),e("div",ee,[e("label",te,[c(e("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=s=>o(t).track_inventory=s),class:"rounded"},null,512),[[D,o(t).track_inventory]]),se]),oe,le,o(t).track_inventory&&o(t).variants.length===0?(i(),n("div",ae,[e("div",null,[re,c(e("input",{id:"quantity","onUpdate:modelValue":l[3]||(l[3]=s=>o(t).quantity=s),type:"number",class:x(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":o(t).variants.length>0}]),disabled:o(t).variants.length>0},null,10,ne),[[m,o(t).quantity]]),o(t).errors.quantity?(i(),n("p",ie,p(o(t).errors.quantity),1)):(i(),n("p",de,"Stock si no hay variantes."))]),e("div",null,[ce,c(e("input",{id:"minimum_stock","onUpdate:modelValue":l[4]||(l[4]=s=>o(t).minimum_stock=s),type:"number",class:x(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":o(t).variants.length>0}]),disabled:o(t).variants.length>0},null,10,me),[[m,o(t).minimum_stock]]),o(t).errors.minimum_stock?(i(),n("p",ue,p(o(t).errors.minimum_stock),1)):(i(),n("p",pe,"Alerta de bajo stock (general)."))]),e("div",null,[_e,c(e("input",{id:"alert","onUpdate:modelValue":l[5]||(l[5]=s=>o(t).alert=s),type:"number",class:x(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":o(t).variants.length>0}]),disabled:o(t).variants.length>0},null,10,ge),[[m,o(t).alert]]),be])])):u("",!0)]),ye,e("div",he,[(i(!0),n(f,null,k(b.value,(s,d)=>(i(),n("div",{key:d,class:"mb-1"},[c(e("select",{class:"block w-full rounded-md shadow-sm border-gray-300","onUpdate:modelValue":a=>s.selected=a,onChange:a=>$(d)},[ve,(i(!0),n(f,null,k(s.options,a=>(i(),n("option",{key:a.id,value:a.id},p(a.name),9,xe))),128))],40,fe),[[G,s.selected]])]))),128))]),o(t).errors.category_id?(i(),n("p",ke,p(o(t).errors.category_id),1)):u("",!0)]),e("div",null,[e("div",we,[Ve,c(e("textarea",{id:"short_description","onUpdate:modelValue":l[6]||(l[6]=s=>o(t).short_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[m,o(t).short_description]])]),e("div",Ue,[Ce,c(e("textarea",{id:"long_description","onUpdate:modelValue":l[7]||(l[7]=s=>o(t).long_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[m,o(t).long_description]])]),e("div",Se,[Ae,c(e("input",{id:"specifications","onUpdate:modelValue":l[8]||(l[8]=s=>o(t).specifications=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"Alto: 2.30m,Ancho: 1.20m,..."},null,512),[[m,o(t).specifications]])]),e("div",Me,[Pe,e("input",{id:"gallery_files",onInput:l[9]||(l[9]=s=>M(s)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),$e])]),e("div",je,[qe,Ee,e("div",Ie,[Ne,Oe,o(t).track_inventory?(i(),n("div",Be,"Stock Actual")):u("",!0),o(t).track_inventory?(i(),n("div",Fe,"Stock Mínimo")):u("",!0),o(t).track_inventory?(i(),n("div",Te,"Alerta (Opcional)")):u("",!0)]),(i(!0),n(f,null,k(o(t).variants,(s,d)=>(i(),n("div",{key:d,class:"grid grid-cols-1 md:grid-cols-6 gap-4 items-center mb-2"},[e("div",De,[Ge,c(e("input",{type:"text","onUpdate:modelValue":a=>s.options_text=a,placeholder:"Color:Rojo, Talla:M",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Le),[[m,s.options_text]])]),e("div",null,[Re,c(e("input",{type:"number",step:"0.01","onUpdate:modelValue":a=>s.price=a,placeholder:"Usa precio principal",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,We),[[m,s.price]])]),o(t).track_inventory?(i(),n("div",ze,[Qe,c(e("input",{type:"number","onUpdate:modelValue":a=>s.stock=a,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Xe),[[m,s.stock]]),o(t).errors[`variants.${d}.stock`]?(i(),n("p",Ye,p(o(t).errors[`variants.${d}.stock`]),1)):u("",!0)])):u("",!0),o(t).track_inventory?(i(),n("div",He,[Je,c(e("input",{type:"number","onUpdate:modelValue":a=>s.minimum_stock=a,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Ke),[[m,s.minimum_stock]]),o(t).errors[`variants.${d}.minimum_stock`]?(i(),n("p",Ze,p(o(t).errors[`variants.${d}.minimum_stock`]),1)):u("",!0)])):u("",!0),o(t).track_inventory?(i(),n("div",et,[tt,c(e("input",{type:"number","onUpdate:modelValue":a=>s.alert=a,placeholder:"Ej: 5",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,st),[[m,s.alert]])])):u("",!0),e("button",{onClick:a=>q(d),type:"button",class:"text-red-600 hover:text-red-800 text-sm self-end pb-2 md:pb-0"}," Quitar ",8,ot)]))),128)),e("button",{onClick:j,type:"button",class:"mt-4 text-sm font-medium text-blue-600 hover:text-blue-800"}," + Añadir Variante ")]),e("div",lt,[e("button",{type:"submit",disabled:o(t).processing,class:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700"}," Guardar Producto ",8,at),Object.keys(o(t).errors).length?(i(),n("span",rt,"Por favor corrige los campos marcados.")):u("",!0)])],32)])])])])]),_:1}),h(U,{show:g.value,type:"success",title:"¡Producto creado con éxito!","primary-text":"Entendido",onPrimary:l[10]||(l[10]=s=>g.value=!1),onClose:l[11]||(l[11]=s=>g.value=!1)},null,8,["show"]),h(U,{show:_.value,type:"error",title:"No pudimos guardar el producto",message:"Revisá los siguientes puntos:",messages:v.value,"primary-text":"Entendido",onPrimary:l[12]||(l[12]=s=>_.value=!1),onClose:l[13]||(l[13]=s=>_.value=!1)},null,8,["show","messages"])],64))}};export{pt as default};
