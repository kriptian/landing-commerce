import{L as ie,r as v,p as re,C as de,N as ce,c as x,w as G,a as d,o as c,b as _,u as n,h as ue,d as k,e,s as f,f as V,g as u,v as g,M as me,n as j,F as b,i as w,t as M,x as pe,m as L}from"./app-1McBFp1T.js";import{_ as ge}from"./AuthenticatedLayout-D7Yb8bmF.js";import{_ as T}from"./AlertModal-DiQ7T1JD.js";import{_ as fe}from"./Modal-GP-28cde.js";import{_ as he}from"./SecondaryButton-B6YG8noK.js";import{D as ve}from"./DangerButton-CFlXY-dj.js";const _e={class:"font-semibold text-xl text-gray-800 leading-tight"},be={class:"py-12"},ye={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},xe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ke={class:"p-6 text-gray-900"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ce={class:"mb-4"},Ve=e("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1),je={class:"mb-4"},Me=e("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1),Ue={class:"inline-flex items-center gap-2 mb-3 select-none"},Ae=e("span",{class:"font-semibold"},"Controlar inventario",-1),Se={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Pe=e("label",{for:"quantity",class:"block font-medium text-sm text-gray-700"},"Inventario (Total)",-1),Ee=["disabled"],Ie={key:0,class:"text-xs text-gray-500 mt-1"},$e={key:1,class:"text-xs text-gray-500 mt-1"},ze=e("label",{for:"minimum_stock",class:"block font-medium text-sm text-gray-700"},"Inventario Mínimo",-1),Ne=["disabled"],qe=e("p",{class:"text-xs text-gray-500 mt-1"},"Alerta de bajo stock (general).",-1),Oe=e("label",{for:"alert_general",class:"block font-medium text-sm text-gray-700"},"Alerta (Opcional)",-1),Be=["disabled"],De=e("div",{class:"mb-2"},[e("label",{class:"block font-medium text-sm text-gray-700"},"Categorías")],-1),Ge={class:"space-y-3"},Le=["onUpdate:modelValue","onChange"],Te=e("option",{value:null},"Seleccione una categoría",-1),Fe=["value"],Re={class:"mb-4"},We=e("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"Descripción Corta",-1),Je={class:"mb-4"},Qe=e("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"Descripción Larga",-1),Xe={class:"mb-4"},Ye=e("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1),He={class:"md:col-span-2 mt-6 border-t pt-6"},Ke=e("h3",{class:"text-lg font-medium text-gray-900"},"Variantes del Producto",-1),Ze=e("p",{class:"text-sm text-gray-600 mb-4"}," Editá, añadí o eliminá las combinaciones de variantes. ",-1),et=e("div",{class:"hidden md:grid grid-cols-6 gap-4 mb-2 text-sm font-medium text-gray-600"},[e("div",{class:"col-span-2"},"Opciones (ej: Color:Rojo)"),e("div",null,"Precio (Opcional)"),e("div",null,"Stock Actual"),e("div",null,"Stock Mínimo"),e("div",null,"Alerta (Opcional)")],-1),tt={class:"md:col-span-2"},st=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Opciones",-1),ot=["onUpdate:modelValue"],lt=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Precio (Opcional)",-1),nt=["onUpdate:modelValue"],at=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Actual",-1),it=["onUpdate:modelValue"],rt=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Mínimo",-1),dt=["onUpdate:modelValue"],ct=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Alerta (Opcional)",-1),ut=["onUpdate:modelValue"],mt=["onClick"],pt={class:"mt-6 border-t pt-6"},gt={class:"p-4 border rounded-md bg-gray-50 col-span-2"},ft={class:"flex items-center justify-between mb-2"},ht=e("label",{class:"block font-medium text-sm text-gray-700"},"Imágenes actuales",-1),vt={class:"text-xs text-gray-500"},_t={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3"},bt=["onClick"],yt=["src"],xt=["onClick"],kt={key:1,class:"text-sm text-gray-500 mt-2"},wt={class:"mt-4 col-span-2"},Ct=e("label",{for:"new_gallery_files",class:"block font-medium text-sm text-gray-700"},"Añadir más imágenes",-1),Vt=e("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1),jt={class:"relative flex items-center justify-center bg-gray-50 border rounded-lg h-[60vh] min-h-[320px] mb-3 select-none"},Mt=["src"],Ut={class:"flex items-center gap-2 overflow-x-auto py-2"},At=["onClick"],St=["src"],Pt={class:"flex items-center justify-end mt-6 border-t pt-6"},Et=["disabled"],It={class:"p-6"},$t=e("h2",{class:"text-lg font-medium text-gray-900"}," ¿Deseás guardar los cambios del producto? ",-1),zt=e("p",{class:"mt-1 text-sm text-gray-600"}," Se actualizará la información y variantes del producto. ",-1),Nt={class:"mt-6 flex justify-end"},qt=2*1024*1024,Ft={__name:"Edit",props:{product:Object,categories:Array,selectedCategoryPath:Array},setup(F){const r=F,$=ie(),U=v(!!$?.props?.flash?.success);v($?.props?.flash?.success||"");const C=v(!1),y=v(!1),A=v([]),R=o=>{const t=Array.from(o?.target?.files||[]),s=[],i=[];for(const a of t){if(!(a?.type||"").startsWith("image/")){s.push(`${a.name}: no es una imagen válida.`);continue}if(a.size>qt){s.push(`${a.name}: supera el límite de 2 MB.`);continue}i.push(a)}if(s.length){A.value=["Problemas con las imágenes seleccionadas:",...s],y.value=!0,o?.target&&(o.target.value=""),l.new_gallery_files=[];return}l.new_gallery_files=i},m=v([{options:r.categories,selected:null}]),W=async()=>{if(!Array.isArray(r.selectedCategoryPath)||r.selectedCategoryPath.length===0)return;for(let t=0;t<r.selectedCategoryPath.length;t++){const s=r.selectedCategoryPath[t];if(m.value[t]||(m.value[t]={options:[],selected:null}),t>0&&m.value[t].options.length===0){const i=m.value[t-1].selected;if(i){const I=await(await fetch(route("admin.categories.children",i))).json();m.value[t].options=Array.isArray(I.data)?I.data:[]}}m.value[t].selected=s.id,l.category_id=s.id,t<r.selectedCategoryPath.length-1&&(m.value[t+1]||(m.value[t+1]={options:[],selected:null}))}const o=l.category_id;if(o){const s=await(await fetch(route("admin.categories.children",o))).json(),i=Array.isArray(s.data)?s.data:[];i.length>0&&m.value.push({options:i,selected:null})}},J=o=>{m.value.splice(o+1)},Q=async o=>{const t=m.value[o].selected;if(J(o),l.category_id=t||null,!t)return;const s=await fetch(route("admin.categories.children",t));if(!s.ok)return;const i=await s.json(),a=Array.isArray(i.data)?i.data:[];a.length>0&&m.value.push({options:a,selected:null})},X=o=>Object.entries(o).map(([t,s])=>`${t}:${s}`).join(", "),Y=r.product.variants.map(o=>({id:o.id,options_text:X(o.options),price:o.price??"",stock:o.stock,minimum_stock:o.minimum_stock,alert:o.alert??null})),l=re({_method:"PUT",name:r.product.name,price:r.product.price,track_inventory:r.product.track_inventory??!0,quantity:r.product.quantity,minimum_stock:r.product.minimum_stock,alert:r.product.alert??null,category_id:r.product.category_id,short_description:r.product.short_description,long_description:r.product.long_description,specifications:r.product.specifications?JSON.parse(r.product.specifications).join(", "):"",new_gallery_files:[],images_to_delete:[],variants:Y,variants_to_delete:[]}),p=v([...r.product.images]),z=o=>{l.images_to_delete.push(o.id),p.value=p.value.filter(t=>t.id!==o.id)},S=v(!1),h=v(0),N=v(!1);function P(){N.value=window.innerWidth<768}de(()=>{P(),window.addEventListener("resize",P),W()}),ce(()=>window.removeEventListener("resize",P));const E=x(()=>N.value?1:4),H=x(()=>p.value.slice(0,E.value)),q=x(()=>p.value.slice(E.value));function O(o=0){h.value=o,S.value=!0}function B(){S.value=!1}function K(){const o=p.value.length;o!==0&&(h.value=(h.value-1+o)%o)}function Z(){const o=p.value.length;o!==0&&(h.value=(h.value+1)%o)}function ee(o){o<0||o>=p.value.length||(h.value=o)}const te=()=>{l.variants.push({id:null,options_text:"",price:"",stock:0,minimum_stock:1,alert:null})},se=o=>{const t=l.variants[o];t.id&&l.variants_to_delete.push(t.id),l.variants.splice(o,1)},oe=x(()=>{if(l.variants.length>0){let o=0;return l.variants.forEach(t=>{o+=Number(t.stock)||0}),o}return Number(l.quantity)||0});G(oe,o=>{l.variants.length>0&&(l.quantity=o)});const le=x(()=>l.variants.length===0?Number(l.minimum_stock)||0:l.variants.reduce((o,t)=>o+(Number(t.minimum_stock)||0),0));G(le,o=>{l.variants.length>0&&(l.minimum_stock=o)},{immediate:!0});const ne=()=>{C.value=!0},D=()=>{C.value=!1},ae=()=>{l.post(route("admin.products.update",r.product.id),{onError:async()=>{const o=[];for(const[t,s]of Object.entries(l.errors))t.startsWith("new_gallery_files.")&&String(s).toLowerCase().includes("image")?o.push("Una o más imágenes nuevas superan el tamaño máximo permitido (2 MB) o no son válidas."):o.push(String(s));A.value=o,y.value=o.length>0},onFinish:()=>{C.value=!1}})};return(o,t)=>(c(),d(b,null,[_(n(ue),{title:"Editar Producto"}),_(ge,null,{header:k(()=>[e("h2",_e,"Editar Producto: "+M(n(l).name),1)]),default:k(()=>[e("div",be,[e("div",ye,[e("div",xe,[e("div",ke,[e("form",{onSubmit:f(ne,["prevent"])},[e("div",we,[e("div",null,[e("div",Ce,[Ve,u(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=s=>n(l).name=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[g,n(l).name]])]),e("div",je,[Me,u(e("input",{id:"price","onUpdate:modelValue":t[1]||(t[1]=s=>n(l).price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[g,n(l).price]])]),e("label",Ue,[u(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=s=>n(l).track_inventory=s),class:"rounded"},null,512),[[me,n(l).track_inventory]]),Ae]),n(l).track_inventory&&n(l).variants.length===0?(c(),d("div",Se,[e("div",null,[Pe,u(e("input",{id:"quantity","onUpdate:modelValue":t[3]||(t[3]=s=>n(l).quantity=s),type:"number",class:j(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(l).variants.length>0}]),disabled:n(l).variants.length>0,required:""},null,10,Ee),[[g,n(l).quantity]]),n(l).variants.length>0?(c(),d("p",Ie,"Suma automática de variantes.")):(c(),d("p",$e,"Stock si no hay variantes."))]),e("div",null,[ze,u(e("input",{id:"minimum_stock","onUpdate:modelValue":t[4]||(t[4]=s=>n(l).minimum_stock=s),type:"number",class:j(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(l).variants.length>0}]),disabled:n(l).variants.length>0},null,10,Ne),[[g,n(l).minimum_stock]]),qe]),e("div",null,[Oe,u(e("input",{id:"alert_general","onUpdate:modelValue":t[5]||(t[5]=s=>n(l).alert=s),type:"number",class:j(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(l).variants.length>0}]),disabled:n(l).variants.length>0},null,10,Be),[[g,n(l).alert]])])])):V("",!0),De,e("div",Ge,[(c(!0),d(b,null,w(m.value,(s,i)=>(c(),d("div",{key:i,class:"mb-1"},[u(e("select",{class:"block w-full rounded-md shadow-sm border-gray-300","onUpdate:modelValue":a=>s.selected=a,onChange:a=>Q(i)},[Te,(c(!0),d(b,null,w(s.options,a=>(c(),d("option",{key:a.id,value:a.id},M(a.name),9,Fe))),128))],40,Le),[[pe,s.selected]])]))),128))])]),e("div",null,[e("div",Re,[We,u(e("textarea",{id:"short_description","onUpdate:modelValue":t[6]||(t[6]=s=>n(l).short_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[g,n(l).short_description]])]),e("div",Je,[Qe,u(e("textarea",{id:"long_description","onUpdate:modelValue":t[7]||(t[7]=s=>n(l).long_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[g,n(l).long_description]])]),e("div",Xe,[Ye,u(e("input",{id:"specifications","onUpdate:modelValue":t[8]||(t[8]=s=>n(l).specifications=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[g,n(l).specifications]])])])]),e("div",He,[Ke,Ze,et,(c(!0),d(b,null,w(n(l).variants,(s,i)=>(c(),d("div",{key:i,class:"grid grid-cols-1 md:grid-cols-6 gap-4 items-center mb-2"},[e("div",tt,[st,u(e("input",{type:"text","onUpdate:modelValue":a=>s.options_text=a,placeholder:"Color:Rojo, Talla:M",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,ot),[[g,s.options_text]])]),e("div",null,[lt,u(e("input",{type:"number",step:"0.01","onUpdate:modelValue":a=>s.price=a,placeholder:"Usa precio principal",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,nt),[[g,s.price]])]),e("div",null,[at,u(e("input",{type:"number","onUpdate:modelValue":a=>s.stock=a,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,it),[[g,s.stock]])]),e("div",null,[rt,u(e("input",{type:"number","onUpdate:modelValue":a=>s.minimum_stock=a,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,dt),[[g,s.minimum_stock]])]),e("div",null,[ct,u(e("input",{type:"number","onUpdate:modelValue":a=>s.alert=a,placeholder:"Ej: 5",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,ut),[[g,s.alert]])]),e("button",{onClick:a=>se(i),type:"button",class:"text-red-600 hover:text-red-800 text-sm self-end pb-2 md:pb-0"}," Quitar ",8,mt)]))),128)),e("button",{onClick:te,type:"button",class:"mt-4 text-sm font-medium text-blue-600 hover:text-blue-800"}," + Añadir Variante ")]),e("div",pt,[e("div",gt,[e("div",ft,[ht,e("span",vt,M(p.value.length)+" imagen(es)",1)]),p.value.length>0?(c(),d("div",_t,[(c(!0),d(b,null,w(H.value,(s,i)=>(c(),d("div",{key:s.id,class:"relative rounded-lg overflow-hidden border bg-white shadow-sm hover:shadow-md transition group cursor-pointer",onClick:a=>O(i)},[e("img",{src:s.path,class:"w-full h-full aspect-[4/3] object-cover",alt:"Imagen del producto"},null,8,yt),e("button",{onClick:f(a=>z(s),["stop","prevent"]),type:"button",class:"absolute top-2 right-2 bg-red-600 text-white rounded-full w-7 h-7 flex items-center justify-center shadow-md hover:bg-red-700"}," × ",8,xt)],8,bt))),128)),q.value.length>0?(c(),d("div",{key:0,class:"relative rounded-lg overflow-hidden border bg-white shadow-sm hover:shadow-md transition group cursor-pointer flex items-center justify-center text-gray-800 font-bold text-base h-full min-h-[90px]",onClick:t[9]||(t[9]=s=>O(E.value))}," +"+M(q.value.length),1)):V("",!0)])):(c(),d("p",kt,"Este producto no tiene imágenes."))]),e("div",wt,[Ct,e("input",{id:"new_gallery_files",onInput:t[10]||(t[10]=s=>R(s)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),Vt])]),S.value?(c(),d("div",{key:0,class:"fixed inset-0 bg-black/50 z-[1000] flex items-center justify-center p-4",style:{"pointer-events":"auto"},onClick:f(B,["self"])},[e("div",{class:"bg-white rounded-lg p-4 w-full max-w-5xl max-h-[85vh] overflow-hidden relative",onClick:t[16]||(t[16]=f(()=>{},["stop"]))},[e("button",{type:"button",class:"absolute top-3 right-3 bg-gray-900 text-white rounded-full w-8 h-8 flex items-center justify-center z-30",onClick:f(B,["stop","prevent"]),onMousedown:t[11]||(t[11]=f(()=>{},["stop","prevent"]))},"×",32),e("div",jt,[e("button",{class:"absolute left-2 bg-white/90 border rounded-full w-9 h-9 flex items-center justify-center z-20",onClick:f(K,["stop","prevent"]),onMousedown:t[12]||(t[12]=f(()=>{},["stop","prevent"]))},"‹",32),e("img",{src:p.value[h.value]?.path,class:"max-w-full max-h-full object-contain",alt:"Imagen"},null,8,Mt),e("button",{class:"absolute right-2 bg-white/90 border rounded-full w-9 h-9 flex items-center justify-center z-20",onClick:f(Z,["stop","prevent"]),onMousedown:t[13]||(t[13]=f(()=>{},["stop","prevent"]))},"›",32),p.value[h.value]?(c(),d("button",{key:0,class:"absolute top-2 right-12 bg-red-600 text-white rounded px-2 py-1 text-xs z-20",type:"button",onClick:t[14]||(t[14]=f(s=>z(p.value[h.value]),["stop","prevent"])),onMousedown:t[15]||(t[15]=f(()=>{},["stop","prevent"]))},"Eliminar",32)):V("",!0)]),e("div",Ut,[(c(!0),d(b,null,w(p.value,(s,i)=>(c(),d("div",{key:s.id,class:j(["border rounded p-1 cursor-pointer flex-shrink-0",{"ring-2 ring-blue-500":i===h.value}]),onClick:a=>ee(i)},[e("img",{src:s.path,class:"w-20 h-20 object-cover rounded",alt:"thumb"},null,8,St)],10,At))),128))])])])):V("",!0),e("div",Pt,[e("button",{type:"submit",disabled:n(l).processing,class:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700"}," Actualizar Producto ",8,Et)])],32)])])])])]),_:1}),_(fe,{show:C.value,onClose:D},{default:k(()=>[e("div",It,[$t,zt,e("div",Nt,[_(he,{onClick:D},{default:k(()=>[L("Cancelar")]),_:1}),_(ve,{class:"ms-3",onClick:ae,disabled:n(l).processing},{default:k(()=>[L(" Guardar cambios ")]),_:1},8,["disabled"])])])]),_:1},8,["show"]),_(T,{show:U.value,type:"success",title:"Producto actualizado","primary-text":"Entendido",onPrimary:t[17]||(t[17]=s=>U.value=!1),onClose:t[18]||(t[18]=s=>U.value=!1)},null,8,["show"]),_(T,{show:y.value,type:"error",title:"No pudimos actualizar el producto",message:"Revisá los siguientes puntos:",messages:A.value,"primary-text":"Entendido",onPrimary:t[19]||(t[19]=s=>y.value=!1),onClose:t[20]||(t[20]=s=>y.value=!1)},null,8,["show","messages"])],64))}};export{Ft as default};
