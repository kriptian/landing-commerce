import{K as ie,r as f,c as y,w as P,p as re,C as ae,M as de,a as r,o as a,b as v,u as n,h as ue,d as h,e as t,s as p,f as _,g as u,v as c,L as me,n as U,F as x,i as C,t as V,x as L,m as R}from"./app-DdN1dnwv.js";import{_ as ce}from"./AuthenticatedLayout-0XqtQlBh.js";import{_ as W}from"./AlertModal-CWL83k3D.js";import{_ as pe}from"./Modal-uE4VJq8H.js";import{_ as ge}from"./SecondaryButton-B5xcrSpi.js";import{D as be}from"./DangerButton-BMEUFFUh.js";import"./DropdownLink-DQGx_2Xf.js";const fe={class:"font-semibold text-xl text-gray-800 leading-tight"},ve={class:"py-12"},ye={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},xe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ke={class:"p-6 text-gray-900"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},he={class:"mb-4"},_e={class:"mb-4"},Ce={class:"inline-flex items-center gap-2 mb-3 select-none"},Ve={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Me=["disabled"],Ue={key:0,class:"text-xs text-gray-500 mt-1"},je={key:1,class:"text-xs text-gray-500 mt-1"},Se=["disabled"],Ee=["disabled"],Ie={class:"mb-4"},$e=["value"],Pe={key:1,class:"mb-4"},ze=["value"],Ae={class:"mb-4"},qe={class:"mb-4"},Ne={class:"mb-4"},Oe={class:"md:col-span-2 mt-6 border-t pt-6"},Be={class:"md:col-span-2"},Ge=["onUpdate:modelValue"],De=["onUpdate:modelValue"],Te=["onUpdate:modelValue"],Fe=["onUpdate:modelValue"],Le=["onUpdate:modelValue"],Re=["onClick"],We={class:"mt-6 border-t pt-6"},Je={class:"p-4 border rounded-md bg-gray-50 col-span-2"},Qe={class:"flex items-center justify-between mb-2"},Ke={class:"text-xs text-gray-500"},Xe={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3"},Ye=["onClick"],He=["src"],Ze=["onClick"],et={key:1,class:"text-sm text-gray-500 mt-2"},tt={class:"mt-4 col-span-2"},st={class:"relative flex items-center justify-center bg-gray-50 border rounded-lg h-[60vh] min-h-[320px] mb-3 select-none"},ot=["src"],lt={class:"flex items-center gap-2 overflow-x-auto py-2"},nt=["onClick"],it=["src"],rt={class:"flex items-center justify-end mt-6 border-t pt-6"},at=["disabled"],dt={class:"p-6"},ut={class:"mt-6 flex justify-end"},mt=2*1024*1024,kt={__name:"Edit",props:{product:Object,categories:Array},setup(z){const i=z,A=ie(),j=f(!!A?.props?.flash?.success);f(A?.props?.flash?.success||"");const M=f(!1),k=f(!1),S=f([]),J=l=>{const e=Array.from(l?.target?.files||[]),s=[],b=[];for(const d of e){if(!(d?.type||"").startsWith("image/")){s.push(`${d.name}: no es una imagen válida.`);continue}if(d.size>mt){s.push(`${d.name}: supera el límite de 2 MB.`);continue}b.push(d)}if(s.length){S.value=["Problemas con las imágenes seleccionadas:",...s],k.value=!0,l?.target&&(l.target.value=""),o.new_gallery_files=[];return}o.new_gallery_files=b},q=i.product.category.parent_id?i.product.category.parent:i.product.category;i.product.category.parent_id&&i.product.category;const w=f(q?q.id:null),N=y(()=>{if(!w.value)return[];const l=i.categories.find(e=>e.id===w.value);return l?l.children:[]});P(w,(l,e)=>{l!==e&&(o.category_id=null)});const Q=l=>Object.entries(l).map(([e,s])=>`${e}:${s}`).join(", "),K=i.product.variants.map(l=>({id:l.id,options_text:Q(l.options),price:l.price??"",stock:l.stock,minimum_stock:l.minimum_stock,alert:l.alert??null})),o=re({_method:"PUT",name:i.product.name,price:i.product.price,track_inventory:i.product.track_inventory??!0,quantity:i.product.quantity,minimum_stock:i.product.minimum_stock,alert:i.product.alert??null,category_id:i.product.category_id,short_description:i.product.short_description,long_description:i.product.long_description,specifications:i.product.specifications?JSON.parse(i.product.specifications).join(", "):"",new_gallery_files:[],images_to_delete:[],variants:K,variants_to_delete:[]}),m=f([...i.product.images]),O=l=>{o.images_to_delete.push(l.id),m.value=m.value.filter(e=>e.id!==l.id)},E=f(!1),g=f(0),B=f(!1);function I(){B.value=window.innerWidth<768}ae(()=>{I(),window.addEventListener("resize",I)}),de(()=>window.removeEventListener("resize",I));const $=y(()=>B.value?1:4),X=y(()=>m.value.slice(0,$.value)),G=y(()=>m.value.slice($.value));function D(l=0){g.value=l,E.value=!0}function T(){E.value=!1}function Y(){const l=m.value.length;l!==0&&(g.value=(g.value-1+l)%l)}function H(){const l=m.value.length;l!==0&&(g.value=(g.value+1)%l)}function Z(l){l<0||l>=m.value.length||(g.value=l)}const ee=()=>{o.variants.push({id:null,options_text:"",price:"",stock:0,minimum_stock:1,alert:null})},te=l=>{const e=o.variants[l];e.id&&o.variants_to_delete.push(e.id),o.variants.splice(l,1)},se=y(()=>{if(o.variants.length>0){let l=0;return o.variants.forEach(e=>{l+=Number(e.stock)||0}),l}return Number(o.quantity)||0});P(se,l=>{o.variants.length>0&&(o.quantity=l)});const oe=y(()=>o.variants.length===0?Number(o.minimum_stock)||0:o.variants.reduce((l,e)=>l+(Number(e.minimum_stock)||0),0));P(oe,l=>{o.variants.length>0&&(o.minimum_stock=l)},{immediate:!0});const le=()=>{M.value=!0},F=()=>{M.value=!1},ne=()=>{o.post(route("admin.products.update",i.product.id),{onError:async()=>{const l=[];for(const[e,s]of Object.entries(o.errors))e.startsWith("new_gallery_files.")&&String(s).toLowerCase().includes("image")?l.push("Una o más imágenes nuevas superan el tamaño máximo permitido (2 MB) o no son válidas."):l.push(String(s));S.value=l,k.value=l.length>0},onFinish:()=>{M.value=!1}})};return(l,e)=>(a(),r(x,null,[v(n(ue),{title:"Editar Producto"}),v(ce,null,{header:h(()=>[t("h2",fe,"Editar Producto: "+V(n(o).name),1)]),default:h(()=>[t("div",ve,[t("div",ye,[t("div",xe,[t("div",ke,[t("form",{onSubmit:p(le,["prevent"])},[t("div",we,[t("div",null,[t("div",he,[e[23]||(e[23]=t("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1)),u(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=s=>n(o).name=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[c,n(o).name]])]),t("div",_e,[e[24]||(e[24]=t("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1)),u(t("input",{id:"price","onUpdate:modelValue":e[1]||(e[1]=s=>n(o).price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[c,n(o).price]])]),t("label",Ce,[u(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>n(o).track_inventory=s),class:"rounded"},null,512),[[me,n(o).track_inventory]]),e[25]||(e[25]=t("span",{class:"font-semibold"},"Controlar inventario",-1))]),n(o).track_inventory&&n(o).variants.length===0?(a(),r("div",Ve,[t("div",null,[e[26]||(e[26]=t("label",{for:"quantity",class:"block font-medium text-sm text-gray-700"},"Inventario (Total)",-1)),u(t("input",{id:"quantity","onUpdate:modelValue":e[3]||(e[3]=s=>n(o).quantity=s),type:"number",class:U(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(o).variants.length>0}]),disabled:n(o).variants.length>0,required:""},null,10,Me),[[c,n(o).quantity]]),n(o).variants.length>0?(a(),r("p",Ue,"Suma automática de variantes.")):(a(),r("p",je,"Stock si no hay variantes."))]),t("div",null,[e[27]||(e[27]=t("label",{for:"minimum_stock",class:"block font-medium text-sm text-gray-700"},"Inventario Mínimo",-1)),u(t("input",{id:"minimum_stock","onUpdate:modelValue":e[4]||(e[4]=s=>n(o).minimum_stock=s),type:"number",class:U(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(o).variants.length>0}]),disabled:n(o).variants.length>0},null,10,Se),[[c,n(o).minimum_stock]]),e[28]||(e[28]=t("p",{class:"text-xs text-gray-500 mt-1"},"Alerta de bajo stock (general).",-1))]),t("div",null,[e[29]||(e[29]=t("label",{for:"alert_general",class:"block font-medium text-sm text-gray-700"},"Alerta (Opcional)",-1)),u(t("input",{id:"alert_general","onUpdate:modelValue":e[5]||(e[5]=s=>n(o).alert=s),type:"number",class:U(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(o).variants.length>0}]),disabled:n(o).variants.length>0},null,10,Ee),[[c,n(o).alert]])])])):_("",!0),t("div",Ie,[e[31]||(e[31]=t("label",{for:"parent_category",class:"block font-medium text-sm text-gray-700"},"Categoría Principal",-1)),u(t("select",{id:"parent_category","onUpdate:modelValue":e[6]||(e[6]=s=>w.value=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},[e[30]||(e[30]=t("option",{value:null},"Seleccione una categoría",-1)),(a(!0),r(x,null,C(z.categories,s=>(a(),r("option",{key:s.id,value:s.id},V(s.name),9,$e))),128))],512),[[L,w.value]])]),N.value.length>0?(a(),r("div",Pe,[e[33]||(e[33]=t("label",{for:"category_id",class:"block font-medium text-sm text-gray-700"},"Subcategoría",-1)),u(t("select",{id:"category_id","onUpdate:modelValue":e[7]||(e[7]=s=>n(o).category_id=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},[e[32]||(e[32]=t("option",{value:null},"Seleccione una subcategoría",-1)),(a(!0),r(x,null,C(N.value,s=>(a(),r("option",{key:s.id,value:s.id},V(s.name),9,ze))),128))],512),[[L,n(o).category_id]])])):_("",!0)]),t("div",null,[t("div",Ae,[e[34]||(e[34]=t("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"Descripción Corta",-1)),u(t("textarea",{id:"short_description","onUpdate:modelValue":e[8]||(e[8]=s=>n(o).short_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[c,n(o).short_description]])]),t("div",qe,[e[35]||(e[35]=t("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"Descripción Larga",-1)),u(t("textarea",{id:"long_description","onUpdate:modelValue":e[9]||(e[9]=s=>n(o).long_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[c,n(o).long_description]])]),t("div",Ne,[e[36]||(e[36]=t("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1)),u(t("input",{id:"specifications","onUpdate:modelValue":e[10]||(e[10]=s=>n(o).specifications=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[c,n(o).specifications]])])])]),t("div",Oe,[e[42]||(e[42]=t("h3",{class:"text-lg font-medium text-gray-900"},"Variantes del Producto",-1)),e[43]||(e[43]=t("p",{class:"text-sm text-gray-600 mb-4"}," Editá, añadí o eliminá las combinaciones de variantes. ",-1)),e[44]||(e[44]=t("div",{class:"hidden md:grid grid-cols-6 gap-4 mb-2 text-sm font-medium text-gray-600"},[t("div",{class:"col-span-2"},"Opciones (ej: Color:Rojo)"),t("div",null,"Precio (Opcional)"),t("div",null,"Stock Actual"),t("div",null,"Stock Mínimo"),t("div",null,"Alerta (Opcional)")],-1)),(a(!0),r(x,null,C(n(o).variants,(s,b)=>(a(),r("div",{key:b,class:"grid grid-cols-1 md:grid-cols-6 gap-4 items-center mb-2"},[t("div",Be,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Opciones",-1)),u(t("input",{type:"text","onUpdate:modelValue":d=>s.options_text=d,placeholder:"Color:Rojo, Talla:M",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Ge),[[c,s.options_text]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Precio (Opcional)",-1)),u(t("input",{type:"number",step:"0.01","onUpdate:modelValue":d=>s.price=d,placeholder:"Usa precio principal",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,De),[[c,s.price]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Actual",-1)),u(t("input",{type:"number","onUpdate:modelValue":d=>s.stock=d,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Te),[[c,s.stock]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Mínimo",-1)),u(t("input",{type:"number","onUpdate:modelValue":d=>s.minimum_stock=d,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Fe),[[c,s.minimum_stock]])]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Alerta (Opcional)",-1)),u(t("input",{type:"number","onUpdate:modelValue":d=>s.alert=d,placeholder:"Ej: 5",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Le),[[c,s.alert]])]),t("button",{onClick:d=>te(b),type:"button",class:"text-red-600 hover:text-red-800 text-sm self-end pb-2 md:pb-0"}," Quitar ",8,Re)]))),128)),t("button",{onClick:ee,type:"button",class:"mt-4 text-sm font-medium text-blue-600 hover:text-blue-800"}," + Añadir Variante ")]),t("div",We,[t("div",Je,[t("div",Qe,[e[45]||(e[45]=t("label",{class:"block font-medium text-sm text-gray-700"},"Imágenes actuales",-1)),t("span",Ke,V(m.value.length)+" imagen(es)",1)]),m.value.length>0?(a(),r("div",Xe,[(a(!0),r(x,null,C(X.value,(s,b)=>(a(),r("div",{key:s.id,class:"relative rounded-lg overflow-hidden border bg-white shadow-sm hover:shadow-md transition group cursor-pointer",onClick:d=>D(b)},[t("img",{src:s.path,class:"w-full h-full aspect-[4/3] object-cover",alt:"Imagen del producto"},null,8,He),t("button",{onClick:p(d=>O(s),["stop","prevent"]),type:"button",class:"absolute top-2 right-2 bg-red-600 text-white rounded-full w-7 h-7 flex items-center justify-center shadow-md hover:bg-red-700"}," × ",8,Ze)],8,Ye))),128)),G.value.length>0?(a(),r("div",{key:0,class:"relative rounded-lg overflow-hidden border bg-white shadow-sm hover:shadow-md transition group cursor-pointer flex items-center justify-center text-gray-800 font-bold text-base h-full min-h-[90px]",onClick:e[11]||(e[11]=s=>D($.value))}," +"+V(G.value.length),1)):_("",!0)])):(a(),r("p",et,"Este producto no tiene imágenes."))]),t("div",tt,[e[46]||(e[46]=t("label",{for:"new_gallery_files",class:"block font-medium text-sm text-gray-700"},"Añadir más imágenes",-1)),t("input",{id:"new_gallery_files",onInput:e[12]||(e[12]=s=>J(s)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),e[47]||(e[47]=t("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1))])]),E.value?(a(),r("div",{key:0,class:"fixed inset-0 bg-black/50 z-[1000] flex items-center justify-center p-4",style:{"pointer-events":"auto"},onClick:p(T,["self"])},[t("div",{class:"bg-white rounded-lg p-4 w-full max-w-5xl max-h-[85vh] overflow-hidden relative",onClick:e[18]||(e[18]=p(()=>{},["stop"]))},[t("button",{type:"button",class:"absolute top-3 right-3 bg-gray-900 text-white rounded-full w-8 h-8 flex items-center justify-center z-30",onClick:p(T,["stop","prevent"]),onMousedown:e[13]||(e[13]=p(()=>{},["stop","prevent"]))},"×",32),t("div",st,[t("button",{class:"absolute left-2 bg-white/90 border rounded-full w-9 h-9 flex items-center justify-center z-20",onClick:p(Y,["stop","prevent"]),onMousedown:e[14]||(e[14]=p(()=>{},["stop","prevent"]))},"‹",32),t("img",{src:m.value[g.value]?.path,class:"max-w-full max-h-full object-contain",alt:"Imagen"},null,8,ot),t("button",{class:"absolute right-2 bg-white/90 border rounded-full w-9 h-9 flex items-center justify-center z-20",onClick:p(H,["stop","prevent"]),onMousedown:e[15]||(e[15]=p(()=>{},["stop","prevent"]))},"›",32),m.value[g.value]?(a(),r("button",{key:0,class:"absolute top-2 right-12 bg-red-600 text-white rounded px-2 py-1 text-xs z-20",type:"button",onClick:e[16]||(e[16]=p(s=>O(m.value[g.value]),["stop","prevent"])),onMousedown:e[17]||(e[17]=p(()=>{},["stop","prevent"]))},"Eliminar",32)):_("",!0)]),t("div",lt,[(a(!0),r(x,null,C(m.value,(s,b)=>(a(),r("div",{key:s.id,class:U(["border rounded p-1 cursor-pointer flex-shrink-0",{"ring-2 ring-blue-500":b===g.value}]),onClick:d=>Z(b)},[t("img",{src:s.path,class:"w-20 h-20 object-cover rounded",alt:"thumb"},null,8,it)],10,nt))),128))])])])):_("",!0),t("div",rt,[t("button",{type:"submit",disabled:n(o).processing,class:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700"}," Actualizar Producto ",8,at)])],32)])])])])]),_:1}),v(pe,{show:M.value,onClose:F},{default:h(()=>[t("div",dt,[e[50]||(e[50]=t("h2",{class:"text-lg font-medium text-gray-900"}," ¿Deseás guardar los cambios del producto? ",-1)),e[51]||(e[51]=t("p",{class:"mt-1 text-sm text-gray-600"}," Se actualizará la información y variantes del producto. ",-1)),t("div",ut,[v(ge,{onClick:F},{default:h(()=>[...e[48]||(e[48]=[R("Cancelar",-1)])]),_:1}),v(be,{class:"ms-3",onClick:ne,disabled:n(o).processing},{default:h(()=>[...e[49]||(e[49]=[R(" Guardar cambios ",-1)])]),_:1},8,["disabled"])])])]),_:1},8,["show"]),v(W,{show:j.value,type:"success",title:"Producto actualizado","primary-text":"Entendido",onPrimary:e[19]||(e[19]=s=>j.value=!1),onClose:e[20]||(e[20]=s=>j.value=!1)},null,8,["show"]),v(W,{show:k.value,type:"error",title:"No pudimos actualizar el producto",message:"Revisá los siguientes puntos:",messages:S.value,"primary-text":"Entendido",onPrimary:e[21]||(e[21]=s=>k.value=!1),onClose:e[22]||(e[22]=s=>k.value=!1)},null,8,["show","messages"])],64))}};export{kt as default};
