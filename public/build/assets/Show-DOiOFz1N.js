import{r as x,c as S,u as L,H as U,I as G,a as d,o as i,b as w,f as e,d as $,h as H,e as D,F as k,n as P,i as C,t as s,m as h,p as R,g as W,j as Q,x as Y,l as J}from"./app-BbGXU1BN.js";import{_ as K}from"./AuthenticatedLayout-CMzDSey0.js";import{_ as X}from"./AlertModal-DRMsBwYl.js";import{d as Z,s as ee}from"./pdfUtils-KPvN2_XH.js";import"./Modal-CeUYkVjj.js";const te={class:"flex items-center justify-between w-full"},se={class:"font-semibold text-xl text-gray-800 leading-tight"},oe={class:"flex gap-2"},ne=["disabled"],ae={key:0},re={key:1},de=e("span",{class:"hidden sm:inline"},"Descargar",-1),ie=["disabled"],le={key:0},ce={key:1},ue=e("span",{class:"hidden sm:inline"},"Compartir",-1),me=e("span",null,"üñ®Ô∏è",-1),pe=e("span",{class:"hidden sm:inline"},"Imprimir",-1),he=[me,pe],_e=e("span",null,"‚¨ÖÔ∏è",-1),ge=e("span",{class:"hidden sm:inline"},"Volver",-1),ve={class:"py-12"},be={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-3 gap-8"},fe={class:"lg:col-span-2 space-y-8"},ye={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},xe={class:"p-6"},we=e("h3",{class:"text-lg font-semibold border-b pb-4 mb-4"},"Productos en la Orden",-1),$e={class:"divide-y divide-gray-200"},ke={class:"flex-grow"},Ce={class:"font-bold text-gray-900"},De={key:0,class:"text-sm text-gray-600 mt-1"},Pe={class:"font-semibold"},Ee={class:"text-sm text-gray-500 mt-2"},Ne={class:"font-semibold text-gray-800 shrink-0 ml-4"},Se={class:"border-t border-gray-200 pt-4 mt-4 text-right"},Te={class:"text-2xl font-bold"},Fe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},je={class:"p-6"},qe=e("h3",{class:"text-lg font-semibold border-b pb-4 mb-4"},"Datos del Cliente",-1),Ie={class:"mt-4 space-y-4 text-gray-700"},Oe=e("p",{class:"font-semibold text-sm text-gray-500"},"Nombre:",-1),ze=e("p",{class:"font-semibold text-sm text-gray-500"},"Tel√©fono:",-1),Ve=e("p",{class:"font-semibold text-sm text-gray-500"},"Correo:",-1),Ae=e("p",{class:"font-semibold text-sm text-gray-500"},"Direcci√≥n:",-1),Me={class:"space-y-8"},Be={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Le={class:"p-6"},Ue=e("h3",{class:"text-lg font-semibold mb-4"},"Estado del Pedido",-1),Ge={class:"text-center mb-4"},He={class:"text-sm text-center text-gray-500"},Re={class:"mt-6 border-t pt-6"},We=e("label",{for:"status",class:"block font-medium text-sm text-gray-700 mb-2"},"Cambiar Estado",-1),Qe=e("option",{value:"recibido"},"Recibido",-1),Ye=e("option",{value:"en_preparacion"},"En Preparaci√≥n",-1),Je=e("option",{value:"despachado"},"Despachado",-1),Ke=e("option",{value:"entregado"},"Entregado",-1),Xe=e("option",{value:"cancelado"},"Cancelado",-1),Ze=[Qe,Ye,Je,Ke,Xe],et=["disabled"],tt=e("div",{class:"p-6"},[e("div",{class:"mt-6 flex justify-end"})],-1),st={class:"fixed top-0 left-0 w-[210mm] bg-white z-[-100] opacity-0 pointer-events-none"},ot={id:"invoice-content-digital",class:"p-8 bg-white text-black relative overflow-hidden"},nt={key:0,class:"absolute inset-0 flex items-center justify-center pointer-events-none z-0 opacity-[0.12]"},at={class:"text-[80px] font-[900] text-black uppercase whitespace-nowrap -rotate-45 transform select-none"},rt={class:"relative z-10"},dt={class:"flex items-center justify-center gap-4 mb-8 pb-4 border-b-2 border-black"},it=["src"],lt={key:1,class:"text-3xl font-bold"},ct={class:"mb-8"},ut=e("h2",{class:"text-xl font-bold mb-4"},"Informaci√≥n de Venta",-1),mt={class:"grid grid-cols-2 gap-4 text-sm"},pt=e("strong",null,"N√∫mero:",-1),ht=e("strong",null,"Fecha:",-1),_t=e("strong",null,"Cliente:",-1),gt=e("strong",null,"Tel√©fono:",-1),vt=e("strong",null,"Direcci√≥n:",-1),bt=e("strong",null,"M√©todo de Pago:",-1),ft={class:"capitalize"},yt={class:"w-full mb-8 text-sm"},xt=e("thead",{class:"border-b-2 border-black"},[e("tr",null,[e("th",{class:"text-left py-2"},"Producto"),e("th",{class:"text-center py-2"},"Cant"),e("th",{class:"text-right py-2"},"Precio"),e("th",{class:"text-right py-2"},"Total")])],-1),wt={class:"py-2"},$t={key:0,class:"text-xs text-gray-500"},kt={class:"text-center py-2"},Ct={class:"text-right py-2"},Dt={class:"text-right py-2"},Pt={class:"flex justify-end"},Et={class:"w-1/2 space-y-2 text-right"},Nt={class:"flex justify-between text-xl font-bold border-t border-black pt-2"},St=e("span",null,"Total:",-1),Tt=e("div",{class:"mt-12 text-center text-xs text-gray-500"},[e("p",null,"Gracias por su compra")],-1),zt={__name:"Show",props:{order:Object,store:Object},setup(n){const _=x(!1),g=x(""),v=x(""),f=x("success"),a=n,b=t=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),p=x(!1),q=async()=>{p.value=!0;try{const t=document.getElementById("invoice-content-digital");t&&await Z(t,`factura-${a.order.sequence_number||a.order.id}.pdf`)}catch(t){console.error(t),alert("Error al generar el PDF")}finally{p.value=!1}},I=async()=>{p.value=!0;try{const t=document.getElementById("invoice-content-digital");t&&await ee(t,`factura-${a.order.sequence_number||a.order.id}.pdf`,`Factura #${a.order.sequence_number||a.order.id}`)}catch(t){console.error(t)}finally{p.value=!1}},O=()=>{window.print()},T=t=>{const r={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(t).toLocaleDateString("es-CO",r)},E=S(()=>({recibido:{text:"Recibido",class:"bg-yellow-100 text-yellow-800"},en_preparacion:{text:"En Preparaci√≥n",class:"bg-blue-100 text-blue-800"},despachado:{text:"Despachado",class:"bg-purple-100 text-purple-800"},entregado:{text:"Entregado",class:"bg-green-100 text-green-800"},cancelado:{text:"Cancelado",class:"bg-red-100 text-red-800"}})[a.order.status]||{text:a.order.status,class:"bg-gray-100 text-gray-800"}),y=L({status:a.order.status}),z=()=>{const t=y.status;y.put(route("admin.orders.update",a.order.id),{preserveScroll:!0,onSuccess:()=>{f.value="success",t==="despachado"||t==="entregado"?(g.value="Venta confirmada",v.value="Inventario actualizado correctamente."):t==="cancelado"?(g.value="Pedido cancelado",v.value="El estado se actualiz√≥ y el inventario fue revertido si correspond√≠a."):(g.value="Estado actualizado",v.value="El estado de la orden se guard√≥ correctamente."),_.value=!0},onError:r=>{f.value="error",g.value="Error al actualizar",v.value=Array.isArray(r)?r.join(`
`):r?.status||Object.values(r||{}).join(`
`)||"Ocurri√≥ un error inesperado.",_.value=!0}})},F=U(),N=S(()=>F?.props?.auth?.user?.store?.name||"nuestra tienda"),j=S(()=>{const t=F?.props?.auth?.user?.store;return t?t.custom_domain?`${typeof window<"u"?window.location.protocol:"https:"}//${t.custom_domain}`:route("catalogo.index",{store:t.slug}):"#"}),V=()=>{try{const t=Array.isArray(a.order?.items)?a.order.items:[];return t.length?`
Tu orden incluye:
${t.map(u=>{const o=Number(u.quantity||0);let c="";if(u.variant_options)try{const l=Object.entries(u.variant_options).map(([m,B])=>`${m}: ${B}`);c=l.length?` (${l.join(", ")})`:""}catch{}return` - ${o} x ${u.product_name}${c}`}).join(`
`)}`:""}catch{return""}},A=()=>{const t=a.order.sequence_number??a.order.id,r=T(a.order.created_at),u=b(a.order.total_price),o=(a.order?.customer_name||"").trim(),c=o?`Hola ${o},`:"Hola,",l=(a.order?.customer_address||"").trim(),m=V();switch(a.order.status){case"recibido":return`${c}

¬°Gracias por comprar en ${N.value}!

Tu pedido No. ${t} fue recibido correctamente.${m?`
${m}`:""}

Fecha del pedido: ${r}.
Total del pedido: ${u}${l?`
Direcci√≥n: ${l}`:""}

Te avisaremos cuando est√© en preparaci√≥n.`;case"en_preparacion":return`${c}

Estamos preparando tu pedido No. ${t} en ${N.value}.${m?`
${m}`:""}

Fecha del pedido: ${r}.
Total del pedido: ${u}${l?`
Direcci√≥n: ${l}`:""}

Te notificaremos cuando salga a despacho.`;case"despachado":return`${c}

Tu pedido No. ${t} fue despachado desde ${N.value}.${m?`
${m}`:""}

Total del pedido: ${u}${l?`
Direcci√≥n de entrega: ${l}`:""}

Si necesitas coordinar algo de la entrega, responde este mensaje.`;case"entregado":return`${c}

¬°Qu√© alegr√≠a! Ya entregamos tu pedido No. ${t}.${m?`
${m}`:""}

Total del pedido: ${u}

Esperamos que lo disfrutes. Si quieres descubrir m√°s productos, visita nuestro cat√°logo: ${j.value}`;case"cancelado":return`${c}

Tu pedido No. ${t} fue cancelado. Si no fuiste t√∫ quien lo solicit√≥, por favor cont√°ctanos para ayudarte.${m?`
${m}`:""}

Cuando desees, puedes volver a comprar aqu√≠: ${j.value}`;default:return`${c}

Estado actual de tu pedido No. ${t}: ${E.value?.text??a.order.status}.`}},M=()=>{try{const r=(a.order?.customer_phone??"").toString().replace(/[^0-9]/g,"");if(!r){f.value="error",g.value="Sin tel√©fono del cliente",v.value="No encontramos un n√∫mero de WhatsApp v√°lido para el cliente.",_.value=!0;return}const u=A(),o=encodeURIComponent(u),c=`https://wa.me/${r}?text=${o}`;typeof window<"u"&&window.open(c,"_blank")}catch{f.value="error",g.value="No se pudo abrir WhatsApp",v.value="Intenta nuevamente en unos segundos.",_.value=!0}};return(t,r)=>{const u=G("Modal");return i(),d(k,null,[w($(H),{title:`Orden #${n.order.sequence_number??n.order.id}`},null,8,["title"]),w(K,null,{header:D(()=>[e("div",te,[e("h2",se," Detalle de la Orden #"+s(n.order.sequence_number??n.order.id),1),e("div",oe,[e("button",{onClick:q,class:"px-3 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm flex items-center gap-1 no-print",disabled:p.value,title:"Descargar PDF"},[p.value?(i(),d("span",ae,"‚è≥")):(i(),d("span",re,"‚¨áÔ∏è")),de],8,ne),e("button",{onClick:I,class:"px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-sm flex items-center gap-1 no-print",disabled:p.value,title:"Compartir Factura"},[p.value?(i(),d("span",le,"‚è≥")):(i(),d("span",ce,"üîó")),ue],8,ie),e("button",{onClick:O,class:"px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 no-print flex items-center gap-1",title:"Imprimir"},he),w($(J),{href:t.route("admin.reports.index"),class:"px-3 sm:px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 no-print flex items-center gap-1",title:"Volver"},{default:D(()=>[_e,ge]),_:1},8,["href"])])])]),default:D(()=>[e("div",ve,[e("div",be,[e("div",fe,[e("div",ye,[e("div",xe,[we,e("div",$e,[(i(!0),d(k,null,P(n.order.items,o=>(i(),d("div",{key:o.id,class:"py-4 flex justify-between items-start"},[e("div",ke,[e("p",Ce,s(o.product_name),1),o.variant_options?(i(),d("div",De,[(i(!0),d(k,null,P(o.variant_options,(c,l)=>(i(),d("span",{key:l,class:"mr-2 bg-gray-100 px-2 py-1 rounded"},[e("span",Pe,s(l)+":",1),h(" "+s(c),1)]))),128))])):C("",!0),e("p",Ee,s(o.quantity)+" x "+s(b(o.unit_price)),1)]),e("p",Ne,s(b(o.unit_price*o.quantity)),1)]))),128))]),e("div",Se,[e("p",Te,"Total: "+s(b(n.order.total_price)),1)])])]),e("div",Fe,[e("div",je,[qe,e("div",Ie,[e("div",null,[Oe,e("p",null,s(n.order.customer_name),1)]),e("div",null,[ze,e("p",null,s(n.order.customer_phone),1)]),e("div",null,[Ve,e("p",null,s(n.order.customer_email),1)]),e("div",null,[Ae,e("p",null,s(n.order.customer_address),1)])])])])]),e("div",Me,[e("div",Be,[e("div",Le,[Ue,e("div",Ge,[e("span",{class:R(["px-4 py-2 inline-flex text-lg leading-5 font-semibold rounded-full",E.value.class])},s(E.value.text),3)]),e("p",He," Pedido realizado el: "+s(T(n.order.created_at)),1),e("form",{onSubmit:W(z,["prevent"])},[e("div",Re,[We,Q(e("select",{id:"status","onUpdate:modelValue":r[0]||(r[0]=o=>$(y).status=o),class:"block w-full rounded-md shadow-sm border-gray-300"},Ze,512),[[Y,$(y).status]]),e("button",{type:"submit",disabled:$(y).processing,class:"mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 disabled:opacity-50"}," Actualizar Estado ",8,et),e("button",{type:"button",onClick:M,class:"mt-3 w-full bg-green-600 text-white font-bold py-2 px-4 rounded hover:bg-green-700"}," Notificar estado actual ")])],32)])])])])])]),_:1}),w(u,{show:t.confirmingSale,onClose:t.closeSaleModal},{default:D(()=>[tt]),_:1},8,["show","onClose"]),w(X,{show:_.value,type:f.value,title:g.value,message:v.value,"primary-text":"Entendido",onPrimary:r[1]||(r[1]=o=>_.value=!1),onClose:r[2]||(r[2]=o=>_.value=!1)},null,8,["show","type","title","message"]),e("div",st,[e("div",ot,[n.order.store?.name||t.$page.props.auth.user.store?.name?(i(),d("div",nt,[e("div",at,s(n.order.store?.name||t.$page.props.auth.user.store?.name),1)])):C("",!0),e("div",rt,[e("div",dt,[n.order.store?.logo_url||t.$page.props.auth.user.store?.logo_url?(i(),d("img",{key:0,src:n.order.store?.logo_url||t.$page.props.auth.user.store?.logo_url,alt:"Logo",class:"h-20 w-auto object-contain",crossorigin:"anonymous"},null,8,it)):C("",!0),n.order.store?.name||t.$page.props.auth.user.store?.name?(i(),d("h1",lt,s(n.order.store?.name||t.$page.props.auth.user.store?.name),1)):C("",!0)]),e("div",ct,[ut,e("div",mt,[e("div",null,[pt,h(" #"+s(n.order.sequence_number??n.order.id),1)]),e("div",null,[ht,h(" "+s(new Date(n.order.created_at).toLocaleString("es-CO")),1)]),e("div",null,[_t,h(" "+s(n.order.customer_name),1)]),e("div",null,[gt,h(" "+s(n.order.customer_phone),1)]),e("div",null,[vt,h(" "+s(n.order.customer_address),1)]),e("div",null,[bt,h(),e("span",ft,s(n.order.payment_method||"N/A"),1)])])]),e("table",yt,[xt,e("tbody",null,[(i(!0),d(k,null,P(n.order.items,o=>(i(),d("tr",{key:o.id,class:"border-b border-gray-200"},[e("td",wt,[h(s(o.product_name)+" ",1),o.variant_options?(i(),d("div",$t,[(i(!0),d(k,null,P(o.variant_options,(c,l)=>(i(),d("span",{key:l,class:"mr-1"},s(l)+": "+s(c),1))),128))])):C("",!0)]),e("td",kt,s(o.quantity),1),e("td",Ct,s(b(o.unit_price)),1),e("td",Dt,s(b(o.unit_price*o.quantity)),1)]))),128))])]),e("div",Pt,[e("div",Et,[e("div",Nt,[St,e("span",null,s(b(n.order.total_price)),1)])])]),Tt])])])],64)}}};export{zt as default};
