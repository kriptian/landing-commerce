import{p as q,r,C as oe,a,o as l,b as _,u as d,h as ne,d as S,e,s as J,g as k,v as C,f as u,F,i as K,t as p,m as W,j as R}from"./app-9mQJuWzP.js";import{_ as ae}from"./AuthenticatedLayout-DnHW7twC.js";import{_ as le}from"./Modal-CBuPActV.js";import{_ as re}from"./AlertModal-c2YCcOTS.js";import{_ as ie}from"./SecondaryButton-ESrZDC4e.js";import{D as de}from"./DangerButton-BWL4xgZO.js";const ue={class:"font-semibold text-xl text-gray-800 leading-tight"},ce={class:"py-12"},ve={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},me={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ge={class:"p-6 text-gray-900"},ye=["disabled"],be={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},fe={class:"p-6 text-gray-900"},xe={class:"flex items-center justify-between"},pe={class:"flex items-center gap-2"},he={class:"mt-4 border rounded-lg divide-y"},we={key:0,class:"text-sm text-gray-500"},_e={key:1,class:"text-sm text-gray-500"},ke={class:"flex justify-between items-center"},Ce={class:"flex-1"},je={key:0,class:"flex items-center gap-2"},Ae=["title","onClick"],Ee={key:0},Se={key:1},$e={class:"font-medium"},Ve={key:0,class:"text-xs bg-gray-100 text-gray-700 rounded px-2 py-0.5 align-middle"},Be={key:1,class:"flex items-center gap-2"},Ne=["onUpdate:modelValue"],Me=["onClick"],Ue=["onClick"],De={class:"flex items-center gap-2"},Le=["onClick"],ze=["onClick"],Pe=["onClick"],Fe={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2"},Re={class:"flex items-center gap-2"},He=["onUpdate:modelValue"],Te=["disabled","onClick"],Ge=["onClick"],Oe={key:0,class:"text-xs text-red-600 mt-1"},Qe={key:1,class:"mt-2 pl-4 border-l"},qe={key:0,class:"text-sm text-gray-500"},Je={class:"flex-1"},Ke={key:0},We={key:1,class:"flex items-center gap-2"},Xe=["onUpdate:modelValue"],Ye=["onClick"],Ze=["onClick"],Ie={class:"flex items-center gap-2"},et=["onClick"],tt=["onClick"],st={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2 w-full"},ot={class:"flex items-center gap-2"},nt=["onUpdate:modelValue"],at=["disabled","onClick"],lt={key:0,class:"text-xs text-red-600 mt-1"},rt={class:"mt-2 flex items-center gap-2"},it=["disabled"],dt={key:0,class:"text-sm text-red-600 mt-2"},ut={class:"p-6"},ct={class:"mt-6 flex justify-end"},xt={__name:"Edit",props:{category:Object},setup($){const c=$,V=q({name:c.category.name}),v=q({name:""}),X=()=>{V.put(route("admin.categories.update",c.category.id))},Y=()=>{v.post(route("admin.categories.storeSubcategory",c.category.id),{onSuccess:()=>{v.reset(),f()},preserveScroll:!0})},Z=()=>{v.name=""},U=r(!1),j=r(null),B=()=>{U.value=!1,j.value=null},I=()=>{j.value&&R.delete(route("admin.categories.destroy",j.value),{preserveScroll:!0,onSuccess:()=>{const s=j.value;B();const t=P.value;s&&(delete i.value[s],delete h.value[s],delete m.value[s],delete g.value[s],delete E.value[s]),t&&t!==c.category.id?w(t):f(),f()},onError:s=>{const t=P.value;t&&t!==c.category.id?w(t):f(),Q.value=s&&(s.delete||s.message)||"Existen productos asociados a esta categoría y no se puede borrar.",M.value=!0},onFinish:()=>B()})},D=r(!1),b=r(c.category.children||[]),f=async()=>{try{D.value=!0;const s=await fetch(route("admin.categories.children",c.category.id));if(!s.ok)return;const t=await s.json();b.value=Array.isArray(t.data)?t.data:[]}finally{D.value=!1}};oe(()=>{f()});const h=r({}),m=r({}),A=r({}),g=r({}),ee=s=>{h.value[s]=!h.value[s]},H=s=>{const t=(m.value[s]||"").trim();t&&(A.value[s]=!0,g.value[s]=null,R.post(route("admin.categories.storeSubcategory",s),{name:t},{preserveScroll:!0,onSuccess:()=>{m.value[s]="",A.value[s]=!1,i.value[s]=!0,w(s),f()},onError:()=>{A.value[s]=!1,g.value[s]="No se pudo crear el subnivel"}}))},te=s=>{m.value[s]="",g.value[s]=null,h.value[s]=!1},N=r({}),x=r({}),T=s=>{N.value[s.id]=!0,x.value[s.id]=s.name},L=s=>{N.value[s]=!1,x.value[s]=""},G=(s,t=null)=>{const o=(x.value[s]||"").trim();o&&R.put(route("admin.categories.update",s),{name:o},{preserveScroll:!0,onSuccess:()=>{L(s),t&&t!==c.category.id?w(t):f()}})},i=r({}),z=r({}),E=r({}),w=async s=>{z.value[s]=!0;try{const t=await fetch(route("admin.categories.children",s));if(!t.ok)return;const o=await t.json();E.value[s]=Array.isArray(o.data)?o.data:[]}finally{z.value[s]=!1}},se=async s=>{const t=!i.value[s];i.value[s]=t,t&&!Array.isArray(E.value[s])&&await w(s)},P=r(null),O=(s,t=null)=>{j.value=s,P.value=t,U.value=!0},M=r(!1),Q=r("");return(s,t)=>(l(),a(F,null,[_(d(ne),{title:`Editar: ${$.category.name}`},null,8,["title"]),_(ae,null,{header:S(()=>[e("h2",ue," Editando Categoría: "+p($.category.name),1)]),default:S(()=>[e("div",ce,[e("div",ve,[e("div",me,[e("div",ge,[t[6]||(t[6]=e("h3",{class:"text-lg font-medium"},"Editar Nombre",-1)),e("form",{onSubmit:J(X,["prevent"]),class:"mt-4 flex items-center gap-4"},[k(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>d(V).name=o),type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,512),[[C,d(V).name]]),e("button",{type:"submit",disabled:d(V).processing,class:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700"}," Actualizar ",8,ye)],32)])]),e("div",be,[e("div",fe,[e("div",xe,[t[7]||(t[7]=e("h3",{class:"text-lg font-medium"},"Gestionar Subcategorías",-1)),e("div",pe,[e("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Expandir todo",onClick:t[1]||(t[1]=()=>{b.value.forEach(o=>i.value[o.id]=!0),b.value.forEach(o=>{Array.isArray(E.value[o.id])||w(o.id)})})},"+ "),e("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Colapsar todo",onClick:t[2]||(t[2]=()=>{b.value.forEach(o=>i.value[o.id]=!1)})},"− ")])]),e("div",he,[D.value?(l(),a("p",we,"Cargando subcategorías…")):!b.value||b.value.length===0?(l(),a("p",_e," Esta categoría aún no tiene subcategorías. ")):u("",!0),(l(!0),a(F,null,K(b.value,o=>(l(),a("div",{key:o.id,class:"p-3 hover:bg-gray-50"},[e("div",ke,[e("div",Ce,[N.value[o.id]?(l(),a("div",Be,[k(e("input",{"onUpdate:modelValue":n=>x.value[o.id]=n,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,8,Ne),[[C,x.value[o.id]]]),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-blue-500 text-white hover:bg-blue-600",title:"Guardar",onClick:n=>G(o.id,$.category.id)},"✔",8,Me),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100",title:"Cancelar",onClick:n=>L(o.id)},"✖",8,Ue)])):(l(),a("div",je,[e("button",{type:"button",class:"w-6 h-6 inline-flex items-center justify-center rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100",title:i.value[o.id]?"Colapsar subniveles":"Expandir subniveles",onClick:n=>se(o.id)},[i.value[o.id]?(l(),a("span",Se,"v")):(l(),a("span",Ee,">"))],8,Ae),e("span",$e,p(o.name),1),typeof o.children_count<"u"?(l(),a("span",Ve,"("+p(o.children_count)+")",1)):u("",!0)]))]),e("div",De,[e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:"Renombrar",onClick:n=>T(o)},[...t[8]||(t[8]=[e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M16.862 3.487a2.25 2.25 0 113.182 3.182L9.428 17.284a3.75 3.75 0 01-1.582.992l-2.685.805a.75.75 0 01-.93-.93l.805-2.685a3.75 3.75 0 01.992-1.582L16.862 3.487z"}),e("path",{d:"M15.75 4.5l3.75 3.75"})],-1)])],8,Le),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded border border-green-500 text-green-600 hover:bg-green-50",title:"Añadir subnivel",onClick:n=>ee(o.id)},[...t[9]||(t[9]=[e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("rect",{x:"4",y:"3",width:"11",height:"15",rx:"2",ry:"2","stroke-width":"1.5"}),e("circle",{cx:"18",cy:"18",r:"3","stroke-width":"1.5"}),e("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M18 16.5v3M16.5 18h3"})],-1)])],8,ze),e("button",{onClick:n=>O(o.id),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},[...t[10]||(t[10]=[e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1)])],8,Pe)])]),h.value[o.id]?(l(),a("div",Fe,[t[11]||(t[11]=e("label",{class:"block text-xs text-gray-600 mb-1"},"Añadir Nueva Subcategoría",-1)),e("div",Re,[k(e("input",{"onUpdate:modelValue":n=>m.value[o.id]=n,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Ej: Baños"},null,8,He),[[C,m.value[o.id]]]),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",disabled:A.value[o.id],onClick:n=>H(o.id)},"✔",8,Te),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:n=>te(o.id)},"✖",8,Ge)]),g.value[o.id]?(l(),a("p",Oe,p(g.value[o.id]),1)):u("",!0)])):u("",!0),i.value[o.id]?(l(),a("div",Qe,[z.value[o.id]?(l(),a("p",qe,"Cargando…")):u("",!0),(l(!0),a(F,null,K(E.value[o.id]||[],n=>(l(),a("div",{key:n.id,class:"py-1 flex justify-between items-center"},[e("div",Je,[N.value[n.id]?(l(),a("div",We,[k(e("input",{"onUpdate:modelValue":y=>x.value[n.id]=y,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,8,Xe),[[C,x.value[n.id]]]),e("button",{type:"button",class:"bg-blue-500 text-white text-xs font-semibold py-1 px-2 rounded",onClick:y=>G(n.id,o.id)},"Guardar",8,Ye),e("button",{type:"button",class:"text-xs text-gray-600",onClick:y=>L(n.id)},"Cancelar",8,Ze)])):(l(),a("div",Ke,p(n.name),1))]),e("div",Ie,[e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:"Renombrar",onClick:y=>T(n)},[...t[12]||(t[12]=[e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M16.862 3.487a2.25 2.25 0 113.182 3.182L9.428 17.284a3.75 3.75 0 01-1.582.992l-2.685.805a.75.75 0 01-.93-.93l.805-2.685a3.75 3.75 0 01.992-1.582L16.862 3.487z"}),e("path",{d:"M15.75 4.5l3.75 3.75"})],-1)])],8,et),e("button",{onClick:y=>O(n.id,o.id),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},[...t[13]||(t[13]=[e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1)])],8,tt)]),h.value[n.id]?(l(),a("div",st,[t[14]||(t[14]=e("label",{class:"block text-xs text-gray-600 mb-1"},"Nombre del subnivel",-1)),e("div",ot,[k(e("input",{"onUpdate:modelValue":y=>m.value[n.id]=y,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Ej: Accesorios"},null,8,nt),[[C,m.value[n.id]]]),e("button",{type:"button",class:"bg-green-500 text-white font-bold py-1 px-3 rounded hover:bg-green-600",disabled:A.value[n.id],onClick:y=>H(n.id)},"Añadir",8,at)]),g.value[n.id]?(l(),a("p",lt,p(g.value[n.id]),1)):u("",!0)])):u("",!0)]))),128))])):u("",!0)]))),128))]),e("form",{onSubmit:J(Y,["prevent"]),class:"mt-6 border-t pt-4"},[t[15]||(t[15]=e("label",{class:"block font-medium text-sm text-gray-700"},"Añadir Nueva Subcategoría",-1)),e("div",rt,[k(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>d(v).name=o),type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Nombre de la nueva subcategoría"},null,512),[[C,d(v).name]]),e("button",{type:"submit",disabled:d(v).processing,class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",title:"Añadir"},"✔",8,it),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:Z,title:"Cancelar"},"✖")]),d(v).errors.name?(l(),a("p",dt,p(d(v).errors.name),1)):u("",!0)],32)])])])])]),_:1}),_(le,{show:U.value,onClose:B},{default:S(()=>[e("div",ut,[t[18]||(t[18]=e("h2",{class:"text-lg font-medium text-gray-900"}," ¿Querés eliminar esta subcategoría? ",-1)),t[19]||(t[19]=e("p",{class:"mt-1 text-sm text-gray-600"}," Esta acción es irreversible y removerá la subcategoría seleccionada. ",-1)),e("div",ct,[_(ie,{onClick:B},{default:S(()=>[...t[16]||(t[16]=[W("Cancelar",-1)])]),_:1}),_(de,{class:"ms-3",onClick:I},{default:S(()=>[...t[17]||(t[17]=[W("Sí, eliminar",-1)])]),_:1})])])]),_:1},8,["show"]),_(re,{show:M.value,type:"error",title:"No se puede eliminar",messages:[Q.value],"primary-text":"Entendido",onPrimary:t[4]||(t[4]=o=>M.value=!1),onClose:t[5]||(t[5]=o=>M.value=!1)},null,8,["show","messages"])],64))}};export{xt as default};
