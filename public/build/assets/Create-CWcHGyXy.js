import{M as Z,r as V,y as ee,w as j,c as se,z as te,b as d,d as c,e as y,u as a,h as oe,f as E,g as e,x as le,i as h,j as m,v as _,N as I,k as O,m as q,t as v,F as x,l as k,A as B,n as ne}from"./app-D7ttTWGz.js";import{_ as ae}from"./AuthenticatedLayout-DDDo1cMT.js";import{_ as N}from"./AlertModal-Bl0CaqCv.js";import"./Modal-UfrBPs3q.js";const re=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear producto",-1),ie={class:"py-12"},de={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ce={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ue={class:"p-6 text-gray-900"},me={class:"mb-4"},pe=e("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1),_e={class:"mb-4"},he=e("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1),ge={class:"p-4 border rounded-md bg-gray-50"},fe={class:"inline-flex items-center gap-2 mb-3 select-none"},be=e("span",{class:"font-semibold"},"Controlar inventario",-1),ye={key:0,class:"font-semibold text-gray-800 mb-2"},ve={key:1,class:"text-xs text-gray-500 mb-4"},xe={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ke={for:"quantity",class:"block font-medium text-sm text-gray-700 flex items-center"},we=["disabled"],Se={key:0,class:"mt-1 text-sm text-red-600"},Ve={for:"alert",class:"block font-medium text-sm text-gray-700 flex items-center"},Ce=["disabled"],Ae={for:"purchase_price",class:"block font-medium text-sm text-gray-700 flex items-center"},Ue=e("div",{class:"mt-4 mb-2"},[e("label",{class:"block font-medium text-sm text-gray-700"},"Categorías")],-1),Oe={class:"space-y-3"},$e=["onUpdate:modelValue","onChange"],Te=e("option",{value:null},"Seleccione una categoría",-1),je=["value"],Me={key:0,class:"mt-1 text-sm text-red-600"},Pe={class:"mb-4"},Ee=e("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"Descripción Corta",-1),Ie={class:"mb-4"},qe=e("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"Descripción Larga",-1),Be={class:"mb-4"},Ne=e("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1),ze={class:"mb-4"},De=e("label",{for:"gallery_files",class:"block font-medium text-sm text-gray-700"},"Imágenes de la Galería",-1),Fe=e("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1),Le={class:"md:col-span-2 mt-6 border-t pt-6"},Re=e("h3",{class:"text-lg font-medium text-gray-900"},"Variantes del Producto",-1),Ge=e("p",{class:"text-sm text-gray-600 mb-4"}," Cada fila representa una combinación única. Si usás inventario, el stock total se suma automáticamente. ",-1),He={class:"mb-4 p-4 border rounded-md bg-gray-50"},We=e("h4",{class:"font-semibold text-gray-800 mb-2"},"Atributos de variantes",-1),Qe=e("p",{class:"text-xs text-gray-500 mb-3"},'Ejemplos: Nombre "Color" y Valores "Rojo, Verde, Azul". Podés agregar más filas como "Talla" con "S, M, L".',-1),Xe={class:"space-y-2"},Ye={class:"md:col-span-2"},Je=e("label",{class:"block text-sm font-medium text-gray-700"},"Nombre",-1),Ke=["onUpdate:modelValue"],Ze={class:"md:col-span-3"},es=e("label",{class:"block text-sm font-medium text-gray-700"},"Valores (separados por coma)",-1),ss=["onUpdate:modelValue"],ts={class:"md:col-span-5"},os={class:"inline-flex items-center gap-2 text-sm"},ls=["onUpdate:modelValue"],ns=e("span",null,"Configurar dependencia",-1),as={key:0,class:"md:col-span-5 grid grid-cols-1 md:grid-cols-5 gap-3 items-start"},rs={class:"md:col-span-2"},is=e("label",{class:"block text-sm font-medium text-gray-700"},"Depende de",-1),ds=["onUpdate:modelValue"],cs=e("option",{value:""},"(sin dependencia)",-1),us=["value","disabled"],ms={key:0,class:"md:col-span-3"},ps=e("label",{class:"block text-sm font-medium text-gray-700"},"Permitir valores del hijo según el valor del padre",-1),_s={class:"mt-2 space-y-3"},hs={class:"text-xs font-semibold text-gray-700 mb-2"},gs={class:"flex flex-wrap gap-3"},fs=["checked","onChange"],bs=e("p",{class:"text-xs text-gray-500 mt-2"},"Si no seleccionas nada para un valor del padre, se permiten todos los valores del hijo.",-1),ys={class:"md:col-span-5 flex gap-2"},vs=["onClick"],xs={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},ks=["disabled"],ws=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M4 4a2 2 0 0 1 2-2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4zm9-1.5V7h4.5L13 2.5z"}),e("path",{d:"M8 13h8v2H8zM8 9h5v2H8z"})],-1),Ss=e("span",null,"Crear",-1),Vs=[ws,Ss],Cs={key:0,class:"ml-3 text-sm text-red-600"},As=2*1024*1024,js={__name:"Create",props:{categories:Array},setup(z){const D=z,F=Z(),C=V(!!F?.props?.flash?.success),w=V(!1),$=V([]),L=l=>{const s=Array.from(l?.target?.files||[]),r=[],t=[];for(const i of s){if(!(i?.type||"").startsWith("image/")){r.push(`${i.name}: no es una imagen válida.`);continue}if(i.size>As){r.push(`${i.name}: supera el límite de 2 MB.`);continue}t.push(i)}if(r.length){$.value=["Problemas con las imágenes seleccionadas:",...r],w.value=!0,l?.target&&(l.target.value=""),o.gallery_files=[];return}o.gallery_files=t},A=V([{options:D.categories,selected:null}]),R=l=>{A.value.splice(l+1)},G=async l=>{const s=A.value[l].selected;if(R(l),o.category_id=s,!s)return;const r=await fetch(route("admin.categories.children",s));if(!r.ok)return;const t=await r.json(),i=Array.isArray(t.data)?t.data:[];i.length>0&&A.value.push({options:i,selected:null})},o=ee({name:"",price:"",purchase_price:null,retail_price:null,track_inventory:!0,quantity:0,alert:null,category_id:null,short_description:"",long_description:"",specifications:"",gallery_files:[],variants:[],variant_attributes:[]});j(()=>o.track_inventory,l=>{l&&(o.retail_price=o.price)}),j(()=>o.price,l=>{o.track_inventory&&(o.retail_price=l)});const b=V([{name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}}]),H=()=>{b.value.push({name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}})},W=l=>{b.value.splice(l,1)},U=l=>String(l||"").split(",").map(s=>s.trim()).filter(Boolean);function Q(l,s,r){return(l.rulesSelected&&Array.isArray(l.rulesSelected[s])?l.rulesSelected[s]:[]).includes(r)}function X(l,s,r,t){const i=!!t?.target?.checked;l.rulesSelected||(l.rulesSelected={});const n=Array.isArray(l.rulesSelected[s])?[...l.rulesSelected[s]]:[],p=n.indexOf(r);i&&p===-1&&n.push(r),!i&&p!==-1&&n.splice(p,1),l.rulesSelected[s]=n}const Y=se(()=>o.variants.length===0?Number(o.quantity)||0:o.variants.reduce((l,s)=>l+(Number(s.stock)||0),0));j(Y,l=>{o.variants.length>0&&(o.quantity=l)});const J=()=>{try{const l=b.value.map(s=>({name:String(s.name||"").trim(),values:U(s.valuesText),dependsOn:String(s.dependsOn||"").trim(),rules:s.rules||{},rulesSelected:s.rulesSelected||{}})).filter(s=>s.name&&s.values.length>0);if(o.variant_attributes=l,l.length>0){let i=function(u){t.has(u.name)||(u.dependsOn&&s[u.dependsOn]&&i(s[u.dependsOn]),t.add(u.name),r.push(u))},p=function(u,g){if(u===r.length){n.push({...g});return}const f=r[u];let M=f.values;if(f.dependsOn){const S=g[f.dependsOn];if(S!=null){const T=f.rulesSelected?.[S]??f.rules?.[S]??[],P=Array.isArray(T)?T:U(T);P.length>0&&(M=f.values.filter(K=>P.includes(K)))}}for(const S of M)g[f.name]=S,p(u+1,g);delete g[f.name]};const s=Object.fromEntries(l.map(u=>[u.name,u])),r=[],t=new Set;l.forEach(i);const n=[];p(0,{}),o.variants=n.map(u=>({options_text:r.map(g=>`${g.name}:${u[g.name]}`).join(", "),price:"",purchase_price:null,stock:0,alert:null}))}}catch{}o.post(route("admin.products.store"),{preserveScroll:!0,onError:async()=>{await ne();const l=[];for(const[t,i]of Object.entries(o.errors))t.startsWith("gallery_files.")&&String(i).includes("The gallery files.")?l.push("Una o más imágenes superan el tamaño máximo permitido (2 MB) o no son válidas."):t.startsWith("new_gallery_files.")?l.push("Una o más imágenes nuevas superan el tamaño máximo permitido (2 MB) o no son válidas."):l.push(String(i));$.value=l,w.value=l.length>0;const s=Object.keys(o.errors)[0],r=document.getElementById(s);r&&typeof r.scrollIntoView=="function"&&(r.scrollIntoView({behavior:"smooth",block:"center"}),r.focus?.())},onSuccess:()=>{C.value=!0,o.reset()}})};return(l,s)=>{const r=te("InfoTip");return c(),d(x,null,[y(a(oe),{title:"Crear Producto"}),y(ae,null,{header:E(()=>[re]),default:E(()=>[e("div",ie,[e("div",de,[e("div",ce,[e("div",ue,[e("form",{onSubmit:le(J,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,[e("div",me,[pe,m(e("input",{id:"name","onUpdate:modelValue":s[0]||(s[0]=t=>a(o).name=t),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,a(o).name]])]),e("div",_e,[he,m(e("input",{id:"price","onUpdate:modelValue":s[1]||(s[1]=t=>a(o).price=t),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,a(o).price]])]),e("div",ge,[e("label",fe,[m(e("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=t=>a(o).track_inventory=t),class:"rounded"},null,512),[[I,a(o).track_inventory]]),be]),a(o).track_inventory?(c(),d("h4",ye,"Inventario y Precios")):h("",!0),a(o).track_inventory?(c(),d("p",ve," Si creas variantes, estos totales se calcularán solos. ")):h("",!0),a(o).track_inventory?(c(),d("div",xe,[e("div",null,[e("label",ke,[O("Inventario (Total) "),y(r,{class:"ml-1 md:hidden",text:"Stock si no hay variantes. Con variantes, se suma automáticamente."})]),m(e("input",{id:"quantity","onUpdate:modelValue":s[3]||(s[3]=t=>a(o).quantity=t),type:"number",class:q(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":a(o).variants.length>0}]),disabled:a(o).track_inventory===!1||a(o).variants.length>0,title:"Stock si no hay variantes. Con variantes, se suma automáticamente."},null,10,we),[[_,a(o).quantity]]),a(o).errors.quantity?(c(),d("p",Se,v(a(o).errors.quantity),1)):h("",!0)]),e("div",null,[e("label",Ve,[O("Alerta (Opcional) "),y(r,{class:"ml-1 md:hidden",text:"Se considera bajo stock cuando cantidad ≤ alerta."})]),m(e("input",{id:"alert","onUpdate:modelValue":s[4]||(s[4]=t=>a(o).alert=t),type:"number",class:q(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":a(o).variants.length>0&&a(o).track_inventory}]),disabled:a(o).variants.length>0&&a(o).track_inventory,title:"Se considera bajo stock cuando cantidad ≤ alerta."},null,10,Ce),[[_,a(o).alert]])]),e("div",null,[e("label",Ae,[O("Precio de compra "),y(r,{class:"ml-1 md:hidden",text:"Costo de adquisición del producto."})]),m(e("input",{id:"purchase_price","onUpdate:modelValue":s[5]||(s[5]=t=>a(o).purchase_price=t),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[_,a(o).purchase_price]])])])):h("",!0)]),Ue,e("div",Oe,[(c(!0),d(x,null,k(A.value,(t,i)=>(c(),d("div",{key:i,class:"mb-1"},[m(e("select",{class:"block w-full rounded-md shadow-sm border-gray-300","onUpdate:modelValue":n=>t.selected=n,onChange:n=>G(i)},[Te,(c(!0),d(x,null,k(t.options,n=>(c(),d("option",{key:n.id,value:n.id},v(n.name),9,je))),128))],40,$e),[[B,t.selected]])]))),128))]),a(o).errors.category_id?(c(),d("p",Me,v(a(o).errors.category_id),1)):h("",!0)]),e("div",null,[e("div",Pe,[Ee,m(e("textarea",{id:"short_description","onUpdate:modelValue":s[6]||(s[6]=t=>a(o).short_description=t),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[_,a(o).short_description]])]),e("div",Ie,[qe,m(e("textarea",{id:"long_description","onUpdate:modelValue":s[7]||(s[7]=t=>a(o).long_description=t),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[_,a(o).long_description]])]),e("div",Be,[Ne,m(e("input",{id:"specifications","onUpdate:modelValue":s[8]||(s[8]=t=>a(o).specifications=t),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"Alto: 2.30m,Ancho: 1.20m,..."},null,512),[[_,a(o).specifications]])]),e("div",ze,[De,e("input",{id:"gallery_files",onInput:s[9]||(s[9]=t=>L(t)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),Fe])]),e("div",Le,[Re,Ge,e("div",He,[We,Qe,e("div",Xe,[(c(!0),d(x,null,k(b.value,(t,i)=>(c(),d("div",{key:`attr-${i}`,class:"grid grid-cols-1 md:grid-cols-5 gap-3 items-center"},[e("div",Ye,[Je,m(e("input",{"onUpdate:modelValue":n=>t.name=n,type:"text",placeholder:"Color",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Ke),[[_,t.name]])]),e("div",Ze,[es,m(e("input",{"onUpdate:modelValue":n=>t.valuesText=n,type:"text",placeholder:"Rojo, Verde, Azul",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,ss),[[_,t.valuesText]])]),e("div",ts,[e("label",os,[m(e("input",{type:"checkbox","onUpdate:modelValue":n=>t.__showDependency=n,class:"rounded"},null,8,ls),[[I,t.__showDependency]]),ns])]),t.__showDependency?(c(),d("div",as,[e("div",rs,[is,m(e("select",{"onUpdate:modelValue":n=>t.dependsOn=n,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},[cs,(c(!0),d(x,null,k(b.value,(n,p)=>(c(),d("option",{key:`dep-${i}-${p}`,value:n.name,disabled:n===t||!n.name},v(n.name||"(sin nombre)"),9,us))),128))],8,ds),[[B,t.dependsOn]])]),t.dependsOn?(c(),d("div",ms,[ps,e("div",_s,[(c(!0),d(x,null,k(U(b.value.find(n=>n.name===t.dependsOn)?.valuesText||""),n=>(c(),d("div",{key:`pv-${i}-${n}`,class:"border rounded p-2"},[e("div",hs,[O(v(t.dependsOn)+" = ",1),e("strong",null,v(n),1)]),e("div",gs,[(c(!0),d(x,null,k(U(t.valuesText),p=>(c(),d("label",{key:`cv-${i}-${n}-${p}`,class:"inline-flex items-center gap-1 text-sm"},[e("input",{type:"checkbox",checked:Q(t,n,p),onChange:u=>X(t,n,p,u),class:"rounded"},null,40,fs),e("span",null,v(p),1)]))),128))])]))),128))]),bs])):h("",!0)])):h("",!0),e("div",ys,[e("button",{type:"button",class:"text-sm text-blue-600 hover:text-blue-800",onClick:H},"+ Añadir atributo"),b.value.length>1?(c(),d("button",{key:0,type:"button",class:"text-sm text-red-600 hover:text-red-800",onClick:n=>W(i)},"Quitar",8,vs)):h("",!0)])]))),128))])])]),e("div",xs,[e("button",{type:"submit",disabled:a(o).processing,class:"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow"},Vs,8,ks),Object.keys(a(o).errors).length?(c(),d("span",Cs,"Por favor corrige los campos marcados.")):h("",!0)])],32)])])])])]),_:1}),y(N,{show:C.value,type:"success",title:"¡Producto creado con éxito!","primary-text":"Entendido",onPrimary:s[10]||(s[10]=t=>C.value=!1),onClose:s[11]||(s[11]=t=>C.value=!1)},null,8,["show"]),y(N,{show:w.value,type:"error",title:"No pudimos guardar el producto",message:"Revisá los siguientes puntos:",messages:$.value,"primary-text":"Entendido",onPrimary:s[12]||(s[12]=t=>w.value=!1),onClose:s[13]||(s[13]=t=>w.value=!1)},null,8,["show","messages"])],64)}}};export{js as default};
