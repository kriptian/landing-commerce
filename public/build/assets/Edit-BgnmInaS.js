import{L as ae,r as b,p as re,C as de,N as ue,c as k,w as G,a as d,o as u,b as y,u as n,h as me,d as w,e as t,s as f,f as V,g as m,v as g,M as ce,n as j,F as x,i as _,t as M,x as pe,m as L}from"./app-BRVkAi0d.js";import{_ as ge}from"./AuthenticatedLayout-BpCRplDY.js";import{_ as T}from"./AlertModal-Kba0pXFQ.js";import{_ as fe}from"./Modal-BqEUkn8w.js";import{_ as ve}from"./SecondaryButton-B7UnpNNk.js";import{D as be}from"./DangerButton-CYQpnfup.js";const ye={class:"font-semibold text-xl text-gray-800 leading-tight"},xe={class:"py-12"},he={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ke={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},we={class:"p-6 text-gray-900"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ce={class:"mb-4"},Ve={class:"mb-4"},je={class:"inline-flex items-center gap-2 mb-3 select-none"},Me={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Ue=["disabled"],Ae={key:0,class:"text-xs text-gray-500 mt-1"},Se={key:1,class:"text-xs text-gray-500 mt-1"},Pe=["disabled"],Ee=["disabled"],Ie={class:"space-y-3"},$e=["onUpdate:modelValue","onChange"],ze=["value"],Ne={class:"mb-4"},qe={class:"mb-4"},Oe={class:"mb-4"},Be={class:"md:col-span-2 mt-6 border-t pt-6"},De={class:"md:col-span-2"},Ge=["onUpdate:modelValue"],Le=["onUpdate:modelValue"],Te=["onUpdate:modelValue"],Fe=["onUpdate:modelValue"],Re=["onUpdate:modelValue"],We=["onClick"],Je={class:"mt-6 border-t pt-6"},Qe={class:"p-4 border rounded-md bg-gray-50 col-span-2"},Xe={class:"flex items-center justify-between mb-2"},Ye={class:"text-xs text-gray-500"},He={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3"},Ke=["onClick"],Ze=["src"],et=["onClick"],tt={key:1,class:"text-sm text-gray-500 mt-2"},st={class:"mt-4 col-span-2"},ot={class:"relative flex items-center justify-center bg-gray-50 border rounded-lg h-[60vh] min-h-[320px] mb-3 select-none"},lt=["src"],nt={class:"flex items-center gap-2 overflow-x-auto py-2"},it=["onClick"],at=["src"],rt={class:"flex items-center justify-end mt-6 border-t pt-6"},dt=["disabled"],ut={class:"p-6"},mt={class:"mt-6 flex justify-end"},ct=2*1024*1024,xt={__name:"Edit",props:{product:Object,categories:Array,selectedCategoryPath:Array},setup(F){const r=F,$=ae(),U=b(!!$?.props?.flash?.success);b($?.props?.flash?.success||"");const C=b(!1),h=b(!1),A=b([]),R=o=>{const e=Array.from(o?.target?.files||[]),s=[],a=[];for(const i of e){if(!(i?.type||"").startsWith("image/")){s.push(`${i.name}: no es una imagen válida.`);continue}if(i.size>ct){s.push(`${i.name}: supera el límite de 2 MB.`);continue}a.push(i)}if(s.length){A.value=["Problemas con las imágenes seleccionadas:",...s],h.value=!0,o?.target&&(o.target.value=""),l.new_gallery_files=[];return}l.new_gallery_files=a},c=b([{options:r.categories,selected:null}]),W=async()=>{if(!Array.isArray(r.selectedCategoryPath)||r.selectedCategoryPath.length===0)return;for(let e=0;e<r.selectedCategoryPath.length;e++){const s=r.selectedCategoryPath[e];if(c.value[e]||(c.value[e]={options:[],selected:null}),e>0&&c.value[e].options.length===0){const a=c.value[e-1].selected;if(a){const I=await(await fetch(route("admin.categories.children",a))).json();c.value[e].options=Array.isArray(I.data)?I.data:[]}}c.value[e].selected=s.id,l.category_id=s.id,e<r.selectedCategoryPath.length-1&&(c.value[e+1]||(c.value[e+1]={options:[],selected:null}))}const o=l.category_id;if(o){const s=await(await fetch(route("admin.categories.children",o))).json(),a=Array.isArray(s.data)?s.data:[];a.length>0&&c.value.push({options:a,selected:null})}},J=o=>{c.value.splice(o+1)},Q=async o=>{const e=c.value[o].selected;if(J(o),l.category_id=e||null,!e)return;const s=await fetch(route("admin.categories.children",e));if(!s.ok)return;const a=await s.json(),i=Array.isArray(a.data)?a.data:[];i.length>0&&c.value.push({options:i,selected:null})},X=o=>Object.entries(o).map(([e,s])=>`${e}:${s}`).join(", "),Y=r.product.variants.map(o=>({id:o.id,options_text:X(o.options),price:o.price??"",stock:o.stock,minimum_stock:o.minimum_stock,alert:o.alert??null})),l=re({_method:"PUT",name:r.product.name,price:r.product.price,track_inventory:r.product.track_inventory??!0,quantity:r.product.quantity,minimum_stock:r.product.minimum_stock,alert:r.product.alert??null,category_id:r.product.category_id,short_description:r.product.short_description,long_description:r.product.long_description,specifications:r.product.specifications?JSON.parse(r.product.specifications).join(", "):"",new_gallery_files:[],images_to_delete:[],variants:Y,variants_to_delete:[]}),p=b([...r.product.images]),z=o=>{l.images_to_delete.push(o.id),p.value=p.value.filter(e=>e.id!==o.id)},S=b(!1),v=b(0),N=b(!1);function P(){N.value=window.innerWidth<768}de(()=>{P(),window.addEventListener("resize",P),W()}),ue(()=>window.removeEventListener("resize",P));const E=k(()=>N.value?1:4),H=k(()=>p.value.slice(0,E.value)),q=k(()=>p.value.slice(E.value));function O(o=0){v.value=o,S.value=!0}function B(){S.value=!1}function K(){const o=p.value.length;o!==0&&(v.value=(v.value-1+o)%o)}function Z(){const o=p.value.length;o!==0&&(v.value=(v.value+1)%o)}function ee(o){o<0||o>=p.value.length||(v.value=o)}const te=()=>{l.variants.push({id:null,options_text:"",price:"",stock:0,minimum_stock:1,alert:null})},se=o=>{const e=l.variants[o];e.id&&l.variants_to_delete.push(e.id),l.variants.splice(o,1)},oe=k(()=>{if(l.variants.length>0){let o=0;return l.variants.forEach(e=>{o+=Number(e.stock)||0}),o}return Number(l.quantity)||0});G(oe,o=>{l.variants.length>0&&(l.quantity=o)});const le=k(()=>l.variants.length===0?Number(l.minimum_stock)||0:l.variants.reduce((o,e)=>o+(Number(e.minimum_stock)||0),0));G(le,o=>{l.variants.length>0&&(l.minimum_stock=o)},{immediate:!0});const ne=()=>{C.value=!0},D=()=>{C.value=!1},ie=()=>{l.post(route("admin.products.update",r.product.id),{onError:async()=>{const o=[];for(const[e,s]of Object.entries(l.errors))e.startsWith("new_gallery_files.")&&String(s).toLowerCase().includes("image")?o.push("Una o más imágenes nuevas superan el tamaño máximo permitido (2 MB) o no son válidas."):o.push(String(s));A.value=o,h.value=o.length>0},onFinish:()=>{C.value=!1}})};return(o,e)=>(u(),d(x,null,[y(n(me),{title:"Editar Producto"}),y(ge,null,{header:w(()=>[t("h2",ye,"Editar Producto: "+M(n(l).name),1)]),default:w(()=>[t("div",xe,[t("div",he,[t("div",ke,[t("div",we,[t("form",{onSubmit:f(ne,["prevent"])},[t("div",_e,[t("div",null,[t("div",Ce,[e[21]||(e[21]=t("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1)),m(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=s=>n(l).name=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[g,n(l).name]])]),t("div",Ve,[e[22]||(e[22]=t("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1)),m(t("input",{id:"price","onUpdate:modelValue":e[1]||(e[1]=s=>n(l).price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[g,n(l).price]])]),t("label",je,[m(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>n(l).track_inventory=s),class:"rounded"},null,512),[[ce,n(l).track_inventory]]),e[23]||(e[23]=t("span",{class:"font-semibold"},"Controlar inventario",-1))]),n(l).track_inventory&&n(l).variants.length===0?(u(),d("div",Me,[t("div",null,[e[24]||(e[24]=t("label",{for:"quantity",class:"block font-medium text-sm text-gray-700"},"Inventario (Total)",-1)),m(t("input",{id:"quantity","onUpdate:modelValue":e[3]||(e[3]=s=>n(l).quantity=s),type:"number",class:j(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(l).variants.length>0}]),disabled:n(l).variants.length>0,required:""},null,10,Ue),[[g,n(l).quantity]]),n(l).variants.length>0?(u(),d("p",Ae,"Suma automática de variantes.")):(u(),d("p",Se,"Stock si no hay variantes."))]),t("div",null,[e[25]||(e[25]=t("label",{for:"minimum_stock",class:"block font-medium text-sm text-gray-700"},"Inventario Mínimo",-1)),m(t("input",{id:"minimum_stock","onUpdate:modelValue":e[4]||(e[4]=s=>n(l).minimum_stock=s),type:"number",class:j(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(l).variants.length>0}]),disabled:n(l).variants.length>0},null,10,Pe),[[g,n(l).minimum_stock]]),e[26]||(e[26]=t("p",{class:"text-xs text-gray-500 mt-1"},"Alerta de bajo stock (general).",-1))]),t("div",null,[e[27]||(e[27]=t("label",{for:"alert_general",class:"block font-medium text-sm text-gray-700"},"Alerta (Opcional)",-1)),m(t("input",{id:"alert_general","onUpdate:modelValue":e[5]||(e[5]=s=>n(l).alert=s),type:"number",class:j(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(l).variants.length>0}]),disabled:n(l).variants.length>0},null,10,Ee),[[g,n(l).alert]])])])):V("",!0),e[29]||(e[29]=t("div",{class:"mb-2"},[t("label",{class:"block font-medium text-sm text-gray-700"},"Categorías")],-1)),t("div",Ie,[(u(!0),d(x,null,_(c.value,(s,a)=>(u(),d("div",{key:a,class:"mb-1"},[m(t("select",{class:"block w-full rounded-md shadow-sm border-gray-300","onUpdate:modelValue":i=>s.selected=i,onChange:i=>Q(a)},[e[28]||(e[28]=t("option",{value:null},"Seleccione una categoría",-1)),(u(!0),d(x,null,_(s.options,i=>(u(),d("option",{key:i.id,value:i.id},M(i.name),9,ze))),128))],40,$e),[[pe,s.selected]])]))),128))])]),t("div",null,[t("div",Ne,[e[30]||(e[30]=t("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"Descripción Corta",-1)),m(t("textarea",{id:"short_description","onUpdate:modelValue":e[6]||(e[6]=s=>n(l).short_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[g,n(l).short_description]])]),t("div",qe,[e[31]||(e[31]=t("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"Descripción Larga",-1)),m(t("textarea",{id:"long_description","onUpdate:modelValue":e[7]||(e[7]=s=>n(l).long_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[g,n(l).long_description]])]),t("div",Oe,[e[32]||(e[32]=t("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1)),m(t("input",{id:"specifications","onUpdate:modelValue":e[8]||(e[8]=s=>n(l).specifications=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[g,n(l).specifications]])])])]),t("div",Be,[e[38]||(e[38]=t("h3",{class:"text-lg font-medium text-gray-900"},"Variantes del Producto",-1)),e[39]||(e[39]=t("p",{class:"text-sm text-gray-600 mb-4"}," Editá, añadí o eliminá las combinaciones de variantes. ",-1)),e[40]||(e[40]=t("div",{class:"hidden md:grid grid-cols-6 gap-4 mb-2 text-sm font-medium text-gray-600"},[t("div",{class:"col-span-2"},"Opciones (ej: Color:Rojo)"),t("div",null,"Precio (Opcional)"),t("div",null,"Stock Actual"),t("div",null,"Stock Mínimo"),t("div",null,"Alerta (Opcional)")],-1)),(u(!0),d(x,null,_(n(l).variants,(s,a)=>(u(),d("div",{key:a,class:"grid grid-cols-1 md:grid-cols-6 gap-4 items-center mb-2"},[t("div",De,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Opciones",-1)),m(t("input",{type:"text","onUpdate:modelValue":i=>s.options_text=i,placeholder:"Color:Rojo, Talla:M",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Ge),[[g,s.options_text]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Precio (Opcional)",-1)),m(t("input",{type:"number",step:"0.01","onUpdate:modelValue":i=>s.price=i,placeholder:"Usa precio principal",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Le),[[g,s.price]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Actual",-1)),m(t("input",{type:"number","onUpdate:modelValue":i=>s.stock=i,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Te),[[g,s.stock]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Mínimo",-1)),m(t("input",{type:"number","onUpdate:modelValue":i=>s.minimum_stock=i,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Fe),[[g,s.minimum_stock]])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Alerta (Opcional)",-1)),m(t("input",{type:"number","onUpdate:modelValue":i=>s.alert=i,placeholder:"Ej: 5",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Re),[[g,s.alert]])]),t("button",{onClick:i=>se(a),type:"button",class:"text-red-600 hover:text-red-800 text-sm self-end pb-2 md:pb-0"}," Quitar ",8,We)]))),128)),t("button",{onClick:te,type:"button",class:"mt-4 text-sm font-medium text-blue-600 hover:text-blue-800"}," + Añadir Variante ")]),t("div",Je,[t("div",Qe,[t("div",Xe,[e[41]||(e[41]=t("label",{class:"block font-medium text-sm text-gray-700"},"Imágenes actuales",-1)),t("span",Ye,M(p.value.length)+" imagen(es)",1)]),p.value.length>0?(u(),d("div",He,[(u(!0),d(x,null,_(H.value,(s,a)=>(u(),d("div",{key:s.id,class:"relative rounded-lg overflow-hidden border bg-white shadow-sm hover:shadow-md transition group cursor-pointer",onClick:i=>O(a)},[t("img",{src:s.path,class:"w-full h-full aspect-[4/3] object-cover",alt:"Imagen del producto"},null,8,Ze),t("button",{onClick:f(i=>z(s),["stop","prevent"]),type:"button",class:"absolute top-2 right-2 bg-red-600 text-white rounded-full w-7 h-7 flex items-center justify-center shadow-md hover:bg-red-700"}," × ",8,et)],8,Ke))),128)),q.value.length>0?(u(),d("div",{key:0,class:"relative rounded-lg overflow-hidden border bg-white shadow-sm hover:shadow-md transition group cursor-pointer flex items-center justify-center text-gray-800 font-bold text-base h-full min-h-[90px]",onClick:e[9]||(e[9]=s=>O(E.value))}," +"+M(q.value.length),1)):V("",!0)])):(u(),d("p",tt,"Este producto no tiene imágenes."))]),t("div",st,[e[42]||(e[42]=t("label",{for:"new_gallery_files",class:"block font-medium text-sm text-gray-700"},"Añadir más imágenes",-1)),t("input",{id:"new_gallery_files",onInput:e[10]||(e[10]=s=>R(s)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),e[43]||(e[43]=t("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1))])]),S.value?(u(),d("div",{key:0,class:"fixed inset-0 bg-black/50 z-[1000] flex items-center justify-center p-4",style:{"pointer-events":"auto"},onClick:f(B,["self"])},[t("div",{class:"bg-white rounded-lg p-4 w-full max-w-5xl max-h-[85vh] overflow-hidden relative",onClick:e[16]||(e[16]=f(()=>{},["stop"]))},[t("button",{type:"button",class:"absolute top-3 right-3 bg-gray-900 text-white rounded-full w-8 h-8 flex items-center justify-center z-30",onClick:f(B,["stop","prevent"]),onMousedown:e[11]||(e[11]=f(()=>{},["stop","prevent"]))},"×",32),t("div",ot,[t("button",{class:"absolute left-2 bg-white/90 border rounded-full w-9 h-9 flex items-center justify-center z-20",onClick:f(K,["stop","prevent"]),onMousedown:e[12]||(e[12]=f(()=>{},["stop","prevent"]))},"‹",32),t("img",{src:p.value[v.value]?.path,class:"max-w-full max-h-full object-contain",alt:"Imagen"},null,8,lt),t("button",{class:"absolute right-2 bg-white/90 border rounded-full w-9 h-9 flex items-center justify-center z-20",onClick:f(Z,["stop","prevent"]),onMousedown:e[13]||(e[13]=f(()=>{},["stop","prevent"]))},"›",32),p.value[v.value]?(u(),d("button",{key:0,class:"absolute top-2 right-12 bg-red-600 text-white rounded px-2 py-1 text-xs z-20",type:"button",onClick:e[14]||(e[14]=f(s=>z(p.value[v.value]),["stop","prevent"])),onMousedown:e[15]||(e[15]=f(()=>{},["stop","prevent"]))},"Eliminar",32)):V("",!0)]),t("div",nt,[(u(!0),d(x,null,_(p.value,(s,a)=>(u(),d("div",{key:s.id,class:j(["border rounded p-1 cursor-pointer flex-shrink-0",{"ring-2 ring-blue-500":a===v.value}]),onClick:i=>ee(a)},[t("img",{src:s.path,class:"w-20 h-20 object-cover rounded",alt:"thumb"},null,8,at)],10,it))),128))])])])):V("",!0),t("div",rt,[t("button",{type:"submit",disabled:n(l).processing,class:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700"}," Actualizar Producto ",8,dt)])],32)])])])])]),_:1}),y(fe,{show:C.value,onClose:D},{default:w(()=>[t("div",ut,[e[46]||(e[46]=t("h2",{class:"text-lg font-medium text-gray-900"}," ¿Deseás guardar los cambios del producto? ",-1)),e[47]||(e[47]=t("p",{class:"mt-1 text-sm text-gray-600"}," Se actualizará la información y variantes del producto. ",-1)),t("div",mt,[y(ve,{onClick:D},{default:w(()=>[...e[44]||(e[44]=[L("Cancelar",-1)])]),_:1}),y(be,{class:"ms-3",onClick:ie,disabled:n(l).processing},{default:w(()=>[...e[45]||(e[45]=[L(" Guardar cambios ",-1)])]),_:1},8,["disabled"])])])]),_:1},8,["show"]),y(T,{show:U.value,type:"success",title:"Producto actualizado","primary-text":"Entendido",onPrimary:e[17]||(e[17]=s=>U.value=!1),onClose:e[18]||(e[18]=s=>U.value=!1)},null,8,["show"]),y(T,{show:h.value,type:"error",title:"No pudimos actualizar el producto",message:"Revisá los siguientes puntos:",messages:A.value,"primary-text":"Entendido",onPrimary:e[19]||(e[19]=s=>h.value=!1),onClose:e[20]||(e[20]=s=>h.value=!1)},null,8,["show","messages"])],64))}};export{xt as default};
