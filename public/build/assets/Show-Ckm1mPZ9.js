import{r as f,c as k,u as U,H as G,a as n,o as a,b as C,f as e,d as w,h as H,e as N,F as $,s as D,i as l,t as s,m as F,x as R,g as W,j as Q,p as Y,l as J}from"./app-D72QM3Va.js";import{_ as K}from"./AuthenticatedLayout-D2YWVFQF.js";import{_ as X}from"./AlertModal-Bp8KkPqa.js";import{d as Z,s as ee}from"./pdfUtils-nB1zq1eV.js";import"./Modal-BsW50ZMx.js";const te={class:"flex items-center justify-between w-full"},se={class:"font-semibold text-xl text-gray-800 leading-tight"},oe={class:"flex gap-2"},ne=["disabled"],ae={key:0},re={key:1},de=e("span",{class:"hidden sm:inline"},"Descargar",-1),ie=["disabled"],le={key:0},ce={key:1},ue=e("span",{class:"hidden sm:inline"},"Compartir",-1),me=e("span",null,"üñ®Ô∏è",-1),he=e("span",{class:"hidden sm:inline"},"Imprimir",-1),pe=[me,he],_e=e("span",null,"‚¨ÖÔ∏è",-1),ge=e("span",{class:"hidden sm:inline"},"Volver",-1),be={class:"py-12"},ye={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-3 gap-8"},ve={class:"lg:col-span-2 space-y-8"},xe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},fe={class:"p-6"},we=e("h3",{class:"text-lg font-semibold border-b pb-4 mb-4"},"Productos en la Orden",-1),$e={class:"divide-y divide-gray-200"},ke={class:"flex-grow"},Ce={class:"font-bold text-gray-900"},De={key:0,class:"text-sm text-gray-600 mt-1"},Fe={class:"font-semibold"},je={class:"text-sm text-gray-500 mt-2"},Te={class:"font-semibold text-gray-800 shrink-0 ml-4"},Ee={class:"border-t border-gray-200 pt-4 mt-4 text-right"},Ne={class:"space-y-1"},Se={key:0,class:"flex justify-end gap-8 text-gray-600"},Pe=e("span",null,"Subtotal:",-1),qe={key:1,class:"flex justify-end gap-8 text-gray-600"},Oe=e("span",null,"Costo de Env√≠o:",-1),Ie={key:2,class:"flex justify-end gap-8 text-red-600"},ze={class:"flex justify-end gap-8 text-2xl font-bold"},Ae=e("span",null,"Total:",-1),Ve={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Be={class:"p-6"},Le=e("h3",{class:"text-lg font-semibold border-b pb-4 mb-4"},"Datos del Cliente",-1),Me={class:"mt-4 space-y-4 text-gray-700"},Ue=e("p",{class:"font-semibold text-sm text-gray-500"},"Nombre:",-1),Ge=e("p",{class:"font-semibold text-sm text-gray-500"},"Tel√©fono:",-1),He=e("p",{class:"font-semibold text-sm text-gray-500"},"Correo:",-1),Re=e("p",{class:"font-semibold text-sm text-gray-500"},"Direcci√≥n:",-1),We={class:"space-y-8"},Qe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ye={class:"p-6"},Je=e("h3",{class:"text-lg font-semibold mb-4"},"Estado del Pedido",-1),Ke={class:"text-center mb-4"},Xe={class:"text-sm text-center text-gray-500"},Ze={class:"mt-6 border-t pt-6"},et=e("label",{for:"status",class:"block font-medium text-sm text-gray-700 mb-2"},"Cambiar Estado",-1),tt=e("option",{value:"recibido"},"Recibido",-1),st=e("option",{value:"en_preparacion"},"En Preparaci√≥n",-1),ot=e("option",{value:"despachado"},"Despachado",-1),nt=e("option",{value:"entregado"},"Entregado",-1),at=e("option",{value:"cancelado"},"Cancelado",-1),rt=[tt,st,ot,nt,at],dt=["disabled"],it={id:"invoice-content-digital",class:"fixed top-0 left-0 w-[80mm] bg-white z-[-100] opacity-0 pointer-events-none"},lt={class:"bg-white text-black p-2 font-mono text-[11px] leading-tight",style:{width:"80mm",margin:"0 auto","font-family":"'Courier New', Courier, monospace"}},ct={class:"text-center mb-4"},ut=["src"],mt={class:"font-bold text-base uppercase mb-1"},ht={class:"text-[10px] space-y-0.5",style:{"font-size":"10px"}},pt={key:0},_t={key:1,class:"whitespace-normal"},gt={key:2,class:"whitespace-normal"},bt={key:3,class:"whitespace-normal"},yt={key:4,class:"whitespace-normal"},vt={key:5,class:"whitespace-normal"},xt={key:6,class:"whitespace-normal break-words"},ft={key:7,class:"whitespace-normal break-words"},wt=e("div",{class:"border-b-2 border-dashed border-black my-2"},null,-1),$t={class:"mb-3 text-[10px] grid grid-cols-2 gap-x-2 gap-y-1"},kt={class:"col-span-2 text-center mb-1"},Ct={class:"text-sm font-bold"},Dt={class:"text-[9px] text-gray-500"},Ft=e("div",null,[e("span",{class:"font-bold block text-gray-600"},"Canal:"),e("span",null,"Tienda Online")],-1),jt={class:"text-right"},Tt=e("span",{class:"font-bold block text-gray-600"},"M√©todo de Pago:",-1),Et={class:"capitalize"},Nt={key:0,class:"col-span-2 mt-1 border-t border-dotted border-gray-300 pt-1"},St=e("span",{class:"font-bold text-gray-600"},"Cliente:",-1),Pt={key:0},qt=e("span",{class:"font-bold text-gray-600"},"Tel:",-1),Ot={key:1,class:"leading-tight"},It=e("span",{class:"font-bold text-gray-600"},"Dir:",-1),zt=e("div",{class:"border-b border-black my-2"},null,-1),At={class:"mb-4"},Vt=e("div",{class:"flex justify-between text-[9px] font-bold mb-2 uppercase text-gray-800"},[e("span",null,"Descripci√≥n"),e("span",null,"Total")],-1),Bt={class:"font-bold text-[11px] leading-tight mb-0.5"},Lt={key:0,class:"text-[9px] text-gray-500 italic mb-1"},Mt={class:"flex justify-between items-start text-[10px] mt-1"},Ut={class:"flex flex-col"},Gt={class:"text-gray-800"},Ht={class:"font-bold text-[11px] mt-0.5"},Rt=e("div",{class:"border-t border-black my-2 dashed"},null,-1),Wt={class:"text-right text-[11px] space-y-1"},Qt={key:0,class:"flex justify-between text-gray-600"},Yt=e("span",null,"Subtotal",-1),Jt={key:1,class:"flex justify-between text-gray-600"},Kt=e("span",null,"Costo de Env√≠o",-1),Xt={key:2,class:"flex justify-between text-gray-600"},Zt={class:"flex justify-between text-base font-black pt-1"},es=e("span",null,"TOTAL",-1),ts={class:"text-center mt-6 text-[10px] space-y-1 mb-4"},ss=e("p",{class:"font-medium"},"¬°Gracias por su compra!",-1),os={key:0,class:"mt-2 pt-2 border-t border-dotted border-gray-300 text-left"},ns=e("p",{class:"font-bold text-[9px] text-gray-500"},"Notas:",-1),as={class:"italic"},us={__name:"Show",props:{order:Object,store:Object},setup(t){const g=f(!1),b=f(""),y=f(""),v=f("success"),d=t,j=k(()=>!d.order||!d.order.items?[]:Array.isArray(d.order.items)?d.order.items:Object.values(d.order.items)),u=o=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),_=f(!1),O=async()=>{_.value=!0;try{const o=document.getElementById("invoice-content-digital");o&&await Z(o,`factura-${d.order.sequence_number||d.order.id}.pdf`)}catch(o){console.error(o),alert("Error al generar el PDF")}finally{_.value=!1}},I=async()=>{_.value=!0;try{const o=document.getElementById("invoice-content-digital");o&&await ee(o,`factura-${d.order.sequence_number||d.order.id}.pdf`,`Factura #${d.order.sequence_number||d.order.id}`)}catch(o){console.error(o)}finally{_.value=!1}},z=()=>{window.print()},S=o=>{const i={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(o).toLocaleDateString("es-CO",i)},T=k(()=>({recibido:{text:"Recibido",class:"bg-yellow-100 text-yellow-800"},en_preparacion:{text:"En Preparaci√≥n",class:"bg-blue-100 text-blue-800"},despachado:{text:"Despachado",class:"bg-purple-100 text-purple-800"},entregado:{text:"Entregado",class:"bg-green-100 text-green-800"},cancelado:{text:"Cancelado",class:"bg-red-100 text-red-800"}})[d.order.status]||{text:d.order.status,class:"bg-gray-100 text-gray-800"}),x=U({status:d.order.status}),A=()=>{const o=x.status;x.put(route("admin.orders.update",d.order.id),{preserveScroll:!0,onSuccess:()=>{v.value="success",o==="despachado"||o==="entregado"?(b.value="Venta confirmada",y.value="Inventario actualizado correctamente."):o==="cancelado"?(b.value="Pedido cancelado",y.value="El estado se actualiz√≥ y el inventario fue revertido si correspond√≠a."):(b.value="Estado actualizado",y.value="El estado de la orden se guard√≥ correctamente."),g.value=!0},onError:i=>{v.value="error",b.value="Error al actualizar",y.value=Array.isArray(i)?i.join(`
`):i?.status||Object.values(i||{}).join(`
`)||"Ocurri√≥ un error inesperado.",g.value=!0}})},P=G(),E=k(()=>P?.props?.auth?.user?.store?.name||"nuestra tienda"),q=k(()=>{const o=P?.props?.auth?.user?.store;return o?o.custom_domain?`${typeof window<"u"?window.location.protocol:"https:"}//${o.custom_domain}`:route("catalogo.index",{store:o.slug}):"#"}),V=()=>{try{const o=j.value;return o.length?`
Tu orden incluye:
${o.map(r=>{const h=Number(r.quantity||0);let c="";if(r.variant_options)try{const p=Object.entries(r.variant_options).map(([m,M])=>`${m}: ${M}`);c=p.length?` (${p.join(", ")})`:""}catch{}return` - ${h} x ${r.product_name}${c}`}).join(`
`)}`:""}catch{return""}},B=()=>{const o=d.order.sequence_number??d.order.id,i=S(d.order.created_at),r=u(d.order.total_price),h=(d.order?.customer_name||"").trim(),c=h?`Hola ${h},`:"Hola,",p=(d.order?.customer_address||"").trim(),m=V();switch(d.order.status){case"recibido":return`${c}

¬°Gracias por comprar en ${E.value}!

Tu pedido No. ${o} fue recibido correctamente.${m?`
${m}`:""}

Fecha del pedido: ${i}.
Total del pedido: ${r}${p?`
Direcci√≥n: ${p}`:""}

Te avisaremos cuando est√© en preparaci√≥n.`;case"en_preparacion":return`${c}

Estamos preparando tu pedido No. ${o} en ${E.value}.${m?`
${m}`:""}

Fecha del pedido: ${i}.
Total del pedido: ${r}${p?`
Direcci√≥n: ${p}`:""}

Te notificaremos cuando salga a despacho.`;case"despachado":return`${c}

Tu pedido No. ${o} fue despachado desde ${E.value}.${m?`
${m}`:""}

Total del pedido: ${r}${p?`
Direcci√≥n de entrega: ${p}`:""}

Si necesitas coordinar algo de la entrega, responde este mensaje.`;case"entregado":return`${c}

¬°Qu√© alegr√≠a! Ya entregamos tu pedido No. ${o}.${m?`
${m}`:""}

Total del pedido: ${r}

Esperamos que lo disfrutes. Si quieres descubrir m√°s productos, visita nuestro cat√°logo: ${q.value}`;case"cancelado":return`${c}

Tu pedido No. ${o} fue cancelado. Si no fuiste t√∫ quien lo solicit√≥, por favor cont√°ctanos para ayudarte.${m?`
${m}`:""}

Cuando desees, puedes volver a comprar aqu√≠: ${q.value}`;default:return`${c}

Estado actual de tu pedido No. ${o}: ${T.value?.text??d.order.status}.`}},L=()=>{try{const i=(d.order?.customer_phone??"").toString().replace(/[^0-9]/g,"");if(!i){v.value="error",b.value="Sin tel√©fono del cliente",y.value="No encontramos un n√∫mero de WhatsApp v√°lido para el cliente.",g.value=!0;return}const r=B(),h=encodeURIComponent(r),c=`https://wa.me/${i}?text=${h}`;typeof window<"u"&&window.open(c,"_blank")}catch{v.value="error",b.value="No se pudo abrir WhatsApp",y.value="Intenta nuevamente en unos segundos.",g.value=!0}};return(o,i)=>(a(),n($,null,[C(w(H),{title:`Orden #${t.order.sequence_number??t.order.id}`},null,8,["title"]),C(K,null,{header:N(()=>[e("div",te,[e("h2",se," Detalle de la Orden #"+s(t.order.sequence_number??t.order.id),1),e("div",oe,[e("button",{onClick:O,class:"px-3 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm flex items-center gap-1 no-print",disabled:_.value,title:"Descargar PDF"},[_.value?(a(),n("span",ae,"‚è≥")):(a(),n("span",re,"‚¨áÔ∏è")),de],8,ne),e("button",{onClick:I,class:"px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-sm flex items-center gap-1 no-print",disabled:_.value,title:"Compartir Factura"},[_.value?(a(),n("span",le,"‚è≥")):(a(),n("span",ce,"üîó")),ue],8,ie),e("button",{onClick:z,class:"px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 no-print flex items-center gap-1",title:"Imprimir"},pe),C(w(J),{href:o.route("admin.reports.index"),class:"px-3 sm:px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 no-print flex items-center gap-1",title:"Volver"},{default:N(()=>[_e,ge]),_:1},8,["href"])])])]),default:N(()=>[e("div",be,[e("div",ye,[e("div",ve,[e("div",xe,[e("div",fe,[we,e("div",$e,[(a(!0),n($,null,D(j.value,r=>(a(),n("div",{key:r.id,class:"py-4 flex justify-between items-start"},[e("div",ke,[e("p",Ce,s(r.product_name),1),r.variant_options?(a(),n("div",De,[(a(!0),n($,null,D(r.variant_options,(h,c)=>(a(),n("span",{key:c,class:"mr-2 bg-gray-100 px-2 py-1 rounded"},[e("span",Fe,s(c)+":",1),F(" "+s(h),1)]))),128))])):l("",!0),e("p",je,s(r.quantity)+" x "+s(u(r.unit_price)),1)]),e("p",Te,s(u(r.unit_price*r.quantity)),1)]))),128))]),e("div",Ee,[e("div",Ne,[t.order.discount_amount>0?(a(),n("div",Se,[Pe,e("span",null,s(u(parseFloat(t.order.total_price)+parseFloat(t.order.discount_amount)-parseFloat(t.order.delivery_cost||0))),1)])):l("",!0),parseFloat(t.order.delivery_cost)>0?(a(),n("div",qe,[Oe,e("span",null,s(u(t.order.delivery_cost)),1)])):l("",!0),t.order.discount_amount>0?(a(),n("div",Ie,[e("span",null,"Descuento (Cup√≥n: "+s(t.order.coupon?.code||"Aplicado")+"):",1),e("span",null,"-"+s(u(t.order.discount_amount)),1)])):l("",!0),e("div",ze,[Ae,e("span",null,s(u(t.order.total_price)),1)])])])])]),e("div",Ve,[e("div",Be,[Le,e("div",Me,[e("div",null,[Ue,e("p",null,s(t.order.customer_name),1)]),e("div",null,[Ge,e("p",null,s(t.order.customer_phone),1)]),e("div",null,[He,e("p",null,s(t.order.customer_email),1)]),e("div",null,[Re,e("p",null,s(t.order.customer_address),1)])])])])]),e("div",We,[e("div",Qe,[e("div",Ye,[Je,e("div",Ke,[e("span",{class:R(["px-4 py-2 inline-flex text-lg leading-5 font-semibold rounded-full",T.value.class])},s(T.value.text),3)]),e("p",Xe," Pedido realizado el: "+s(S(t.order.created_at)),1),e("form",{onSubmit:W(A,["prevent"])},[e("div",Ze,[et,Q(e("select",{id:"status","onUpdate:modelValue":i[0]||(i[0]=r=>w(x).status=r),class:"block w-full rounded-md shadow-sm border-gray-300"},rt,512),[[Y,w(x).status]]),e("button",{type:"submit",disabled:w(x).processing,class:"mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 disabled:opacity-50"}," Actualizar Estado ",8,dt),e("button",{type:"button",onClick:L,class:"mt-3 w-full bg-green-600 text-white font-bold py-2 px-4 rounded hover:bg-green-700"}," Notificar estado actual ")])],32)])])])])])]),_:1}),C(X,{show:g.value,type:v.value,title:b.value,message:y.value,"primary-text":"Entendido",onPrimary:i[1]||(i[1]=r=>g.value=!1),onClose:i[2]||(i[2]=r=>g.value=!1)},null,8,["show","type","title","message"]),e("div",it,[e("div",lt,[e("div",ct,[t.store?.logo_url||o.$page.props.auth.user.store?.logo_url?(a(),n("img",{key:0,src:t.store?.logo_url||o.$page.props.auth.user.store?.logo_url,alt:"Logo",class:"h-12 w-auto object-contain mx-auto mb-2 grayscale",crossorigin:"anonymous"},null,8,ut)):l("",!0),e("h2",mt,s(t.store?.name||o.$page.props.auth.user.store?.name),1),e("div",ht,[t.store?.nit?(a(),n("p",pt,"NIT: "+s(t.store.nit),1)):l("",!0),t.store?.address?(a(),n("p",_t,s(t.store.address),1)):l("",!0),t.store?.address_two?(a(),n("p",gt,s(t.store.address_two),1)):l("",!0),t.store?.address_three?(a(),n("p",bt,s(t.store.address_three),1)):l("",!0),t.store?.address_four?(a(),n("p",yt,s(t.store.address_four),1)):l("",!0),t.store?.phone?(a(),n("p",vt,"Tel: "+s(t.store.phone?.startsWith("57")?t.store.phone.substring(2):t.store.phone),1)):l("",!0),t.store?.email?(a(),n("p",xt,s(t.store.email),1)):l("",!0),t.store?.custom_domain?(a(),n("p",ft,s(t.store.custom_domain),1)):l("",!0)])]),wt,e("div",$t,[e("div",kt,[e("p",Ct,"Orden #"+s(t.order.sequence_number??t.order.id),1),e("p",Dt,s(new Date(t.order.created_at).toLocaleString("es-CO")),1)]),Ft,e("div",jt,[Tt,e("span",Et,s(t.order.payment_method||"N/A"),1)]),t.order.customer_name?(a(),n("div",Nt,[e("p",null,[St,F(" "+s(t.order.customer_name),1)]),t.order.customer_phone?(a(),n("p",Pt,[qt,F(" "+s(t.order.customer_phone),1)])):l("",!0),t.order.customer_address?(a(),n("p",Ot,[It,F(" "+s(t.order.customer_address),1)])):l("",!0)])):l("",!0)]),zt,e("div",At,[Vt,(a(!0),n($,null,D(j.value,r=>(a(),n("div",{key:r.id,class:"mb-3 border-b border-gray-200 last:border-0 pb-2"},[e("div",Bt,s(r.product_name),1),r.variant_options?(a(),n("div",Lt,[(a(!0),n($,null,D(r.variant_options,(h,c)=>(a(),n("span",{key:c,class:"mr-1"},s(h),1))),128))])):l("",!0),e("div",Mt,[e("div",Ut,[e("span",Gt,s(r.quantity)+" x "+s(u(r.unit_price)),1)]),e("div",Ht,s(u(r.unit_price*r.quantity)),1)])]))),128))]),Rt,e("div",Wt,[t.order.discount_amount>0?(a(),n("div",Qt,[Yt,e("span",null,s(u(parseFloat(t.order.total_price)+parseFloat(t.order.discount_amount)-parseFloat(t.order.delivery_cost||0))),1)])):l("",!0),parseFloat(t.order.delivery_cost)>0?(a(),n("div",Jt,[Kt,e("span",null,s(u(t.order.delivery_cost)),1)])):l("",!0),t.order.discount_amount>0?(a(),n("div",Xt,[e("span",null,"Descuento "+s(t.order.coupon?"("+t.order.coupon.code+")":""),1),e("span",null,"-"+s(u(t.order.discount_amount)),1)])):l("",!0),e("div",Zt,[es,e("span",null,s(u(t.order.total_price)),1)])]),e("div",ts,[ss,t.order.notes?(a(),n("div",os,[ns,e("p",as,s(t.order.notes),1)])):l("",!0)])])])],64))}};export{us as default};
