import{u as B,r as v,a as i,o as d,b as g,d as a,h as F,e as S,f as e,i as _,F as f,k as y,t as m,g as h,j as w,l as k,x as $}from"./app-CNtyBUG6.js";import{_ as D}from"./AuthenticatedLayout-BQLhKsA9.js";import{_ as q}from"./AlertModal-Bs-KWCLu.js";import{u as L,S as O}from"./useSectionTour-CgIbUnYg.js";import{s as P}from"./safeRoute-CFL_QDz4.js";import"./Modal-CLjQAg4u.js";const R=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear categoría",-1),z={class:"py-12"},G={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},H={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},J={class:"p-6 text-gray-900"},K={key:0,class:"mb-4 p-4 rounded-lg bg-red-50 border border-red-200"},Q=e("h4",{class:"font-medium text-red-800 mb-2"},"Errores al crear la categoría:",-1),W={class:"list-disc list-inside text-sm text-red-700 space-y-1"},X={class:"mb-6 border-b pb-6"},Y=e("label",{for:"name",class:"block font-medium text-lg text-gray-800"},"Nombre de la Categoría",-1),Z={key:0,class:"text-sm text-red-600 mt-2"},ee={class:"mt-6"},te=e("h3",{class:"font-medium text-lg text-gray-800"},"Estructura de Subcategorías",-1),se=e("p",{class:"text-sm text-gray-500"},"Definí subcategorías y un subnivel adicional (máximo 3 niveles en total).",-1),re={class:"flex items-center gap-4 p-3"},oe=["onUpdate:modelValue","placeholder"],ne=["onClick"],ae={class:"bg-gray-50 px-3 pb-3"},le=["onClick"],ie={class:"w-5 h-5 inline-flex items-center justify-center rounded-full border border-gray-300 text-gray-700"},de={key:0,class:"mt-3 space-y-2"},ce=["onUpdate:modelValue","placeholder"],ue=["onClick"],he=["onClick"],me=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("rect",{x:"4",y:"3",width:"11",height:"15",rx:"2",ry:"2","stroke-width":"1.5"}),e("circle",{cx:"18",cy:"18",r:"3","stroke-width":"1.5"}),e("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M18 16.5v3M16.5 18h3"})],-1),pe={key:0,class:"text-sm text-red-600 mt-2"},be=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("rect",{x:"4",y:"3",width:"11",height:"15",rx:"2",ry:"2","stroke-width":"1.5"}),e("circle",{cx:"18",cy:"18",r:"3","stroke-width":"1.5"}),e("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M18 16.5v3M16.5 18h3"})],-1),ge={class:"flex items-center justify-end mt-8 border-t pt-6"},_e=["disabled"],fe=e("span",{class:"text-lg"},"+",-1),xe=e("span",null,"Crear",-1),ve=[fe,xe],Ve={__name:"Create",setup(ye){const r=B({name:"",subcategories:[]}),{showTour:A,steps:E,handleTourComplete:V}=L("categories-create"),I=()=>{r.subcategories.push({name:"",children:[],_showChildren:!1})},j=c=>{r.subcategories.splice(c,1)},M=c=>{const t=r.subcategories[c];t&&(Array.isArray(t.children)||(t.children=[]),t._showChildren=!t._showChildren)},T=c=>{const t=r.subcategories[c];t&&(Array.isArray(t.children)||(t.children=[]),t.children.push({name:""}))},U=(c,t)=>{const s=r.subcategories[c];!s||!Array.isArray(s.children)||s.children.splice(t,1)},p=v(!1),x=v(!1),b=v([]),N=()=>{const c=P("admin.categories.store",{},"/admin/categories");r.post(c,{onSuccess:()=>{p.value=!0,x.value=!1,b.value=[]},onError:t=>{console.error("Error al crear categoría:",t);const s=[];for(const[n,l]of Object.entries(r.errors)){let o="";if(typeof l=="string"?o=l:Array.isArray(l)?o=l.join(", "):o=String(l),o.includes("has already been taken"))if(n.includes("subcategories")&&n.includes("children")){const u=n.match(/subcategories\.(\d+)\.children\.(\d+)\.name/);if(u){const C=parseInt(u[1])+1;o=`El nombre del subnivel ${parseInt(u[2])+1} de la subcategoría ${C} ya existe en tu tienda.`}else o="Uno de los nombres de subnivel ya existe en tu tienda."}else if(n.includes("subcategories")){const u=n.match(/subcategories\.(\d+)\.name/);u?o=`El nombre de la subcategoría ${parseInt(u[1])+1} ya existe en tu tienda.`:o="Uno de los nombres de subcategoría ya existe en tu tienda."}else o=o.replace("has already been taken","ya existe en tu tienda");s.push(o)}b.value=s,x.value=s.length>0}})};return(c,t)=>(d(),i(f,null,[g(a(F),{title:"Crear categoría"}),g(D,null,{header:S(()=>[R]),default:S(()=>[e("div",z,[e("div",G,[e("div",H,[e("div",J,[x.value&&b.value.length>0?(d(),i("div",K,[Q,e("ul",W,[(d(!0),i(f,null,y(b.value,(s,n)=>(d(),i("li",{key:n},m(s),1))),128))])])):_("",!0),e("form",{onSubmit:h(N,["prevent"])},[e("div",X,[Y,w(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=s=>a(r).name=s),type:"text",class:"block mt-2 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[k,a(r).name]]),a(r).errors.name?(d(),i("p",Z,m(a(r).errors.name),1)):_("",!0)]),e("div",ee,[te,se,(d(!0),i(f,null,y(a(r).subcategories,(s,n)=>(d(),i("div",{key:n,class:"mt-4 border rounded-lg overflow-hidden"},[e("div",re,[w(e("input",{"onUpdate:modelValue":l=>s.name=l,type:"text",placeholder:`Nombre de la Subcategoría ${n+1}`,class:"block w-full rounded-md shadow-sm border-gray-300"},null,8,oe),[[k,s.name]]),e("button",{onClick:h(l=>j(n),["prevent"]),type:"button",class:"bg-red-500 text-white font-bold p-2 rounded-full h-8 w-8 flex items-center justify-center"}," - ",8,ne)]),e("div",ae,[e("button",{type:"button",class:"inline-flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",onClick:h(l=>M(n),["prevent"])},[e("span",ie,m(s._showChildren?"v":">"),1),e("span",null,m(s._showChildren?"Colapsar subniveles":"Expandir subniveles"),1)],8,le),s._showChildren?(d(),i("div",de,[(d(!0),i(f,null,y(s.children||[],(l,o)=>(d(),i("div",{key:o,class:"flex items-center gap-3"},[w(e("input",{"onUpdate:modelValue":u=>l.name=u,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:`Subnivel ${o+1}`},null,8,ce),[[k,l.name]]),e("button",{onClick:h(u=>U(n,o),["prevent"]),type:"button",class:"bg-red-500 text-white font-bold p-2 rounded-full h-8 w-8 flex items-center justify-center"},"- ",8,ue)]))),128)),e("button",{type:"button",class:"mt-1 inline-flex items-center gap-2 border border-green-500 text-green-600 py-1 px-3 rounded hover:bg-green-50",onClick:h(l=>T(n),["prevent"])},[me,$(" Agregar subnivel ")],8,he)])):_("",!0)])]))),128)),a(r).errors.subcategories?(d(),i("p",pe,m(a(r).errors.subcategories),1)):_("",!0),e("button",{onClick:h(I,["prevent"]),type:"button",class:"mt-4 inline-flex items-center gap-2 border border-green-500 text-green-600 py-2 px-4 rounded hover:bg-green-50"},[be,$(" Añadir Subcategoría ")])]),e("div",ge,[e("button",{type:"submit",disabled:a(r).processing,class:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 inline-flex items-center gap-2"},ve,8,_e)])],32)])])])])]),_:1}),g(q,{show:p.value,type:"success",title:"Categorías",message:"¡Categoría creada con éxito!","primary-text":"Entendido",onPrimary:t[1]||(t[1]=s=>{p.value=!1,a(r).reset()}),onClose:t[2]||(t[2]=s=>{p.value=!1,a(r).reset()})},null,8,["show"]),g(O,{show:a(A),section:"categories-create",steps:a(E),onComplete:a(V)},null,8,["show","steps","onComplete"])],64))}};export{Ve as default};
