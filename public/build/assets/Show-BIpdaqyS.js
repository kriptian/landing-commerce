import{r as x,c as E,u as L,H as U,I as G,a,o as r,b as w,f as e,d as $,h as H,e as C,F as k,n as D,i as p,t as o,m as F,p as R,g as W,j as Q,x as Y,l as J}from"./app-DWzOy7w2.js";import{_ as K}from"./AuthenticatedLayout-CugQ99eV.js";import{_ as X}from"./AlertModal-DPFi-dg7.js";import{d as Z,s as ee}from"./pdfUtils-F4UIJyTs.js";import"./Modal-B4C0nd8L.js";const te={class:"flex items-center justify-between w-full"},se={class:"font-semibold text-xl text-gray-800 leading-tight"},oe={class:"flex gap-2"},ne=["disabled"],ae={key:0},re={key:1},de=e("span",{class:"hidden sm:inline"},"Descargar",-1),ie=["disabled"],le={key:0},ce={key:1},ue=e("span",{class:"hidden sm:inline"},"Compartir",-1),me=e("span",null,"üñ®Ô∏è",-1),pe=e("span",{class:"hidden sm:inline"},"Imprimir",-1),he=[me,pe],_e=e("span",null,"‚¨ÖÔ∏è",-1),be=e("span",{class:"hidden sm:inline"},"Volver",-1),ge={class:"py-12"},ve={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-3 gap-8"},fe={class:"lg:col-span-2 space-y-8"},ye={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},xe={class:"p-6"},we=e("h3",{class:"text-lg font-semibold border-b pb-4 mb-4"},"Productos en la Orden",-1),$e={class:"divide-y divide-gray-200"},ke={class:"flex-grow"},Ce={class:"font-bold text-gray-900"},De={key:0,class:"text-sm text-gray-600 mt-1"},Te={class:"font-semibold"},Ne={class:"text-sm text-gray-500 mt-2"},Ee={class:"font-semibold text-gray-800 shrink-0 ml-4"},Pe={class:"border-t border-gray-200 pt-4 mt-4 text-right"},Se={class:"text-2xl font-bold"},je={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Fe={class:"p-6"},qe=e("h3",{class:"text-lg font-semibold border-b pb-4 mb-4"},"Datos del Cliente",-1),Ie={class:"mt-4 space-y-4 text-gray-700"},Oe=e("p",{class:"font-semibold text-sm text-gray-500"},"Nombre:",-1),ze=e("p",{class:"font-semibold text-sm text-gray-500"},"Tel√©fono:",-1),Ae=e("p",{class:"font-semibold text-sm text-gray-500"},"Correo:",-1),Me=e("p",{class:"font-semibold text-sm text-gray-500"},"Direcci√≥n:",-1),Ve={class:"space-y-8"},Be={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Le={class:"p-6"},Ue=e("h3",{class:"text-lg font-semibold mb-4"},"Estado del Pedido",-1),Ge={class:"text-center mb-4"},He={class:"text-sm text-center text-gray-500"},Re={class:"mt-6 border-t pt-6"},We=e("label",{for:"status",class:"block font-medium text-sm text-gray-700 mb-2"},"Cambiar Estado",-1),Qe=e("option",{value:"recibido"},"Recibido",-1),Ye=e("option",{value:"en_preparacion"},"En Preparaci√≥n",-1),Je=e("option",{value:"despachado"},"Despachado",-1),Ke=e("option",{value:"entregado"},"Entregado",-1),Xe=e("option",{value:"cancelado"},"Cancelado",-1),Ze=[Qe,Ye,Je,Ke,Xe],et=["disabled"],tt=e("div",{class:"p-6"},[e("div",{class:"mt-6 flex justify-end"})],-1),st={id:"invoice-content-digital",class:"fixed top-0 left-0 w-[80mm] bg-white z-[-100] opacity-0 pointer-events-none"},ot={class:"bg-white text-black p-2 font-mono text-[11px] leading-tight",style:{width:"80mm",margin:"0 auto","font-family":"'Courier New', Courier, monospace"}},nt={key:0,class:"absolute inset-0 flex items-center justify-center pointer-events-none z-0 opacity-[0.12]"},at={class:"text-[60px] font-[900] text-black uppercase whitespace-nowrap -rotate-45 transform select-none"},rt={class:"relative z-10"},dt={class:"text-center mb-4"},it=["src"],lt={class:"font-bold text-base uppercase mb-1"},ct={key:1,class:"text-[10px] space-y-0.5",style:{"font-size":"10px"}},ut={key:0},mt={key:1,class:"whitespace-normal"},pt={key:2,class:"whitespace-normal"},ht={key:3,class:"whitespace-normal break-words"},_t=e("div",{class:"border-b-2 border-dashed border-black my-2"},null,-1),bt={class:"mb-3 text-[10px] space-y-1"},gt=e("p",null,"Canal: Tienda Online",-1),vt={class:"font-bold"},ft={key:0},yt={key:1},xt={key:2,class:"whitespace-normal"},wt=e("div",{class:"border-b border-dashed border-black my-2"},null,-1),$t={class:"mb-4"},kt={class:"flex justify-between font-bold items-start"},Ct={class:"w-[70%] leading-tight"},Dt={class:"whitespace-nowrap"},Tt={class:"flex flex-col text-[10px] text-gray-600 pl-2 mt-0.5"},Nt={key:0,class:"text-xs text-gray-500 italic"},Et=e("div",{class:"border-b-2 border-dashed border-black my-2"},null,-1),Pt={class:"space-y-1 text-right"},St={class:"flex justify-between text-xl font-bold mt-2"},jt=e("span",null,"TOTAL",-1),Ft={class:"flex justify-between text-[10px] mt-2 pt-1 border-dotted border-t border-gray-400"},qt=e("span",null,"M√©todo Pago",-1),It={class:"capitalize"},Ot={class:"flex justify-between text-[10px]"},zt=e("span",null,"Estado",-1),At={class:"capitalize"},Mt=e("div",{class:"text-center mt-6 text-[10px] space-y-1 mb-4"},[e("p",null,"¬°Gracias por su compra!"),e("p",{class:"italic"},"Para consultas sobre su env√≠o, cont√°ctenos.")],-1),Ht={__name:"Show",props:{order:Object,store:Object},setup(s){const _=x(!1),b=x(""),g=x(""),f=x("success"),d=s,v=t=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),h=x(!1),q=async()=>{h.value=!0;try{const t=document.getElementById("invoice-content-digital");t&&await Z(t,`factura-${d.order.sequence_number||d.order.id}.pdf`)}catch(t){console.error(t),alert("Error al generar el PDF")}finally{h.value=!1}},I=async()=>{h.value=!0;try{const t=document.getElementById("invoice-content-digital");t&&await ee(t,`factura-${d.order.sequence_number||d.order.id}.pdf`,`Factura #${d.order.sequence_number||d.order.id}`)}catch(t){console.error(t)}finally{h.value=!1}},O=()=>{window.print()},P=t=>{const i={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(t).toLocaleDateString("es-CO",i)},T=E(()=>({recibido:{text:"Recibido",class:"bg-yellow-100 text-yellow-800"},en_preparacion:{text:"En Preparaci√≥n",class:"bg-blue-100 text-blue-800"},despachado:{text:"Despachado",class:"bg-purple-100 text-purple-800"},entregado:{text:"Entregado",class:"bg-green-100 text-green-800"},cancelado:{text:"Cancelado",class:"bg-red-100 text-red-800"}})[d.order.status]||{text:d.order.status,class:"bg-gray-100 text-gray-800"}),y=L({status:d.order.status}),z=()=>{const t=y.status;y.put(route("admin.orders.update",d.order.id),{preserveScroll:!0,onSuccess:()=>{f.value="success",t==="despachado"||t==="entregado"?(b.value="Venta confirmada",g.value="Inventario actualizado correctamente."):t==="cancelado"?(b.value="Pedido cancelado",g.value="El estado se actualiz√≥ y el inventario fue revertido si correspond√≠a."):(b.value="Estado actualizado",g.value="El estado de la orden se guard√≥ correctamente."),_.value=!0},onError:i=>{f.value="error",b.value="Error al actualizar",g.value=Array.isArray(i)?i.join(`
`):i?.status||Object.values(i||{}).join(`
`)||"Ocurri√≥ un error inesperado.",_.value=!0}})},S=U(),N=E(()=>S?.props?.auth?.user?.store?.name||"nuestra tienda"),j=E(()=>{const t=S?.props?.auth?.user?.store;return t?t.custom_domain?`${typeof window<"u"?window.location.protocol:"https:"}//${t.custom_domain}`:route("catalogo.index",{store:t.slug}):"#"}),A=()=>{try{const t=Array.isArray(d.order?.items)?d.order.items:[];return t.length?`
Tu orden incluye:
${t.map(u=>{const n=Number(u.quantity||0);let c="";if(u.variant_options)try{const l=Object.entries(u.variant_options).map(([m,B])=>`${m}: ${B}`);c=l.length?` (${l.join(", ")})`:""}catch{}return` - ${n} x ${u.product_name}${c}`}).join(`
`)}`:""}catch{return""}},M=()=>{const t=d.order.sequence_number??d.order.id,i=P(d.order.created_at),u=v(d.order.total_price),n=(d.order?.customer_name||"").trim(),c=n?`Hola ${n},`:"Hola,",l=(d.order?.customer_address||"").trim(),m=A();switch(d.order.status){case"recibido":return`${c}

¬°Gracias por comprar en ${N.value}!

Tu pedido No. ${t} fue recibido correctamente.${m?`
${m}`:""}

Fecha del pedido: ${i}.
Total del pedido: ${u}${l?`
Direcci√≥n: ${l}`:""}

Te avisaremos cuando est√© en preparaci√≥n.`;case"en_preparacion":return`${c}

Estamos preparando tu pedido No. ${t} en ${N.value}.${m?`
${m}`:""}

Fecha del pedido: ${i}.
Total del pedido: ${u}${l?`
Direcci√≥n: ${l}`:""}

Te notificaremos cuando salga a despacho.`;case"despachado":return`${c}

Tu pedido No. ${t} fue despachado desde ${N.value}.${m?`
${m}`:""}

Total del pedido: ${u}${l?`
Direcci√≥n de entrega: ${l}`:""}

Si necesitas coordinar algo de la entrega, responde este mensaje.`;case"entregado":return`${c}

¬°Qu√© alegr√≠a! Ya entregamos tu pedido No. ${t}.${m?`
${m}`:""}

Total del pedido: ${u}

Esperamos que lo disfrutes. Si quieres descubrir m√°s productos, visita nuestro cat√°logo: ${j.value}`;case"cancelado":return`${c}

Tu pedido No. ${t} fue cancelado. Si no fuiste t√∫ quien lo solicit√≥, por favor cont√°ctanos para ayudarte.${m?`
${m}`:""}

Cuando desees, puedes volver a comprar aqu√≠: ${j.value}`;default:return`${c}

Estado actual de tu pedido No. ${t}: ${T.value?.text??d.order.status}.`}},V=()=>{try{const i=(d.order?.customer_phone??"").toString().replace(/[^0-9]/g,"");if(!i){f.value="error",b.value="Sin tel√©fono del cliente",g.value="No encontramos un n√∫mero de WhatsApp v√°lido para el cliente.",_.value=!0;return}const u=M(),n=encodeURIComponent(u),c=`https://wa.me/${i}?text=${n}`;typeof window<"u"&&window.open(c,"_blank")}catch{f.value="error",b.value="No se pudo abrir WhatsApp",g.value="Intenta nuevamente en unos segundos.",_.value=!0}};return(t,i)=>{const u=G("Modal");return r(),a(k,null,[w($(H),{title:`Orden #${s.order.sequence_number??s.order.id}`},null,8,["title"]),w(K,null,{header:C(()=>[e("div",te,[e("h2",se," Detalle de la Orden #"+o(s.order.sequence_number??s.order.id),1),e("div",oe,[e("button",{onClick:q,class:"px-3 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm flex items-center gap-1 no-print",disabled:h.value,title:"Descargar PDF"},[h.value?(r(),a("span",ae,"‚è≥")):(r(),a("span",re,"‚¨áÔ∏è")),de],8,ne),e("button",{onClick:I,class:"px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-sm flex items-center gap-1 no-print",disabled:h.value,title:"Compartir Factura"},[h.value?(r(),a("span",le,"‚è≥")):(r(),a("span",ce,"üîó")),ue],8,ie),e("button",{onClick:O,class:"px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 no-print flex items-center gap-1",title:"Imprimir"},he),w($(J),{href:t.route("admin.reports.index"),class:"px-3 sm:px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 no-print flex items-center gap-1",title:"Volver"},{default:C(()=>[_e,be]),_:1},8,["href"])])])]),default:C(()=>[e("div",ge,[e("div",ve,[e("div",fe,[e("div",ye,[e("div",xe,[we,e("div",$e,[(r(!0),a(k,null,D(s.order.items,n=>(r(),a("div",{key:n.id,class:"py-4 flex justify-between items-start"},[e("div",ke,[e("p",Ce,o(n.product_name),1),n.variant_options?(r(),a("div",De,[(r(!0),a(k,null,D(n.variant_options,(c,l)=>(r(),a("span",{key:l,class:"mr-2 bg-gray-100 px-2 py-1 rounded"},[e("span",Te,o(l)+":",1),F(" "+o(c),1)]))),128))])):p("",!0),e("p",Ne,o(n.quantity)+" x "+o(v(n.unit_price)),1)]),e("p",Ee,o(v(n.unit_price*n.quantity)),1)]))),128))]),e("div",Pe,[e("p",Se,"Total: "+o(v(s.order.total_price)),1)])])]),e("div",je,[e("div",Fe,[qe,e("div",Ie,[e("div",null,[Oe,e("p",null,o(s.order.customer_name),1)]),e("div",null,[ze,e("p",null,o(s.order.customer_phone),1)]),e("div",null,[Ae,e("p",null,o(s.order.customer_email),1)]),e("div",null,[Me,e("p",null,o(s.order.customer_address),1)])])])])]),e("div",Ve,[e("div",Be,[e("div",Le,[Ue,e("div",Ge,[e("span",{class:R(["px-4 py-2 inline-flex text-lg leading-5 font-semibold rounded-full",T.value.class])},o(T.value.text),3)]),e("p",He," Pedido realizado el: "+o(P(s.order.created_at)),1),e("form",{onSubmit:W(z,["prevent"])},[e("div",Re,[We,Q(e("select",{id:"status","onUpdate:modelValue":i[0]||(i[0]=n=>$(y).status=n),class:"block w-full rounded-md shadow-sm border-gray-300"},Ze,512),[[Y,$(y).status]]),e("button",{type:"submit",disabled:$(y).processing,class:"mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 disabled:opacity-50"}," Actualizar Estado ",8,et),e("button",{type:"button",onClick:V,class:"mt-3 w-full bg-green-600 text-white font-bold py-2 px-4 rounded hover:bg-green-700"}," Notificar estado actual ")])],32)])])])])])]),_:1}),w(u,{show:t.confirmingSale,onClose:t.closeSaleModal},{default:C(()=>[tt]),_:1},8,["show","onClose"]),w(X,{show:_.value,type:f.value,title:b.value,message:g.value,"primary-text":"Entendido",onPrimary:i[1]||(i[1]=n=>_.value=!1),onClose:i[2]||(i[2]=n=>_.value=!1)},null,8,["show","type","title","message"]),e("div",st,[e("div",ot,[s.order.store?.name||t.$page.props.auth.user.store?.name?(r(),a("div",nt,[e("div",at,o(s.order.store?.name||t.$page.props.auth.user.store?.name),1)])):p("",!0),e("div",rt,[e("div",dt,[s.order.store?.logo_url||t.$page.props.auth.user.store?.logo_url?(r(),a("img",{key:0,src:s.order.store?.logo_url||t.$page.props.auth.user.store?.logo_url,alt:"Logo",class:"h-12 w-auto object-contain mx-auto mb-2 grayscale",crossorigin:"anonymous"},null,8,it)):p("",!0),e("h2",lt,o(s.order.store?.name||t.$page.props.auth.user.store?.name),1),s.store?(r(),a("div",ct,[s.store.nit?(r(),a("p",ut,"NIT: "+o(s.store.nit),1)):p("",!0),s.store.phone?(r(),a("p",mt,"Tel: "+o(s.store.phone),1)):p("",!0),s.store.address?(r(),a("p",pt,o(s.store.address),1)):p("",!0),s.store.email?(r(),a("p",ht,o(s.store.email),1)):p("",!0)])):p("",!0)]),_t,e("div",bt,[gt,e("p",null,"Fecha: "+o(new Date(s.order.created_at).toLocaleString("es-CO")),1),e("p",null,[F("No. Orden: "),e("span",vt,"#"+o(s.order.sequence_number??s.order.id),1)]),s.order.customer_name?(r(),a("p",ft,"Cliente: "+o(s.order.customer_name),1)):p("",!0),s.order.customer_phone?(r(),a("p",yt,"Tel: "+o(s.order.customer_phone),1)):p("",!0),s.order.customer_address?(r(),a("p",xt,"Dir: "+o(s.order.customer_address),1)):p("",!0)]),wt,e("div",$t,[(r(!0),a(k,null,D(s.order.items,n=>(r(),a("div",{key:n.id,class:"mb-2 pb-1 border-b border-dotted border-gray-400 last:border-0"},[e("div",kt,[e("span",Ct,o(n.product_name),1),e("span",Dt,o(v(n.unit_price*n.quantity)),1)]),e("div",Tt,[n.variant_options?(r(),a("div",Nt,[(r(!0),a(k,null,D(n.variant_options,(c,l)=>(r(),a("span",{key:l,class:"mr-1"},o(l)+": "+o(c),1))),128))])):p("",!0),e("span",null,o(n.quantity)+" x "+o(v(n.unit_price)),1)])]))),128))]),Et,e("div",Pt,[e("div",St,[jt,e("span",null,o(v(s.order.total_price)),1)]),e("div",Ft,[qt,e("span",It,o(s.order.payment_method||"N/A"),1)]),e("div",Ot,[zt,e("span",At,o(s.order.status),1)])]),Mt])])])],64)}}};export{Ht as default};
