const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BpSoWi5o.js","assets/app-DuuN3wQf.js","assets/app-C7iBc-Q6.css"])))=>i.map(i=>d[i]);
import{G as Oe,r as h,D as Ue,c as G,u as Be,w as W,H as qe,a as c,o as d,b,d as i,h as Te,e as j,f as t,g as Y,i as f,j as p,q as _,m as $,k as De,p as N,t as x,F as S,n as A,x as oe,A as Ne,C as J,_ as ze}from"./app-DuuN3wQf.js";import{_ as He}from"./AuthenticatedLayout-Ljt7PewI.js";import{_ as Q}from"./AlertModal-DTAn80qJ.js";import{_ as ne}from"./Modal-BbwZiN4u.js";import{_ as Le}from"./PrimaryButton-CerFzSqO.js";import{_ as Re}from"./SecondaryButton-EulbxJxb.js";const Fe=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear producto",-1),Ge={class:"py-12"},We={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Qe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ke={class:"p-6 text-gray-900"},Xe={class:"mb-4"},Ye=t("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1),Je={class:"mb-4"},Ze=t("label",{for:"barcode",class:"block font-medium text-sm text-gray-700 mb-1"},"CÃ³digo de Barras (Opcional)",-1),Ie={class:"flex gap-2"},et=t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})],-1),tt={class:"mb-4"},st=t("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1),at={class:"p-4 border rounded-md bg-gray-50"},ot={class:"inline-flex items-center gap-2 mb-3 select-none"},nt=t("span",{class:"font-semibold"},"Controlar inventario",-1),rt={key:0,class:"font-semibold text-gray-800 mb-2"},lt={key:1,class:"text-xs text-gray-500 mb-4"},it={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ct={for:"quantity",class:"block font-medium text-sm text-gray-700 flex items-center"},dt=["disabled"],ut={key:0,class:"mt-1 text-sm text-red-600"},mt={for:"alert",class:"block font-medium text-sm text-gray-700 flex items-center"},pt=["disabled"],gt={for:"purchase_price",class:"block font-medium text-sm text-gray-700 flex items-center"},ht={class:"mt-4 mb-2"},vt=t("label",{class:"block font-medium text-sm text-gray-700"},"CategorÃ­as",-1),ft={key:0,class:"mt-1 text-sm text-amber-600 font-medium"},_t={class:"space-y-3"},bt=["onUpdate:modelValue","onChange","required"],yt=t("option",{value:null},"Seleccione una categorÃ­a",-1),wt=["value"],xt={key:0,class:"mt-1 text-sm text-red-600"},kt={key:1,class:"mt-1 text-sm text-red-600"},Ct={class:"mb-4"},St=t("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"DescripciÃ³n Corta",-1),Vt={class:"mb-4"},Pt=t("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"DescripciÃ³n Larga",-1),$t={class:"mb-4"},At=t("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1),Et={class:"mb-4"},Mt=t("label",{for:"meta_keywords",class:"block font-medium text-sm text-gray-700"},"Palabras Clave SEO (separadas por comas)",-1),jt=t("p",{class:"mt-1 text-xs text-gray-500"},"Estas palabras clave ayudan a mejorar el SEO del producto. No son visibles para los clientes.",-1),Ot={class:"md:col-span-2 mt-6 border-t pt-6"},Ut={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Bt={class:"p-6 text-gray-900"},qt={class:"flex items-center justify-between"},Tt=t("h3",{class:"text-lg font-medium"},"Variantes del Producto",-1),Dt={class:"flex items-center gap-2"},Nt={class:"mt-4 border rounded-lg divide-y"},zt={key:0,class:"text-sm text-gray-500 p-3"},Ht={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2"},Lt={class:"flex-1 min-w-0"},Rt={class:"flex items-center gap-2"},Ft=["title","onClick"],Gt={key:0},Wt={key:1},Qt=["onUpdate:modelValue"],Kt={key:0,class:"flex-shrink-0 text-xs bg-gray-100 text-gray-700 rounded px-2 py-0.5 align-middle"},Xt={class:"flex items-center gap-2 flex-shrink-0"},Yt=["title","onClick"],Jt=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),t("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})],-1),Zt=[Jt],It=["onClick"],es=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("rect",{x:"4",y:"3",width:"11",height:"15",rx:"2",ry:"2","stroke-width":"1.5"}),t("circle",{cx:"18",cy:"18",r:"3","stroke-width":"1.5"}),t("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M18 16.5v3M16.5 18h3"})],-1),ts=[es],ss=["onClick"],as=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),os=[as],ns={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2"},rs={class:"grid grid-cols-1 md:grid-cols-5 gap-3"},ls={class:"md:col-span-2"},is=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Depende de",-1),cs=["onUpdate:modelValue"],ds=t("option",{value:""},"(sin dependencia)",-1),us=["value","disabled"],ms={key:0,class:"md:col-span-3"},ps=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Permitir valores segÃºn el valor del padre",-1),gs={class:"mt-2 space-y-2"},hs={class:"text-xs font-semibold text-gray-700 mb-1"},vs={class:"flex flex-wrap gap-2"},fs=["checked","onChange"],_s={key:1,class:"mt-2 pl-4 border-l"},bs={class:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-3"},ys=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Nombre",-1),ws=["onUpdate:modelValue"],xs=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Precio (opcional)",-1),ks=["onUpdate:modelValue","disabled","onInput"],Cs={key:0,class:"mt-1 text-xs text-amber-600"},Ss={class:"flex items-center gap-2"},Vs=["onChange","id","disabled"],Ps={key:0,class:"relative"},$s=["src"],As=["onClick"],Es=["for","title"],Ms=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-5 h-5 text-gray-400",fill:"currentColor"},[t("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1),js=[Ms],Os={key:2,class:"mt-1 text-xs text-amber-600"},Us={class:"flex items-center gap-2 ml-2"},Bs=["onClick"],qs=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),Ts=[qs],Ds=t("label",{class:"block font-medium text-sm text-gray-700"},"AÃ±adir Nueva Variante Principal",-1),Ns={class:"mt-2 flex items-center gap-2"},zs=t("button",{type:"submit",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",title:"AÃ±adir"}," âœ” ",-1),Hs={class:"md:col-span-2 mt-6 border-t pt-6"},Ls=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"ImÃ¡genes Extra de la GalerÃ­a",-1),Rs=t("p",{class:"text-sm text-gray-600 mb-4"}," Estas imÃ¡genes se agregarÃ¡n a la galerÃ­a general del producto. Las imÃ¡genes de las variantes se muestran cuando se selecciona esa opciÃ³n. ",-1),Fs={class:"mb-4"},Gs=t("label",{for:"gallery_files",class:"block font-medium text-sm text-gray-700"},"ImÃ¡genes de la GalerÃ­a",-1),Ws=t("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1),Qs={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},Ks=["disabled"],Xs=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M4 4a2 2 0 0 1 2-2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4zm9-1.5V7h4.5L13 2.5z"}),t("path",{d:"M8 13h8v2H8zM8 9h5v2H8z"})],-1),Ys=t("span",null,"Crear",-1),Js=[Xs,Ys],Zs={key:0,class:"ml-3 text-sm text-red-600"},Is={class:"p-6"},ea=t("h2",{class:"text-lg font-semibold mb-4"},"Escanear CÃ³digo de Barras",-1),ta=t("div",{class:"mb-4"},[t("p",{class:"text-sm text-gray-600 mb-4"}," Apunta la cÃ¡mara hacia el cÃ³digo de barras. El cÃ³digo se detectarÃ¡ automÃ¡ticamente. "),t("div",{id:"barcode-scanner-create",class:"w-full rounded-lg overflow-hidden",style:{"min-height":"300px"}})],-1),sa={class:"flex gap-3"},aa={class:"p-6"},oa=t("h2",{class:"text-lg font-semibold mb-4 text-green-600"},"Â¡CÃ³digo de barras escaneado!",-1),na={class:"mb-4"},ra=t("p",{class:"text-sm text-gray-600 mb-2"}," CÃ³digo escaneado: ",-1),la={class:"text-lg font-semibold text-gray-900"},ia={class:"flex gap-3"},re=2*1024*1024,ha={__name:"Create",props:{categories:Array},setup(le){const ie=le,ce=Oe(),z=h(!!ce?.props?.flash?.success),V=h(!1),O=h([]),U=h(!1),P=h(null),B=h(!1),K=h(""),Z=()=>{try{const a=new(window.AudioContext||window.webkitAudioContext),e=a.createOscillator(),n=a.createGain();e.connect(n),n.connect(a.destination),e.frequency.value=800,e.type="sine",n.gain.setValueAtTime(.3,a.currentTime),n.gain.exponentialRampToValueAtTime(.01,a.currentTime+.2),e.start(a.currentTime),e.stop(a.currentTime+.2)}catch{}},de=async()=>{try{U.value=!0,await J();const{Html5Qrcode:a}=await ze(async()=>{const{Html5Qrcode:s}=await import("./index-BpSoWi5o.js");return{Html5Qrcode:s}},__vite__mapDeps([0,1,2])),e=document.getElementById("barcode-scanner-create");if(!e)return;P.value=new a(e.id);const n={fps:10,qrbox:{width:250,height:250}};try{await P.value.start({facingMode:"environment"},n,s=>{Z(),r.barcode=s,K.value=s,q(),B.value=!0},s=>{})}catch{try{await P.value.start({facingMode:"user"},n,o=>{Z(),r.barcode=o,K.value=o,q(),B.value=!0},o=>{})}catch{alert("No se pudo acceder a la cÃ¡mara. Por favor, permite el acceso a la cÃ¡mara en la configuraciÃ³n del navegador."),U.value=!1}}}catch{alert("Error al inicializar el escÃ¡ner. Por favor, intenta nuevamente."),U.value=!1}},q=async()=>{if(P.value){try{await P.value.stop(),await P.value.clear()}catch{}P.value=null}U.value=!1};Ue(()=>{q()});const ue=a=>{const e=Array.from(a?.target?.files||[]),n=[],s=[];for(const o of e){if(!(o?.type||"").startsWith("image/")){n.push(`${o.name}: no es una imagen vÃ¡lida.`);continue}if(o.size>re){n.push(`${o.name}: supera el lÃ­mite de 2 MB.`);continue}s.push(o)}if(n.length){O.value=["Problemas con las imÃ¡genes seleccionadas:",...n],V.value=!0,a?.target&&(a.target.value=""),r.gallery_files=[];return}r.gallery_files=s},y=h([{options:ie.categories,selected:null}]),me=a=>{y.value.splice(a+1)},pe=async a=>{const e=y.value[a].selected;if(me(a),r.category_id=e,!!e)try{const n=await window.axios.get(route("admin.categories.children",e)),s=Array.isArray(n.data?.data)?n.data.data:[];s.length>0&&(y.value.push({options:s,selected:null}),r.category_id=null)}catch{}},H=G(()=>{if(y.value.length>1){const a=y.value[y.value.length-1];return a.options.length>0&&!a.selected}return!1}),r=Be({name:"",barcode:"",price:"",purchase_price:null,retail_price:null,track_inventory:!0,quantity:0,alert:null,category_id:null,short_description:"",long_description:"",specifications:"",meta_keywords:"",gallery_files:[],variant_options:[],variants:[],variant_attributes:[]}),u=h([]),T=h(""),w=h({}),ge=a=>{w.value[a]=!(w.value[a]??!1)},I=()=>{const a=T.value.trim()||"",e=u.value.length;u.value.push({id:null,name:a,children:[],order:e,dependsOn:"",rules:{},rulesSelected:{},__showDependency:!1}),w.value[e]=!0,T.value=""},he=a=>{u.value.splice(a,1)},ve=a=>{u.value[a].children||(u.value[a].children=[]),u.value[a].children.push({id:null,name:"",price:null,image:null,imagePreview:null,imagePath:null,order:u.value[a].children.length}),w.value[a]=!0},fe=(a,e)=>{u.value[a].children.splice(e,1)},_e=(a,e,n)=>{const s=n?.target?.files?.[0];if(!s)return;if(!M(a)){n?.target&&(n.target.value=""),ee.value||(F.value=!0,ee.value=!0);return}const o=[];if((s?.type||"").startsWith("image/")||o.push(`${s.name}: no es una imagen vÃ¡lida.`),s.size>re&&o.push(`${s.name}: supera el lÃ­mite de 2 MB.`),o.length){O.value=["Problemas con la imagen de la variante:",...o],V.value=!0,n?.target&&(n.target.value=""),u.value[a].children[e].image=null,u.value[a].children[e].imagePreview=null;return}u.value[a].children[e].image=s;const m=new FileReader;m.onload=g=>{u.value[a].children[e].imagePreview=g.target.result},m.readAsDataURL(s)},be=(a,e)=>{u.value[a].children[e].image=null,u.value[a].children[e].imagePreview=null},ye=()=>{const a=[];return u.value.forEach((e,n)=>{if(!e.name.trim())return;const s={name:e.name.trim(),parent_id:null,price:null,image_path:null,order:n,children:[]};e.children&&e.children.length>0&&e.children.forEach((o,l)=>{o.name.trim()&&s.children.push({name:o.name.trim(),parent_id:null,price:o.price?parseFloat(o.price):null,image_file_key:o.image?`variant_option_${n}_${l}`:null,order:l})}),(s.children.length>0||s.name)&&a.push(s)}),a},we=()=>{const a=[];return u.value.forEach(e=>{if(!e.name.trim())return;const n=(e.children||[]).map(o=>o.name.trim()).filter(Boolean);if(n.length===0)return;const s={name:e.name.trim(),values:n,valuesText:n.join(", "),dependsOn:e.dependsOn||"",rules:e.rules||{},rulesSelected:e.rulesSelected||{}};a.push(s)}),a},xe=G(()=>u.value.filter(e=>!e.children||e.children.length===0?!1:e.children.some(n=>n.price&&n.price!==""&&n.price!=null)).length>1);G(()=>u.value.find(a=>!a.children||a.children.length===0?!1:a.children.some(e=>e.price&&e.price!==""&&e.price!=null)));const E=h(!1),L=h(!1),ke=["Has intentado agregar precios a una variante cuando ya existe otra variante principal con precios configurados.","","ðŸ“‹ Regla del Sistema:","Solo puedes asignar precios a las opciones hijas de UNA variante principal. Si ya asignaste precios a una variante (por ejemplo, Color), no podrÃ¡s agregar precios a otra variante (por ejemplo, Equipo).","","ðŸ’¡ CÃ³mo funciona:","Cuando un cliente seleccione una opciÃ³n de la variante que tiene precios, se mostrarÃ¡ el precio de esa opciÃ³n especÃ­fica. Si no selecciona ninguna opciÃ³n o selecciona una opciÃ³n sin precio, se usarÃ¡ el precio principal del producto.","","ðŸ’¡ Sugerencia:","Si necesitas diferentes precios segÃºn mÃºltiples caracterÃ­sticas, considera crear productos separados o usar una sola variante que combine ambas caracterÃ­sticas."],R=a=>!u.value.find((n,s)=>s===a||!n.children||n.children.length===0?!1:n.children.some(o=>o.price&&o.price!==""&&o.price!=null)),M=a=>!u.value.find((n,s)=>s===a||!n.children||n.children.length===0?!1:n.children.some(o=>o.imagePreview||o.image||o.imagePath&&o.imagePath!=="")),Ce=(a,e,n)=>{const s=n?.target?.value;!s||s===""||s==null||R(a)||(n.target.value="",u.value[a].children[e].price=null,L.value||(E.value=!0,L.value=!0))},F=h(!1),ee=h(!1),Se=["Has intentado agregar imÃ¡genes a una variante cuando ya existe otra variante principal con imÃ¡genes configuradas.","","ðŸ“‹ Regla del Sistema:","Solo puedes asignar imÃ¡genes a las opciones hijas de UNA variante principal. Si ya asignaste imÃ¡genes a una variante (por ejemplo, Color), no podrÃ¡s agregar imÃ¡genes a otra variante (por ejemplo, Equipo).","","ðŸ’¡ CÃ³mo funciona:","Cuando un cliente seleccione una opciÃ³n de la variante que tiene imÃ¡genes, se mostrarÃ¡ la imagen de esa opciÃ³n especÃ­fica en la galerÃ­a. Si no selecciona ninguna opciÃ³n o selecciona una opciÃ³n sin imagen, se mostrarÃ¡n las imÃ¡genes regulares del producto.","","ðŸ’¡ Sugerencia:","Si necesitas diferentes imÃ¡genes segÃºn mÃºltiples caracterÃ­sticas, considera crear productos separados o usar una sola variante que combine ambas caracterÃ­sticas."];W(()=>u.value,()=>{L.value||setTimeout(()=>{xe.value&&!E.value&&(E.value=!0,L.value=!0)},1e3)},{deep:!0}),W(()=>r.track_inventory,a=>{a&&(r.retail_price=r.price)}),W(()=>r.price,a=>{r.track_inventory&&(r.retail_price=a)});const Ve=h([{name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}}]),te=a=>String(a||"").split(",").map(e=>e.trim()).filter(Boolean);function Pe(a,e,n){return(a.rulesSelected&&Array.isArray(a.rulesSelected[e])?a.rulesSelected[e]:[]).includes(n)}function $e(a,e,n,s){const o=!!s?.target?.checked;a.rulesSelected||(a.rulesSelected={});const l=Array.isArray(a.rulesSelected[e])?[...a.rulesSelected[e]]:[],m=l.indexOf(n);o&&m===-1&&l.push(n),!o&&m!==-1&&l.splice(m,1),a.rulesSelected[e]=l}function Ae(a){a.__showDependency=!a.__showDependency,a.__showDependency||(a.dependsOn="",a.rulesSelected={},a.rules={})}const Ee=G(()=>r.variants.length===0?Number(r.quantity)||0:r.variants.reduce((a,e)=>a+(Number(e.stock)||0),0));W(Ee,a=>{r.variants.length>0&&(r.quantity=a)});const Me=()=>{if(H.value){O.value=["DebÃ©s seleccionar una subcategorÃ­a. La categorÃ­a principal tiene subcategorÃ­as disponibles y es obligatorio elegir una de ellas."],V.value=!0,J(()=>{const e=document.querySelector(".space-y-3 select");e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus())});return}r.variant_options=ye();const a=we();if(a.length>0)r.variant_attributes=a.map(e=>({name:e.name,values:e.values,dependsOn:e.dependsOn||"",rulesSelected:e.rulesSelected||{},rules:e.rules||{}}));else try{const e=Ve.value.map(n=>({name:String(n.name||"").trim(),values:te(n.valuesText),dependsOn:String(n.dependsOn||"").trim(),rules:n.rules||{},rulesSelected:n.rulesSelected||{}})).filter(n=>n.name&&n.values.length>0);if(r.variant_attributes=e,e.length>0){let l=function(v){o.has(v.name)||(v.dependsOn&&n[v.dependsOn]&&l(n[v.dependsOn]),o.add(v.name),s.push(v))},g=function(v,k){if(v===s.length){m.push({...k});return}const C=s[v];let se=C.values;if(C.dependsOn){const D=k[C.dependsOn];if(D!=null){const X=C.rulesSelected?.[D]??C.rules?.[D]??[],ae=Array.isArray(X)?X:te(X);ae.length>0&&(se=C.values.filter(je=>ae.includes(je)))}}for(const D of se)k[C.name]=D,g(v+1,k);delete k[C.name]};const n=Object.fromEntries(e.map(v=>[v.name,v])),s=[],o=new Set;e.forEach(l);const m=[];g(0,{}),r.variants=m.map(v=>({options_text:s.map(k=>`${k.name}:${v[k.name]}`).join(", "),price:"",purchase_price:null,stock:0,alert:null}))}}catch{r.variant_attributes=[]}r.transform(e=>(u.value.forEach((n,s)=>{n.children&&n.children.length>0&&n.children.forEach((o,l)=>{if(o.image instanceof File){const m=`variant_option_${s}_${l}`;e[m]=o.image}})}),e)),r.post(route("admin.products.store"),{preserveScroll:!0,onError:async()=>{await J();const e=[];for(const[o,l]of Object.entries(r.errors))o.startsWith("gallery_files.")&&String(l).includes("The gallery files.")?e.push("Una o mÃ¡s imÃ¡genes superan el tamaÃ±o mÃ¡ximo permitido (2 MB) o no son vÃ¡lidas."):o.startsWith("new_gallery_files.")?e.push("Una o mÃ¡s imÃ¡genes nuevas superan el tamaÃ±o mÃ¡ximo permitido (2 MB) o no son vÃ¡lidas."):e.push(String(l));O.value=e,V.value=e.length>0;const n=Object.keys(r.errors)[0],s=document.getElementById(n);s&&typeof s.scrollIntoView=="function"&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.focus?.())},onSuccess:()=>{z.value=!0,r.reset()}})};return(a,e)=>{const n=qe("InfoTip");return d(),c(S,null,[b(i(Te),{title:"Crear Producto"}),b(He,null,{header:j(()=>[Fe]),default:j(()=>[t("div",Ge,[t("div",We,[t("div",Qe,[t("div",Ke,[t("form",{onSubmit:Y(Me,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[t("div",null,[t("div",Xe,[Ye,p(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=s=>i(r).name=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,i(r).name]])]),t("div",Je,[Ze,t("div",Ie,[p(t("input",{id:"barcode","onUpdate:modelValue":e[1]||(e[1]=s=>i(r).barcode=s),type:"text",class:"flex-1 block mt-1 rounded-md shadow-sm border-gray-300",placeholder:"Ej: 1234567890123"},null,512),[[_,i(r).barcode]]),t("button",{type:"button",onClick:de,class:"px-4 py-2 mt-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2 whitespace-nowrap",title:"Escanear cÃ³digo de barras"},[et,$(" Escanear ")])])]),t("div",tt,[st,p(t("input",{id:"price","onUpdate:modelValue":e[2]||(e[2]=s=>i(r).price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,i(r).price]])]),t("div",at,[t("label",ot,[p(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=s=>i(r).track_inventory=s),class:"rounded"},null,512),[[De,i(r).track_inventory]]),nt]),i(r).track_inventory?(d(),c("h4",rt,"Inventario y Precios")):f("",!0),i(r).track_inventory?(d(),c("p",lt," Si creas variantes, estos totales se calcularÃ¡n solos. ")):f("",!0),i(r).track_inventory?(d(),c("div",it,[t("div",null,[t("label",ct,[$("Inventario (Total) "),b(n,{class:"ml-1 md:hidden",text:"Stock si no hay variantes. Con variantes, se suma automÃ¡ticamente."})]),p(t("input",{id:"quantity","onUpdate:modelValue":e[4]||(e[4]=s=>i(r).quantity=s),type:"number",class:N(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":i(r).variants.length>0}]),disabled:i(r).track_inventory===!1||i(r).variants.length>0,title:"Stock si no hay variantes. Con variantes, se suma automÃ¡ticamente."},null,10,dt),[[_,i(r).quantity]]),i(r).errors.quantity?(d(),c("p",ut,x(i(r).errors.quantity),1)):f("",!0)]),t("div",null,[t("label",mt,[$("Alerta (Opcional) "),b(n,{class:"ml-1 md:hidden",text:"Se considera bajo stock cuando cantidad â‰¤ alerta."})]),p(t("input",{id:"alert","onUpdate:modelValue":e[5]||(e[5]=s=>i(r).alert=s),type:"number",class:N(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":i(r).variants.length>0&&i(r).track_inventory}]),disabled:i(r).variants.length>0&&i(r).track_inventory,title:"Se considera bajo stock cuando cantidad â‰¤ alerta."},null,10,pt),[[_,i(r).alert]])]),t("div",null,[t("label",gt,[$("Precio de compra "),b(n,{class:"ml-1 md:hidden",text:"Costo de adquisiciÃ³n del producto."})]),p(t("input",{id:"purchase_price","onUpdate:modelValue":e[6]||(e[6]=s=>i(r).purchase_price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[_,i(r).purchase_price]])])])):f("",!0)]),t("div",ht,[vt,H.value?(d(),c("p",ft," âš ï¸ Es obligatorio seleccionar una subcategorÃ­a ")):f("",!0)]),t("div",_t,[(d(!0),c(S,null,A(y.value,(s,o)=>(d(),c("div",{key:o,class:"mb-1"},[p(t("select",{class:N(["block w-full rounded-md shadow-sm border-gray-300",{"border-red-500":H.value&&o===y.value.length-1&&!s.selected}]),"onUpdate:modelValue":l=>s.selected=l,onChange:l=>pe(o),required:o===y.value.length-1&&s.options.length>0},[yt,(d(!0),c(S,null,A(s.options,l=>(d(),c("option",{key:l.id,value:l.id},x(l.name),9,wt))),128))],42,bt),[[oe,s.selected]])]))),128))]),i(r).errors.category_id?(d(),c("p",xt,x(i(r).errors.category_id),1)):f("",!0),H.value&&!i(r).errors.category_id?(d(),c("p",kt," DebÃ©s seleccionar una subcategorÃ­a. La categorÃ­a principal tiene subcategorÃ­as disponibles. ")):f("",!0)]),t("div",null,[t("div",Ct,[St,p(t("textarea",{id:"short_description","onUpdate:modelValue":e[7]||(e[7]=s=>i(r).short_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[_,i(r).short_description]])]),t("div",Vt,[Pt,p(t("textarea",{id:"long_description","onUpdate:modelValue":e[8]||(e[8]=s=>i(r).long_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[_,i(r).long_description]])]),t("div",$t,[At,p(t("input",{id:"specifications","onUpdate:modelValue":e[9]||(e[9]=s=>i(r).specifications=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"Alto: 2.30m,Ancho: 1.20m,..."},null,512),[[_,i(r).specifications]])]),t("div",Et,[Mt,p(t("input",{id:"meta_keywords","onUpdate:modelValue":e[10]||(e[10]=s=>i(r).meta_keywords=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"palabra1, palabra2, palabra3"},null,512),[[_,i(r).meta_keywords]]),jt])]),t("div",Ot,[t("div",Ut,[t("div",Bt,[t("div",qt,[Tt,t("div",Dt,[t("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Expandir todo",onClick:e[11]||(e[11]=()=>{u.value.forEach((s,o)=>w.value[o]=!0)})}," + "),t("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Colapsar todo",onClick:e[12]||(e[12]=()=>{u.value.forEach((s,o)=>w.value[o]=!1)})}," âˆ’ ")])]),t("div",Nt,[u.value.length===0?(d(),c("p",zt," AÃºn no hay variantes principales. AgregÃ¡ una usando el botÃ³n de abajo. ")):f("",!0),(d(!0),c(S,null,A(u.value,(s,o)=>(d(),c("div",{key:`parent-${o}`,class:"p-3 hover:bg-gray-50"},[t("div",Ht,[t("div",Lt,[t("div",Rt,[t("button",{type:"button",class:"w-6 h-6 flex-shrink-0 inline-flex items-center justify-center rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100",title:w.value[o]??!1?"Colapsar opciones":"Expandir opciones",onClick:l=>ge(o)},[w.value[o]??!1?(d(),c("span",Wt,"v")):(d(),c("span",Gt,">"))],8,Ft),p(t("input",{"onUpdate:modelValue":l=>s.name=l,type:"text",placeholder:"Ej: Color, Talla, Material",class:"flex-1 min-w-0 font-medium border-0 bg-transparent focus:bg-white focus:border focus:border-gray-300 rounded px-2 py-1 focus:outline-none"},null,8,Qt),[[_,s.name]]),s.children&&s.children.length>0?(d(),c("span",Kt," ("+x(s.children.length)+") ",1)):f("",!0)])]),t("div",Xt,[t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:s.__showDependency?"Ocultar dependencia":"Configurar dependencia",onClick:l=>Ae(s)},Zt,8,Yt),t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded border border-green-500 text-green-600 hover:bg-green-50",title:"AÃ±adir opciÃ³n",onClick:l=>ve(o)},ts,8,It),t("button",{type:"button",onClick:l=>he(o),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},os,8,ss)])]),s.__showDependency?(d(),c("div",ns,[t("div",rs,[t("div",ls,[is,p(t("select",{"onUpdate:modelValue":l=>s.dependsOn=l,class:"block w-full text-sm border-gray-300 rounded-md shadow-sm"},[ds,(d(!0),c(S,null,A(u.value,(l,m)=>(d(),c("option",{key:`dep-${o}-${m}`,value:l.name,disabled:l===s||!l.name},x(l.name||"(sin nombre)"),9,us))),128))],8,cs),[[oe,s.dependsOn]])]),s.dependsOn?(d(),c("div",ms,[ps,t("div",gs,[(d(!0),c(S,null,A((u.value.find(l=>l.name===s.dependsOn)?.children||[]).map(l=>l.name),l=>(d(),c("div",{key:`pv-${o}-${l}`,class:"border rounded p-2 bg-white"},[t("div",hs,[$(x(s.dependsOn)+" = ",1),t("strong",null,x(l),1)]),t("div",vs,[(d(!0),c(S,null,A((s.children||[]).map(m=>m.name),m=>(d(),c("label",{key:`cv-${o}-${l}-${m}`,class:"inline-flex items-center gap-1 text-xs"},[t("input",{type:"checkbox",checked:Pe(s,l,m),onChange:g=>$e(s,l,m,g),class:"rounded"},null,40,fs),t("span",null,x(m),1)]))),128))])]))),128))])])):f("",!0)])])):f("",!0),w.value[o]??!1?(d(),c("div",_s,[(d(!0),c(S,null,A(s.children,(l,m)=>(d(),c("div",{key:`child-${o}-${m}`,class:"py-2 flex justify-between items-start"},[t("div",bs,[t("div",null,[ys,p(t("input",{"onUpdate:modelValue":g=>l.name=g,type:"text",placeholder:"Ej: Rojo, Verde",class:"block w-full text-sm border-gray-300 rounded-md shadow-sm"},null,8,ws),[[_,l.name]])]),t("div",null,[xs,p(t("input",{"onUpdate:modelValue":g=>l.price=g,type:"number",step:"0.01",placeholder:"Usa precio principal",class:N(["block w-full text-sm border-gray-300 rounded-md shadow-sm",{"bg-gray-100 cursor-not-allowed":!R(o)}]),disabled:!R(o),onInput:g=>Ce(o,m,g)},null,42,ks),[[_,l.price]]),R(o)?f("",!0):(d(),c("p",Cs," Solo puedes agregar precios a una variante principal "))]),t("div",Ss,[t("input",{type:"file",accept:"image/*",onChange:g=>_e(o,m,g),class:"hidden",id:`variant-image-input-${o}-${m}`,disabled:!M(o)},null,40,Vs),l.imagePreview?(d(),c("div",Ps,[t("img",{src:l.imagePreview,alt:"Preview",class:"w-10 h-10 object-cover rounded border"},null,8,$s),t("button",{type:"button",onClick:Y(g=>be(o,m),["stop"]),class:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs hover:bg-red-600"}," Ã— ",8,As)])):(d(),c("label",{key:1,for:`variant-image-input-${o}-${m}`,class:N(["inline-flex items-center justify-center w-10 h-10 border-2 border-dashed border-gray-300 rounded hover:border-blue-400 hover:bg-blue-50 transition",{"cursor-pointer":M(o),"cursor-not-allowed opacity-50":!M(o)}]),title:M(o)?"Agregar foto":"Solo puedes agregar imÃ¡genes a una variante principal"},js,10,Es)),M(o)?f("",!0):(d(),c("p",Os," Solo puedes agregar imÃ¡genes a una variante principal "))])]),t("div",Us,[t("button",{type:"button",onClick:g=>fe(o,m),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},Ts,8,Bs)])]))),128))])):f("",!0)]))),128))]),t("form",{onSubmit:Y(I,["prevent"]),class:"mt-6 border-t pt-4"},[Ds,t("div",Ns,[p(t("input",{type:"text","onUpdate:modelValue":e[13]||(e[13]=s=>T.value=s),class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Nombre de la nueva variante principal",onKeyup:Ne(I,["enter"])},null,544),[[_,T.value]]),zs,t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:e[14]||(e[14]=s=>T.value=""),title:"Cancelar"}," âœ– ")])],32)])])]),t("div",Hs,[Ls,Rs,t("div",Fs,[Gs,t("input",{id:"gallery_files",onInput:e[15]||(e[15]=s=>ue(s)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),Ws])]),t("div",Qs,[t("button",{type:"submit",disabled:i(r).processing,class:"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow"},Js,8,Ks),Object.keys(i(r).errors).length?(d(),c("span",Zs,"Por favor corrige los campos marcados.")):f("",!0)])],32)])])])])]),_:1}),b(Q,{show:z.value,type:"success",title:"Â¡Producto creado con Ã©xito!","primary-text":"Entendido",onPrimary:e[16]||(e[16]=s=>z.value=!1),onClose:e[17]||(e[17]=s=>z.value=!1)},null,8,["show"]),b(Q,{show:V.value,type:"error",title:"No pudimos guardar el producto",message:"RevisÃ¡ los siguientes puntos:",messages:O.value,"primary-text":"Entendido",onPrimary:e[18]||(e[18]=s=>V.value=!1),onClose:e[19]||(e[19]=s=>V.value=!1)},null,8,["show","messages"]),b(Q,{show:E.value,type:"warning",title:"Solo una Variante Puede Tener Precios",messages:ke,"primary-text":"Entendido",onPrimary:e[20]||(e[20]=s=>E.value=!1),onClose:e[21]||(e[21]=s=>E.value=!1)},null,8,["show"]),b(Q,{show:F.value,type:"warning",title:"Solo una Variante Puede Tener ImÃ¡genes",messages:Se,"primary-text":"Entendido",onPrimary:e[22]||(e[22]=s=>F.value=!1),onClose:e[23]||(e[23]=s=>F.value=!1)},null,8,["show"]),b(ne,{show:U.value,onClose:q},{default:j(()=>[t("div",Is,[ea,ta,t("div",sa,[b(Re,{onClick:q},{default:j(()=>[$("Cerrar")]),_:1})])])]),_:1},8,["show"]),b(ne,{show:B.value,onClose:e[25]||(e[25]=s=>B.value=!1)},{default:j(()=>[t("div",aa,[oa,t("div",na,[ra,t("p",la,x(K.value),1)]),t("div",ia,[b(Le,{onClick:e[24]||(e[24]=s=>B.value=!1)},{default:j(()=>[$("Aceptar")]),_:1})])])]),_:1},8,["show"])],64)}}};export{ha as default};
