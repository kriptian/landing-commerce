import{c as M,r as h,u as K,a as n,o as d,b as c,d as l,h as R,e as u,f as e,i as p,l as U,x as w,m as _,F as V,s as O,t as i,g as W,j as r,n as m,p as X,k as Y,z as Z,A as S}from"./app-DsV3hoUw.js";import{_ as ee}from"./AuthenticatedLayout-CneOKjKy.js";import{_ as te}from"./Pagination-CsYWGaGw.js";import{_ as N}from"./Modal-qQ5PtVgh.js";import{_ as F}from"./PrimaryButton-B_cKDgPf.js";import{_ as L}from"./SecondaryButton-B53taTkr.js";import{D as se}from"./DangerButton-xYgGGn3P.js";import"./AlertModal-Dyptdycb.js";const oe={class:"flex items-center justify-between"},ae=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Clientes",-1),le={class:"py-12"},ie={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},de={class:"mb-6 border-b border-gray-200"},ne={class:"-mb-px flex space-x-8"},re={key:0},ce={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ue={class:"overflow-x-auto"},me={class:"min-w-full divide-y divide-gray-200"},pe=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Código"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tipo"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Valor"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Usos"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Expira"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Acciones")])],-1),_e={class:"bg-white divide-y divide-gray-200"},xe={class:"px-6 py-4 whitespace-nowrap"},ge={class:"text-sm font-medium text-gray-900"},ye={key:0,class:"text-xs text-gray-500"},ve={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},we={class:"px-6 py-4 whitespace-nowrap"},ke=["onClick"],Ce={class:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2"},De=["onClick"],Ee=["onClick"],Ve={key:0},je=e("td",{colspan:"7",class:"px-6 py-4 text-center text-sm text-gray-500"}," No hay cupones creados ",-1),$e=[je],Me={key:0,class:"px-6 py-4 border-t border-gray-200"},Ue={class:"p-6"},Oe={class:"text-lg font-semibold text-gray-900 mb-4"},Se=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Código del Cupón",-1),Ne=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de Descuento",-1),Fe=e("option",{value:"percentage"},"Porcentaje (%)",-1),Le=e("option",{value:"fixed"},"Monto Fijo ($)",-1),Pe=[Fe,Le],Te={class:"block text-sm font-medium text-gray-700 mb-1"},qe=e("span",{class:"text-red-500"},"*",-1),Ae={class:"text-xs text-gray-500 mb-2"},Be=["placeholder"],Ie=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Monto Mínimo de Compra (Opcional)",-1),ze=e("p",{class:"text-xs text-gray-500 mb-2"}," El cupón solo será válido si el total del carrito es igual o mayor a este monto. Déjalo vacío si no quieres un mínimo. ",-1),Ge={key:0},He=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Descuento Máximo (Opcional)",-1),Qe=e("p",{class:"text-xs text-gray-500 mb-2"}," Limita el descuento máximo en pesos. Ejemplo: Si el cupón es 15% y pones máximo $50.000, aunque el 15% de $1.000.000 sería $150.000, solo se aplicará $50.000 de descuento. ",-1),Je={class:"grid grid-cols-2 gap-4"},Ke=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Válido Desde (Opcional)",-1),Re=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Válido Hasta (Opcional)",-1),We={class:"grid grid-cols-2 gap-4"},Xe=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Límite Total de Usos (Opcional)",-1),Ye=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Límite por Cliente (Opcional)",-1),Ze=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Descripción (Opcional)",-1),et=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Productos Específicos (Opcional)",-1),tt=e("p",{class:"text-xs text-gray-500 mb-2"},"Selecciona uno o varios productos. Si no seleccionas ninguno, el cupón aplicará a todo el catálogo.",-1),st={class:"mb-3"},ot={class:"border border-gray-300 rounded-md max-h-60 overflow-y-auto bg-white"},at={key:0,class:"p-4 text-sm text-gray-500 text-center"},lt={key:1,class:"divide-y divide-gray-200"},it=["checked","onChange"],dt={class:"ml-3 flex-1"},nt={class:"text-sm font-medium text-gray-900"},rt={key:0,class:"ml-2 text-xs text-gray-500"},ct={key:0,class:"mt-2 text-sm text-indigo-600"},ut={class:"flex items-center"},mt=e("label",{for:"is_active",class:"ml-2 text-sm text-gray-700"},"Cupón activo",-1),pt={class:"flex justify-end gap-3 mt-6"},_t={class:"p-6"},xt=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Eliminar Cupón",-1),gt={class:"text-gray-600 mb-6"},yt={class:"flex justify-end gap-3"},Et={__name:"Index",props:{coupons:Object,products:Array},setup(y){const j=y,f=M(()=>route().current("admin.coupons.*")?"coupons":"customers"),v=h(!1),k=h(!1),C=h(!1),D=h(null),b=h(null),x=h(""),t=K({code:"",type:"percentage",value:"",min_purchase:"",max_discount:"",valid_from:"",valid_until:"",usage_limit:"",usage_limit_per_customer:"",is_active:!0,description:"",product_ids:[]}),P=()=>{t.reset(),t.type="percentage",t.is_active=!0,t.product_ids=[],x.value="",v.value=!0},T=o=>{D.value=o,t.code=o.code,t.type=o.type,t.value=o.value,t.min_purchase=o.min_purchase||"",t.max_discount=o.max_discount||"",t.valid_from=o.valid_from?o.valid_from.split(" ")[0]:"",t.valid_until=o.valid_until?o.valid_until.split(" ")[0]:"",t.usage_limit=o.usage_limit||"",t.usage_limit_per_customer=o.usage_limit_per_customer||"",t.is_active=o.is_active,t.description=o.description||"",t.product_ids=o.products?.map(a=>a.id)||[],x.value="",k.value=!0},g=()=>{v.value=!1,k.value=!1,C.value=!1,D.value=null,b.value=null,x.value="",t.reset()},q=()=>{t.post(route("admin.coupons.store"),{onSuccess:()=>{g()}})},A=()=>{t.put(route("admin.coupons.update",D.value.id),{onSuccess:()=>{g()}})},B=o=>{b.value=o,C.value=!0},I=()=>{S.delete(route("admin.coupons.destroy",b.value.id),{onSuccess:()=>{g()}})},z=o=>{S.put(route("admin.coupons.toggle-active",o.id),{preserveScroll:!0})},G=o=>o?new Date(o).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric"}):"N/A",H=o=>o.valid_until?new Date(o.valid_until)<new Date:!1,$=M(()=>{if(!x.value.trim())return j.products||[];const o=x.value.toLowerCase();return(j.products||[]).filter(a=>a.name.toLowerCase().includes(o))}),Q=o=>{const a=t.product_ids.indexOf(o);a>-1?t.product_ids.splice(a,1):t.product_ids.push(o)},J=o=>t.product_ids.includes(o);return(o,a)=>(d(),n(V,null,[c(l(R),{title:"Cupones de Descuento"}),c(ee,null,{header:u(()=>[e("div",oe,[ae,f.value==="coupons"?(d(),Z(F,{key:0,onClick:P},{default:u(()=>[_(" + Crear Cupón ")]),_:1})):p("",!0)])]),default:u(()=>[e("div",le,[e("div",ie,[e("div",de,[e("nav",ne,[c(l(U),{href:o.route("admin.customers.index"),class:w([f.value==="customers"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},{default:u(()=>[_(" Listado de Clientes ")]),_:1},8,["href","class"]),c(l(U),{href:o.route("admin.coupons.index"),class:w([f.value==="coupons"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},{default:u(()=>[_(" Cupones de Descuento ")]),_:1},8,["href","class"])])]),f.value==="coupons"?(d(),n("div",re,[e("div",ce,[e("div",ue,[e("table",me,[pe,e("tbody",_e,[(d(!0),n(V,null,O(y.coupons.data,s=>(d(),n("tr",{key:s.id,class:w(["hover:bg-gray-50",{"bg-red-50":H(s)}])},[e("td",xe,[e("div",ge,i(s.code),1),s.products&&s.products.length>0?(d(),n("div",ye,i(s.products.length)+" producto(s) ",1)):p("",!0)]),e("td",ve,i(s.type==="percentage"?"Porcentaje":"Fijo"),1),e("td",he,i(s.type==="percentage"?s.value+"%":"$"+s.value),1),e("td",fe,i(s.usages_count||0)+i(s.usage_limit?" / "+s.usage_limit:""),1),e("td",be,i(G(s.valid_until)),1),e("td",we,[e("button",{onClick:E=>z(s),class:w(["px-2 py-1 rounded text-xs font-medium",s.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},i(s.is_active?"Activo":"Inactivo"),11,ke)]),e("td",Ce,[e("button",{onClick:E=>T(s),class:"text-indigo-600 hover:text-indigo-900"}," Editar ",8,De),e("button",{onClick:E=>B(s),class:"text-red-600 hover:text-red-900"}," Eliminar ",8,Ee)])],2))),128)),y.coupons.data.length===0?(d(),n("tr",Ve,$e)):p("",!0)])])]),y.coupons.links&&y.coupons.links.length>3?(d(),n("div",Me,[c(te,{links:y.coupons.links},null,8,["links"])])):p("",!0)])])):p("",!0)])]),c(N,{show:v.value||k.value,onClose:g},{default:u(()=>[e("div",Ue,[e("h2",Oe,i(v.value?"Crear Nuevo Cupón":"Editar Cupón"),1),e("form",{onSubmit:a[12]||(a[12]=W(s=>v.value?q():A(),["prevent"])),class:"space-y-4"},[e("div",null,[Se,r(e("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>l(t).code=s),type:"text",class:"block w-full rounded-md border-gray-300 shadow-sm",required:""},null,512),[[m,l(t).code]])]),e("div",null,[Ne,r(e("select",{"onUpdate:modelValue":a[1]||(a[1]=s=>l(t).type=s),class:"block w-full rounded-md border-gray-300 shadow-sm"},Pe,512),[[X,l(t).type]])]),e("div",null,[e("label",Te,[_(" Valor del Descuento "+i(l(t).type==="percentage"?"(%)":"($)")+" ",1),qe]),e("p",Ae,i(l(t).type==="percentage"?"Ingresa el porcentaje de descuento (ej: 15 para 15% de descuento)":"Ingresa el monto fijo de descuento en pesos (ej: 50000 para $50.000 de descuento)"),1),r(e("input",{"onUpdate:modelValue":a[2]||(a[2]=s=>l(t).value=s),type:"number",step:"0.01",min:"0",class:"block w-full rounded-md border-gray-300 shadow-sm",required:"",placeholder:l(t).type==="percentage"?"Ej: 15":"Ej: 50000"},null,8,Be),[[m,l(t).value]])]),e("div",null,[Ie,ze,r(e("input",{"onUpdate:modelValue":a[3]||(a[3]=s=>l(t).min_purchase=s),type:"number",step:"0.01",min:"0",class:"block w-full rounded-md border-gray-300 shadow-sm",placeholder:"Ej: 100000"},null,512),[[m,l(t).min_purchase]])]),l(t).type==="percentage"?(d(),n("div",Ge,[He,Qe,r(e("input",{"onUpdate:modelValue":a[4]||(a[4]=s=>l(t).max_discount=s),type:"number",step:"0.01",min:"0",class:"block w-full rounded-md border-gray-300 shadow-sm",placeholder:"Ej: 50000"},null,512),[[m,l(t).max_discount]])])):p("",!0),e("div",Je,[e("div",null,[Ke,r(e("input",{"onUpdate:modelValue":a[5]||(a[5]=s=>l(t).valid_from=s),type:"date",class:"block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[m,l(t).valid_from]])]),e("div",null,[Re,r(e("input",{"onUpdate:modelValue":a[6]||(a[6]=s=>l(t).valid_until=s),type:"date",class:"block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[m,l(t).valid_until]])])]),e("div",We,[e("div",null,[Xe,r(e("input",{"onUpdate:modelValue":a[7]||(a[7]=s=>l(t).usage_limit=s),type:"number",min:"1",class:"block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[m,l(t).usage_limit]])]),e("div",null,[Ye,r(e("input",{"onUpdate:modelValue":a[8]||(a[8]=s=>l(t).usage_limit_per_customer=s),type:"number",min:"1",class:"block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[m,l(t).usage_limit_per_customer]])])]),e("div",null,[Ze,r(e("textarea",{"onUpdate:modelValue":a[9]||(a[9]=s=>l(t).description=s),class:"block w-full rounded-md border-gray-300 shadow-sm",rows:"2"},null,512),[[m,l(t).description]])]),e("div",null,[et,tt,e("div",st,[r(e("input",{"onUpdate:modelValue":a[10]||(a[10]=s=>x.value=s),type:"text",placeholder:"Buscar productos...",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"},null,512),[[m,x.value]])]),e("div",ot,[$.value.length===0?(d(),n("div",at," No se encontraron productos ")):(d(),n("div",lt,[(d(!0),n(V,null,O($.value,s=>(d(),n("label",{key:s.id,class:"flex items-center px-4 py-3 hover:bg-gray-50 cursor-pointer"},[e("input",{type:"checkbox",checked:J(s.id),onChange:E=>Q(s.id),class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,40,it),e("div",dt,[e("span",nt,i(s.name),1),s.price?(d(),n("span",rt," - "+i(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(s.price)),1)):p("",!0)])]))),128))]))]),l(t).product_ids.length>0?(d(),n("div",ct,i(l(t).product_ids.length)+" producto(s) seleccionado(s) ",1)):p("",!0)]),e("div",ut,[r(e("input",{"onUpdate:modelValue":a[11]||(a[11]=s=>l(t).is_active=s),type:"checkbox",id:"is_active",class:"rounded border-gray-300"},null,512),[[Y,l(t).is_active]]),mt]),e("div",pt,[c(L,{onClick:g,type:"button"},{default:u(()=>[_("Cancelar")]),_:1}),c(F,{type:"submit",disabled:l(t).processing},{default:u(()=>[_(i(v.value?"Crear":"Guardar"),1)]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"]),c(N,{show:C.value,onClose:g},{default:u(()=>[e("div",_t,[xt,e("p",gt,' ¿Estás seguro de que deseas eliminar el cupón "'+i(b.value?.code)+'"? Esta acción no se puede deshacer. ',1),e("div",yt,[c(L,{onClick:g},{default:u(()=>[_("Cancelar")]),_:1}),c(se,{onClick:I},{default:u(()=>[_("Eliminar")]),_:1})])])]),_:1},8,["show"])]),_:1})],64))}};export{Et as default};
