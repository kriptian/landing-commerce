import{B as Ke,r as f,c as D,u as Qe,w as ue,q as Xe,x as Ye,a as d,o as c,b as j,d as p,h as Ze,e as B,f as s,g as y,i as w,j as _,l as x,v as Ie,n as T,F as P,k as V,t as A,D as me,p as I,P as et,s as tt}from"./app-Wfwqp0Xc.js";import{_ as st}from"./AuthenticatedLayout-BY7n14zS.js";import{_ as W}from"./AlertModal-8hoYPLLj.js";import{_ as ot}from"./Modal-BwX-D_Hf.js";import{_ as nt}from"./SecondaryButton-B1_JX0Mt.js";import{D as at}from"./DangerButton-C7Kcf1Z6.js";const lt={class:"font-semibold text-xl text-gray-800 leading-tight"},rt={class:"py-12"},it={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},dt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ct={class:"p-6 text-gray-900"},ut={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},mt={class:"mb-4"},pt=s("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1),gt={class:"mb-4"},ht=s("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1),vt={class:"inline-flex items-center gap-2 mb-3 select-none"},ft=s("span",{class:"font-semibold"},"Controlar inventario",-1),_t={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},yt=s("label",{for:"quantity",class:"block font-medium text-sm text-gray-700"},"Inventario (Total)",-1),bt=["disabled"],wt=s("label",{for:"alert_general",class:"block font-medium text-sm text-gray-700"},"Alerta (Opcional)",-1),xt=["disabled"],kt=s("label",{for:"purchase_price",class:"block font-medium text-sm text-gray-700"},"Precio de compra",-1),St={class:"mb-2"},Ct=s("label",{class:"block font-medium text-sm text-gray-700"},"CategorÃ­as",-1),Pt={key:0,class:"mt-1 text-sm text-amber-600 font-medium"},jt={class:"space-y-3"},Vt=["onUpdate:modelValue","onChange","required"],At=s("option",{value:null},"Seleccione una categorÃ­a",-1),Et=["value"],$t={key:1,class:"mt-1 text-sm text-red-600"},Ot={class:"mb-4"},Mt=s("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"DescripciÃ³n Corta",-1),Dt={class:"mb-4"},Tt=s("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"DescripciÃ³n Larga",-1),Ut={class:"mb-4"},zt=s("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1),qt={class:"md:col-span-2 mt-6 border-t pt-6"},Bt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Nt={class:"p-6 text-gray-900"},Ft={class:"flex items-center justify-between"},Lt=s("h3",{class:"text-lg font-medium"},"Variantes del Producto",-1),Gt={class:"flex items-center gap-2"},Ht={class:"mt-4 border rounded-lg divide-y"},Rt={key:0,class:"text-sm text-gray-500 p-3"},Wt={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2"},Jt={class:"flex-1 min-w-0"},Kt={class:"flex items-center gap-2"},Qt=["title","onClick"],Xt={key:0},Yt={key:1},Zt=["onUpdate:modelValue"],It={key:0,class:"flex-shrink-0 text-xs bg-gray-100 text-gray-700 rounded px-2 py-0.5 align-middle"},es={class:"flex items-center gap-2 flex-shrink-0"},ts=["title","onClick"],ss=s("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[s("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),s("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})],-1),os=[ss],ns=["onClick"],as=s("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("rect",{x:"4",y:"3",width:"11",height:"15",rx:"2",ry:"2","stroke-width":"1.5"}),s("circle",{cx:"18",cy:"18",r:"3","stroke-width":"1.5"}),s("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M18 16.5v3M16.5 18h3"})],-1),ls=[as],rs=["onClick"],is=s("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),ds=[is],cs={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2"},us={class:"grid grid-cols-1 md:grid-cols-5 gap-3"},ms={class:"md:col-span-2"},ps=s("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Depende de",-1),gs=["onUpdate:modelValue"],hs=s("option",{value:""},"(sin dependencia)",-1),vs=["value","disabled"],fs={key:0,class:"md:col-span-3"},_s=s("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Permitir valores segÃºn el valor del padre",-1),ys={class:"mt-2 space-y-2"},bs={class:"text-xs font-semibold text-gray-700 mb-1"},ws={class:"flex flex-wrap gap-2"},xs=["checked","onChange"],ks={key:1,class:"mt-2 pl-4 border-l"},Ss={class:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-3"},Cs=s("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Nombre",-1),Ps=["onUpdate:modelValue"],js=s("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Precio (opcional)",-1),Vs=["onUpdate:modelValue","disabled","onInput"],As={key:0,class:"mt-1 text-xs text-amber-600"},Es={class:"flex items-center gap-2"},$s=["onChange","id","disabled"],Os={key:0,class:"relative"},Ms=["src"],Ds=["onClick"],Ts=["for","title"],Us=s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-5 h-5 text-gray-400",fill:"currentColor"},[s("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1),zs=[Us],qs={key:2,class:"mt-1 text-xs text-amber-600"},Bs={class:"flex items-center gap-2 ml-2"},Ns=["onClick"],Fs=s("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),Ls=[Fs],Gs=s("label",{class:"block font-medium text-sm text-gray-700"},"AÃ±adir Nueva Variante Principal",-1),Hs={class:"mt-2 flex items-center gap-2"},Rs=s("button",{type:"submit",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",title:"AÃ±adir"}," âœ” ",-1),Ws={class:"md:col-span-2 mt-6 border-t pt-6"},Js=s("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"ImÃ¡genes Extra de la GalerÃ­a",-1),Ks=s("p",{class:"text-sm text-gray-600 mb-4"}," Estas imÃ¡genes se agregarÃ¡n a la galerÃ­a general del producto. Las imÃ¡genes de las variantes se muestran cuando se selecciona esa opciÃ³n. ",-1),Qs={class:"p-4 border rounded-md bg-gray-50 col-span-2"},Xs={class:"flex items-center justify-between mb-2"},Ys=s("label",{class:"block font-medium text-sm text-gray-700"},"ImÃ¡genes actuales",-1),Zs={class:"text-xs text-gray-500"},Is={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3"},eo=["onClick"],to=["src"],so=["onClick"],oo={key:1,class:"text-sm text-gray-500 mt-2"},no={class:"mt-4 col-span-2"},ao=s("label",{for:"new_gallery_files",class:"block font-medium text-sm text-gray-700"},"AÃ±adir mÃ¡s imÃ¡genes",-1),lo=s("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1),ro={class:"relative flex items-center justify-center bg-gray-50 border rounded-lg h-[60vh] min-h-[320px] mb-3 select-none"},io=["src"],co={class:"flex items-center gap-2 overflow-x-auto py-2"},uo=["onClick"],mo=["src"],po={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},go=["disabled"],ho=s("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M4 4a2 2 0 0 1 2-2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4zm9-1.5V7h4.5L13 2.5z"}),s("path",{d:"M8 13h8v2H8zM8 9h5v2H8z"})],-1),vo=s("span",null,"Guardar",-1),fo=[ho,vo],_o={class:"p-6"},yo=s("h2",{class:"text-lg font-medium text-gray-900"}," Â¿DeseÃ¡s guardar los cambios del producto? ",-1),bo=s("p",{class:"mt-1 text-sm text-gray-600"}," Se actualizarÃ¡ la informaciÃ³n y variantes del producto. ",-1),wo={class:"mt-6 flex justify-end"},pe=2*1024*1024,Vo={__name:"Edit",props:{product:Object,categories:Array,selectedCategoryPath:Array},setup(ge){const m=ge,ee=Ke(),J=f(!!ee?.props?.flash?.success);f(ee?.props?.flash?.success||"");const N=f(!1),$=f(!1),U=f([]),he=o=>{const e=Array.from(o?.target?.files||[]),t=[],n=[];for(const a of e){if(!(a?.type||"").startsWith("image/")){t.push(`${a.name}: no es una imagen vÃ¡lida.`);continue}if(a.size>pe){t.push(`${a.name}: supera el lÃ­mite de 2 MB.`);continue}n.push(a)}if(t.length){U.value=["Problemas con las imÃ¡genes seleccionadas:",...t],$.value=!0,o?.target&&(o.target.value=""),r.new_gallery_files=[];return}r.new_gallery_files=n},h=f([{options:m.categories,selected:null}]),ve=async()=>{if(!Array.isArray(m.selectedCategoryPath)||m.selectedCategoryPath.length===0)return;for(let e=0;e<m.selectedCategoryPath.length;e++){const t=m.selectedCategoryPath[e];if(h.value[e]||(h.value[e]={options:[],selected:null}),e>0&&h.value[e].options.length===0){const n=h.value[e-1].selected;if(n){const l=await(await fetch(route("admin.categories.children",n))).json();h.value[e].options=Array.isArray(l.data)?l.data:[]}}h.value[e].selected=t.id,r.category_id=t.id,e<m.selectedCategoryPath.length-1&&(h.value[e+1]||(h.value[e+1]={options:[],selected:null}))}const o=r.category_id;if(o){const t=await(await fetch(route("admin.categories.children",o))).json(),n=Array.isArray(t.data)?t.data:[];n.length>0&&h.value.push({options:n,selected:null})}},fe=o=>{h.value.splice(o+1)},_e=async o=>{const e=h.value[o].selected;if(fe(o),r.category_id=e||null,!e)return;const t=await fetch(route("admin.categories.children",e));if(!t.ok)return;const n=await t.json(),a=Array.isArray(n.data)?n.data:[];a.length>0&&(h.value.push({options:a,selected:null}),r.category_id=null)},F=D(()=>{if(h.value.length>1){const o=h.value[h.value.length-1];if(o.options.length>0&&!o.selected)return!h.value.some(t=>t.selected===r.category_id)}return!1}),ye=o=>Object.entries(o).map(([e,t])=>`${e}:${t}`).join(", "),be=m.product.variants.map(o=>({id:o.id,options_text:ye(o.options),price:o.price??"",purchase_price:o.purchase_price??null,retail_price:o.retail_price??null,stock:o.stock,alert:o.alert??null})),r=Qe({_method:"PUT",name:m.product.name,price:m.product.price,purchase_price:m.product.purchase_price??null,track_inventory:m.product.track_inventory??!0,quantity:m.product.quantity,alert:m.product.alert??null,category_id:m.product.category_id,short_description:m.product.short_description,long_description:m.product.long_description,specifications:m.product.specifications?JSON.parse(m.product.specifications).join(", "):"",new_gallery_files:[],images_to_delete:[],variants:be,variants_to_delete:[],variant_attributes:[],variant_options:[]}),u=f([]),z=f(""),k=f({}),we=o=>{k.value[o]=!k.value[o]},xe=()=>{if(!m.product.variant_options||!Array.isArray(m.product.variant_options)){console.log("ðŸ” EDIT - No hay variant_options para hidratar");return}console.log("ðŸ” EDIT - Variant options recibidas del backend",JSON.stringify(m.product.variant_options,null,2));const o={};m.product.variant_attributes&&Array.isArray(m.product.variant_attributes)&&m.product.variant_attributes.forEach(e=>{e.name&&e.dependsOn&&(o[e.name]={dependsOn:e.dependsOn,rulesSelected:e.rulesSelected||{},rules:e.rules||{}})}),u.value=m.product.variant_options.map(e=>{const t=(e.children||[]).map(l=>{let i=l.image_path||null;return console.log("ðŸ” EDIT - Hidratando child",{id:l.id,name:l.name,image_path_raw:l.image_path,image_path_type:typeof l.image_path}),i&&!i.startsWith("/storage/")&&!i.startsWith("http://")&&!i.startsWith("https://")&&(i="/storage/"+i.replace(/^\/+/,"")),console.log("ðŸ” EDIT - Child hidratado",{id:l.id,name:l.name,imagePath_normalized:i}),{id:l.id,name:l.name,price:l.price,image:null,imagePreview:i,imagePath:i,order:l.order||0}}),n=o[e.name]||{},a=!!(n.dependsOn||Object.keys(n.rulesSelected||{}).length||Object.keys(n.rules||{}).length);return{id:e.id,name:e.name,children:t,order:e.order||0,dependsOn:n.dependsOn||"",rules:n.rules||{},rulesSelected:n.rulesSelected||{},__showDependency:a}}),u.value.forEach((e,t)=>{k.value[t]=!0})},te=()=>{const o=z.value.trim()||"",e=u.value.length;u.value.push({id:null,name:o,children:[],order:e,dependsOn:"",rules:{},rulesSelected:{},__showDependency:!1}),k.value[e]=!0,z.value=""},ke=o=>{u.value.splice(o,1)},Se=o=>{u.value[o].children||(u.value[o].children=[]),u.value[o].children.push({id:null,name:"",price:null,image:null,imagePreview:null,imagePath:null,order:u.value[o].children.length}),k.value[o]=!0},Ce=(o,e)=>{u.value[o].children.splice(e,1)},Pe=(o,e,t)=>{const n=t?.target?.files?.[0];if(!n)return;if(!M(o)){t?.target&&(t.target.value=""),se.value||(H.value=!0,se.value=!0);return}const a=[];if((n?.type||"").startsWith("image/")||a.push(`${n.name}: no es una imagen vÃ¡lida.`),n.size>pe&&a.push(`${n.name}: supera el lÃ­mite de 2 MB.`),a.length){U.value=["Problemas con la imagen de la variante:",...a],$.value=!0,t?.target&&(t.target.value=""),u.value[o].children[e].image=null,u.value[o].children[e].imagePreview=null,u.value[o].children[e].imagePath=null;return}u.value[o].children[e].image=n,u.value[o].children[e].imagePath=null;const i=new FileReader;i.onload=g=>{u.value[o].children[e].imagePreview=g.target.result},i.readAsDataURL(n)},je=(o,e)=>{u.value[o].children[e].image=null,u.value[o].children[e].imagePreview=null,u.value[o].children[e].imagePath=null},Ve=()=>{const o=[];return u.value.forEach((e,t)=>{if(!e.name.trim())return;const n={id:e.id,name:e.name.trim(),parent_id:null,price:null,image_path:null,order:e.order??t,children:[]};e.children&&e.children.length>0&&e.children.forEach((a,l)=>{if(!a.name.trim())return;let i=null;if(!a.image&&a.imagePath){const g=String(a.imagePath||"").trim();g&&g!=="null"&&g!=="undefined"&&(i=g)}console.log("ðŸ” EDIT - Preparando variant option child",{childId:a.id,name:a.name,hasNewImage:!!a.image,imagePath:a.imagePath,imagePathToSend:i}),n.children.push({id:a.id,name:a.name.trim(),parent_id:null,price:a.price?parseFloat(a.price):null,image_file_key:a.image?`variant_option_${t}_${l}`:null,image_path:i,order:a.order??l})}),(n.children.length>0||n.name)&&o.push(n)}),console.log("ðŸ” EDIT - Variant options preparadas para enviar",JSON.stringify(o,null,2)),o},Ae=()=>{const o=[];return u.value.forEach(e=>{if(!e.name.trim())return;const t=(e.children||[]).map(a=>a.name.trim()).filter(Boolean);if(t.length===0)return;const n={name:e.name.trim(),values:t,valuesText:t.join(", "),dependsOn:e.dependsOn||"",rules:e.rules||{},rulesSelected:e.rulesSelected||{}};o.push(n)}),o},Ee=D(()=>u.value.filter(e=>!e.children||e.children.length===0?!1:e.children.some(t=>t.price&&t.price!==""&&t.price!=null)).length>1),O=f(!1),L=f(!1),$e=["Has intentado agregar precios a una variante cuando ya existe otra variante principal con precios configurados.","","ðŸ“‹ Regla del Sistema:","Solo puedes asignar precios a las opciones hijas de UNA variante principal. Si ya asignaste precios a una variante (por ejemplo, Color), no podrÃ¡s agregar precios a otra variante (por ejemplo, Equipo).","","ðŸ’¡ CÃ³mo funciona:","Cuando un cliente seleccione una opciÃ³n de la variante que tiene precios, se mostrarÃ¡ el precio de esa opciÃ³n especÃ­fica. Si no selecciona ninguna opciÃ³n o selecciona una opciÃ³n sin precio, se usarÃ¡ el precio principal del producto.","","ðŸ’¡ Sugerencia:","Si necesitas diferentes precios segÃºn mÃºltiples caracterÃ­sticas, considera crear productos separados o usar una sola variante que combine ambas caracterÃ­sticas."],G=o=>!u.value.find((t,n)=>n===o||!t.children||t.children.length===0?!1:t.children.some(a=>a.price&&a.price!==""&&a.price!=null)),M=o=>!u.value.find((t,n)=>n===o||!t.children||t.children.length===0?!1:t.children.some(a=>a.imagePreview||a.image||a.imagePath&&a.imagePath!=="")),Oe=(o,e,t)=>{const n=t?.target?.value;!n||n===""||n==null||G(o)||(t.target.value="",u.value[o].children[e].price=null,L.value||(O.value=!0,L.value=!0))},H=f(!1),se=f(!1),Me=["Has intentado agregar imÃ¡genes a una variante cuando ya existe otra variante principal con imÃ¡genes configuradas.","","ðŸ“‹ Regla del Sistema:","Solo puedes asignar imÃ¡genes a las opciones hijas de UNA variante principal. Si ya asignaste imÃ¡genes a una variante (por ejemplo, Color), no podrÃ¡s agregar imÃ¡genes a otra variante (por ejemplo, Equipo).","","ðŸ’¡ CÃ³mo funciona:","Cuando un cliente seleccione una opciÃ³n de la variante que tiene imÃ¡genes, se mostrarÃ¡ la imagen de esa opciÃ³n especÃ­fica en la galerÃ­a. Si no selecciona ninguna opciÃ³n o selecciona una opciÃ³n sin imagen, se mostrarÃ¡n las imÃ¡genes regulares del producto.","","ðŸ’¡ Sugerencia:","Si necesitas diferentes imÃ¡genes segÃºn mÃºltiples caracterÃ­sticas, considera crear productos separados o usar una sola variante que combine ambas caracterÃ­sticas."];ue(()=>u.value,()=>{L.value||setTimeout(()=>{Ee.value&&!O.value&&(O.value=!0,L.value=!0)},1e3)},{deep:!0});const R=f([{name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}}]),K=o=>String(o||"").split(",").map(e=>e.trim()).filter(Boolean);function De(o,e,t){return(o.rulesSelected&&Array.isArray(o.rulesSelected[e])?o.rulesSelected[e]:[]).includes(t)}function Te(o,e,t,n){const a=!!n?.target?.checked;o.rulesSelected||(o.rulesSelected={});const l=Array.isArray(o.rulesSelected[e])?[...o.rulesSelected[e]]:[],i=l.indexOf(t);a&&i===-1&&l.push(t),!a&&i!==-1&&l.splice(i,1),o.rulesSelected[e]=l}function Ue(o){o.__showDependency=!o.__showDependency,o.__showDependency||(o.dependsOn="",o.rulesSelected={},o.rules={})}const ze=()=>{try{const o=Array.isArray(m.product.variants)?m.product.variants:[];if(o.length===0)return;const e=new Set;o.forEach(n=>{Object.keys(n?.options||{}).forEach(a=>e.add(a))});const t=[];e.forEach(n=>{const a=new Set;o.forEach(i=>{const g=(i?.options||{})[n];g!=null&&String(g).trim()!==""&&a.add(String(g))});const l=Array.from(a).join(", ");t.push({name:n,valuesText:l,dependsOn:"",rules:{},rulesSelected:{}})}),t.length>0&&(R.value=t)}catch{}},qe=()=>{try{const o=m.product?.variant_attributes,e=Array.isArray(o)?o:[];if(e.length===0)return!1;const t=e.map(n=>{const a=Array.isArray(n?.values)?n.values:K(n?.valuesText||""),l=String(n?.dependsOn||"").trim(),i=typeof n?.rulesSelected=="object"&&n.rulesSelected?n.rulesSelected:{},g=typeof n?.rules=="object"&&n.rules?n.rules:{},v=!!(l||Object.keys(i).length||Object.keys(g).length);return{name:String(n?.name||""),valuesText:a.join(", "),dependsOn:l,rulesSelected:i,rules:g,__showDependency:v}}).filter(n=>n.name);if(t.length>0)return R.value=t,!0}catch{}return!1},Be=()=>{try{const o=m.product?.variant_attributes||[];if(!Array.isArray(o)||o.length===0)return;const e=Object.fromEntries(R.value.map(t=>[t.name,t]));for(const t of o){const n=e[t.name];n&&(t.dependsOn&&(n.dependsOn=t.dependsOn,n.__showDependency=!0),t.rulesSelected&&typeof t.rulesSelected=="object"?(n.rulesSelected=t.rulesSelected,Object.keys(n.rulesSelected||{}).length>0&&(n.__showDependency=!0)):t.rules&&typeof t.rules=="object"&&(n.rules=t.rules,Object.keys(n.rules||{}).length>0&&(n.__showDependency=!0)))}}catch{}},b=f([...m.product.images]),oe=o=>{r.images_to_delete.push(o.id),b.value=b.value.filter(e=>e.id!==o.id)},Q=f(!1),S=f(0),ne=f(!1);function X(){ne.value=window.innerWidth<768}Xe(()=>{X(),window.addEventListener("resize",X),ve(),xe(),qe()||(ze(),Be())}),Ye(()=>window.removeEventListener("resize",X));const Y=D(()=>ne.value?1:4),Ne=D(()=>b.value.slice(0,Y.value)),ae=D(()=>b.value.slice(Y.value));function le(o=0){S.value=o,Q.value=!0}function re(){Q.value=!1}function Fe(){const o=b.value.length;o!==0&&(S.value=(S.value-1+o)%o)}function Le(){const o=b.value.length;o!==0&&(S.value=(S.value+1)%o)}function Ge(o){o<0||o>=b.value.length||(S.value=o)}const He=D(()=>{if(r.variants.length>0){let o=0;return r.variants.forEach(e=>{o+=Number(e.stock)||0}),o}return Number(r.quantity)||0});ue(He,o=>{r.variants.length>0&&(r.quantity=o)});const Re=()=>{if(F.value){U.value=["DebÃ©s seleccionar una subcategorÃ­a. La categorÃ­a principal tiene subcategorÃ­as disponibles y es obligatorio elegir una de ellas."],$.value=!0,tt(()=>{const e=document.querySelector(".space-y-3 select");e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus())});return}r.variant_options=Ve();const o=Ae();if(o.length>0)r.variant_attributes=o.map(e=>({name:e.name,values:e.values,dependsOn:e.dependsOn||"",rulesSelected:e.rulesSelected||{},rules:e.rules||{}}));else try{const e=R.value.map(t=>({name:String(t.name||"").trim(),values:K(t.valuesText),dependsOn:String(t.dependsOn||"").trim(),rules:t.rules||{},rulesSelected:t.rulesSelected||{}})).filter(t=>t.name&&t.values.length>0);if(r.variant_attributes=e,e.length>0){let l=function(v){a.has(v.name)||(v.dependsOn&&t[v.dependsOn]&&l(t[v.dependsOn]),a.add(v.name),n.push(v))},g=function(v,C){if(v===n.length){i.push({...C});return}const E=n[v];let de=E.values;if(E.dependsOn){const q=C[E.dependsOn];if(q!=null){const Z=E.rulesSelected?.[q]??E.rules?.[q]??[],ce=Array.isArray(Z)?Z:K(Z);ce.length>0&&(de=E.values.filter(Je=>ce.includes(Je)))}}for(const q of de)C[E.name]=q,g(v+1,C);delete C[E.name]};const t=Object.fromEntries(e.map(v=>[v.name,v])),n=[],a=new Set;e.forEach(l);const i=[];g(0,{}),r.variants=i.map(v=>({id:null,options_text:n.map(C=>`${C.name}:${v[C.name]}`).join(", "),price:"",purchase_price:null,stock:0,alert:null}))}else r.variants=[]}catch{r.variant_attributes=[]}N.value=!0},ie=()=>{N.value=!1},We=()=>{r.transform(a=>(u.value.forEach((l,i)=>{l.children&&l.children.length>0&&l.children.forEach((g,v)=>{if(g.image instanceof File){const C=`variant_option_${i}_${v}`;a[C]=g.image}})}),a));const o=u.value.flatMap((a,l)=>(a.children||[]).map((i,g)=>i.image instanceof File?`variant_option_${l}_${g}`:null).filter(Boolean)),e=r.new_gallery_files&&r.new_gallery_files.length>0,t=o.length>0||e,n={preserveScroll:!0,onError:async()=>{const a=[];for(const[l,i]of Object.entries(r.errors))l.startsWith("new_gallery_files.")&&String(i).toLowerCase().includes("image")?a.push("Una o mÃ¡s imÃ¡genes nuevas superan el tamaÃ±o mÃ¡ximo permitido (2 MB) o no son vÃ¡lidas."):a.push(String(i));U.value=a,$.value=a.length>0},onFinish:()=>{N.value=!1}};t?r.post(route("admin.products.update",m.product.id),n):r.put(route("admin.products.update",m.product.id),n)};return(o,e)=>(c(),d(P,null,[j(p(Ze),{title:"Editar Producto"}),j(st,null,{header:B(()=>[s("h2",lt,"Editar Producto: "+A(p(r).name),1)]),default:B(()=>[s("div",rt,[s("div",it,[s("div",dt,[s("div",ct,[s("form",{onSubmit:y(Re,["prevent"])},[s("div",ut,[s("div",null,[s("div",mt,[pt,_(s("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=t=>p(r).name=t),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[x,p(r).name]])]),s("div",gt,[ht,_(s("input",{id:"price","onUpdate:modelValue":e[1]||(e[1]=t=>p(r).price=t),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[x,p(r).price]])]),s("label",vt,[_(s("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=t=>p(r).track_inventory=t),class:"rounded"},null,512),[[Ie,p(r).track_inventory]]),ft]),p(r).track_inventory?(c(),d("div",_t,[s("div",null,[yt,_(s("input",{id:"quantity","onUpdate:modelValue":e[3]||(e[3]=t=>p(r).quantity=t),type:"number",class:T(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":p(r).track_inventory===!1}]),disabled:p(r).track_inventory===!1,required:"",title:"Stock si no hay variantes. Con variantes, se suma automÃ¡ticamente."},null,10,bt),[[x,p(r).quantity]])]),s("div",null,[wt,_(s("input",{id:"alert_general","onUpdate:modelValue":e[4]||(e[4]=t=>p(r).alert=t),type:"number",class:T(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":p(r).track_inventory===!1}]),disabled:p(r).track_inventory===!1,title:"Se considera bajo stock cuando cantidad â‰¤ alerta."},null,10,xt),[[x,p(r).alert]])]),s("div",null,[kt,_(s("input",{id:"purchase_price","onUpdate:modelValue":e[5]||(e[5]=t=>p(r).purchase_price=t),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[x,p(r).purchase_price]])])])):w("",!0),s("div",St,[Ct,F.value?(c(),d("p",Pt," âš ï¸ Es obligatorio seleccionar una subcategorÃ­a ")):w("",!0)]),s("div",jt,[(c(!0),d(P,null,V(h.value,(t,n)=>(c(),d("div",{key:n,class:"mb-1"},[_(s("select",{class:T(["block w-full rounded-md shadow-sm border-gray-300",{"border-red-500":F.value&&n===h.value.length-1&&!t.selected}]),"onUpdate:modelValue":a=>t.selected=a,onChange:a=>_e(n),required:n===h.value.length-1&&t.options.length>0},[At,(c(!0),d(P,null,V(t.options,a=>(c(),d("option",{key:a.id,value:a.id},A(a.name),9,Et))),128))],42,Vt),[[me,t.selected]])]))),128))]),F.value?(c(),d("p",$t," DebÃ©s seleccionar una subcategorÃ­a. La categorÃ­a principal tiene subcategorÃ­as disponibles. ")):w("",!0)]),s("div",null,[s("div",Ot,[Mt,_(s("textarea",{id:"short_description","onUpdate:modelValue":e[6]||(e[6]=t=>p(r).short_description=t),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[x,p(r).short_description]])]),s("div",Dt,[Tt,_(s("textarea",{id:"long_description","onUpdate:modelValue":e[7]||(e[7]=t=>p(r).long_description=t),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[x,p(r).long_description]])]),s("div",Ut,[zt,_(s("input",{id:"specifications","onUpdate:modelValue":e[8]||(e[8]=t=>p(r).specifications=t),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[x,p(r).specifications]])])])]),s("div",qt,[s("div",Bt,[s("div",Nt,[s("div",Ft,[Lt,s("div",Gt,[s("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Expandir todo",onClick:e[9]||(e[9]=()=>{u.value.forEach((t,n)=>k.value[n]=!0)})}," + "),s("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Colapsar todo",onClick:e[10]||(e[10]=()=>{u.value.forEach((t,n)=>k.value[n]=!1)})}," âˆ’ ")])]),s("div",Ht,[u.value.length===0?(c(),d("p",Rt," AÃºn no hay variantes principales. AgregÃ¡ una usando el botÃ³n de abajo. ")):w("",!0),(c(!0),d(P,null,V(u.value,(t,n)=>(c(),d("div",{key:`parent-${n}`,class:"p-3 hover:bg-gray-50"},[s("div",Wt,[s("div",Jt,[s("div",Kt,[s("button",{type:"button",class:"w-6 h-6 flex-shrink-0 inline-flex items-center justify-center rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100",title:k.value[n]??!1?"Colapsar opciones":"Expandir opciones",onClick:a=>we(n)},[k.value[n]??!1?(c(),d("span",Yt,"v")):(c(),d("span",Xt,">"))],8,Qt),_(s("input",{"onUpdate:modelValue":a=>t.name=a,type:"text",placeholder:"Ej: Color, Talla, Material",class:"flex-1 min-w-0 font-medium border-0 bg-transparent focus:bg-white focus:border focus:border-gray-300 rounded px-2 py-1 focus:outline-none"},null,8,Zt),[[x,t.name]]),t.children&&t.children.length>0?(c(),d("span",It," ("+A(t.children.length)+") ",1)):w("",!0)])]),s("div",es,[s("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:t.__showDependency?"Ocultar dependencia":"Configurar dependencia",onClick:a=>Ue(t)},os,8,ts),s("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded border border-green-500 text-green-600 hover:bg-green-50",title:"AÃ±adir opciÃ³n",onClick:a=>Se(n)},ls,8,ns),s("button",{type:"button",onClick:a=>ke(n),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},ds,8,rs)])]),t.__showDependency?(c(),d("div",cs,[s("div",us,[s("div",ms,[ps,_(s("select",{"onUpdate:modelValue":a=>t.dependsOn=a,class:"block w-full text-sm border-gray-300 rounded-md shadow-sm"},[hs,(c(!0),d(P,null,V(u.value,(a,l)=>(c(),d("option",{key:`dep-${n}-${l}`,value:a.name,disabled:a===t||!a.name},A(a.name||"(sin nombre)"),9,vs))),128))],8,gs),[[me,t.dependsOn]])]),t.dependsOn?(c(),d("div",fs,[_s,s("div",ys,[(c(!0),d(P,null,V((u.value.find(a=>a.name===t.dependsOn)?.children||[]).map(a=>a.name),a=>(c(),d("div",{key:`pv-${n}-${a}`,class:"border rounded p-2 bg-white"},[s("div",bs,[I(A(t.dependsOn)+" = ",1),s("strong",null,A(a),1)]),s("div",ws,[(c(!0),d(P,null,V((t.children||[]).map(l=>l.name),l=>(c(),d("label",{key:`cv-${n}-${a}-${l}`,class:"inline-flex items-center gap-1 text-xs"},[s("input",{type:"checkbox",checked:De(t,a,l),onChange:i=>Te(t,a,l,i),class:"rounded"},null,40,xs),s("span",null,A(l),1)]))),128))])]))),128))])])):w("",!0)])])):w("",!0),k.value[n]??!1?(c(),d("div",ks,[(c(!0),d(P,null,V(t.children,(a,l)=>(c(),d("div",{key:`child-${n}-${l}`,class:"py-2 flex justify-between items-start"},[s("div",Ss,[s("div",null,[Cs,_(s("input",{"onUpdate:modelValue":i=>a.name=i,type:"text",placeholder:"Ej: Rojo, Verde",class:"block w-full text-sm border-gray-300 rounded-md shadow-sm"},null,8,Ps),[[x,a.name]])]),s("div",null,[js,_(s("input",{"onUpdate:modelValue":i=>a.price=i,type:"number",step:"0.01",placeholder:"Usa precio principal",class:T(["block w-full text-sm border-gray-300 rounded-md shadow-sm",{"bg-gray-100 cursor-not-allowed":!G(n)}]),disabled:!G(n),onInput:i=>Oe(n,l,i)},null,42,Vs),[[x,a.price]]),G(n)?w("",!0):(c(),d("p",As," Solo puedes agregar precios a una variante principal "))]),s("div",Es,[s("input",{type:"file",accept:"image/*",onChange:i=>Pe(n,l,i),class:"hidden",id:`variant-image-input-${n}-${l}`,disabled:!M(n)},null,40,$s),a.imagePreview||a.imagePath?(c(),d("div",Os,[s("img",{src:a.imagePreview||a.imagePath,alt:"Preview",class:"w-10 h-10 object-cover rounded border"},null,8,Ms),s("button",{type:"button",onClick:y(i=>je(n,l),["stop"]),class:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs hover:bg-red-600"}," Ã— ",8,Ds)])):(c(),d("label",{key:1,for:`variant-image-input-${n}-${l}`,class:T(["inline-flex items-center justify-center w-10 h-10 border-2 border-dashed border-gray-300 rounded hover:border-blue-400 hover:bg-blue-50 transition",{"cursor-pointer":M(n),"cursor-not-allowed opacity-50":!M(n)}]),title:M(n)?"Agregar foto":"Solo puedes agregar imÃ¡genes a una variante principal"},zs,10,Ts)),M(n)?w("",!0):(c(),d("p",qs," Solo puedes agregar imÃ¡genes a una variante principal "))])]),s("div",Bs,[s("button",{type:"button",onClick:i=>Ce(n,l),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},Ls,8,Ns)])]))),128))])):w("",!0)]))),128))]),s("form",{onSubmit:y(te,["prevent"]),class:"mt-6 border-t pt-4"},[Gs,s("div",Hs,[_(s("input",{type:"text","onUpdate:modelValue":e[11]||(e[11]=t=>z.value=t),class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Nombre de la nueva variante principal",onKeyup:et(te,["enter"])},null,544),[[x,z.value]]),Rs,s("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:e[12]||(e[12]=t=>z.value=""),title:"Cancelar"}," âœ– ")])],32)])])]),s("div",Ws,[Js,Ks,s("div",Qs,[s("div",Xs,[Ys,s("span",Zs,A(b.value.length)+" imagen(es)",1)]),b.value.length>0?(c(),d("div",Is,[(c(!0),d(P,null,V(Ne.value,(t,n)=>(c(),d("div",{key:t.id,class:"relative rounded-lg overflow-hidden border bg-white shadow-sm hover:shadow-md transition group cursor-pointer",onClick:a=>le(n)},[s("img",{src:t.path,class:"w-full h-full aspect-[4/3] object-cover",alt:"Imagen del producto"},null,8,to),s("button",{onClick:y(a=>oe(t),["stop","prevent"]),type:"button",class:"absolute top-2 right-2 bg-red-600 text-white rounded-full w-7 h-7 flex items-center justify-center shadow-md hover:bg-red-700"}," Ã— ",8,so)],8,eo))),128)),ae.value.length>0?(c(),d("div",{key:0,class:"relative rounded-lg overflow-hidden border bg-white shadow-sm hover:shadow-md transition group cursor-pointer flex items-center justify-center text-gray-800 font-bold text-base h-full min-h-[90px]",onClick:e[13]||(e[13]=t=>le(Y.value))}," +"+A(ae.value.length),1)):w("",!0)])):(c(),d("p",oo,"Este producto no tiene imÃ¡genes."))]),s("div",no,[ao,s("input",{id:"new_gallery_files",onInput:e[14]||(e[14]=t=>he(t)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),lo])]),Q.value?(c(),d("div",{key:0,class:"fixed inset-0 bg-black/50 z-[1000] flex items-center justify-center p-4",style:{"pointer-events":"auto"},onClick:y(re,["self"])},[s("div",{class:"bg-white rounded-lg p-4 w-full max-w-5xl max-h-[85vh] overflow-hidden relative",onClick:e[20]||(e[20]=y(()=>{},["stop"]))},[s("button",{type:"button",class:"absolute top-3 right-3 bg-gray-900 text-white rounded-full w-8 h-8 flex items-center justify-center z-30",onClick:y(re,["stop","prevent"]),onMousedown:e[15]||(e[15]=y(()=>{},["stop","prevent"]))},"Ã—",32),s("div",ro,[s("button",{class:"absolute left-2 bg-white/90 border rounded-full w-9 h-9 flex items-center justify-center z-20",onClick:y(Fe,["stop","prevent"]),onMousedown:e[16]||(e[16]=y(()=>{},["stop","prevent"]))},"â€¹",32),s("img",{src:b.value[S.value]?.path,class:"max-w-full max-h-full object-contain",alt:"Imagen"},null,8,io),s("button",{class:"absolute right-2 bg-white/90 border rounded-full w-9 h-9 flex items-center justify-center z-20",onClick:y(Le,["stop","prevent"]),onMousedown:e[17]||(e[17]=y(()=>{},["stop","prevent"]))},"â€º",32),b.value[S.value]?(c(),d("button",{key:0,class:"absolute top-2 right-12 bg-red-600 text-white rounded px-2 py-1 text-xs z-20",type:"button",onClick:e[18]||(e[18]=y(t=>oe(b.value[S.value]),["stop","prevent"])),onMousedown:e[19]||(e[19]=y(()=>{},["stop","prevent"]))},"Eliminar",32)):w("",!0)]),s("div",co,[(c(!0),d(P,null,V(b.value,(t,n)=>(c(),d("div",{key:t.id,class:T(["border rounded p-1 cursor-pointer flex-shrink-0",{"ring-2 ring-blue-500":n===S.value}]),onClick:a=>Ge(n)},[s("img",{src:t.path,class:"w-20 h-20 object-cover rounded",alt:"thumb"},null,8,mo)],10,uo))),128))])])])):w("",!0),s("div",po,[s("button",{type:"submit",disabled:p(r).processing,class:"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow"},fo,8,go)])],32)])])])])]),_:1}),j(ot,{show:N.value,onClose:ie},{default:B(()=>[s("div",_o,[yo,bo,s("div",wo,[j(nt,{onClick:ie},{default:B(()=>[I("Cancelar")]),_:1}),j(at,{class:"ms-3",onClick:We,disabled:p(r).processing},{default:B(()=>[I(" Guardar cambios ")]),_:1},8,["disabled"])])])]),_:1},8,["show"]),j(W,{show:J.value,type:"success",title:"Producto actualizado","primary-text":"Entendido",onPrimary:e[21]||(e[21]=t=>J.value=!1),onClose:e[22]||(e[22]=t=>J.value=!1)},null,8,["show"]),j(W,{show:$.value,type:"error",title:"No pudimos actualizar el producto",message:"RevisÃ¡ los siguientes puntos:",messages:U.value,"primary-text":"Entendido",onPrimary:e[23]||(e[23]=t=>$.value=!1),onClose:e[24]||(e[24]=t=>$.value=!1)},null,8,["show","messages"]),j(W,{show:O.value,type:"warning",title:"Solo una Variante Puede Tener Precios",messages:$e,"primary-text":"Entendido",onPrimary:e[25]||(e[25]=t=>O.value=!1),onClose:e[26]||(e[26]=t=>O.value=!1)},null,8,["show"]),j(W,{show:H.value,type:"warning",title:"Solo una Variante Puede Tener ImÃ¡genes",messages:Me,"primary-text":"Entendido",onPrimary:e[27]||(e[27]=t=>H.value=!1),onClose:e[28]||(e[28]=t=>H.value=!1)},null,8,["show"])],64))}};export{Vo as default};
