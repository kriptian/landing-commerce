import{A as $e,r as f,c as N,z as Ae,w as z,B as je,b as c,d,e as b,u as i,h as Ee,f as Y,g as t,s as R,i as g,j as h,v as _,O as Me,k as L,m as O,t as S,F as V,l as P,C as J,P as Oe,n as Z}from"./app-BMMVlDHL.js";import{_ as Ue}from"./AuthenticatedLayout-BtjFhtlN.js";import{_ as H}from"./AlertModal-DAaf1Ndj.js";import{u as qe,S as Te}from"./useSectionTour-BgmXgbpT.js";import"./Modal-CAc8xvIf.js";const Be=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear producto",-1),De={class:"py-12"},Ne={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ze={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Le={class:"p-6 text-gray-900"},He={class:"mb-4"},Fe=t("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1),Re={class:"mb-4"},We=t("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1),Ge={class:"p-4 border rounded-md bg-gray-50"},Ke={class:"inline-flex items-center gap-2 mb-3 select-none"},Qe=t("span",{class:"font-semibold"},"Controlar inventario",-1),Xe={key:0,class:"font-semibold text-gray-800 mb-2"},Ye={key:1,class:"text-xs text-gray-500 mb-4"},Je={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ze={for:"quantity",class:"block font-medium text-sm text-gray-700 flex items-center"},Ie=["disabled"],et={key:0,class:"mt-1 text-sm text-red-600"},tt={for:"alert",class:"block font-medium text-sm text-gray-700 flex items-center"},st=["disabled"],ot={for:"purchase_price",class:"block font-medium text-sm text-gray-700 flex items-center"},nt={class:"mt-4 mb-2"},at=t("label",{class:"block font-medium text-sm text-gray-700"},"CategorÃ­as",-1),lt={key:0,class:"mt-1 text-sm text-amber-600 font-medium"},rt={class:"space-y-3"},it=["onUpdate:modelValue","onChange","required"],ct=t("option",{value:null},"Seleccione una categorÃ­a",-1),dt=["value"],ut={key:0,class:"mt-1 text-sm text-red-600"},mt={key:1,class:"mt-1 text-sm text-red-600"},pt={class:"mb-4"},gt=t("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"DescripciÃ³n Corta",-1),ht={class:"mb-4"},vt=t("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"DescripciÃ³n Larga",-1),ft={class:"mb-4"},_t=t("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1),bt={class:"md:col-span-2 mt-6 border-t pt-6"},yt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},wt={class:"p-6 text-gray-900"},xt={class:"flex items-center justify-between"},kt=t("h3",{class:"text-lg font-medium"},"Variantes del Producto",-1),Ct={class:"flex items-center gap-2"},St={class:"mt-4 border rounded-lg divide-y"},Vt={key:0,class:"text-sm text-gray-500 p-3"},Pt={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2"},$t={class:"flex-1 min-w-0"},At={class:"flex items-center gap-2"},jt=["title","onClick"],Et={key:0},Mt={key:1},Ot=["onUpdate:modelValue"],Ut={key:0,class:"flex-shrink-0 text-xs bg-gray-100 text-gray-700 rounded px-2 py-0.5 align-middle"},qt={class:"flex items-center gap-2 flex-shrink-0"},Tt=["title","onClick"],Bt=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),t("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})],-1),Dt=[Bt],Nt=["onClick"],zt=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("rect",{x:"4",y:"3",width:"11",height:"15",rx:"2",ry:"2","stroke-width":"1.5"}),t("circle",{cx:"18",cy:"18",r:"3","stroke-width":"1.5"}),t("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M18 16.5v3M16.5 18h3"})],-1),Lt=[zt],Ht=["onClick"],Ft=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),Rt=[Ft],Wt={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2"},Gt={class:"grid grid-cols-1 md:grid-cols-5 gap-3"},Kt={class:"md:col-span-2"},Qt=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Depende de",-1),Xt=["onUpdate:modelValue"],Yt=t("option",{value:""},"(sin dependencia)",-1),Jt=["value","disabled"],Zt={key:0,class:"md:col-span-3"},It=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Permitir valores segÃºn el valor del padre",-1),es={class:"mt-2 space-y-2"},ts={class:"text-xs font-semibold text-gray-700 mb-1"},ss={class:"flex flex-wrap gap-2"},os=["checked","onChange"],ns={key:1,class:"mt-2 pl-4 border-l"},as={class:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-3"},ls=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Nombre",-1),rs=["onUpdate:modelValue"],is=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Precio (opcional)",-1),cs=["onUpdate:modelValue","disabled","onInput"],ds={key:0,class:"mt-1 text-xs text-amber-600"},us={class:"flex items-center gap-2"},ms=["onChange","id","disabled"],ps={key:0,class:"relative"},gs=["src"],hs=["onClick"],vs=["for","title"],fs=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-5 h-5 text-gray-400",fill:"currentColor"},[t("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1),_s=[fs],bs={key:2,class:"mt-1 text-xs text-amber-600"},ys={class:"flex items-center gap-2 ml-2"},ws=["onClick"],xs=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),ks=[xs],Cs=t("label",{class:"block font-medium text-sm text-gray-700"},"AÃ±adir Nueva Variante Principal",-1),Ss={class:"mt-2 flex items-center gap-2"},Vs=t("button",{type:"submit",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",title:"AÃ±adir"}," âœ” ",-1),Ps={class:"md:col-span-2 mt-6 border-t pt-6"},$s=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"ImÃ¡genes Extra de la GalerÃ­a",-1),As=t("p",{class:"text-sm text-gray-600 mb-4"}," Estas imÃ¡genes se agregarÃ¡n a la galerÃ­a general del producto. Las imÃ¡genes de las variantes se muestran cuando se selecciona esa opciÃ³n. ",-1),js={class:"mb-4"},Es=t("label",{for:"gallery_files",class:"block font-medium text-sm text-gray-700"},"ImÃ¡genes de la GalerÃ­a",-1),Ms=t("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1),Os={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},Us=["disabled"],qs=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M4 4a2 2 0 0 1 2-2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4zm9-1.5V7h4.5L13 2.5z"}),t("path",{d:"M8 13h8v2H8zM8 9h5v2H8z"})],-1),Ts=t("span",null,"Crear",-1),Bs=[qs,Ts],Ds={key:0,class:"ml-3 text-sm text-red-600"},I=2*1024*1024,Rs={__name:"Create",props:{categories:Array},setup(ee){const te=ee,se=$e(),U=f(!!se?.props?.flash?.success),x=f(!1),$=f([]),{showTour:oe,steps:ne,handleTourComplete:ae}=qe("products-create"),le=o=>{const e=Array.from(o?.target?.files||[]),a=[],s=[];for(const n of e){if(!(n?.type||"").startsWith("image/")){a.push(`${n.name}: no es una imagen vÃ¡lida.`);continue}if(n.size>I){a.push(`${n.name}: supera el lÃ­mite de 2 MB.`);continue}s.push(n)}if(a.length){$.value=["Problemas con las imÃ¡genes seleccionadas:",...a],x.value=!0,o?.target&&(o.target.value=""),l.gallery_files=[];return}l.gallery_files=s},y=f([{options:te.categories,selected:null}]),re=o=>{y.value.splice(o+1)},ie=async o=>{const e=y.value[o].selected;if(re(o),l.category_id=e,!e)return;const a=await fetch(route("admin.categories.children",e));if(!a.ok)return;const s=await a.json(),n=Array.isArray(s.data)?s.data:[];n.length>0&&(y.value.push({options:n,selected:null}),l.category_id=null)},q=N(()=>{if(y.value.length>1){const o=y.value[y.value.length-1];return o.options.length>0&&!o.selected}return!1}),l=Ae({name:"",price:"",purchase_price:null,retail_price:null,track_inventory:!0,quantity:0,alert:null,category_id:null,short_description:"",long_description:"",specifications:"",gallery_files:[],variant_options:[],variants:[],variant_attributes:[]}),u=f([]),E=f(""),w=f({}),ce=o=>{w.value[o]=!(w.value[o]??!1)},W=()=>{const o=E.value.trim()||"",e=u.value.length;u.value.push({id:null,name:o,children:[],order:e,dependsOn:"",rules:{},rulesSelected:{},__showDependency:!1}),w.value[e]=!0,E.value=""},de=o=>{u.value.splice(o,1)},ue=o=>{u.value[o].children||(u.value[o].children=[]),u.value[o].children.push({id:null,name:"",price:null,image:null,imagePreview:null,imagePath:null,order:u.value[o].children.length}),w.value[o]=!0},me=(o,e)=>{u.value[o].children.splice(e,1)},pe=(o,e,a)=>{const s=a?.target?.files?.[0];if(!s)return;if(!j(o)){a?.target&&(a.target.value=""),G.value||(D.value=!0,G.value=!0);return}if(!s.type?.startsWith("image/")){$.value=["El archivo seleccionado no es una imagen vÃ¡lida."],x.value=!0,a?.target&&(a.target.value="");return}if(s.size>I){$.value=[`La imagen "${s.name}" supera el lÃ­mite de 2 MB.`],x.value=!0,a?.target&&(a.target.value="");return}u.value[o].children[e].image=s;const r=new FileReader;r.onload=m=>{u.value[o].children[e].imagePreview=m.target.result},r.readAsDataURL(s)},ge=(o,e)=>{u.value[o].children[e].image=null,u.value[o].children[e].imagePreview=null},he=()=>{const o=[];return u.value.forEach((e,a)=>{if(!e.name.trim())return;const s={name:e.name.trim(),parent_id:null,price:null,image_path:null,order:a,children:[]};e.children&&e.children.length>0&&e.children.forEach((n,r)=>{n.name.trim()&&s.children.push({name:n.name.trim(),parent_id:null,price:n.price?parseFloat(n.price):null,image_file_key:n.image?`variant_option_${a}_${r}`:null,order:r})}),(s.children.length>0||s.name)&&o.push(s)}),o},ve=()=>{const o=[];return u.value.forEach(e=>{if(!e.name.trim())return;const a=(e.children||[]).map(n=>n.name.trim()).filter(Boolean);if(a.length===0)return;const s={name:e.name.trim(),values:a,valuesText:a.join(", "),dependsOn:e.dependsOn||"",rules:e.rules||{},rulesSelected:e.rulesSelected||{}};o.push(s)}),o},fe=N(()=>u.value.filter(e=>!e.children||e.children.length===0?!1:e.children.some(a=>a.price&&a.price!==""&&a.price!=null)).length>1);N(()=>u.value.find(o=>!o.children||o.children.length===0?!1:o.children.some(e=>e.price&&e.price!==""&&e.price!=null)));const A=f(!1),T=f(!1),_e=["Has intentado agregar precios a una variante cuando ya existe otra variante principal con precios configurados.","","ðŸ“‹ Regla del Sistema:","Solo puedes asignar precios a las opciones hijas de UNA variante principal. Si ya asignaste precios a una variante (por ejemplo, Color), no podrÃ¡s agregar precios a otra variante (por ejemplo, Equipo).","","ðŸ’¡ CÃ³mo funciona:","Cuando un cliente seleccione una opciÃ³n de la variante que tiene precios, se mostrarÃ¡ el precio de esa opciÃ³n especÃ­fica. Si no selecciona ninguna opciÃ³n o selecciona una opciÃ³n sin precio, se usarÃ¡ el precio principal del producto.","","ðŸ’¡ Sugerencia:","Si necesitas diferentes precios segÃºn mÃºltiples caracterÃ­sticas, considera crear productos separados o usar una sola variante que combine ambas caracterÃ­sticas."],B=o=>!u.value.find((a,s)=>s===o||!a.children||a.children.length===0?!1:a.children.some(n=>n.price&&n.price!==""&&n.price!=null)),j=o=>!u.value.find((a,s)=>s===o||!a.children||a.children.length===0?!1:a.children.some(n=>n.imagePreview||n.image||n.imagePath&&n.imagePath!=="")),be=(o,e,a)=>{const s=a?.target?.value;!s||s===""||s==null||B(o)||(a.target.value="",u.value[o].children[e].price=null,T.value||(A.value=!0,T.value=!0))},D=f(!1),G=f(!1),ye=["Has intentado agregar imÃ¡genes a una variante cuando ya existe otra variante principal con imÃ¡genes configuradas.","","ðŸ“‹ Regla del Sistema:","Solo puedes asignar imÃ¡genes a las opciones hijas de UNA variante principal. Si ya asignaste imÃ¡genes a una variante (por ejemplo, Color), no podrÃ¡s agregar imÃ¡genes a otra variante (por ejemplo, Equipo).","","ðŸ’¡ CÃ³mo funciona:","Cuando un cliente seleccione una opciÃ³n de la variante que tiene imÃ¡genes, se mostrarÃ¡ la imagen de esa opciÃ³n especÃ­fica en la galerÃ­a. Si no selecciona ninguna opciÃ³n o selecciona una opciÃ³n sin imagen, se mostrarÃ¡n las imÃ¡genes regulares del producto.","","ðŸ’¡ Sugerencia:","Si necesitas diferentes imÃ¡genes segÃºn mÃºltiples caracterÃ­sticas, considera crear productos separados o usar una sola variante que combine ambas caracterÃ­sticas."];z(()=>u.value,()=>{T.value||setTimeout(()=>{fe.value&&!A.value&&(A.value=!0,T.value=!0)},1e3)},{deep:!0}),z(()=>l.track_inventory,o=>{o&&(l.retail_price=l.price)}),z(()=>l.price,o=>{l.track_inventory&&(l.retail_price=o)});const we=f([{name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}}]),K=o=>String(o||"").split(",").map(e=>e.trim()).filter(Boolean);function xe(o,e,a){return(o.rulesSelected&&Array.isArray(o.rulesSelected[e])?o.rulesSelected[e]:[]).includes(a)}function ke(o,e,a,s){const n=!!s?.target?.checked;o.rulesSelected||(o.rulesSelected={});const r=Array.isArray(o.rulesSelected[e])?[...o.rulesSelected[e]]:[],m=r.indexOf(a);n&&m===-1&&r.push(a),!n&&m!==-1&&r.splice(m,1),o.rulesSelected[e]=r}function Ce(o){o.__showDependency=!o.__showDependency,o.__showDependency||(o.dependsOn="",o.rulesSelected={},o.rules={})}const Se=N(()=>l.variants.length===0?Number(l.quantity)||0:l.variants.reduce((o,e)=>o+(Number(e.stock)||0),0));z(Se,o=>{l.variants.length>0&&(l.quantity=o)});const Ve=()=>{if(q.value){$.value=["DebÃ©s seleccionar una subcategorÃ­a. La categorÃ­a principal tiene subcategorÃ­as disponibles y es obligatorio elegir una de ellas."],x.value=!0,Z(()=>{const e=document.querySelector(".space-y-3 select");e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus())});return}l.variant_options=he();const o=ve();if(o.length>0)l.variant_attributes=o.map(e=>({name:e.name,values:e.values,dependsOn:e.dependsOn||"",rulesSelected:e.rulesSelected||{},rules:e.rules||{}}));else try{const e=we.value.map(a=>({name:String(a.name||"").trim(),values:K(a.valuesText),dependsOn:String(a.dependsOn||"").trim(),rules:a.rules||{},rulesSelected:a.rulesSelected||{}})).filter(a=>a.name&&a.values.length>0);if(l.variant_attributes=e,e.length>0){let r=function(p){n.has(p.name)||(p.dependsOn&&a[p.dependsOn]&&r(a[p.dependsOn]),n.add(p.name),s.push(p))},v=function(p,k){if(p===s.length){m.push({...k});return}const C=s[p];let Q=C.values;if(C.dependsOn){const M=k[C.dependsOn];if(M!=null){const F=C.rulesSelected?.[M]??C.rules?.[M]??[],X=Array.isArray(F)?F:K(F);X.length>0&&(Q=C.values.filter(Pe=>X.includes(Pe)))}}for(const M of Q)k[C.name]=M,v(p+1,k);delete k[C.name]};const a=Object.fromEntries(e.map(p=>[p.name,p])),s=[],n=new Set;e.forEach(r);const m=[];v(0,{}),l.variants=m.map(p=>({options_text:s.map(k=>`${k.name}:${p[k.name]}`).join(", "),price:"",purchase_price:null,stock:0,alert:null}))}}catch{l.variant_attributes=[]}l.transform(e=>(u.value.forEach((a,s)=>{a.children&&a.children.length>0&&a.children.forEach((n,r)=>{if(n.image instanceof File){const m=`variant_option_${s}_${r}`;e[m]=n.image}})}),e)),l.post(route("admin.products.store"),{preserveScroll:!0,onError:async()=>{await Z();const e=[];for(const[n,r]of Object.entries(l.errors))n.startsWith("gallery_files.")&&String(r).includes("The gallery files.")?e.push("Una o mÃ¡s imÃ¡genes superan el tamaÃ±o mÃ¡ximo permitido (2 MB) o no son vÃ¡lidas."):n.startsWith("new_gallery_files.")?e.push("Una o mÃ¡s imÃ¡genes nuevas superan el tamaÃ±o mÃ¡ximo permitido (2 MB) o no son vÃ¡lidas."):e.push(String(r));$.value=e,x.value=e.length>0;const a=Object.keys(l.errors)[0],s=document.getElementById(a);s&&typeof s.scrollIntoView=="function"&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.focus?.())},onSuccess:()=>{U.value=!0,l.reset()}})};return(o,e)=>{const a=je("InfoTip");return d(),c(V,null,[b(i(Ee),{title:"Crear Producto"}),b(Ue,null,{header:Y(()=>[Be]),default:Y(()=>[t("div",De,[t("div",Ne,[t("div",ze,[t("div",Le,[t("form",{onSubmit:R(Ve,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[t("div",null,[t("div",He,[Fe,h(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=s=>i(l).name=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,i(l).name]])]),t("div",Re,[We,h(t("input",{id:"price","onUpdate:modelValue":e[1]||(e[1]=s=>i(l).price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,i(l).price]])]),t("div",Ge,[t("label",Ke,[h(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>i(l).track_inventory=s),class:"rounded"},null,512),[[Me,i(l).track_inventory]]),Qe]),i(l).track_inventory?(d(),c("h4",Xe,"Inventario y Precios")):g("",!0),i(l).track_inventory?(d(),c("p",Ye," Si creas variantes, estos totales se calcularÃ¡n solos. ")):g("",!0),i(l).track_inventory?(d(),c("div",Je,[t("div",null,[t("label",Ze,[L("Inventario (Total) "),b(a,{class:"ml-1 md:hidden",text:"Stock si no hay variantes. Con variantes, se suma automÃ¡ticamente."})]),h(t("input",{id:"quantity","onUpdate:modelValue":e[3]||(e[3]=s=>i(l).quantity=s),type:"number",class:O(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":i(l).variants.length>0}]),disabled:i(l).track_inventory===!1||i(l).variants.length>0,title:"Stock si no hay variantes. Con variantes, se suma automÃ¡ticamente."},null,10,Ie),[[_,i(l).quantity]]),i(l).errors.quantity?(d(),c("p",et,S(i(l).errors.quantity),1)):g("",!0)]),t("div",null,[t("label",tt,[L("Alerta (Opcional) "),b(a,{class:"ml-1 md:hidden",text:"Se considera bajo stock cuando cantidad â‰¤ alerta."})]),h(t("input",{id:"alert","onUpdate:modelValue":e[4]||(e[4]=s=>i(l).alert=s),type:"number",class:O(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":i(l).variants.length>0&&i(l).track_inventory}]),disabled:i(l).variants.length>0&&i(l).track_inventory,title:"Se considera bajo stock cuando cantidad â‰¤ alerta."},null,10,st),[[_,i(l).alert]])]),t("div",null,[t("label",ot,[L("Precio de compra "),b(a,{class:"ml-1 md:hidden",text:"Costo de adquisiciÃ³n del producto."})]),h(t("input",{id:"purchase_price","onUpdate:modelValue":e[5]||(e[5]=s=>i(l).purchase_price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[_,i(l).purchase_price]])])])):g("",!0)]),t("div",nt,[at,q.value?(d(),c("p",lt," âš ï¸ Es obligatorio seleccionar una subcategorÃ­a ")):g("",!0)]),t("div",rt,[(d(!0),c(V,null,P(y.value,(s,n)=>(d(),c("div",{key:n,class:"mb-1"},[h(t("select",{class:O(["block w-full rounded-md shadow-sm border-gray-300",{"border-red-500":q.value&&n===y.value.length-1&&!s.selected}]),"onUpdate:modelValue":r=>s.selected=r,onChange:r=>ie(n),required:n===y.value.length-1&&s.options.length>0},[ct,(d(!0),c(V,null,P(s.options,r=>(d(),c("option",{key:r.id,value:r.id},S(r.name),9,dt))),128))],42,it),[[J,s.selected]])]))),128))]),i(l).errors.category_id?(d(),c("p",ut,S(i(l).errors.category_id),1)):g("",!0),q.value&&!i(l).errors.category_id?(d(),c("p",mt," DebÃ©s seleccionar una subcategorÃ­a. La categorÃ­a principal tiene subcategorÃ­as disponibles. ")):g("",!0)]),t("div",null,[t("div",pt,[gt,h(t("textarea",{id:"short_description","onUpdate:modelValue":e[6]||(e[6]=s=>i(l).short_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[_,i(l).short_description]])]),t("div",ht,[vt,h(t("textarea",{id:"long_description","onUpdate:modelValue":e[7]||(e[7]=s=>i(l).long_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[_,i(l).long_description]])]),t("div",ft,[_t,h(t("input",{id:"specifications","onUpdate:modelValue":e[8]||(e[8]=s=>i(l).specifications=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"Alto: 2.30m,Ancho: 1.20m,..."},null,512),[[_,i(l).specifications]])])]),t("div",bt,[t("div",yt,[t("div",wt,[t("div",xt,[kt,t("div",Ct,[t("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Expandir todo",onClick:e[9]||(e[9]=()=>{u.value.forEach((s,n)=>w.value[n]=!0)})}," + "),t("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Colapsar todo",onClick:e[10]||(e[10]=()=>{u.value.forEach((s,n)=>w.value[n]=!1)})}," âˆ’ ")])]),t("div",St,[u.value.length===0?(d(),c("p",Vt," AÃºn no hay variantes principales. AgregÃ¡ una usando el botÃ³n de abajo. ")):g("",!0),(d(!0),c(V,null,P(u.value,(s,n)=>(d(),c("div",{key:`parent-${n}`,class:"p-3 hover:bg-gray-50"},[t("div",Pt,[t("div",$t,[t("div",At,[t("button",{type:"button",class:"w-6 h-6 flex-shrink-0 inline-flex items-center justify-center rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100",title:w.value[n]??!1?"Colapsar opciones":"Expandir opciones",onClick:r=>ce(n)},[w.value[n]??!1?(d(),c("span",Mt,"v")):(d(),c("span",Et,">"))],8,jt),h(t("input",{"onUpdate:modelValue":r=>s.name=r,type:"text",placeholder:"Ej: Color, Talla, Material",class:"flex-1 min-w-0 font-medium border-0 bg-transparent focus:bg-white focus:border focus:border-gray-300 rounded px-2 py-1 focus:outline-none"},null,8,Ot),[[_,s.name]]),s.children&&s.children.length>0?(d(),c("span",Ut," ("+S(s.children.length)+") ",1)):g("",!0)])]),t("div",qt,[t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:s.__showDependency?"Ocultar dependencia":"Configurar dependencia",onClick:r=>Ce(s)},Dt,8,Tt),t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded border border-green-500 text-green-600 hover:bg-green-50",title:"AÃ±adir opciÃ³n",onClick:r=>ue(n)},Lt,8,Nt),t("button",{type:"button",onClick:r=>de(n),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},Rt,8,Ht)])]),s.__showDependency?(d(),c("div",Wt,[t("div",Gt,[t("div",Kt,[Qt,h(t("select",{"onUpdate:modelValue":r=>s.dependsOn=r,class:"block w-full text-sm border-gray-300 rounded-md shadow-sm"},[Yt,(d(!0),c(V,null,P(u.value,(r,m)=>(d(),c("option",{key:`dep-${n}-${m}`,value:r.name,disabled:r===s||!r.name},S(r.name||"(sin nombre)"),9,Jt))),128))],8,Xt),[[J,s.dependsOn]])]),s.dependsOn?(d(),c("div",Zt,[It,t("div",es,[(d(!0),c(V,null,P((u.value.find(r=>r.name===s.dependsOn)?.children||[]).map(r=>r.name),r=>(d(),c("div",{key:`pv-${n}-${r}`,class:"border rounded p-2 bg-white"},[t("div",ts,[L(S(s.dependsOn)+" = ",1),t("strong",null,S(r),1)]),t("div",ss,[(d(!0),c(V,null,P((s.children||[]).map(m=>m.name),m=>(d(),c("label",{key:`cv-${n}-${r}-${m}`,class:"inline-flex items-center gap-1 text-xs"},[t("input",{type:"checkbox",checked:xe(s,r,m),onChange:v=>ke(s,r,m,v),class:"rounded"},null,40,os),t("span",null,S(m),1)]))),128))])]))),128))])])):g("",!0)])])):g("",!0),w.value[n]??!1?(d(),c("div",ns,[(d(!0),c(V,null,P(s.children,(r,m)=>(d(),c("div",{key:`child-${n}-${m}`,class:"py-2 flex justify-between items-start"},[t("div",as,[t("div",null,[ls,h(t("input",{"onUpdate:modelValue":v=>r.name=v,type:"text",placeholder:"Ej: Rojo, Verde",class:"block w-full text-sm border-gray-300 rounded-md shadow-sm"},null,8,rs),[[_,r.name]])]),t("div",null,[is,h(t("input",{"onUpdate:modelValue":v=>r.price=v,type:"number",step:"0.01",placeholder:"Usa precio principal",class:O(["block w-full text-sm border-gray-300 rounded-md shadow-sm",{"bg-gray-100 cursor-not-allowed":!B(n)}]),disabled:!B(n),onInput:v=>be(n,m,v)},null,42,cs),[[_,r.price]]),B(n)?g("",!0):(d(),c("p",ds," Solo puedes agregar precios a una variante principal "))]),t("div",us,[t("input",{type:"file",accept:"image/*",onChange:v=>pe(n,m,v),class:"hidden",id:`variant-image-input-${n}-${m}`,disabled:!j(n)},null,40,ms),r.imagePreview?(d(),c("div",ps,[t("img",{src:r.imagePreview,alt:"Preview",class:"w-10 h-10 object-cover rounded border"},null,8,gs),t("button",{type:"button",onClick:R(v=>ge(n,m),["stop"]),class:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs hover:bg-red-600"}," Ã— ",8,hs)])):(d(),c("label",{key:1,for:`variant-image-input-${n}-${m}`,class:O(["inline-flex items-center justify-center w-10 h-10 border-2 border-dashed border-gray-300 rounded hover:border-blue-400 hover:bg-blue-50 transition",{"cursor-pointer":j(n),"cursor-not-allowed opacity-50":!j(n)}]),title:j(n)?"Agregar foto":"Solo puedes agregar imÃ¡genes a una variante principal"},_s,10,vs)),j(n)?g("",!0):(d(),c("p",bs," Solo puedes agregar imÃ¡genes a una variante principal "))])]),t("div",ys,[t("button",{type:"button",onClick:v=>me(n,m),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},ks,8,ws)])]))),128))])):g("",!0)]))),128))]),t("form",{onSubmit:R(W,["prevent"]),class:"mt-6 border-t pt-4"},[Cs,t("div",Ss,[h(t("input",{type:"text","onUpdate:modelValue":e[11]||(e[11]=s=>E.value=s),class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Nombre de la nueva variante principal",onKeyup:Oe(W,["enter"])},null,544),[[_,E.value]]),Vs,t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:e[12]||(e[12]=s=>E.value=""),title:"Cancelar"}," âœ– ")])],32)])])]),t("div",Ps,[$s,As,t("div",js,[Es,t("input",{id:"gallery_files",onInput:e[13]||(e[13]=s=>le(s)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),Ms])]),t("div",Os,[t("button",{type:"submit",disabled:i(l).processing,class:"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow"},Bs,8,Us),Object.keys(i(l).errors).length?(d(),c("span",Ds,"Por favor corrige los campos marcados.")):g("",!0)])],32)])])])])]),_:1}),b(H,{show:U.value,type:"success",title:"Â¡Producto creado con Ã©xito!","primary-text":"Entendido",onPrimary:e[14]||(e[14]=s=>U.value=!1),onClose:e[15]||(e[15]=s=>U.value=!1)},null,8,["show"]),b(H,{show:x.value,type:"error",title:"No pudimos guardar el producto",message:"RevisÃ¡ los siguientes puntos:",messages:$.value,"primary-text":"Entendido",onPrimary:e[16]||(e[16]=s=>x.value=!1),onClose:e[17]||(e[17]=s=>x.value=!1)},null,8,["show","messages"]),b(H,{show:A.value,type:"warning",title:"Solo una Variante Puede Tener Precios",messages:_e,"primary-text":"Entendido",onPrimary:e[18]||(e[18]=s=>A.value=!1),onClose:e[19]||(e[19]=s=>A.value=!1)},null,8,["show"]),b(H,{show:D.value,type:"warning",title:"Solo una Variante Puede Tener ImÃ¡genes",messages:ye,"primary-text":"Entendido",onPrimary:e[20]||(e[20]=s=>D.value=!1),onClose:e[21]||(e[21]=s=>D.value=!1)},null,8,["show"]),b(Te,{show:i(oe),section:"products-create",steps:i(ne),onComplete:i(ae)},null,8,["show","steps","onComplete"])],64)}}};export{Rs as default};
