import{z as le,o as n,e as O,f as e,t as a,b as x,d as v,l as q,m as h,c as m,r as g,B as ae,u as ne,a as d,i as f,h as ue,g as ie,j as N,n as I,y as p,x as _,p as ce,F as U,s as T}from"./app-DsV3hoUw.js";import{_ as de}from"./AlertModal-Dyptdycb.js";import{_ as me}from"./Modal-qQ5PtVgh.js";import{_ as ve}from"./CookieConsent-X75JsxQf.js";const ge={class:"p-6 text-center"},be=e("div",{class:"mb-4 mx-auto w-12 h-12 flex items-center justify-center bg-blue-100 rounded-full text-blue-600"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})])],-1),fe=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," Iniciar Sesión Requerido ",-1),pe={class:"text-sm text-gray-600 mb-6"},ye={class:"flex flex-col gap-3"},_e={__name:"AuthRequiredModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Debes iniciar sesión para realizar esta acción."},store:{type:Object,required:!1}},emits:["close"],setup(u,{emit:l}){const r=l;return(j,w)=>(n(),le(me,{show:u.show,onClose:w[1]||(w[1]=A=>r("close")),maxWidth:"sm"},{default:O(()=>[e("div",ge,[be,fe,e("p",pe,a(u.message),1),e("div",ye,[x(v(q),{href:j.route("customer.login",{store:u.store?.slug||u.store?.id}),class:"w-full inline-flex justify-center items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 focus:bg-blue-700 active:bg-blue-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150"},{default:O(()=>[h(" Iniciar Sesión ")]),_:1},8,["href"]),x(v(q),{href:j.route("customer.register",{store:u.store?.slug||u.store?.id}),class:"w-full inline-flex justify-center items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150"},{default:O(()=>[h(" Registrarse ")]),_:1},8,["href"]),e("button",{onClick:w[0]||(w[0]=A=>r("close")),class:"mt-2 text-xs text-gray-500 hover:text-gray-700 underline"}," Cancelar ")])])]),_:1},8,["show"]))}},xe=["href"],he={class:"bg-white shadow-sm sticky top-0 z-40"},we={class:"container mx-auto px-6 py-4 flex items-center gap-3"},ke=["src","alt"],Ce={class:"text-lg font-medium text-gray-600"},Fe={class:"grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12"},$e=e("h1",{class:"text-xl sm:text-2xl font-medium text-gray-600 mb-6"},"Datos de Envío",-1),De={key:0,class:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},Ne={class:"text-sm text-blue-800 mb-2"},Oe=e("label",{for:"customer_name",class:"block font-medium text-sm text-gray-700 mb-2"},"Nombre Completo",-1),je=e("label",{for:"customer_phone",class:"block font-medium text-sm text-gray-700 mb-2"},"Teléfono (WhatsApp)",-1),Pe=e("label",{for:"customer_email",class:"block font-medium text-sm text-gray-700 mb-2"},"Correo Electrónico",-1),Ie={key:0},Ae=e("label",{class:"block font-medium text-sm text-gray-700 mb-2"},"Dirección de Envío",-1),Me=e("option",{value:null},"Seleccionar dirección guardada",-1),Se=["value"],Be={for:"customer_address",class:"block font-medium text-sm text-gray-700 mb-2"},Ee=["disabled"],Ue=["disabled"],qe={class:"bg-white/95 backdrop-blur-sm p-8 lg:p-10 rounded-2xl shadow-2xl border border-gray-100 sticky top-24 transform transition-all hover:shadow-3xl"},ze=e("h2",{class:"text-xl sm:text-2xl font-medium text-gray-600 mb-6"},"Resumen de tu Pedido",-1),Ve={class:"space-y-4"},Re={class:"flex items-start gap-3 flex-1 min-w-0"},Te=["src"],Le={class:"min-w-0"},We={class:"font-semibold text-gray-900 break-words"},Qe={key:0,class:"text-sm text-gray-500 break-words mt-1"},Ge={class:"text-sm text-gray-600 mt-1"},He={class:"font-semibold text-gray-900 whitespace-nowrap shrink-0 sm:text-right mt-2 sm:mt-0"},Ye={class:"border-t border-gray-200 pt-6"},Je=e("label",{class:"block font-medium text-sm text-gray-700 mb-2"},"Código de Cupón (Opcional)",-1),Ke={class:"flex gap-2"},Xe=["disabled"],Ze=["disabled"],et={key:0,class:"mt-2 text-sm text-red-600"},tt={key:1,class:"mt-2 text-sm text-green-600"},ot={class:"border-t border-gray-200 mt-6 pt-6 space-y-3"},st={class:"flex justify-between items-center"},rt=e("span",{class:"text-lg font-medium text-gray-600"},"Subtotal",-1),lt={class:"text-lg font-semibold text-gray-900"},at={key:0,class:"flex justify-between items-center text-green-600"},nt=e("span",{class:"text-lg font-medium"},"Descuento",-1),ut={class:"text-lg font-semibold"},it={key:1,class:"flex justify-between items-center text-gray-800"},ct=e("span",{class:"text-lg font-medium"},"Costo de envío",-1),dt={class:"text-lg font-semibold"},mt={class:"flex justify-between items-center border-t border-gray-200 pt-3"},vt=e("span",{class:"text-xl font-bold text-gray-900"},"Total",-1),gt={class:"text-2xl font-bold text-gray-900"},_t={__name:"CheckoutPage",props:{cartItems:Array,store:Object,customer:Object,addresses:Array},setup(u){const l=u,r=m(()=>l.store?.catalog_use_default??!0),j=m(()=>r.value?null:l.store?.catalog_body_bg_color||"#FFFFFF"),w=m(()=>r.value?null:l.store?.catalog_body_text_color||"#1F2937"),A=m(()=>r.value?null:l.store?.catalog_input_bg_color||"#FFFFFF"),L=m(()=>r.value?null:l.store?.catalog_input_text_color||"#1F2937"),W=m(()=>r.value?null:l.store?.catalog_button_bg_color||"#2563EB"),Q=m(()=>r.value?null:l.store?.catalog_button_text_color||"#FFFFFF"),J=m(()=>r.value?{}:!j.value||!w.value?{}:{backgroundColor:j.value,color:w.value}),D=m(()=>r.value?{}:!A.value||!L.value?{}:{backgroundColor:A.value,color:L.value}),M=m(()=>r.value?{}:!W.value||!Q.value?{}:{backgroundColor:W.value,color:Q.value}),K=s=>{const t=s?.variant||null,o=s?.product||null;if(t&&o){const E=t.price!=null&&t.price!==""?Number(t.price):null;if(E!==null)return E}return o&&o.price!=null?Number(o.price):0},X=s=>{try{return l.store?.promo_active&&Number(l.store?.promo_discount_percent||0)>0?Number(l.store.promo_discount_percent):s?.product?.promo_active&&Number(s?.product?.promo_discount_percent||0)>0?Number(s.product.promo_discount_percent):0}catch{return 0}},G=s=>{const t=K(s),o=X(s);return o>0?Math.round(t*(100-o)/100):t},S=m(()=>l.cartItems.reduce((s,t)=>s+G(t)*t.quantity,0)),k=g(""),i=g(null),y=g(""),P=g(!1),z=g(!1),V=m(()=>{if(!i.value)return 0;if(i.value.type==="percentage"){const s=S.value*i.value.value/100;return i.value.max_discount?Math.min(s,i.value.max_discount):s}else return Math.min(i.value.value,S.value)}),R=m(()=>l.store?.delivery_cost_active&&Number(l.store?.delivery_cost)>0?Number(l.store.delivery_cost):0),Z=m(()=>Math.max(0,S.value-V.value)+R.value),ee=async()=>{if(!k.value.trim()){y.value="Ingresa un código de cupón";return}P.value=!0,y.value="";try{const s=await window.axios.post(route("checkout.validate-coupon",{store:l.store.slug}),{code:k.value.trim()});s.data.valid?(i.value=s.data.coupon,y.value=""):s.data.code==="LOGIN_REQUIRED"?(z.value=!0,i.value=null):(y.value=s.data.message||"Cupón inválido",i.value=null)}catch(s){y.value=s.response?.data?.message||"Error al validar el cupón",i.value=null}finally{P.value=!1}},te=()=>{k.value="",i.value=null,y.value=""},C=g(null),F=g(!1);g("");const b=m(()=>l.customer||null),$=m(()=>l.addresses||[]),oe=()=>{if(b.value){c.customer_name=b.value.name||"",c.customer_phone=b.value.phone||"",c.customer_email=b.value.email||"";const s=$.value.find(t=>t.is_default);s&&(C.value=s.id,c.customer_address=s.full_address||`${s.address_line_1}, ${s.city}`)}};ae(()=>{oe()});const se=s=>{if(s){const t=$.value.find(o=>o.id===s);t&&(c.customer_address=t.full_address||`${t.address_line_1}, ${t.city}`,F.value=!1)}},c=ne({customer_name:"",customer_phone:"",customer_email:"",customer_address:"",address_id:null,coupon_code:null}),B=g(!1),H=g(""),re=()=>{c.address_id=C.value,c.coupon_code=i.value?k.value:null,c.post(route("checkout.store",{store:l.store.slug}),{onSuccess:()=>{},onError:s=>{H.value="Hubo un error al procesar tu pedido. Por favor verificá tus datos.",B.value=!0}})};return(s,t)=>(n(),d(U,null,[x(v(ue),{title:"Finalizar Compra"},{default:O(()=>[u.store?.logo_url?(n(),d("link",{key:0,rel:"icon",type:"image/png",href:u.store.logo_url},null,8,xe)):f("",!0)]),_:1}),e("header",he,[e("nav",we,[u.store?.logo_url?(n(),d("img",{key:0,src:u.store.logo_url,alt:`Logo de ${u.store.name}`,class:"h-10 w-10 rounded-full object-cover ring-2 ring-gray-100"},null,8,ke)):f("",!0),e("h1",Ce,a(u.store.name),1)])]),e("main",{class:"container mx-auto px-6 py-12 min-h-screen",style:p(J.value)},[e("div",Fe,[e("div",null,[$e,b.value?f("",!0):(n(),d("div",De,[e("p",Ne,[h(" ¿Ya tienes cuenta? "),x(v(q),{href:s.route("customer.login",{store:u.store.slug}),class:"font-semibold underline"},{default:O(()=>[h("Inicia sesión")]),_:1},8,["href"]),h(" para prellenar tus datos o "),x(v(q),{href:s.route("customer.register",{store:u.store.slug}),class:"font-semibold underline"},{default:O(()=>[h("regístrate")]),_:1},8,["href"]),h(" para guardar tus direcciones. ")])])),e("form",{onSubmit:ie(re,["prevent"]),class:"space-y-6 bg-white p-8 lg:p-10 shadow-2xl rounded-2xl border border-gray-100 backdrop-blur-sm transform transition-all hover:shadow-3xl"},[e("div",null,[Oe,N(e("input",{id:"customer_name","onUpdate:modelValue":t[0]||(t[0]=o=>v(c).customer_name=o),type:"text",class:_(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",r.value?"bg-gray-50 hover:bg-white":""]),style:p(D.value),required:""},null,6),[[I,v(c).customer_name]])]),e("div",null,[je,N(e("input",{id:"customer_phone","onUpdate:modelValue":t[1]||(t[1]=o=>v(c).customer_phone=o),type:"tel",class:_(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",r.value?"bg-gray-50 hover:bg-white":""]),style:p(D.value),required:""},null,6),[[I,v(c).customer_phone]])]),e("div",null,[Pe,N(e("input",{id:"customer_email","onUpdate:modelValue":t[2]||(t[2]=o=>v(c).customer_email=o),type:"email",class:_(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",r.value?"bg-gray-50 hover:bg-white":""]),style:p(D.value),required:""},null,6),[[I,v(c).customer_email]])]),b.value&&$.value.length>0?(n(),d("div",Ie,[Ae,N(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>C.value=o),onChange:t[4]||(t[4]=o=>se(C.value)),class:_(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4 mb-3",r.value?"bg-gray-50 hover:bg-white":""]),style:p(D.value)},[Me,(n(!0),d(U,null,T($.value,o=>(n(),d("option",{key:o.id,value:o.id},a(o.label)+" - "+a(o.address_line_1)+", "+a(o.city),9,Se))),128))],38),[[ce,C.value]]),e("button",{type:"button",onClick:t[5]||(t[5]=o=>F.value=!F.value),class:"text-sm text-blue-600 hover:text-blue-700 font-medium"},a(F.value?"Usar dirección guardada":"Usar dirección diferente"),1)])):f("",!0),e("div",null,[e("label",Be,a(b.value&&$.value.length>0&&!F.value?"Dirección (seleccionada arriba)":"Dirección Completa (con ciudad y detalles)"),1),N(e("textarea",{id:"customer_address","onUpdate:modelValue":t[6]||(t[6]=o=>v(c).customer_address=o),disabled:b.value&&$.value.length>0&&!F.value&&C.value,class:_(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4 resize-none",[r.value?"bg-gray-50 hover:bg-white":"",b.value&&$.value.length>0&&!F.value&&C.value?"bg-gray-100 cursor-not-allowed":""]]),style:p(D.value),rows:"3",required:""},null,14,Ee),[[I,v(c).customer_address]])]),e("button",{type:"submit",disabled:v(c).processing,class:_(["w-full font-bold py-4 px-6 rounded-xl text-center disabled:opacity-50 transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-lg hover:shadow-xl",r.value?"bg-green-600 text-white hover:bg-green-700":""]),style:p(!r.value&&M.value?M.value:{})},a(v(c).processing?"Procesando...":"Realizar Pedido por WhatsApp"),15,Ue)],32)]),e("div",qe,[ze,e("div",Ve,[(n(!0),d(U,null,T(u.cartItems,o=>(n(),d("div",{key:o.id,class:"flex flex-col sm:flex-row sm:items-start sm:justify-between sm:gap-4 p-3 rounded-lg hover:bg-gray-50 transition-colors"},[e("div",Re,[e("img",{src:o.product.main_image_url,class:"w-16 h-16 object-cover rounded-lg shadow-sm ring-1 ring-gray-200"},null,8,Te),e("div",Le,[e("p",We,a(o.product.name),1),o.variant?(n(),d("div",Qe,[(n(!0),d(U,null,T(o.variant.options,(E,Y)=>(n(),d("span",{key:Y,class:"mr-2 inline-block"},[e("strong",null,a(Y)+":",1),h(" "+a(E),1)]))),128))])):f("",!0),e("p",Ge,"Cantidad: "+a(o.quantity),1)])]),e("p",He,a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(G(o)*o.quantity)),1)]))),128))]),e("div",Ye,[Je,e("div",Ke,[N(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>k.value=o),type:"text",placeholder:"Ingresa el código",disabled:P.value||!!i.value,class:_(["flex-1 block rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",r.value?"bg-gray-50 hover:bg-white":""]),style:p(D.value)},null,14,Xe),[[I,k.value]]),i.value?(n(),d("button",{key:1,type:"button",onClick:te,class:"px-6 py-3 rounded-xl font-medium bg-red-600 text-white hover:bg-red-700 transition-all"}," Quitar ")):(n(),d("button",{key:0,type:"button",onClick:ee,disabled:P.value||!k.value.trim(),class:_(["px-6 py-3 rounded-xl font-medium transition-all disabled:opacity-50",r.value?"bg-blue-600 text-white hover:bg-blue-700":""]),style:p(!r.value&&M.value?M.value:{})},a(P.value?"...":"Aplicar"),15,Ze))]),y.value?(n(),d("p",et,a(y.value),1)):f("",!0),i.value?(n(),d("p",tt," ✓ Cupón aplicado: "+a(i.value.type==="percentage"?i.value.value+"%":"$"+i.value.value)+" de descuento ",1)):f("",!0)]),e("div",ot,[e("div",st,[rt,e("span",lt,a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(S.value)),1)]),V.value>0?(n(),d("div",at,[nt,e("span",ut,"-"+a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(V.value)),1)])):f("",!0),R.value>0?(n(),d("div",it,[ct,e("span",dt,a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(R.value)),1)])):f("",!0),e("div",mt,[vt,e("span",gt,a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(Z.value)),1)])])])])],4),x(ve),x(de,{show:B.value,type:"error",title:"No pudimos procesar tu pedido",message:H.value,"primary-text":"Entendido",onPrimary:t[8]||(t[8]=o=>B.value=!1),onClose:t[9]||(t[9]=o=>B.value=!1)},null,8,["show","message"]),x(_e,{show:z.value,store:u.store,onClose:t[10]||(t[10]=o=>z.value=!1)},null,8,["show","store"])],64))}};export{_t as default};
