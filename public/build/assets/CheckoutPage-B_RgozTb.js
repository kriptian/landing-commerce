import{c as d,r as g,B as se,u as re,a as u,o as i,b as A,f as e,e as S,i as f,d as m,h as le,t as a,m as F,l as Q,g as ae,j as D,q as O,s as p,p as y,x as ne,F as E,n as V}from"./app-BvE6yrCU.js";import{_ as ue}from"./AlertModal-DQ0yr3UK.js";import"./Modal-DOUVcKgR.js";const ie=["href"],ce={class:"bg-white shadow-sm sticky top-0 z-40"},de={class:"container mx-auto px-6 py-4 flex items-center gap-3"},me=["src","alt"],ve={class:"text-lg font-medium text-gray-600"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12"},ge=e("h1",{class:"text-xl sm:text-2xl font-medium text-gray-600 mb-6"},"Datos de Envío",-1),pe={key:0,class:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},_e={class:"text-sm text-blue-800 mb-2"},fe=e("label",{for:"customer_name",class:"block font-medium text-sm text-gray-700 mb-2"},"Nombre Completo",-1),ye=e("label",{for:"customer_phone",class:"block font-medium text-sm text-gray-700 mb-2"},"Teléfono (WhatsApp)",-1),xe=e("label",{for:"customer_email",class:"block font-medium text-sm text-gray-700 mb-2"},"Correo Electrónico",-1),he={key:0},we=e("label",{class:"block font-medium text-sm text-gray-700 mb-2"},"Dirección de Envío",-1),ke=e("option",{value:null},"Seleccionar dirección guardada",-1),Ce=["value"],Fe={for:"customer_address",class:"block font-medium text-sm text-gray-700 mb-2"},De=["disabled"],Ne=["disabled"],Oe={class:"bg-white/95 backdrop-blur-sm p-8 lg:p-10 rounded-2xl shadow-2xl border border-gray-100 sticky top-24 transform transition-all hover:shadow-3xl"},Pe=e("h2",{class:"text-xl sm:text-2xl font-medium text-gray-600 mb-6"},"Resumen de tu Pedido",-1),je={class:"space-y-4"},Ue={class:"flex items-start gap-3 flex-1 min-w-0"},$e=["src"],Ae={class:"min-w-0"},Ee={class:"font-semibold text-gray-900 break-words"},Ie={key:0,class:"text-sm text-gray-500 break-words mt-1"},Se={class:"text-sm text-gray-600 mt-1"},Ve={class:"font-semibold text-gray-900 whitespace-nowrap shrink-0 sm:text-right mt-2 sm:mt-0"},Be={class:"border-t border-gray-200 pt-6"},Me=e("label",{class:"block font-medium text-sm text-gray-700 mb-2"},"Código de Cupón (Opcional)",-1),qe={class:"flex gap-2"},ze=["disabled"],Te=["disabled"],Le={key:0,class:"mt-2 text-sm text-red-600"},Re={key:1,class:"mt-2 text-sm text-green-600"},We={class:"border-t border-gray-200 mt-6 pt-6 space-y-3"},He={class:"flex justify-between items-center"},Qe=e("span",{class:"text-lg font-medium text-gray-600"},"Subtotal",-1),Ye={class:"text-lg font-semibold text-gray-900"},Ge={key:0,class:"flex justify-between items-center text-green-600"},Je=e("span",{class:"text-lg font-medium"},"Descuento",-1),Ke={class:"text-lg font-semibold"},Xe={class:"flex justify-between items-center border-t border-gray-200 pt-3"},Ze=e("span",{class:"text-xl font-bold text-gray-900"},"Total",-1),et={class:"text-2xl font-bold text-gray-900"},rt={__name:"CheckoutPage",props:{cartItems:Array,store:Object,customer:Object,addresses:Array},setup(v){const c=v,r=d(()=>c.store?.catalog_use_default??!0),B=d(()=>r.value?null:c.store?.catalog_body_bg_color||"#FFFFFF"),M=d(()=>r.value?null:c.store?.catalog_body_text_color||"#1F2937"),q=d(()=>r.value?null:c.store?.catalog_input_bg_color||"#FFFFFF"),z=d(()=>r.value?null:c.store?.catalog_input_text_color||"#1F2937"),T=d(()=>r.value?null:c.store?.catalog_button_bg_color||"#2563EB"),L=d(()=>r.value?null:c.store?.catalog_button_text_color||"#FFFFFF"),Y=d(()=>r.value?{}:!B.value||!M.value?{}:{backgroundColor:B.value,color:M.value}),C=d(()=>r.value?{}:!q.value||!z.value?{}:{backgroundColor:q.value,color:z.value}),P=d(()=>r.value?{}:!T.value||!L.value?{}:{backgroundColor:T.value,color:L.value}),G=s=>{const o=s?.variant||null,t=s?.product||null;if(o&&t){const $=o.price!=null&&o.price!==""?Number(o.price):null;if($!==null)return $}return t&&t.price!=null?Number(t.price):0},J=s=>{try{return c.store?.promo_active&&Number(c.store?.promo_discount_percent||0)>0?Number(c.store.promo_discount_percent):s?.product?.promo_active&&Number(s?.product?.promo_discount_percent||0)>0?Number(s.product.promo_discount_percent):0}catch{return 0}},R=s=>{const o=G(s),t=J(s);return t>0?Math.round(o*(100-t)/100):o},j=d(()=>c.cartItems.reduce((s,o)=>s+R(o)*o.quantity,0)),x=g(""),n=g(null),_=g(""),N=g(!1),I=d(()=>{if(!n.value)return 0;if(n.value.type==="percentage"){const s=j.value*n.value.value/100;return n.value.max_discount?Math.min(s,n.value.max_discount):s}else return Math.min(n.value.value,j.value)}),K=d(()=>Math.max(0,j.value-I.value)),X=async()=>{if(!x.value.trim()){_.value="Ingresa un código de cupón";return}N.value=!0,_.value="";try{const s=await window.axios.post(route("checkout.validate-coupon",{store:c.store.slug}),{code:x.value.trim()});s.data.valid?(n.value=s.data.coupon,_.value=""):(_.value=s.data.message||"Cupón inválido",n.value=null)}catch(s){_.value=s.response?.data?.message||"Error al validar el cupón",n.value=null}finally{N.value=!1}},Z=()=>{x.value="",n.value=null,_.value=""},h=g(null),w=g(!1);g("");const b=d(()=>c.customer||null),k=d(()=>c.addresses||[]),ee=()=>{if(b.value){l.customer_name=b.value.name||"",l.customer_phone=b.value.phone||"",l.customer_email=b.value.email||"";const s=k.value.find(o=>o.is_default);s&&(h.value=s.id,l.customer_address=s.full_address||`${s.address_line_1}, ${s.city}`)}};se(()=>{ee()});const te=s=>{if(s){const o=k.value.find(t=>t.id===s);o&&(l.customer_address=o.full_address||`${o.address_line_1}, ${o.city}`,w.value=!1)}},l=re({customer_name:"",customer_phone:"",customer_email:"",customer_address:"",address_id:null,coupon_code:null}),U=g(!1),W=g(""),oe=()=>{l.address_id=h.value,l.coupon_code=n.value?x.value:null,l.post(route("checkout.store",{store:c.store.slug}),{onSuccess:()=>{},onError:s=>{W.value="Hubo un error al procesar tu pedido. Por favor verificá tus datos.",U.value=!0}})};return(s,o)=>(i(),u(E,null,[A(m(le),{title:"Finalizar Compra"},{default:S(()=>[v.store?.logo_url?(i(),u("link",{key:0,rel:"icon",type:"image/png",href:v.store.logo_url},null,8,ie)):f("",!0)]),_:1}),e("header",ce,[e("nav",de,[v.store?.logo_url?(i(),u("img",{key:0,src:v.store.logo_url,alt:`Logo de ${v.store.name}`,class:"h-10 w-10 rounded-full object-cover ring-2 ring-gray-100"},null,8,me)):f("",!0),e("h1",ve,a(v.store.name),1)])]),e("main",{class:"container mx-auto px-6 py-12 min-h-screen",style:p(Y.value)},[e("div",be,[e("div",null,[ge,b.value?f("",!0):(i(),u("div",pe,[e("p",_e,[F(" ¿Ya tienes cuenta? "),A(m(Q),{href:s.route("customer.login",{store:v.store.slug}),class:"font-semibold underline"},{default:S(()=>[F("Inicia sesión")]),_:1},8,["href"]),F(" para prellenar tus datos o "),A(m(Q),{href:s.route("customer.register",{store:v.store.slug}),class:"font-semibold underline"},{default:S(()=>[F("regístrate")]),_:1},8,["href"]),F(" para guardar tus direcciones. ")])])),e("form",{onSubmit:ae(oe,["prevent"]),class:"space-y-6 bg-white p-8 lg:p-10 shadow-2xl rounded-2xl border border-gray-100 backdrop-blur-sm transform transition-all hover:shadow-3xl"},[e("div",null,[fe,D(e("input",{id:"customer_name","onUpdate:modelValue":o[0]||(o[0]=t=>m(l).customer_name=t),type:"text",class:y(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",r.value?"bg-gray-50 hover:bg-white":""]),style:p(C.value),required:""},null,6),[[O,m(l).customer_name]])]),e("div",null,[ye,D(e("input",{id:"customer_phone","onUpdate:modelValue":o[1]||(o[1]=t=>m(l).customer_phone=t),type:"tel",class:y(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",r.value?"bg-gray-50 hover:bg-white":""]),style:p(C.value),required:""},null,6),[[O,m(l).customer_phone]])]),e("div",null,[xe,D(e("input",{id:"customer_email","onUpdate:modelValue":o[2]||(o[2]=t=>m(l).customer_email=t),type:"email",class:y(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",r.value?"bg-gray-50 hover:bg-white":""]),style:p(C.value),required:""},null,6),[[O,m(l).customer_email]])]),b.value&&k.value.length>0?(i(),u("div",he,[we,D(e("select",{"onUpdate:modelValue":o[3]||(o[3]=t=>h.value=t),onChange:o[4]||(o[4]=t=>te(h.value)),class:y(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4 mb-3",r.value?"bg-gray-50 hover:bg-white":""]),style:p(C.value)},[ke,(i(!0),u(E,null,V(k.value,t=>(i(),u("option",{key:t.id,value:t.id},a(t.label)+" - "+a(t.address_line_1)+", "+a(t.city),9,Ce))),128))],38),[[ne,h.value]]),e("button",{type:"button",onClick:o[5]||(o[5]=t=>w.value=!w.value),class:"text-sm text-blue-600 hover:text-blue-700 font-medium"},a(w.value?"Usar dirección guardada":"Usar dirección diferente"),1)])):f("",!0),e("div",null,[e("label",Fe,a(b.value&&k.value.length>0&&!w.value?"Dirección (seleccionada arriba)":"Dirección Completa (con ciudad y detalles)"),1),D(e("textarea",{id:"customer_address","onUpdate:modelValue":o[6]||(o[6]=t=>m(l).customer_address=t),disabled:b.value&&k.value.length>0&&!w.value&&h.value,class:y(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4 resize-none",[r.value?"bg-gray-50 hover:bg-white":"",b.value&&k.value.length>0&&!w.value&&h.value?"bg-gray-100 cursor-not-allowed":""]]),style:p(C.value),rows:"3",required:""},null,14,De),[[O,m(l).customer_address]])]),e("button",{type:"submit",disabled:m(l).processing,class:y(["w-full font-bold py-4 px-6 rounded-xl text-center disabled:opacity-50 transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-lg hover:shadow-xl",r.value?"bg-green-600 text-white hover:bg-green-700":""]),style:p(!r.value&&P.value?P.value:{})},a(m(l).processing?"Procesando...":"Realizar Pedido por WhatsApp"),15,Ne)],32)]),e("div",Oe,[Pe,e("div",je,[(i(!0),u(E,null,V(v.cartItems,t=>(i(),u("div",{key:t.id,class:"flex flex-col sm:flex-row sm:items-start sm:justify-between sm:gap-4 p-3 rounded-lg hover:bg-gray-50 transition-colors"},[e("div",Ue,[e("img",{src:t.product.main_image_url,class:"w-16 h-16 object-cover rounded-lg shadow-sm ring-1 ring-gray-200"},null,8,$e),e("div",Ae,[e("p",Ee,a(t.product.name),1),t.variant?(i(),u("div",Ie,[(i(!0),u(E,null,V(t.variant.options,($,H)=>(i(),u("span",{key:H,class:"mr-2 inline-block"},[e("strong",null,a(H)+":",1),F(" "+a($),1)]))),128))])):f("",!0),e("p",Se,"Cantidad: "+a(t.quantity),1)])]),e("p",Ve,a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(R(t)*t.quantity)),1)]))),128))]),e("div",Be,[Me,e("div",qe,[D(e("input",{"onUpdate:modelValue":o[7]||(o[7]=t=>x.value=t),type:"text",placeholder:"Ingresa el código",disabled:N.value||!!n.value,class:y(["flex-1 block rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",r.value?"bg-gray-50 hover:bg-white":""]),style:p(C.value)},null,14,ze),[[O,x.value]]),n.value?(i(),u("button",{key:1,type:"button",onClick:Z,class:"px-6 py-3 rounded-xl font-medium bg-red-600 text-white hover:bg-red-700 transition-all"}," Quitar ")):(i(),u("button",{key:0,type:"button",onClick:X,disabled:N.value||!x.value.trim(),class:y(["px-6 py-3 rounded-xl font-medium transition-all disabled:opacity-50",r.value?"bg-blue-600 text-white hover:bg-blue-700":""]),style:p(!r.value&&P.value?P.value:{})},a(N.value?"...":"Aplicar"),15,Te))]),_.value?(i(),u("p",Le,a(_.value),1)):f("",!0),n.value?(i(),u("p",Re," ✓ Cupón aplicado: "+a(n.value.type==="percentage"?n.value.value+"%":"$"+n.value.value)+" de descuento ",1)):f("",!0)]),e("div",We,[e("div",He,[Qe,e("span",Ye,a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(j.value)),1)]),I.value>0?(i(),u("div",Ge,[Je,e("span",Ke,"-"+a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(I.value)),1)])):f("",!0),e("div",Xe,[Ze,e("span",et,a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(K.value)),1)])])])])],4),A(ue,{show:U.value,type:"error",title:"No pudimos procesar tu pedido",message:W.value,"primary-text":"Entendido",onPrimary:o[8]||(o[8]=t=>U.value=!1),onClose:o[9]||(o[9]=t=>U.value=!1)},null,8,["show","message"])],64))}};export{rt as default};
