import{r as y,c as C,u as U,H as G,I as H,a as n,o as r,b as w,f as e,d as $,h as R,e as D,F as k,n as T,i as l,t as o,m as N,p as W,g as Q,j as Y,x as J,l as K}from"./app-uGEA3Zp4.js";import{_ as X}from"./AuthenticatedLayout-CA52O-kx.js";import{_ as Z}from"./AlertModal-pZbQfNmU.js";import{d as ee,s as te}from"./pdfUtils-BUhzinwv.js";import"./Modal-sXSlI7Gb.js";const se={class:"flex items-center justify-between w-full"},oe={class:"font-semibold text-xl text-gray-800 leading-tight"},ae={class:"flex gap-2"},ne=["disabled"],re={key:0},de={key:1},ie=e("span",{class:"hidden sm:inline"},"Descargar",-1),le=["disabled"],ce={key:0},ue={key:1},me=e("span",{class:"hidden sm:inline"},"Compartir",-1),pe=e("span",null,"üñ®Ô∏è",-1),he=e("span",{class:"hidden sm:inline"},"Imprimir",-1),_e=[pe,he],ge=e("span",null,"‚¨ÖÔ∏è",-1),be=e("span",{class:"hidden sm:inline"},"Volver",-1),ve={class:"py-12"},xe={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-3 gap-8"},fe={class:"lg:col-span-2 space-y-8"},ye={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},we={class:"p-6"},$e=e("h3",{class:"text-lg font-semibold border-b pb-4 mb-4"},"Productos en la Orden",-1),ke={class:"divide-y divide-gray-200"},Ce={class:"flex-grow"},De={class:"font-bold text-gray-900"},Te={key:0,class:"text-sm text-gray-600 mt-1"},Ne={class:"font-semibold"},Pe={class:"text-sm text-gray-500 mt-2"},je={class:"font-semibold text-gray-800 shrink-0 ml-4"},Ee={class:"border-t border-gray-200 pt-4 mt-4 text-right"},Se={class:"text-2xl font-bold"},Fe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},qe={class:"p-6"},Ie=e("h3",{class:"text-lg font-semibold border-b pb-4 mb-4"},"Datos del Cliente",-1),Oe={class:"mt-4 space-y-4 text-gray-700"},ze=e("p",{class:"font-semibold text-sm text-gray-500"},"Nombre:",-1),Ae=e("p",{class:"font-semibold text-sm text-gray-500"},"Tel√©fono:",-1),Me=e("p",{class:"font-semibold text-sm text-gray-500"},"Correo:",-1),Ve=e("p",{class:"font-semibold text-sm text-gray-500"},"Direcci√≥n:",-1),Be={class:"space-y-8"},Le={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ue={class:"p-6"},Ge=e("h3",{class:"text-lg font-semibold mb-4"},"Estado del Pedido",-1),He={class:"text-center mb-4"},Re={class:"text-sm text-center text-gray-500"},We={class:"mt-6 border-t pt-6"},Qe=e("label",{for:"status",class:"block font-medium text-sm text-gray-700 mb-2"},"Cambiar Estado",-1),Ye=e("option",{value:"recibido"},"Recibido",-1),Je=e("option",{value:"en_preparacion"},"En Preparaci√≥n",-1),Ke=e("option",{value:"despachado"},"Despachado",-1),Xe=e("option",{value:"entregado"},"Entregado",-1),Ze=e("option",{value:"cancelado"},"Cancelado",-1),et=[Ye,Je,Ke,Xe,Ze],tt=["disabled"],st=e("div",{class:"p-6"},[e("div",{class:"mt-6 flex justify-end"})],-1),ot={id:"invoice-content-digital",class:"fixed top-0 left-0 w-[80mm] bg-white z-[-100] opacity-0 pointer-events-none"},at={class:"bg-white text-black p-2 font-mono text-[11px] leading-tight",style:{width:"80mm",margin:"0 auto","font-family":"'Courier New', Courier, monospace"}},nt={key:0,class:"absolute inset-0 flex items-center justify-center pointer-events-none z-0 opacity-[0.12]"},rt={class:"text-[60px] font-[900] text-black uppercase whitespace-nowrap -rotate-45 transform select-none"},dt={class:"relative z-10"},it={class:"text-center mb-4"},lt=["src"],ct={class:"font-bold text-base uppercase mb-1"},ut={key:1,class:"text-[10px] space-y-0.5",style:{"font-size":"10px"}},mt={key:0},pt={key:1,class:"whitespace-normal"},ht={key:2,class:"whitespace-normal"},_t={key:3,class:"whitespace-normal"},gt={key:4,class:"whitespace-normal"},bt={key:5,class:"whitespace-normal"},vt={key:6,class:"whitespace-normal break-words"},xt={key:7,class:"whitespace-normal break-words"},ft=e("div",{class:"border-b-2 border-dashed border-black my-2"},null,-1),yt={class:"mb-3 text-[10px] grid grid-cols-2 gap-x-2 gap-y-1"},wt={class:"col-span-2 text-center mb-1"},$t={class:"text-sm font-bold"},kt={class:"text-[9px] text-gray-500"},Ct=e("div",null,[e("span",{class:"font-bold block text-gray-600"},"Canal:"),e("span",null,"Tienda Online")],-1),Dt={class:"text-right"},Tt=e("span",{class:"font-bold block text-gray-600"},"M√©todo de Pago:",-1),Nt={class:"capitalize"},Pt={key:0,class:"col-span-2 mt-1 border-t border-dotted border-gray-300 pt-1"},jt=e("span",{class:"font-bold text-gray-600"},"Cliente:",-1),Et={key:0},St=e("span",{class:"font-bold text-gray-600"},"Tel:",-1),Ft={key:1,class:"leading-tight"},qt=e("span",{class:"font-bold text-gray-600"},"Dir:",-1),It=e("div",{class:"border-b border-black my-2"},null,-1),Ot={class:"mb-4"},zt=e("div",{class:"flex justify-between text-[9px] font-bold mb-2 uppercase text-gray-800"},[e("span",null,"Descripci√≥n"),e("span",null,"Total")],-1),At={class:"font-bold text-[11px] leading-tight mb-0.5"},Mt={key:0,class:"text-[9px] text-gray-500 italic mb-1"},Vt={class:"flex justify-between items-start text-[10px] mt-1"},Bt={class:"flex flex-col"},Lt={class:"text-gray-800"},Ut={key:0,class:"flex flex-col mt-0.5"},Gt={style:{"text-decoration":"line-through",color:"#9ca3af"},class:"text-[9px]"},Ht={class:"text-[9px] font-bold text-gray-800"},Rt={class:"font-bold text-[11px] mt-0.5"},Wt=e("div",{class:"border-t border-black my-2 dashed"},null,-1),Qt={class:"text-right text-[11px] space-y-1"},Yt={class:"flex justify-between text-base font-black pt-1"},Jt=e("span",null,"TOTAL",-1),Kt={class:"flex justify-between text-[10px] mt-2 pt-1 border-dotted border-t border-gray-400"},Xt=e("span",null,"M√©todo Pago",-1),Zt={class:"capitalize"},es={class:"flex justify-between text-[10px]"},ts=e("span",null,"Estado",-1),ss={class:"capitalize"},os=e("div",{class:"text-center mt-6 text-[10px] space-y-1 mb-4"},[e("p",{class:"font-medium"},"¬°Gracias por su compra!"),e("p",{class:"italic"},"Para consultas sobre su env√≠o, cont√°ctenos.")],-1),ls={__name:"Show",props:{order:Object,store:Object},setup(t){const g=y(!1),b=y(""),v=y(""),x=y("success"),d=t,P=C(()=>!d.order||!d.order.items?[]:Array.isArray(d.order.items)?d.order.items:Object.values(d.order.items)),h=s=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),_=y(!1),I=async()=>{_.value=!0;try{const s=document.getElementById("invoice-content-digital");s&&await ee(s,`factura-${d.order.sequence_number||d.order.id}.pdf`)}catch(s){console.error(s),alert("Error al generar el PDF")}finally{_.value=!1}},O=async()=>{_.value=!0;try{const s=document.getElementById("invoice-content-digital");s&&await te(s,`factura-${d.order.sequence_number||d.order.id}.pdf`,`Factura #${d.order.sequence_number||d.order.id}`)}catch(s){console.error(s)}finally{_.value=!1}},z=()=>{window.print()},S=s=>{const i={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(s).toLocaleDateString("es-CO",i)},j=C(()=>({recibido:{text:"Recibido",class:"bg-yellow-100 text-yellow-800"},en_preparacion:{text:"En Preparaci√≥n",class:"bg-blue-100 text-blue-800"},despachado:{text:"Despachado",class:"bg-purple-100 text-purple-800"},entregado:{text:"Entregado",class:"bg-green-100 text-green-800"},cancelado:{text:"Cancelado",class:"bg-red-100 text-red-800"}})[d.order.status]||{text:d.order.status,class:"bg-gray-100 text-gray-800"}),f=U({status:d.order.status}),A=()=>{const s=f.status;f.put(route("admin.orders.update",d.order.id),{preserveScroll:!0,onSuccess:()=>{x.value="success",s==="despachado"||s==="entregado"?(b.value="Venta confirmada",v.value="Inventario actualizado correctamente."):s==="cancelado"?(b.value="Pedido cancelado",v.value="El estado se actualiz√≥ y el inventario fue revertido si correspond√≠a."):(b.value="Estado actualizado",v.value="El estado de la orden se guard√≥ correctamente."),g.value=!0},onError:i=>{x.value="error",b.value="Error al actualizar",v.value=Array.isArray(i)?i.join(`
`):i?.status||Object.values(i||{}).join(`
`)||"Ocurri√≥ un error inesperado.",g.value=!0}})},F=G(),E=C(()=>F?.props?.auth?.user?.store?.name||"nuestra tienda"),q=C(()=>{const s=F?.props?.auth?.user?.store;return s?s.custom_domain?`${typeof window<"u"?window.location.protocol:"https:"}//${s.custom_domain}`:route("catalogo.index",{store:s.slug}):"#"}),M=()=>{try{const s=P.value;return s.length?`
Tu orden incluye:
${s.map(m=>{const a=Number(m.quantity||0);let c="";if(m.variant_options)try{const u=Object.entries(m.variant_options).map(([p,L])=>`${p}: ${L}`);c=u.length?` (${u.join(", ")})`:""}catch{}return` - ${a} x ${m.product_name}${c}`}).join(`
`)}`:""}catch{return""}},V=()=>{const s=d.order.sequence_number??d.order.id,i=S(d.order.created_at),m=h(d.order.total_price),a=(d.order?.customer_name||"").trim(),c=a?`Hola ${a},`:"Hola,",u=(d.order?.customer_address||"").trim(),p=M();switch(d.order.status){case"recibido":return`${c}

¬°Gracias por comprar en ${E.value}!

Tu pedido No. ${s} fue recibido correctamente.${p?`
${p}`:""}

Fecha del pedido: ${i}.
Total del pedido: ${m}${u?`
Direcci√≥n: ${u}`:""}

Te avisaremos cuando est√© en preparaci√≥n.`;case"en_preparacion":return`${c}

Estamos preparando tu pedido No. ${s} en ${E.value}.${p?`
${p}`:""}

Fecha del pedido: ${i}.
Total del pedido: ${m}${u?`
Direcci√≥n: ${u}`:""}

Te notificaremos cuando salga a despacho.`;case"despachado":return`${c}

Tu pedido No. ${s} fue despachado desde ${E.value}.${p?`
${p}`:""}

Total del pedido: ${m}${u?`
Direcci√≥n de entrega: ${u}`:""}

Si necesitas coordinar algo de la entrega, responde este mensaje.`;case"entregado":return`${c}

¬°Qu√© alegr√≠a! Ya entregamos tu pedido No. ${s}.${p?`
${p}`:""}

Total del pedido: ${m}

Esperamos que lo disfrutes. Si quieres descubrir m√°s productos, visita nuestro cat√°logo: ${q.value}`;case"cancelado":return`${c}

Tu pedido No. ${s} fue cancelado. Si no fuiste t√∫ quien lo solicit√≥, por favor cont√°ctanos para ayudarte.${p?`
${p}`:""}

Cuando desees, puedes volver a comprar aqu√≠: ${q.value}`;default:return`${c}

Estado actual de tu pedido No. ${s}: ${j.value?.text??d.order.status}.`}},B=()=>{try{const i=(d.order?.customer_phone??"").toString().replace(/[^0-9]/g,"");if(!i){x.value="error",b.value="Sin tel√©fono del cliente",v.value="No encontramos un n√∫mero de WhatsApp v√°lido para el cliente.",g.value=!0;return}const m=V(),a=encodeURIComponent(m),c=`https://wa.me/${i}?text=${a}`;typeof window<"u"&&window.open(c,"_blank")}catch{x.value="error",b.value="No se pudo abrir WhatsApp",v.value="Intenta nuevamente en unos segundos.",g.value=!0}};return(s,i)=>{const m=H("Modal");return r(),n(k,null,[w($(R),{title:`Orden #${t.order.sequence_number??t.order.id}`},null,8,["title"]),w(X,null,{header:D(()=>[e("div",se,[e("h2",oe," Detalle de la Orden #"+o(t.order.sequence_number??t.order.id),1),e("div",ae,[e("button",{onClick:I,class:"px-3 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm flex items-center gap-1 no-print",disabled:_.value,title:"Descargar PDF"},[_.value?(r(),n("span",re,"‚è≥")):(r(),n("span",de,"‚¨áÔ∏è")),ie],8,ne),e("button",{onClick:O,class:"px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-sm flex items-center gap-1 no-print",disabled:_.value,title:"Compartir Factura"},[_.value?(r(),n("span",ce,"‚è≥")):(r(),n("span",ue,"üîó")),me],8,le),e("button",{onClick:z,class:"px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 no-print flex items-center gap-1",title:"Imprimir"},_e),w($(K),{href:s.route("admin.reports.index"),class:"px-3 sm:px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 no-print flex items-center gap-1",title:"Volver"},{default:D(()=>[ge,be]),_:1},8,["href"])])])]),default:D(()=>[e("div",ve,[e("div",xe,[e("div",fe,[e("div",ye,[e("div",we,[$e,e("div",ke,[(r(!0),n(k,null,T(P.value,a=>(r(),n("div",{key:a.id,class:"py-4 flex justify-between items-start"},[e("div",Ce,[e("p",De,o(a.product_name),1),a.variant_options?(r(),n("div",Te,[(r(!0),n(k,null,T(a.variant_options,(c,u)=>(r(),n("span",{key:u,class:"mr-2 bg-gray-100 px-2 py-1 rounded"},[e("span",Ne,o(u)+":",1),N(" "+o(c),1)]))),128))])):l("",!0),e("p",Pe,o(a.quantity)+" x "+o(h(a.unit_price)),1)]),e("p",je,o(h(a.unit_price*a.quantity)),1)]))),128))]),e("div",Ee,[e("p",Se,"Total: "+o(h(t.order.total_price)),1)])])]),e("div",Fe,[e("div",qe,[Ie,e("div",Oe,[e("div",null,[ze,e("p",null,o(t.order.customer_name),1)]),e("div",null,[Ae,e("p",null,o(t.order.customer_phone),1)]),e("div",null,[Me,e("p",null,o(t.order.customer_email),1)]),e("div",null,[Ve,e("p",null,o(t.order.customer_address),1)])])])])]),e("div",Be,[e("div",Le,[e("div",Ue,[Ge,e("div",He,[e("span",{class:W(["px-4 py-2 inline-flex text-lg leading-5 font-semibold rounded-full",j.value.class])},o(j.value.text),3)]),e("p",Re," Pedido realizado el: "+o(S(t.order.created_at)),1),e("form",{onSubmit:Q(A,["prevent"])},[e("div",We,[Qe,Y(e("select",{id:"status","onUpdate:modelValue":i[0]||(i[0]=a=>$(f).status=a),class:"block w-full rounded-md shadow-sm border-gray-300"},et,512),[[J,$(f).status]]),e("button",{type:"submit",disabled:$(f).processing,class:"mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 disabled:opacity-50"}," Actualizar Estado ",8,tt),e("button",{type:"button",onClick:B,class:"mt-3 w-full bg-green-600 text-white font-bold py-2 px-4 rounded hover:bg-green-700"}," Notificar estado actual ")])],32)])])])])])]),_:1}),w(m,{show:s.confirmingSale,onClose:s.closeSaleModal},{default:D(()=>[st]),_:1},8,["show","onClose"]),w(Z,{show:g.value,type:x.value,title:b.value,message:v.value,"primary-text":"Entendido",onPrimary:i[1]||(i[1]=a=>g.value=!1),onClose:i[2]||(i[2]=a=>g.value=!1)},null,8,["show","type","title","message"]),e("div",ot,[e("div",at,[t.order.store?.name||s.$page.props.auth.user.store?.name?(r(),n("div",nt,[e("div",rt,o(t.order.store?.name||s.$page.props.auth.user.store?.name),1)])):l("",!0),e("div",dt,[e("div",it,[t.order.store?.logo_url||s.$page.props.auth.user.store?.logo_url?(r(),n("img",{key:0,src:t.order.store?.logo_url||s.$page.props.auth.user.store?.logo_url,alt:"Logo",class:"h-12 w-auto object-contain mx-auto mb-2 grayscale",crossorigin:"anonymous"},null,8,lt)):l("",!0),e("h2",ct,o(t.order.store?.name||s.$page.props.auth.user.store?.name),1),t.store?(r(),n("div",ut,[t.store.nit?(r(),n("p",mt,"NIT: "+o(t.store.nit),1)):l("",!0),t.store.address?(r(),n("p",pt,o(t.store.address),1)):l("",!0),t.store.address_two?(r(),n("p",ht,o(t.store.address_two),1)):l("",!0),t.store.address_three?(r(),n("p",_t,o(t.store.address_three),1)):l("",!0),t.store.address_four?(r(),n("p",gt,o(t.store.address_four),1)):l("",!0),t.store.phone?(r(),n("p",bt,"Tel: "+o(t.store.phone?.startsWith("57")?t.store.phone.substring(2):t.store.phone),1)):l("",!0),t.store.email?(r(),n("p",vt,o(t.store.email),1)):l("",!0),t.store.custom_domain?(r(),n("p",xt,o(t.store.custom_domain),1)):l("",!0)])):l("",!0)]),ft,e("div",yt,[e("div",wt,[e("p",$t,"Orden #"+o(t.order.sequence_number??t.order.id),1),e("p",kt,o(new Date(t.order.created_at).toLocaleString("es-CO")),1)]),Ct,e("div",Dt,[Tt,e("span",Nt,o(t.order.payment_method||"N/A"),1)]),t.order.customer_name?(r(),n("div",Pt,[e("p",null,[jt,N(" "+o(t.order.customer_name),1)]),t.order.customer_phone?(r(),n("p",Et,[St,N(" "+o(t.order.customer_phone),1)])):l("",!0),t.order.customer_address?(r(),n("p",Ft,[qt,N(" "+o(t.order.customer_address),1)])):l("",!0)])):l("",!0)]),It,e("div",Ot,[zt,(r(!0),n(k,null,T(P.value,a=>(r(),n("div",{key:a.id,class:"mb-3 border-b border-gray-200 last:border-0 pb-2"},[e("div",At,o(a.product_name),1),a.variant_options?(r(),n("div",Mt,[(r(!0),n(k,null,T(a.variant_options,(c,u)=>(r(),n("span",{key:u,class:"mr-1"},o(c),1))),128))])):l("",!0),e("div",Vt,[e("div",Bt,[e("span",Lt,o(a.quantity)+" x "+o(h(a.unit_price)),1),a.discount_percent>0||a.original_price&&a.original_price>a.unit_price?(r(),n("div",Ut,[e("span",Gt," Precio Normal: "+o(h(a.original_price||a.unit_price*100/(100-(a.discount_percent||0)))),1),e("span",Ht," Desc: "+o(a.discount_percent||Math.round((1-a.unit_price/a.original_price)*100))+"% ",1)])):l("",!0)]),e("div",Rt,o(h(a.unit_price*a.quantity)),1)])]))),128))]),Wt,e("div",Qt,[e("div",Yt,[Jt,e("span",null,o(h(t.order.total_price)),1)]),e("div",Kt,[Xt,e("span",Zt,o(t.order.payment_method||"N/A"),1)]),e("div",es,[ts,e("span",ss,o(t.order.status),1)])]),os])])])],64)}}};export{ls as default};
