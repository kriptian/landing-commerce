const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CT9B7FG_.js","assets/app-C_myp881.js","assets/app-CA4S4Tw8.css"])))=>i.map(i=>d[i]);
import{H as Qe,r as p,D as Ke,c as A,u as Xe,w as T,I as Ye,a as d,o as u,b,d as i,h as Je,e as U,f as t,A as pe,g as se,i as v,j as h,q as _,p as y,m as $,k as Ze,t as C,F as P,n as j,x as ge,C as ae,_ as Ie}from"./app-C_myp881.js";import{_ as et}from"./AuthenticatedLayout-BCbdu8am.js";import{_ as J}from"./AlertModal-DnwgjqkF.js";import{_ as ve}from"./Modal-BEZOzTpV.js";import{_ as tt}from"./PrimaryButton-BU5D1vkC.js";import{_ as st}from"./SecondaryButton-B4XYF8_M.js";import at from"./VariantInventoryModal-CL3be_Re.js";const ot=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear producto",-1),rt={class:"py-12"},nt={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},lt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},it={class:"p-6 text-gray-900"},ct={class:"mb-4"},dt=t("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1),ut={class:"mb-4"},mt=t("label",{for:"barcode",class:"block font-medium text-sm text-gray-700 mb-1"},"CÃ³digo de Barras (Opcional)",-1),pt={class:"flex gap-2"},gt=["disabled","title"],vt=t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})],-1),ht={class:"mb-4"},ft=t("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1),_t={class:"p-4 border rounded-md bg-gray-50"},bt={class:"inline-flex items-center gap-2 mb-3 select-none"},yt=t("span",{class:"font-semibold"},"Controlar inventario",-1),wt={key:0,class:"font-semibold text-gray-800 mb-2"},xt={key:1,class:"text-xs text-gray-500 mb-4"},kt={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ct={for:"quantity",class:"block font-medium text-sm text-gray-700 flex items-center"},St=["disabled","required"],Vt={key:0,class:"mt-1 text-sm text-red-600"},Pt={for:"alert",class:"block font-medium text-sm text-gray-700 flex items-center"},Et=["disabled"],Mt={for:"purchase_price",class:"block font-medium text-sm text-gray-700 flex items-center"},At=["disabled"],$t={class:"mt-4 mb-2"},jt=t("label",{class:"block font-medium text-sm text-gray-700"},"CategorÃ­as",-1),Bt={key:0,class:"mt-1 text-sm text-amber-600 font-medium"},Ot={class:"space-y-3"},Tt=["onUpdate:modelValue","onChange","required"],Ut=t("option",{value:null},"Seleccione una categorÃ­a",-1),qt=["value"],Nt={key:0,class:"mt-1 text-sm text-red-600"},zt={key:1,class:"mt-1 text-sm text-red-600"},Ht={class:"mb-4"},Dt=t("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"DescripciÃ³n Corta",-1),Lt={class:"mb-4"},Rt=t("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"DescripciÃ³n Larga",-1),Ft={class:"mb-4"},Wt=t("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1),Gt={class:"mb-4"},Qt=t("label",{for:"meta_keywords",class:"block font-medium text-sm text-gray-700"},"Palabras Clave SEO (separadas por comas)",-1),Kt=t("p",{class:"mt-1 text-xs text-gray-500"},"Estas palabras clave ayudan a mejorar el SEO del producto. No son visibles para los clientes.",-1),Xt={class:"md:col-span-2 mt-6 border-t pt-6"},Yt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Jt={class:"p-6 text-gray-900"},Zt={class:"flex items-center justify-between"},It=t("h3",{class:"text-lg font-medium"},"Variantes del Producto",-1),es={class:"flex items-center gap-2"},ts={class:"mt-4 border rounded-lg divide-y"},ss={key:0,class:"text-sm text-gray-500 p-3"},as={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2"},os={class:"flex-1 min-w-0"},rs={class:"flex items-center gap-2"},ns=["title","onClick"],ls={key:0},is={key:1},cs=["onUpdate:modelValue"],ds={key:0,class:"flex-shrink-0 text-xs bg-gray-100 text-gray-700 rounded px-2 py-0.5 align-middle"},us={class:"flex items-center gap-2 flex-shrink-0"},ms=["onClick"],ps=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("rect",{x:"4",y:"3",width:"11",height:"15",rx:"2",ry:"2","stroke-width":"1.5"}),t("circle",{cx:"18",cy:"18",r:"3","stroke-width":"1.5"}),t("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M18 16.5v3M16.5 18h3"})],-1),gs=[ps],vs=["onClick"],hs=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),fs=[hs],_s={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2"},bs={class:"grid grid-cols-1 md:grid-cols-5 gap-3"},ys={class:"md:col-span-2"},ws=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Depende de",-1),xs=["onUpdate:modelValue"],ks=t("option",{value:""},"(sin dependencia)",-1),Cs=["value","disabled"],Ss={key:0,class:"md:col-span-3"},Vs=t("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Permitir valores segÃºn el valor del padre",-1),Ps={class:"mt-2 space-y-2"},Es={class:"text-xs font-semibold text-gray-700 mb-1"},Ms={class:"flex flex-wrap gap-2"},As=["checked","onChange"],$s={key:1,class:"mt-2 pl-4 border-l"},js={class:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-3"},Bs=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Nombre",-1),Os=["onUpdate:modelValue"],Ts=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Precio (opcional)",-1),Us=["onUpdate:modelValue","disabled","onInput"],qs={key:0,class:"mt-1 text-xs text-amber-600"},Ns={class:"flex items-center gap-2"},zs=["onChange","id","disabled"],Hs={key:0,class:"relative"},Ds=["src"],Ls=["onClick"],Rs=["for","title"],Fs=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-5 h-5 text-gray-400",fill:"currentColor"},[t("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1),Ws=[Fs],Gs={key:2,class:"mt-1 text-xs text-amber-600"},Qs=t("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"CÃ³digo de Barras",-1),Ks={class:"flex gap-1"},Xs=["onUpdate:modelValue","disabled"],Ys=["onClick","disabled"],Js=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})],-1),Zs=[Js],Is=["onClick","disabled"],ea=t("svg",{class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1),ta=[ea],sa={key:0,class:"mt-1 text-xs text-amber-600"},aa={key:1,class:"mt-1 text-xs text-amber-600"},oa={class:"flex items-center gap-2 ml-2"},ra=["onClick"],na=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),la=[na],ia=t("label",{class:"block font-medium text-sm text-gray-700"},"AÃ±adir Nueva Variante Principal",-1),ca={class:"mt-2 flex items-center gap-2"},da=t("button",{type:"submit",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",title:"AÃ±adir"}," âœ” ",-1),ua={class:"md:col-span-2 mt-6 border-t pt-6"},ma=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"ImÃ¡genes Extra de la GalerÃ­a",-1),pa=t("p",{class:"text-sm text-gray-600 mb-4"}," Estas imÃ¡genes se agregarÃ¡n a la galerÃ­a general del producto. Las imÃ¡genes de las variantes se muestran cuando se selecciona esa opciÃ³n. ",-1),ga={class:"mb-4"},va=t("label",{for:"gallery_files",class:"block font-medium text-sm text-gray-700"},"ImÃ¡genes de la GalerÃ­a",-1),ha=t("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1),fa={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},_a=["disabled"],ba=t("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M4 4a2 2 0 0 1 2-2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4zm9-1.5V7h4.5L13 2.5z"}),t("path",{d:"M8 13h8v2H8zM8 9h5v2H8z"})],-1),ya=t("span",null,"Crear",-1),wa=[ba,ya],xa={key:0,class:"ml-3 text-sm text-red-600"},ka={class:"p-6"},Ca=t("h2",{class:"text-lg font-semibold mb-4"},"Escanear CÃ³digo de Barras",-1),Sa=t("div",{class:"mb-4"},[t("p",{class:"text-sm text-gray-600 mb-4"}," Apunta la cÃ¡mara hacia el cÃ³digo de barras. El cÃ³digo se detectarÃ¡ automÃ¡ticamente. "),t("div",{id:"barcode-scanner-create",class:"w-full rounded-lg overflow-hidden",style:{"min-height":"300px"}})],-1),Va={class:"flex gap-3"},Pa={class:"p-6"},Ea=t("h2",{class:"text-lg font-semibold mb-4 text-green-600"},"Â¡CÃ³digo de barras escaneado!",-1),Ma={class:"mb-4"},Aa=t("p",{class:"text-sm text-gray-600 mb-2"}," CÃ³digo escaneado: ",-1),$a={class:"text-lg font-semibold text-gray-900"},ja={class:"flex gap-3"},he=2*1024*1024,Ha={__name:"Create",props:{categories:Array},setup(fe){const _e=fe,be=Qe(),L=p(!!be?.props?.flash?.success),E=p(!1),q=p([]),N=p(!1),M=p(null),R=p(!1),oe=p(""),F=p(null),ye=()=>{try{const s=new(window.AudioContext||window.webkitAudioContext),e=s.createOscillator(),r=s.createGain();e.connect(r),r.connect(s.destination),e.frequency.value=800,e.type="sine",r.gain.setValueAtTime(.3,s.currentTime),r.gain.exponentialRampToValueAtTime(.01,s.currentTime+.2),e.start(s.currentTime),e.stop(s.currentTime+.2)}catch{}},re=s=>{if(ye(),F.value){const{pIndex:e,cIndex:r}=F.value;c.value[e]&&c.value[e].children[r]&&(c.value[e].children[r].barcode=s),F.value=null}else n.barcode=s;oe.value=s,W(),R.value=!0},we=(s,e)=>{F.value={pIndex:s,cIndex:e},ne()},ne=async()=>{try{N.value=!0,await ae();const{Html5Qrcode:s}=await Ie(async()=>{const{Html5Qrcode:a}=await import("./index-CT9B7FG_.js");return{Html5Qrcode:a}},__vite__mapDeps([0,1,2])),e=document.getElementById("barcode-scanner-create");if(!e)return;M.value=new s(e.id);const r={fps:10,qrbox:{width:250,height:250}};try{await M.value.start({facingMode:"environment"},r,a=>{re(a)},a=>{})}catch{try{await M.value.start({facingMode:"user"},r,o=>{re(o)},o=>{})}catch{alert("No se pudo acceder a la cÃ¡mara. Por favor, permite el acceso a la cÃ¡mara en la configuraciÃ³n del navegador."),N.value=!1}}}catch{alert("Error al inicializar el escÃ¡ner. Por favor, intenta nuevamente."),N.value=!1}},W=async()=>{if(M.value){try{await M.value.stop(),await M.value.clear()}catch{}M.value=null}N.value=!1};Ke(()=>{W()});const xe=s=>{const e=Array.from(s?.target?.files||[]),r=[],a=[];for(const o of e){if(!(o?.type||"").startsWith("image/")){r.push(`${o.name}: no es una imagen vÃ¡lida.`);continue}if(o.size>he){r.push(`${o.name}: supera el lÃ­mite de 2 MB.`);continue}a.push(o)}if(r.length){q.value=["Problemas con las imÃ¡genes seleccionadas:",...r],E.value=!0,s?.target&&(s.target.value=""),n.gallery_files=[];return}n.gallery_files=a},w=p([{options:_e.categories,selected:null}]),ke=s=>{w.value.splice(s+1)},Ce=async s=>{const e=w.value[s].selected;if(ke(s),n.category_id=e,!!e)try{const r=await window.axios.get(route("admin.categories.children",e)),a=Array.isArray(r.data?.data)?r.data.data:[];a.length>0&&(w.value.push({options:a,selected:null}),n.category_id=null)}catch{}},G=A(()=>{if(w.value.length>1){const s=w.value[w.value.length-1];return s.options.length>0&&!s.selected}return!1}),n=Xe({name:"",barcode:"",price:"",purchase_price:null,retail_price:null,track_inventory:!0,quantity:0,alert:null,category_id:null,short_description:"",long_description:"",specifications:"",meta_keywords:"",gallery_files:[],variant_options:[],variants:[],variant_attributes:[]}),c=p([]),z=p(""),x=p({}),k=A(()=>c.value.some(s=>s.children&&s.children.some(e=>(Number(e.stock)||0)>0||e.alert!==null&&e.alert!==""&&e.alert!==void 0||e.purchase_price!==null&&e.purchase_price!==""&&e.purchase_price!==void 0))),Q=A(()=>c.value.some(s=>s.children&&s.children.some(e=>e.barcode&&e.barcode!=="")));T(Q,s=>{s&&(n.barcode="")});const Se=A(()=>{if(!k.value)return n.quantity;let s=0;return c.value.forEach(e=>{e.children&&e.children.forEach(r=>{s+=Number(r.stock)||0})}),s});T(Se,s=>{k.value&&(n.quantity=s)});const Ve=s=>{x.value[s]=!(x.value[s]??!1)},Z=p(!1),I=p(null),le=p({pIndex:-1,cIndex:-1}),Pe=(s,e,r)=>{I.value={stock:s.stock||0,alert:s.alert,purchase_price:s.purchase_price,name:s.name},le.value={pIndex:e,cIndex:r},Z.value=!0},Ee=s=>{const{pIndex:e,cIndex:r}=le.value;e!==-1&&r!==-1&&(c.value[e].children[r].stock=s.stock,c.value[e].children[r].alert=s.alert,c.value[e].children[r].purchase_price=s.purchase_price)},ie=()=>{const s=z.value.trim()||"",e=c.value.length;c.value.push({id:null,name:s,children:[],order:e,dependsOn:"",rules:{},rulesSelected:{},__showDependency:!1}),x.value[e]=!0,z.value=""},Me=s=>{c.value.splice(s,1)},Ae=s=>{c.value[s].children||(c.value[s].children=[]),c.value[s].children.push({id:null,name:"",barcode:"",price:null,image:null,imagePreview:null,imagePath:null,order:c.value[s].children.length}),x.value[s]=!0},$e=(s,e)=>{c.value[s].children.splice(e,1)},je=(s,e,r)=>{const a=r?.target?.files?.[0];if(!a)return;if(!O(s)){r?.target&&(r.target.value=""),ce.value||(Y.value=!0,ce.value=!0);return}const o=[];if((a?.type||"").startsWith("image/")||o.push(`${a.name}: no es una imagen vÃ¡lida.`),a.size>he&&o.push(`${a.name}: supera el lÃ­mite de 2 MB.`),o.length){q.value=["Problemas con la imagen de la variante:",...o],E.value=!0,r?.target&&(r.target.value=""),c.value[s].children[e].image=null,c.value[s].children[e].imagePreview=null;return}c.value[s].children[e].image=a;const m=new FileReader;m.onload=g=>{c.value[s].children[e].imagePreview=g.target.result},m.readAsDataURL(a)},Be=(s,e)=>{c.value[s].children[e].image=null,c.value[s].children[e].imagePreview=null},Oe=()=>{const s=[];return c.value.forEach((e,r)=>{if(!e.name.trim())return;const a={name:e.name.trim(),parent_id:null,price:null,image_path:null,order:r,children:[]};e.children&&e.children.length>0&&e.children.forEach((o,l)=>{o.name.trim()&&a.children.push({name:o.name.trim(),parent_id:null,barcode:o.barcode||null,stock:o.stock||0,alert:o.alert,purchase_price:o.purchase_price,price:o.price?parseFloat(o.price):null,image_file_key:o.image?`variant_option_${r}_${l}`:null,order:l})}),(a.children.length>0||a.name)&&s.push(a)}),s},Te=()=>{const s=[];return c.value.forEach(e=>{if(!e.name.trim())return;const r=(e.children||[]).map(o=>o.name.trim()).filter(Boolean);if(r.length===0)return;const a={name:e.name.trim(),values:r,valuesText:r.join(", "),dependsOn:e.dependsOn||"",rules:e.rules||{},rulesSelected:e.rulesSelected||{}};s.push(a)}),s},Ue=A(()=>c.value.filter(e=>!e.children||e.children.length===0?!1:e.children.some(r=>r.price&&r.price!==""&&r.price!=null)).length>1);A(()=>c.value.find(s=>!s.children||s.children.length===0?!1:s.children.some(e=>e.price&&e.price!==""&&e.price!=null)));const B=p(!1),K=p(!1),qe=["Has intentado agregar precios a una variante cuando ya existe otra variante principal con precios configurados.","","ðŸ“‹ Regla del Sistema:","Solo puedes asignar precios a las opciones hijas de UNA variante principal. Si ya asignaste precios a una variante (por ejemplo, Color), no podrÃ¡s agregar precios a otra variante (por ejemplo, Equipo).","","ðŸ’¡ CÃ³mo funciona:","Cuando un cliente seleccione una opciÃ³n de la variante que tiene precios, se mostrarÃ¡ el precio de esa opciÃ³n especÃ­fica. Si no selecciona ninguna opciÃ³n o selecciona una opciÃ³n sin precio, se usarÃ¡ el precio principal del producto.","","ðŸ’¡ Sugerencia:","Si necesitas diferentes precios segÃºn mÃºltiples caracterÃ­sticas, considera crear productos separados o usar una sola variante que combine ambas caracterÃ­sticas."],X=s=>!c.value.find((r,a)=>a===s||!r.children||r.children.length===0?!1:r.children.some(o=>o.price&&o.price!==""&&o.price!=null)),O=s=>!c.value.find((r,a)=>a===s||!r.children||r.children.length===0?!1:r.children.some(o=>o.imagePreview||o.image||o.imagePath&&o.imagePath!=="")),H=s=>!c.value.find((r,a)=>a===s||!r.children||r.children.length===0?!1:r.children.some(o=>o.barcode&&o.barcode!=="")),ee=s=>!c.value.find((r,a)=>a===s||!r.children||r.children.length===0?!1:r.children.some(o=>(Number(o.stock)||0)>0||o.alert!==null&&o.alert!==""&&o.alert!==void 0||o.purchase_price!==null&&o.purchase_price!==""&&o.purchase_price!==void 0)),Ne=(s,e,r)=>{const a=r?.target?.value;!a||a===""||a==null||X(s)||(r.target.value="",c.value[s].children[e].price=null,K.value||(B.value=!0,K.value=!0))},Y=p(!1),ce=p(!1),ze=["Has intentado agregar imÃ¡genes a una variante cuando ya existe otra variante principal con imÃ¡genes configuradas.","","ðŸ“‹ Regla del Sistema:","Solo puedes asignar imÃ¡genes a las opciones hijas de UNA variante principal. Si ya asignaste imÃ¡genes a una variante (por ejemplo, Color), no podrÃ¡s agregar imÃ¡genes a otra variante (por ejemplo, Equipo).","","ðŸ’¡ CÃ³mo funciona:","Cuando un cliente seleccione una opciÃ³n de la variante que tiene imÃ¡genes, se mostrarÃ¡ la imagen de esa opciÃ³n especÃ­fica en la galerÃ­a. Si no selecciona ninguna opciÃ³n o selecciona una opciÃ³n sin imagen, se mostrarÃ¡n las imÃ¡genes regulares del producto.","","ðŸ’¡ Sugerencia:","Si necesitas diferentes imÃ¡genes segÃºn mÃºltiples caracterÃ­sticas, considera crear productos separados o usar una sola variante que combine ambas caracterÃ­sticas."];T(()=>c.value,()=>{K.value||setTimeout(()=>{Ue.value&&!B.value&&(B.value=!0,K.value=!0)},1e3)},{deep:!0}),T(()=>n.track_inventory,s=>{s&&(n.retail_price=n.price)}),T(()=>n.price,s=>{n.track_inventory&&(n.retail_price=s)});const He=p([{name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}}]),de=s=>String(s||"").split(",").map(e=>e.trim()).filter(Boolean);function De(s,e,r){return(s.rulesSelected&&Array.isArray(s.rulesSelected[e])?s.rulesSelected[e]:[]).includes(r)}function Le(s,e,r,a){const o=!!a?.target?.checked;s.rulesSelected||(s.rulesSelected={});const l=Array.isArray(s.rulesSelected[e])?[...s.rulesSelected[e]]:[],m=l.indexOf(r);o&&m===-1&&l.push(r),!o&&m!==-1&&l.splice(m,1),s.rulesSelected[e]=l}const Re=A(()=>n.variants.length===0?Number(n.quantity)||0:n.variants.reduce((s,e)=>s+(Number(e.stock)||0),0));T(Re,s=>{n.variants.length>0&&(n.quantity=s)});const Fe=()=>{if(G.value){q.value=["DebÃ©s seleccionar una subcategorÃ­a. La categorÃ­a principal tiene subcategorÃ­as disponibles y es obligatorio elegir una de ellas."],E.value=!0,ae(()=>{const e=document.querySelector(".space-y-3 select");e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus())});return}n.variant_options=Oe();const s=Te();if(s.length>0)n.variant_attributes=s.map(e=>({name:e.name,values:e.values,dependsOn:e.dependsOn||"",rulesSelected:e.rulesSelected||{},rules:e.rules||{}}));else try{const e=He.value.map(r=>({name:String(r.name||"").trim(),values:de(r.valuesText),dependsOn:String(r.dependsOn||"").trim(),rules:r.rules||{},rulesSelected:r.rulesSelected||{}})).filter(r=>r.name&&r.values.length>0);if(n.variant_attributes=e,e.length>0){let l=function(f){o.has(f.name)||(f.dependsOn&&r[f.dependsOn]&&l(r[f.dependsOn]),o.add(f.name),a.push(f))},g=function(f,S){if(f===a.length){m.push({...S});return}const V=a[f];let ue=V.values;if(V.dependsOn){const D=S[V.dependsOn];if(D!=null){const te=V.rulesSelected?.[D]??V.rules?.[D]??[],me=Array.isArray(te)?te:de(te);me.length>0&&(ue=V.values.filter(Ge=>me.includes(Ge)))}}for(const D of ue)S[V.name]=D,g(f+1,S);delete S[V.name]};const r=Object.fromEntries(e.map(f=>[f.name,f])),a=[],o=new Set;e.forEach(l);const m=[];g(0,{}),n.variants=m.map(f=>({options_text:a.map(S=>`${S.name}:${f[S.name]}`).join(", "),price:"",purchase_price:null,stock:0,alert:null}))}}catch{n.variant_attributes=[]}n.transform(e=>(c.value.forEach((r,a)=>{r.children&&r.children.length>0&&r.children.forEach((o,l)=>{if(o.image instanceof File){const m=`variant_option_${a}_${l}`;e[m]=o.image}})}),e)),n.post(route("admin.products.store"),{preserveScroll:!0,onError:async()=>{await ae();const e=[];for(const[o,l]of Object.entries(n.errors))o.startsWith("gallery_files.")&&String(l).includes("The gallery files.")?e.push("Una o mÃ¡s imÃ¡genes superan el tamaÃ±o mÃ¡ximo permitido (2 MB) o no son vÃ¡lidas."):o.startsWith("new_gallery_files.")?e.push("Una o mÃ¡s imÃ¡genes nuevas superan el tamaÃ±o mÃ¡ximo permitido (2 MB) o no son vÃ¡lidas."):e.push(String(l));q.value=e,E.value=e.length>0;const r=Object.keys(n.errors)[0],a=document.getElementById(r);a&&typeof a.scrollIntoView=="function"&&(a.scrollIntoView({behavior:"smooth",block:"center"}),a.focus?.())},onSuccess:()=>{L.value=!0,n.reset()}})},We=s=>{s.target.tagName!=="TEXTAREA"&&s.preventDefault()};return(s,e)=>{const r=Ye("InfoTip");return u(),d(P,null,[b(i(Je),{title:"Crear Producto"}),b(et,null,{header:U(()=>[ot]),default:U(()=>[t("div",rt,[t("div",nt,[t("div",lt,[t("div",it,[t("form",{onSubmit:se(Fe,["prevent"]),onKeydown:pe(We,["enter"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[t("div",null,[t("div",ct,[dt,h(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=a=>i(n).name=a),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,i(n).name]])]),t("div",ut,[mt,t("div",pt,[h(t("input",{id:"barcode","onUpdate:modelValue":e[1]||(e[1]=a=>i(n).barcode=a),type:"text",class:y(["flex-1 block mt-1 rounded-md shadow-sm border-gray-300",{"bg-gray-100 cursor-not-allowed":Q.value}]),placeholder:"Ej: 1234567890123",disabled:Q.value,title:Q.value?"Deshabilitado porque hay variantes con cÃ³digo de barras propio":""},null,10,gt),[[_,i(n).barcode]]),t("button",{type:"button",onClick:ne,class:"px-4 py-2 mt-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2 whitespace-nowrap",title:"Escanear cÃ³digo de barras"},[vt,$(" Escanear ")])])]),t("div",ht,[ft,h(t("input",{id:"price","onUpdate:modelValue":e[2]||(e[2]=a=>i(n).price=a),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,i(n).price]])]),t("div",_t,[t("label",bt,[h(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>i(n).track_inventory=a),class:"rounded"},null,512),[[Ze,i(n).track_inventory]]),yt]),i(n).track_inventory?(u(),d("h4",wt,"Inventario y Precios")):v("",!0),i(n).track_inventory?(u(),d("p",xt," Si creas variantes, estos totales se calcularÃ¡n solos. ")):v("",!0),i(n).track_inventory?(u(),d("div",kt,[t("div",null,[t("label",Ct,[$("Inventario (Total) "),b(r,{class:"ml-1 md:hidden",text:"Stock si no hay variantes. Con variantes, se suma automÃ¡ticamente."})]),h(t("input",{id:"quantity","onUpdate:modelValue":e[4]||(e[4]=a=>i(n).quantity=a),type:"number",class:y(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":k.value||i(n).variants.length>0}]),disabled:!i(n).track_inventory||k.value||i(n).variants.length>0,required:i(n).track_inventory&&!k.value,title:"Stock si no hay variantes. Con variantes, se suma automÃ¡ticamente."},null,10,St),[[_,i(n).quantity]]),i(n).errors.quantity?(u(),d("p",Vt,C(i(n).errors.quantity),1)):v("",!0)]),t("div",null,[t("label",Pt,[$("Alerta (Opcional) "),b(r,{class:"ml-1 md:hidden",text:"Se considera bajo stock cuando cantidad â‰¤ alerta."})]),h(t("input",{id:"alert","onUpdate:modelValue":e[5]||(e[5]=a=>i(n).alert=a),type:"number",class:y(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":(k.value||i(n).variants.length>0)&&i(n).track_inventory}]),disabled:(k.value||i(n).variants.length>0)&&i(n).track_inventory,title:"Se considera bajo stock cuando cantidad â‰¤ alerta."},null,10,Et),[[_,i(n).alert]])]),t("div",null,[t("label",Mt,[$("Precio de compra "),b(r,{class:"ml-1 md:hidden",text:"Costo de adquisiciÃ³n del producto."})]),h(t("input",{id:"purchase_price","onUpdate:modelValue":e[6]||(e[6]=a=>i(n).purchase_price=a),type:"number",step:"0.01",class:y(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":(k.value||i(n).variants.length>0)&&i(n).track_inventory}]),disabled:(k.value||i(n).variants.length>0)&&i(n).track_inventory},null,10,At),[[_,i(n).purchase_price]])])])):v("",!0)]),t("div",$t,[jt,G.value?(u(),d("p",Bt," âš ï¸ Es obligatorio seleccionar una subcategorÃ­a ")):v("",!0)]),t("div",Ot,[(u(!0),d(P,null,j(w.value,(a,o)=>(u(),d("div",{key:o,class:"mb-1"},[h(t("select",{class:y(["block w-full rounded-md shadow-sm border-gray-300",{"border-red-500":G.value&&o===w.value.length-1&&!a.selected}]),"onUpdate:modelValue":l=>a.selected=l,onChange:l=>Ce(o),required:o===w.value.length-1&&a.options.length>0},[Ut,(u(!0),d(P,null,j(a.options,l=>(u(),d("option",{key:l.id,value:l.id},C(l.name),9,qt))),128))],42,Tt),[[ge,a.selected]])]))),128))]),i(n).errors.category_id?(u(),d("p",Nt,C(i(n).errors.category_id),1)):v("",!0),G.value&&!i(n).errors.category_id?(u(),d("p",zt," DebÃ©s seleccionar una subcategorÃ­a. La categorÃ­a principal tiene subcategorÃ­as disponibles. ")):v("",!0)]),t("div",null,[t("div",Ht,[Dt,h(t("textarea",{id:"short_description","onUpdate:modelValue":e[7]||(e[7]=a=>i(n).short_description=a),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[_,i(n).short_description]])]),t("div",Lt,[Rt,h(t("textarea",{id:"long_description","onUpdate:modelValue":e[8]||(e[8]=a=>i(n).long_description=a),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[_,i(n).long_description]])]),t("div",Ft,[Wt,h(t("input",{id:"specifications","onUpdate:modelValue":e[9]||(e[9]=a=>i(n).specifications=a),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"Alto: 2.30m,Ancho: 1.20m,..."},null,512),[[_,i(n).specifications]])]),t("div",Gt,[Qt,h(t("input",{id:"meta_keywords","onUpdate:modelValue":e[10]||(e[10]=a=>i(n).meta_keywords=a),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"palabra1, palabra2, palabra3"},null,512),[[_,i(n).meta_keywords]]),Kt])]),t("div",Xt,[t("div",Yt,[t("div",Jt,[t("div",Zt,[It,t("div",es,[t("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Expandir todo",onClick:e[11]||(e[11]=()=>{c.value.forEach((a,o)=>x.value[o]=!0)})}," + "),t("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Colapsar todo",onClick:e[12]||(e[12]=()=>{c.value.forEach((a,o)=>x.value[o]=!1)})}," âˆ’ ")])]),t("div",ts,[c.value.length===0?(u(),d("p",ss," AÃºn no hay variantes principales. AgregÃ¡ una usando el botÃ³n de abajo. ")):v("",!0),(u(!0),d(P,null,j(c.value,(a,o)=>(u(),d("div",{key:`parent-${o}`,class:"p-3 hover:bg-gray-50"},[t("div",as,[t("div",os,[t("div",rs,[t("button",{type:"button",class:"w-6 h-6 flex-shrink-0 inline-flex items-center justify-center rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100",title:x.value[o]??!1?"Colapsar opciones":"Expandir opciones",onClick:l=>Ve(o)},[x.value[o]??!1?(u(),d("span",is,"v")):(u(),d("span",ls,">"))],8,ns),h(t("input",{"onUpdate:modelValue":l=>a.name=l,type:"text",placeholder:"Ej: Color, Talla, Material",class:"flex-1 min-w-0 font-medium border-0 bg-transparent focus:bg-white focus:border focus:border-gray-300 rounded px-2 py-1 focus:outline-none"},null,8,cs),[[_,a.name]]),a.children&&a.children.length>0?(u(),d("span",ds," ("+C(a.children.length)+") ",1)):v("",!0)])]),t("div",us,[t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded border border-green-500 text-green-600 hover:bg-green-50",title:"AÃ±adir opciÃ³n",onClick:l=>Ae(o)},gs,8,ms),t("button",{type:"button",onClick:l=>Me(o),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},fs,8,vs)])]),a.__showDependency?(u(),d("div",_s,[t("div",bs,[t("div",ys,[ws,h(t("select",{"onUpdate:modelValue":l=>a.dependsOn=l,class:"block w-full text-sm border-gray-300 rounded-md shadow-sm"},[ks,(u(!0),d(P,null,j(c.value,(l,m)=>(u(),d("option",{key:`dep-${o}-${m}`,value:l.name,disabled:l===a||!l.name},C(l.name||"(sin nombre)"),9,Cs))),128))],8,xs),[[ge,a.dependsOn]])]),a.dependsOn?(u(),d("div",Ss,[Vs,t("div",Ps,[(u(!0),d(P,null,j((c.value.find(l=>l.name===a.dependsOn)?.children||[]).map(l=>l.name),l=>(u(),d("div",{key:`pv-${o}-${l}`,class:"border rounded p-2 bg-white"},[t("div",Es,[$(C(a.dependsOn)+" = ",1),t("strong",null,C(l),1)]),t("div",Ms,[(u(!0),d(P,null,j((a.children||[]).map(m=>m.name),m=>(u(),d("label",{key:`cv-${o}-${l}-${m}`,class:"inline-flex items-center gap-1 text-xs"},[t("input",{type:"checkbox",checked:De(a,l,m),onChange:g=>Le(a,l,m,g),class:"rounded"},null,40,As),t("span",null,C(m),1)]))),128))])]))),128))])])):v("",!0)])])):v("",!0),x.value[o]??!1?(u(),d("div",$s,[(u(!0),d(P,null,j(a.children,(l,m)=>(u(),d("div",{key:`child-${o}-${m}`,class:"py-2 flex justify-between items-start"},[t("div",js,[t("div",null,[Bs,h(t("input",{"onUpdate:modelValue":g=>l.name=g,type:"text",placeholder:"Ej: Rojo, Verde",class:"block w-full text-sm border-gray-300 rounded-md shadow-sm"},null,8,Os),[[_,l.name]])]),t("div",null,[Ts,h(t("input",{"onUpdate:modelValue":g=>l.price=g,type:"number",step:"0.01",placeholder:"Usa precio principal",class:y(["block w-full text-sm border-gray-300 rounded-md shadow-sm",{"bg-gray-100 cursor-not-allowed":!X(o)}]),disabled:!X(o),onInput:g=>Ne(o,m,g)},null,42,Us),[[_,l.price]]),X(o)?v("",!0):(u(),d("p",qs," Solo puedes agregar precios a una variante principal "))]),t("div",Ns,[t("input",{type:"file",accept:"image/*",onChange:g=>je(o,m,g),class:"hidden",id:`variant-image-input-${o}-${m}`,disabled:!O(o)},null,40,zs),l.imagePreview?(u(),d("div",Hs,[t("img",{src:l.imagePreview,alt:"Preview",class:"w-10 h-10 object-cover rounded border"},null,8,Ds),t("button",{type:"button",onClick:se(g=>Be(o,m),["stop"]),class:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs hover:bg-red-600"}," Ã— ",8,Ls)])):(u(),d("label",{key:1,for:`variant-image-input-${o}-${m}`,class:y(["inline-flex items-center justify-center w-10 h-10 border-2 border-dashed border-gray-300 rounded hover:border-blue-400 hover:bg-blue-50 transition",{"cursor-pointer":O(o),"cursor-not-allowed opacity-50":!O(o)}]),title:O(o)?"Agregar foto":"Solo puedes agregar imÃ¡genes a una variante principal"},Ws,10,Rs)),O(o)?v("",!0):(u(),d("p",Gs," Solo puedes agregar imÃ¡genes a una variante principal "))]),t("div",null,[Qs,t("div",Ks,[h(t("input",{"onUpdate:modelValue":g=>l.barcode=g,type:"text",placeholder:"Ej: 770...",class:y(["block w-full text-sm border-gray-300 rounded-md shadow-sm",{"bg-gray-100 cursor-not-allowed":!H(o)}]),disabled:!H(o)},null,10,Xs),[[_,l.barcode]]),t("button",{type:"button",onClick:g=>we(o,m),class:y(["p-2 bg-blue-100 text-blue-600 rounded hover:bg-blue-200",{"opacity-50 cursor-not-allowed":!H(o)}]),title:"Escanear",disabled:!H(o)},Zs,10,Ys),i(n).track_inventory?(u(),d("button",{key:0,type:"button",onClick:g=>Pe(l,o,m),class:y(["p-2 bg-purple-100 text-purple-600 rounded hover:bg-purple-200",{"opacity-50 cursor-not-allowed":!ee(o)}]),title:"Inventario",disabled:!ee(o)},ta,10,Is)):v("",!0)]),H(o)?v("",!0):(u(),d("p",sa," Solo una variante principal puede tener cÃ³digos ")),i(n).track_inventory&&!ee(o)?(u(),d("p",aa," Solo una variante principal puede tener inventario ")):v("",!0)])])]))),128)),t("div",oa,[t("button",{type:"button",onClick:l=>$e(o,s.childIndex),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},la,8,ra)])])):v("",!0)]))),128))])]),c.value.length<1?(u(),d("form",{key:0,onSubmit:se(ie,["prevent"]),class:"mt-6 border-t pt-4"},[ia,t("div",ca,[h(t("input",{type:"text","onUpdate:modelValue":e[13]||(e[13]=a=>z.value=a),class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Nombre de la nueva variante principal",onKeyup:pe(ie,["enter"])},null,544),[[_,z.value]]),da,t("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:e[14]||(e[14]=a=>z.value=""),title:"Cancelar"}," âœ– ")])],32)):v("",!0)])]),t("div",ua,[ma,pa,t("div",ga,[va,t("input",{id:"gallery_files",onInput:e[15]||(e[15]=a=>xe(a)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),ha])]),t("div",fa,[t("button",{type:"submit",disabled:i(n).processing,class:"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow"},wa,8,_a),Object.keys(i(n).errors).length?(u(),d("span",xa,"Por favor corrige los campos marcados.")):v("",!0)])],32)])])])])]),_:1}),b(J,{show:L.value,type:"success",title:"Â¡Producto creado con Ã©xito!","primary-text":"Entendido",onPrimary:e[16]||(e[16]=a=>L.value=!1),onClose:e[17]||(e[17]=a=>L.value=!1)},null,8,["show"]),b(J,{show:E.value,type:"error",title:"No pudimos guardar el producto",message:"RevisÃ¡ los siguientes puntos:",messages:q.value,"primary-text":"Entendido",onPrimary:e[18]||(e[18]=a=>E.value=!1),onClose:e[19]||(e[19]=a=>E.value=!1)},null,8,["show","messages"]),b(J,{show:B.value,type:"warning",title:"Solo una Variante Puede Tener Precios",messages:qe,"primary-text":"Entendido",onPrimary:e[20]||(e[20]=a=>B.value=!1),onClose:e[21]||(e[21]=a=>B.value=!1)},null,8,["show"]),b(J,{show:Y.value,type:"warning",title:"Solo una Variante Puede Tener ImÃ¡genes",messages:ze,"primary-text":"Entendido",onPrimary:e[22]||(e[22]=a=>Y.value=!1),onClose:e[23]||(e[23]=a=>Y.value=!1)},null,8,["show"]),b(ve,{show:N.value,onClose:W},{default:U(()=>[t("div",ka,[Ca,Sa,t("div",Va,[b(st,{onClick:W},{default:U(()=>[$("Cerrar")]),_:1})])])]),_:1},8,["show"]),b(ve,{show:R.value,onClose:e[25]||(e[25]=a=>R.value=!1)},{default:U(()=>[t("div",Pa,[Ea,t("div",Ma,[Aa,t("p",$a,C(oe.value),1)]),t("div",ja,[b(tt,{onClick:e[24]||(e[24]=a=>R.value=!1)},{default:U(()=>[$("Aceptar")]),_:1})])])]),_:1},8,["show"]),b(at,{show:Z.value,"variant-name":I.value?.name,"initial-data":I.value,onClose:e[26]||(e[26]=a=>Z.value=!1),onSave:Ee},null,8,["show","variant-name","initial-data"])],64)}}};export{Ha as default};
