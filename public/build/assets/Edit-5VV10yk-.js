import{q as J,r,C as ae,a as n,o as l,b as C,u,h as ne,d as N,e,p as K,g as j,v as A,f as v,F as T,j as Y,t as x,i as Z,k as q}from"./app-CdEBBWGl.js";import{_ as le}from"./AuthenticatedLayout-PmA-gZnP.js";import{_ as re}from"./Modal-gcK9qcMR.js";import{_ as ie}from"./AlertModal-BlmVJJtF.js";import{_ as de}from"./SecondaryButton-DpPNSbPE.js";import{D as ce}from"./DangerButton-B6vWHv1A.js";function R(p,i={},w="/"){try{if(typeof route=="function")return route(p,i)}catch{}let d=String(w);return Object.entries(i||{}).forEach(([$,D])=>{d=d.replace(new RegExp(`:${$}\\b|{${$}}`,"g"),String(D))}),d}const ue={class:"font-semibold text-xl text-gray-800 leading-tight"},ve={class:"py-12"},ge={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},me={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ye={class:"p-6 text-gray-900"},he=e("h3",{class:"text-lg font-medium"},"Editar Nombre",-1),_e=["disabled"],be={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},fe={class:"p-6 text-gray-900"},xe={class:"flex items-center justify-between"},pe=e("h3",{class:"text-lg font-medium"},"Gestionar Subcategorías",-1),we={class:"flex items-center gap-2"},ke={class:"mt-4 border rounded-lg divide-y"},Ce={key:0,class:"text-sm text-gray-500"},je={key:1,class:"text-sm text-gray-500"},Ae={class:"flex justify-between items-center"},$e={class:"flex-1"},Ee={key:0,class:"flex items-center gap-2"},Se=["title","onClick"],Ve={key:0},Be={key:1},Ne={class:"font-medium"},Me={key:0,class:"text-xs bg-gray-100 text-gray-700 rounded px-2 py-0.5 align-middle"},Ue={key:1,class:"flex items-center gap-2"},Le=["onUpdate:modelValue"],Re=["onClick"],De=["onClick"],Pe={class:"flex items-center gap-2"},ze=["onClick"],Fe=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M16.862 3.487a2.25 2.25 0 113.182 3.182L9.428 17.284a3.75 3.75 0 01-1.582.992l-2.685.805a.75.75 0 01-.93-.93l.805-2.685a3.75 3.75 0 01.992-1.582L16.862 3.487z"}),e("path",{d:"M15.75 4.5l3.75 3.75"})],-1),He=[Fe],Te=["onClick"],qe=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("rect",{x:"4",y:"3",width:"11",height:"15",rx:"2",ry:"2","stroke-width":"1.5"}),e("circle",{cx:"18",cy:"18",r:"3","stroke-width":"1.5"}),e("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M18 16.5v3M16.5 18h3"})],-1),Ge=[qe],Oe=["onClick"],Xe=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),Qe=[Xe],We={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2"},Je=e("label",{class:"block text-xs text-gray-600 mb-1"},"Añadir Nueva Subcategoría",-1),Ke={class:"flex items-center gap-2"},Ye=["onUpdate:modelValue"],Ze=["disabled","onClick"],Ie=["onClick"],et={key:0,class:"text-xs text-red-600 mt-1"},tt={key:1,class:"mt-2 pl-4 border-l"},st={key:0,class:"text-sm text-gray-500"},ot={class:"flex-1"},at={key:0},nt={key:1,class:"flex items-center gap-2"},lt=["onUpdate:modelValue"],rt=["onClick"],it=["onClick"],dt={class:"flex items-center gap-2"},ct=["onClick"],ut=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M16.862 3.487a2.25 2.25 0 113.182 3.182L9.428 17.284a3.75 3.75 0 01-1.582.992l-2.685.805a.75.75 0 01-.93-.93l.805-2.685a3.75 3.75 0 01.992-1.582L16.862 3.487z"}),e("path",{d:"M15.75 4.5l3.75 3.75"})],-1),vt=[ut],gt=["onClick"],mt=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),yt=[mt],ht={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2 w-full"},_t=e("label",{class:"block text-xs text-gray-600 mb-1"},"Nombre del subnivel",-1),bt={class:"flex items-center gap-2"},ft=["onUpdate:modelValue"],xt=["disabled","onClick"],pt={key:0,class:"text-xs text-red-600 mt-1"},wt=e("label",{class:"block font-medium text-sm text-gray-700"},"Añadir Nueva Subcategoría",-1),kt={class:"mt-2 flex items-center gap-2"},Ct=["disabled"],jt={key:0,class:"text-sm text-red-600 mt-2"},At={class:"p-6"},$t=e("h2",{class:"text-lg font-medium text-gray-900"}," ¿Querés eliminar esta subcategoría? ",-1),Et=e("p",{class:"mt-1 text-sm text-gray-600"}," Esta acción es irreversible y removerá la subcategoría seleccionada. ",-1),St={class:"mt-6 flex justify-end"},Rt={__name:"Edit",props:{category:Object},setup(p){const i=p,w=J({name:i.category.name}),d=J({name:""}),$=()=>{w.put(route("admin.categories.update",{category:i.category.id}))},D=()=>{const t=R("admin.categories.storeSubcategory",{parentCategory:i.category.id},`/admin/categories/${i.category.id}/subcategories`);d.post(t,{onSuccess:()=>{d.reset(),g()},preserveScroll:!0})},I=()=>{d.name=""},P=r(!1),E=r(null),M=()=>{P.value=!1,E.value=null},ee=()=>{E.value&&q.delete(route("admin.categories.destroy",{category:E.value}),{preserveScroll:!0,onSuccess:()=>{const t=E.value;M();const o=H.value;t&&(delete c.value[t],delete k.value[t],delete m.value[t],delete y.value[t],delete B.value[t]),o&&o!==i.category.id?f(o):g(),g()},onError:t=>{const o=H.value;o&&o!==i.category.id?f(o):g(),W.value=t&&(t.delete||t.message)||"Existen productos asociados a esta categoría y no se puede borrar.",L.value=!0},onFinish:()=>M()})},z=r(!1),_=r(i.category.children||[]),g=async()=>{try{z.value=!0;const t=R("admin.categories.children",{category:i.category.id},`/admin/categories/${i.category.id}/children`),o=await fetch(t);if(!o.ok)return;const s=await o.json();_.value=Array.isArray(s.data)?s.data:[]}finally{z.value=!1}};ae(()=>{g()});const k=r({}),m=r({}),S=r({}),y=r({}),te=t=>{k.value[t]=!k.value[t]},G=t=>{const o=(m.value[t]||"").trim();if(!o)return;S.value[t]=!0,y.value[t]=null;const s=R("admin.categories.storeSubcategory",{parentCategory:t},`/admin/categories/${t}/subcategories`);q.post(s,{name:o},{preserveScroll:!0,onSuccess:()=>{m.value[t]="",S.value[t]=!1,c.value[t]=!0,f(t),g()},onError:()=>{S.value[t]=!1,y.value[t]="No se pudo crear el subnivel"}})},se=t=>{m.value[t]="",y.value[t]=null,k.value[t]=!1},U=r({}),b=r({}),O=t=>{U.value[t.id]=!0,b.value[t.id]=t.name},V=t=>{U.value[t]=!1,b.value[t]=""},X=(t,o=null)=>{const s=(b.value[t]||"").trim();if(!s)return;const a=route("admin.categories.update",{category:t});if(window.axios){window.axios.post(a,{name:s,_method:"PUT"},{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(()=>{V(t),o&&o!==i.category.id?f(o):g()}).catch(()=>V(t));return}q.put(a,{name:s},{preserveScroll:!0,onSuccess:()=>{V(t),o&&o!==i.category.id?f(o):g()}})},c=r({}),F=r({}),B=r({}),f=async t=>{F.value[t]=!0;try{const o=R("admin.categories.children",{category:t},`/admin/categories/${t}/children`),s=await fetch(o);if(!s.ok)return;const a=await s.json();B.value[t]=Array.isArray(a.data)?a.data:[]}finally{F.value[t]=!1}},oe=async t=>{const o=!c.value[t];c.value[t]=o,o&&!Array.isArray(B.value[t])&&await f(t)},H=r(null),Q=(t,o=null)=>{E.value=t,H.value=o,P.value=!0},L=r(!1),W=r("");return(t,o)=>(l(),n(T,null,[C(u(ne),{title:`Editar: ${p.category.name}`},null,8,["title"]),C(le,null,{header:N(()=>[e("h2",ue," Editando Categoría: "+x(p.category.name),1)]),default:N(()=>[e("div",ve,[e("div",ge,[e("div",me,[e("div",ye,[he,e("form",{onSubmit:K($,["prevent"]),class:"mt-4 flex items-center gap-4"},[j(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>u(w).name=s),type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,512),[[A,u(w).name]]),e("button",{type:"submit",disabled:u(w).processing,class:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700"}," Actualizar ",8,_e)],32)])]),e("div",be,[e("div",fe,[e("div",xe,[pe,e("div",we,[e("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Expandir todo",onClick:o[1]||(o[1]=()=>{_.value.forEach(s=>c.value[s.id]=!0),_.value.forEach(s=>{Array.isArray(B.value[s.id])||f(s.id)})})},"+ "),e("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Colapsar todo",onClick:o[2]||(o[2]=()=>{_.value.forEach(s=>c.value[s.id]=!1)})},"− ")])]),e("div",ke,[z.value?(l(),n("p",Ce,"Cargando subcategorías…")):!_.value||_.value.length===0?(l(),n("p",je," Esta categoría aún no tiene subcategorías. ")):v("",!0),(l(!0),n(T,null,Y(_.value,s=>(l(),n("div",{key:s.id,class:"p-3 hover:bg-gray-50"},[e("div",Ae,[e("div",$e,[U.value[s.id]?(l(),n("div",Ue,[j(e("input",{"onUpdate:modelValue":a=>b.value[s.id]=a,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,8,Le),[[A,b.value[s.id]]]),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-blue-500 text-white hover:bg-blue-600",title:"Guardar",onClick:a=>X(s.id,p.category.id)},"✔",8,Re),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100",title:"Cancelar",onClick:a=>V(s.id)},"✖",8,De)])):(l(),n("div",Ee,[e("button",{type:"button",class:"w-6 h-6 inline-flex items-center justify-center rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100",title:c.value[s.id]?"Colapsar subniveles":"Expandir subniveles",onClick:a=>oe(s.id)},[c.value[s.id]?(l(),n("span",Be,"v")):(l(),n("span",Ve,">"))],8,Se),e("span",Ne,x(s.name),1),typeof s.children_count<"u"?(l(),n("span",Me,"("+x(s.children_count)+")",1)):v("",!0)]))]),e("div",Pe,[e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:"Renombrar",onClick:a=>O(s)},He,8,ze),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded border border-green-500 text-green-600 hover:bg-green-50",title:"Añadir subnivel",onClick:a=>te(s.id)},Ge,8,Te),e("button",{onClick:a=>Q(s.id),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},Qe,8,Oe)])]),k.value[s.id]?(l(),n("div",We,[Je,e("div",Ke,[j(e("input",{"onUpdate:modelValue":a=>m.value[s.id]=a,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Ej: Baños"},null,8,Ye),[[A,m.value[s.id]]]),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",disabled:S.value[s.id],onClick:a=>G(s.id)},"✔",8,Ze),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:a=>se(s.id)},"✖",8,Ie)]),y.value[s.id]?(l(),n("p",et,x(y.value[s.id]),1)):v("",!0)])):v("",!0),c.value[s.id]?(l(),n("div",tt,[F.value[s.id]?(l(),n("p",st,"Cargando…")):v("",!0),(l(!0),n(T,null,Y(B.value[s.id]||[],a=>(l(),n("div",{key:a.id,class:"py-1 flex justify-between items-center"},[e("div",ot,[U.value[a.id]?(l(),n("div",nt,[j(e("input",{"onUpdate:modelValue":h=>b.value[a.id]=h,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300"},null,8,lt),[[A,b.value[a.id]]]),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-blue-500 text-white hover:bg-blue-600",title:"Guardar",onClick:h=>X(a.id,s.id)},"✔",8,rt),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100",title:"Cancelar",onClick:h=>V(a.id)},"✖",8,it)])):(l(),n("div",at,x(a.name),1))]),e("div",dt,[e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:"Renombrar",onClick:h=>O(a)},vt,8,ct),e("button",{onClick:h=>Q(a.id,s.id),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},yt,8,gt)]),k.value[a.id]?(l(),n("div",ht,[_t,e("div",bt,[j(e("input",{"onUpdate:modelValue":h=>m.value[a.id]=h,type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Ej: Accesorios"},null,8,ft),[[A,m.value[a.id]]]),e("button",{type:"button",class:"bg-green-500 text-white font-bold py-1 px-3 rounded hover:bg-green-600",disabled:S.value[a.id],onClick:h=>G(a.id)},"Añadir",8,xt)]),y.value[a.id]?(l(),n("p",pt,x(y.value[a.id]),1)):v("",!0)])):v("",!0)]))),128))])):v("",!0)]))),128))]),e("form",{onSubmit:K(D,["prevent"]),class:"mt-6 border-t pt-4"},[wt,e("div",kt,[j(e("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>u(d).name=s),type:"text",class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Nombre de la nueva subcategoría"},null,512),[[A,u(d).name]]),e("button",{type:"submit",disabled:u(d).processing,class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",title:"Añadir"},"✔",8,Ct),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:I,title:"Cancelar"},"✖")]),u(d).errors.name?(l(),n("p",jt,x(u(d).errors.name),1)):v("",!0)],32)])])])])]),_:1}),C(re,{show:P.value,onClose:M},{default:N(()=>[e("div",At,[$t,Et,e("div",St,[C(de,{onClick:M},{default:N(()=>[Z("Cancelar")]),_:1}),C(ce,{class:"ms-3",onClick:ee},{default:N(()=>[Z("Sí, eliminar")]),_:1})])])]),_:1},8,["show"]),C(ie,{show:L.value,type:"error",title:"No se puede eliminar",messages:[W.value],"primary-text":"Entendido",onPrimary:o[4]||(o[4]=s=>L.value=!1),onClose:o[5]||(o[5]=s=>L.value=!1)},null,8,["show","messages"])],64))}};export{Rt as default};
