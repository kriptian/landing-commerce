import{L as N,r as f,p as O,c as w,w as B,a,o as i,b as v,u as l,h as F,d as V,e as t,s as T,f as c,g as m,v as u,M as D,n as _,t as p,F as x,i as h,x as G,k as L}from"./app-Mfh2j4V1.js";import{_ as R}from"./AuthenticatedLayout-BU8UzRRX.js";import{_ as U}from"./AlertModal-CmPnyBWU.js";import"./Modal-CMAqVAiJ.js";const W={class:"py-12"},z={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Q={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},X={class:"p-6 text-gray-900"},Y={class:"mb-4"},H={class:"mb-4"},J={class:"p-4 border rounded-md bg-gray-50"},K={class:"inline-flex items-center gap-2 mb-3 select-none"},Z={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ee=["disabled"],te={key:0,class:"mt-1 text-sm text-red-600"},se={key:1,class:"text-xs text-gray-500 mt-1"},oe=["disabled"],le={key:0,class:"mt-1 text-sm text-red-600"},re={key:1,class:"text-xs text-gray-500 mt-1"},ne=["disabled"],ae={class:"space-y-3"},ie=["onUpdate:modelValue","onChange"],de=["value"],me={key:0,class:"mt-1 text-sm text-red-600"},ue={class:"mb-4"},ce={class:"mb-4"},pe={class:"mb-4"},ge={class:"mb-4"},be={class:"md:col-span-2 mt-6 border-t pt-6"},ye={class:"hidden md:grid grid-cols-6 gap-4 mb-2 text-sm font-medium text-gray-600"},fe={key:0},ve={key:1},xe={key:2},ke={class:"md:col-span-2"},_e=["onUpdate:modelValue"],he=["onUpdate:modelValue"],we={key:0},Ve=["onUpdate:modelValue"],Ue={key:0,class:"mt-1 text-sm text-red-600"},Ce={key:1},Se=["onUpdate:modelValue"],Ae={key:0,class:"mt-1 text-sm text-red-600"},Me={key:2},Pe=["onUpdate:modelValue"],$e=["onClick"],je={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},qe=["disabled"],Ee={key:0,class:"ml-3 text-sm text-red-600"},Ie=2*1024*1024,De={__name:"Create",props:{categories:Array},setup(C){const S=C,A=N(),b=f(!!A?.props?.flash?.success),g=f(!1),k=f([]),M=n=>{const e=Array.from(n?.target?.files||[]),o=[],d=[];for(const r of e){if(!(r?.type||"").startsWith("image/")){o.push(`${r.name}: no es una imagen válida.`);continue}if(r.size>Ie){o.push(`${r.name}: supera el límite de 2 MB.`);continue}d.push(r)}if(o.length){k.value=["Problemas con las imágenes seleccionadas:",...o],g.value=!0,n?.target&&(n.target.value=""),s.gallery_files=[];return}s.gallery_files=d},y=f([{options:S.categories,selected:null}]),P=n=>{y.value.splice(n+1)},$=async n=>{const e=y.value[n].selected;if(P(n),s.category_id=e,!e)return;const o=await fetch(route("admin.categories.children",e));if(!o.ok)return;const d=await o.json(),r=Array.isArray(d.data)?d.data:[];r.length>0&&y.value.push({options:r,selected:null})},s=O({name:"",price:"",track_inventory:!0,quantity:0,minimum_stock:0,alert:null,category_id:null,short_description:"",long_description:"",specifications:"",gallery_files:[],variants:[]}),j=()=>{s.variants.push({options_text:"",price:"",stock:0,minimum_stock:1,alert:null})},q=n=>{s.variants.splice(n,1)},E=w(()=>s.variants.length===0?Number(s.quantity)||0:s.variants.reduce((n,e)=>n+(Number(e.stock)||0),0));B(E,n=>{s.variants.length>0&&(s.quantity=n)}),w(()=>s.variants.length===0?Number(s.minimum_stock)||0:s.variants.reduce((n,e)=>n+(Number(e.minimum_stock)||0),0));const I=()=>{s.post(route("admin.products.store"),{preserveScroll:!0,onError:async()=>{await L();const n=[];for(const[d,r]of Object.entries(s.errors))d.startsWith("gallery_files.")&&String(r).includes("The gallery files.")?n.push("Una o más imágenes superan el tamaño máximo permitido (2 MB) o no son válidas."):d.startsWith("new_gallery_files.")?n.push("Una o más imágenes nuevas superan el tamaño máximo permitido (2 MB) o no son válidas."):n.push(String(r));k.value=n,g.value=n.length>0;const e=Object.keys(s.errors)[0],o=document.getElementById(e);o&&typeof o.scrollIntoView=="function"&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.focus?.())},onSuccess:()=>{b.value=!0,s.reset()}})};return(n,e)=>(i(),a(x,null,[v(l(F),{title:"Crear Producto"}),v(R,null,{header:V(()=>[...e[14]||(e[14]=[t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear Nuevo Producto",-1)])]),default:V(()=>[t("div",W,[t("div",z,[t("div",Q,[t("div",X,[t("form",{onSubmit:T(I,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[t("div",null,[t("div",Y,[e[15]||(e[15]=t("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1)),m(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=o=>l(s).name=o),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[u,l(s).name]])]),t("div",H,[e[16]||(e[16]=t("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1)),m(t("input",{id:"price","onUpdate:modelValue":e[1]||(e[1]=o=>l(s).price=o),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[u,l(s).price]])]),t("div",J,[t("label",K,[m(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=o=>l(s).track_inventory=o),class:"rounded"},null,512),[[D,l(s).track_inventory]]),e[17]||(e[17]=t("span",{class:"font-semibold"},"Controlar inventario",-1))]),e[22]||(e[22]=t("h4",{class:"font-semibold text-gray-800 mb-2"},"Inventario General",-1)),e[23]||(e[23]=t("p",{class:"text-xs text-gray-500 mb-4"}," Si creas variantes, estos totales se calcularán solos. ",-1)),l(s).track_inventory&&l(s).variants.length===0?(i(),a("div",Z,[t("div",null,[e[18]||(e[18]=t("label",{for:"quantity",class:"block font-medium text-sm text-gray-700"},"Inventario (Total)",-1)),m(t("input",{id:"quantity","onUpdate:modelValue":e[3]||(e[3]=o=>l(s).quantity=o),type:"number",class:_(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":l(s).variants.length>0}]),disabled:l(s).variants.length>0},null,10,ee),[[u,l(s).quantity]]),l(s).errors.quantity?(i(),a("p",te,p(l(s).errors.quantity),1)):(i(),a("p",se,"Stock si no hay variantes."))]),t("div",null,[e[19]||(e[19]=t("label",{for:"minimum_stock",class:"block font-medium text-sm text-gray-700"},"Mínimo en Stock",-1)),m(t("input",{id:"minimum_stock","onUpdate:modelValue":e[4]||(e[4]=o=>l(s).minimum_stock=o),type:"number",class:_(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":l(s).variants.length>0}]),disabled:l(s).variants.length>0},null,10,oe),[[u,l(s).minimum_stock]]),l(s).errors.minimum_stock?(i(),a("p",le,p(l(s).errors.minimum_stock),1)):(i(),a("p",re,"Alerta de bajo stock (general)."))]),t("div",null,[e[20]||(e[20]=t("label",{for:"alert",class:"block font-medium text-sm text-gray-700"},"Alerta (Opcional)",-1)),m(t("input",{id:"alert","onUpdate:modelValue":e[5]||(e[5]=o=>l(s).alert=o),type:"number",class:_(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":l(s).variants.length>0}]),disabled:l(s).variants.length>0},null,10,ne),[[u,l(s).alert]]),e[21]||(e[21]=t("p",{class:"text-xs text-gray-500 mt-1"},"Para producto único. Con variantes, usá las alertas por variante.",-1))])])):c("",!0)]),e[25]||(e[25]=t("div",{class:"mt-4 mb-2"},[t("label",{class:"block font-medium text-sm text-gray-700"},"Categorías")],-1)),t("div",ae,[(i(!0),a(x,null,h(y.value,(o,d)=>(i(),a("div",{key:d,class:"mb-1"},[m(t("select",{class:"block w-full rounded-md shadow-sm border-gray-300","onUpdate:modelValue":r=>o.selected=r,onChange:r=>$(d)},[e[24]||(e[24]=t("option",{value:null},"Seleccione una categoría",-1)),(i(!0),a(x,null,h(o.options,r=>(i(),a("option",{key:r.id,value:r.id},p(r.name),9,de))),128))],40,ie),[[G,o.selected]])]))),128))]),l(s).errors.category_id?(i(),a("p",me,p(l(s).errors.category_id),1)):c("",!0)]),t("div",null,[t("div",ue,[e[26]||(e[26]=t("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"Descripción Corta",-1)),m(t("textarea",{id:"short_description","onUpdate:modelValue":e[6]||(e[6]=o=>l(s).short_description=o),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[u,l(s).short_description]])]),t("div",ce,[e[27]||(e[27]=t("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"Descripción Larga",-1)),m(t("textarea",{id:"long_description","onUpdate:modelValue":e[7]||(e[7]=o=>l(s).long_description=o),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[u,l(s).long_description]])]),t("div",pe,[e[28]||(e[28]=t("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1)),m(t("input",{id:"specifications","onUpdate:modelValue":e[8]||(e[8]=o=>l(s).specifications=o),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"Alto: 2.30m,Ancho: 1.20m,..."},null,512),[[u,l(s).specifications]])]),t("div",ge,[e[29]||(e[29]=t("label",{for:"gallery_files",class:"block font-medium text-sm text-gray-700"},"Imágenes de la Galería",-1)),t("input",{id:"gallery_files",onInput:e[9]||(e[9]=o=>M(o)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),e[30]||(e[30]=t("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1))])]),t("div",be,[e[38]||(e[38]=t("h3",{class:"text-lg font-medium text-gray-900"},"Variantes del Producto",-1)),e[39]||(e[39]=t("p",{class:"text-sm text-gray-600 mb-4"}," Añadí cada combinación como una variante separada. ",-1)),t("div",ye,[e[31]||(e[31]=t("div",{class:"col-span-2"},"Opciones (ej: Color:Rojo)",-1)),e[32]||(e[32]=t("div",null,"Precio (Opcional)",-1)),l(s).track_inventory?(i(),a("div",fe,"Stock Actual")):c("",!0),l(s).track_inventory?(i(),a("div",ve,"Stock Mínimo")):c("",!0),l(s).track_inventory?(i(),a("div",xe,"Alerta (Opcional)")):c("",!0)]),(i(!0),a(x,null,h(l(s).variants,(o,d)=>(i(),a("div",{key:d,class:"grid grid-cols-1 md:grid-cols-6 gap-4 items-center mb-2"},[t("div",ke,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Opciones",-1)),m(t("input",{type:"text","onUpdate:modelValue":r=>o.options_text=r,placeholder:"Color:Rojo, Talla:M",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,_e),[[u,o.options_text]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Precio (Opcional)",-1)),m(t("input",{type:"number",step:"0.01","onUpdate:modelValue":r=>o.price=r,placeholder:"Usa precio principal",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,he),[[u,o.price]])]),l(s).track_inventory?(i(),a("div",we,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Actual",-1)),m(t("input",{type:"number","onUpdate:modelValue":r=>o.stock=r,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Ve),[[u,o.stock]]),l(s).errors[`variants.${d}.stock`]?(i(),a("p",Ue,p(l(s).errors[`variants.${d}.stock`]),1)):c("",!0)])):c("",!0),l(s).track_inventory?(i(),a("div",Ce,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Mínimo",-1)),m(t("input",{type:"number","onUpdate:modelValue":r=>o.minimum_stock=r,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Se),[[u,o.minimum_stock]]),l(s).errors[`variants.${d}.minimum_stock`]?(i(),a("p",Ae,p(l(s).errors[`variants.${d}.minimum_stock`]),1)):c("",!0)])):c("",!0),l(s).track_inventory?(i(),a("div",Me,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Alerta (Opcional)",-1)),m(t("input",{type:"number","onUpdate:modelValue":r=>o.alert=r,placeholder:"Ej: 5",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Pe),[[u,o.alert]])])):c("",!0),t("button",{onClick:r=>q(d),type:"button",class:"text-red-600 hover:text-red-800 text-sm self-end pb-2 md:pb-0"}," Quitar ",8,$e)]))),128)),t("button",{onClick:j,type:"button",class:"mt-4 text-sm font-medium text-blue-600 hover:text-blue-800"}," + Añadir Variante ")]),t("div",je,[t("button",{type:"submit",disabled:l(s).processing,class:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700"}," Guardar Producto ",8,qe),Object.keys(l(s).errors).length?(i(),a("span",Ee,"Por favor corrige los campos marcados.")):c("",!0)])],32)])])])])]),_:1}),v(U,{show:b.value,type:"success",title:"¡Producto creado con éxito!","primary-text":"Entendido",onPrimary:e[10]||(e[10]=o=>b.value=!1),onClose:e[11]||(e[11]=o=>b.value=!1)},null,8,["show"]),v(U,{show:g.value,type:"error",title:"No pudimos guardar el producto",message:"Revisá los siguientes puntos:",messages:k.value,"primary-text":"Entendido",onPrimary:e[12]||(e[12]=o=>g.value=!1),onClose:e[13]||(e[13]=o=>g.value=!1)},null,8,["show","messages"])],64))}};export{De as default};
