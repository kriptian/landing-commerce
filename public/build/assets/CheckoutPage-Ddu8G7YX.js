import{y as ae,o as n,e as O,f as e,t as a,b as w,d as g,l as B,m as _,r as v,B as J,a as i,i as b,c as m,u as ne,h as ue,g as ie,j as N,n as S,s as x,q as h,x as ce,F as z,p as T}from"./app-BR1AjQaP.js";import{_ as de}from"./AlertModal-CVPhww26.js";import{_ as me}from"./Modal-hVHoEWeb.js";const ge={class:"p-6 text-center"},ve=e("div",{class:"mb-4 mx-auto w-12 h-12 flex items-center justify-center bg-blue-100 rounded-full text-blue-600"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})])],-1),be=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"}," Iniciar Sesión Requerido ",-1),fe={class:"text-sm text-gray-600 mb-6"},pe={class:"flex flex-col gap-3"},xe={__name:"AuthRequiredModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Debes iniciar sesión para realizar esta acción."},store:{type:Object,required:!1}},emits:["close"],setup(u,{emit:r}){const l=r;return(k,f)=>(n(),ae(me,{show:u.show,onClose:f[1]||(f[1]=I=>l("close")),maxWidth:"sm"},{default:O(()=>[e("div",ge,[ve,be,e("p",fe,a(u.message),1),e("div",pe,[w(g(B),{href:k.route("customer.login",{store:u.store?.slug||u.store?.id}),class:"w-full inline-flex justify-center items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 focus:bg-blue-700 active:bg-blue-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150"},{default:O(()=>[_(" Iniciar Sesión ")]),_:1},8,["href"]),w(g(B),{href:k.route("customer.register",{store:u.store?.slug||u.store?.id}),class:"w-full inline-flex justify-center items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150"},{default:O(()=>[_(" Registrarse ")]),_:1},8,["href"]),e("button",{onClick:f[0]||(f[0]=I=>l("close")),class:"mt-2 text-xs text-gray-500 hover:text-gray-700 underline"}," Cancelar ")])])]),_:1},8,["show"]))}},_e={key:0,class:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-50 p-4 md:p-6 transition-transform duration-300 ease-in-out transform"},ye=e("div",{class:"text-sm text-gray-600 flex-1"},[e("p",null,[e("span",{class:"font-semibold text-gray-800"},"Este sitio usa cookies"),_(" para mejorar tu experiencia de navegación. Al continuar navegando, aceptas nuestra política de privacidad y el uso de tecnologías de rastreo. ")])],-1),he={__name:"CookieConsent",setup(u){const r=v(!1),l=()=>{localStorage.setItem("cookie_consent","accepted"),r.value=!1},k=()=>{localStorage.setItem("cookie_consent","rejected"),r.value=!1};return J(()=>{localStorage.getItem("cookie_consent")||(r.value=!0)}),(f,I)=>r.value?(n(),i("div",_e,[e("div",{class:"max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4"},[ye,e("div",{class:"flex items-center gap-3 shrink-0 w-full sm:w-auto"},[e("button",{onClick:k,class:"flex-1 sm:flex-none justify-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"}," Rechazar "),e("button",{onClick:l,class:"flex-1 sm:flex-none justify-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"}," Aceptar ")])])])):b("",!0)}},we=["href"],ke={class:"bg-white shadow-sm sticky top-0 z-40"},Ce={class:"container mx-auto px-6 py-4 flex items-center gap-3"},Fe=["src","alt"],je={class:"text-lg font-medium text-gray-600"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12"},De=e("h1",{class:"text-xl sm:text-2xl font-medium text-gray-600 mb-6"},"Datos de Envío",-1),Ne={key:0,class:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},Oe={class:"text-sm text-blue-800 mb-2"},Ie=e("label",{for:"customer_name",class:"block font-medium text-sm text-gray-700 mb-2"},"Nombre Completo",-1),Pe=e("label",{for:"customer_phone",class:"block font-medium text-sm text-gray-700 mb-2"},"Teléfono (WhatsApp)",-1),Se=e("label",{for:"customer_email",class:"block font-medium text-sm text-gray-700 mb-2"},"Correo Electrónico",-1),Ae={key:0},Ee=e("label",{class:"block font-medium text-sm text-gray-700 mb-2"},"Dirección de Envío",-1),Me=e("option",{value:null},"Seleccionar dirección guardada",-1),qe=["value"],ze={for:"customer_address",class:"block font-medium text-sm text-gray-700 mb-2"},Be=["disabled"],Ue=["disabled"],Ve={class:"bg-white/95 backdrop-blur-sm p-8 lg:p-10 rounded-2xl shadow-2xl border border-gray-100 sticky top-24 transform transition-all hover:shadow-3xl"},Re=e("h2",{class:"text-xl sm:text-2xl font-medium text-gray-600 mb-6"},"Resumen de tu Pedido",-1),Te={class:"space-y-4"},Le={class:"flex items-start gap-3 flex-1 min-w-0"},We=["src"],Qe={class:"min-w-0"},Ge={class:"font-semibold text-gray-900 break-words"},He={key:0,class:"text-sm text-gray-500 break-words mt-1"},Ye={class:"text-sm text-gray-600 mt-1"},Je={class:"font-semibold text-gray-900 whitespace-nowrap shrink-0 sm:text-right mt-2 sm:mt-0"},Ke={class:"border-t border-gray-200 pt-6"},Xe=e("label",{class:"block font-medium text-sm text-gray-700 mb-2"},"Código de Cupón (Opcional)",-1),Ze={class:"flex gap-2"},et=["disabled"],tt=["disabled"],ot={key:0,class:"mt-2 text-sm text-red-600"},st={key:1,class:"mt-2 text-sm text-green-600"},rt={class:"border-t border-gray-200 mt-6 pt-6 space-y-3"},lt={class:"flex justify-between items-center"},at=e("span",{class:"text-lg font-medium text-gray-600"},"Subtotal",-1),nt={class:"text-lg font-semibold text-gray-900"},ut={key:0,class:"flex justify-between items-center text-green-600"},it=e("span",{class:"text-lg font-medium"},"Descuento",-1),ct={class:"text-lg font-semibold"},dt={key:1,class:"flex justify-between items-center text-gray-800"},mt=e("span",{class:"text-lg font-medium"},"Costo de envío",-1),gt={class:"text-lg font-semibold"},vt={class:"flex justify-between items-center border-t border-gray-200 pt-3"},bt=e("span",{class:"text-xl font-bold text-gray-900"},"Total",-1),ft={class:"text-2xl font-bold text-gray-900"},yt={__name:"CheckoutPage",props:{cartItems:Array,store:Object,customer:Object,addresses:Array},setup(u){const r=u,l=m(()=>r.store?.catalog_use_default??!0),k=m(()=>l.value?null:r.store?.catalog_body_bg_color||"#FFFFFF"),f=m(()=>l.value?null:r.store?.catalog_body_text_color||"#1F2937"),I=m(()=>l.value?null:r.store?.catalog_input_bg_color||"#FFFFFF"),L=m(()=>l.value?null:r.store?.catalog_input_text_color||"#1F2937"),W=m(()=>l.value?null:r.store?.catalog_button_bg_color||"#2563EB"),Q=m(()=>l.value?null:r.store?.catalog_button_text_color||"#FFFFFF"),K=m(()=>l.value?{}:!k.value||!f.value?{}:{backgroundColor:k.value,color:f.value}),D=m(()=>l.value?{}:!I.value||!L.value?{}:{backgroundColor:I.value,color:L.value}),A=m(()=>l.value?{}:!W.value||!Q.value?{}:{backgroundColor:W.value,color:Q.value}),X=s=>{const t=s?.variant||null,o=s?.product||null;if(t&&o){const q=t.price!=null&&t.price!==""?Number(t.price):null;if(q!==null)return q}return o&&o.price!=null?Number(o.price):0},Z=s=>{try{return r.store?.promo_active&&Number(r.store?.promo_discount_percent||0)>0?Number(r.store.promo_discount_percent):s?.product?.promo_active&&Number(s?.product?.promo_discount_percent||0)>0?Number(s.product.promo_discount_percent):0}catch{return 0}},G=s=>{const t=X(s),o=Z(s);return o>0?Math.round(t*(100-o)/100):t},E=m(()=>r.cartItems.reduce((s,t)=>s+G(t)*t.quantity,0)),C=v(""),c=v(null),y=v(""),P=v(!1),U=v(!1),V=m(()=>{if(!c.value)return 0;if(c.value.type==="percentage"){const s=E.value*c.value.value/100;return c.value.max_discount?Math.min(s,c.value.max_discount):s}else return Math.min(c.value.value,E.value)}),R=m(()=>r.store?.delivery_cost_active&&Number(r.store?.delivery_cost)>0?Number(r.store.delivery_cost):0),ee=m(()=>Math.max(0,E.value-V.value)+R.value),te=async()=>{if(!C.value.trim()){y.value="Ingresa un código de cupón";return}P.value=!0,y.value="";try{const s=await window.axios.post(route("checkout.validate-coupon",{store:r.store.slug}),{code:C.value.trim()});s.data.valid?(c.value=s.data.coupon,y.value=""):s.data.code==="LOGIN_REQUIRED"?(U.value=!0,c.value=null):(y.value=s.data.message||"Cupón inválido",c.value=null)}catch(s){y.value=s.response?.data?.message||"Error al validar el cupón",c.value=null}finally{P.value=!1}},oe=()=>{C.value="",c.value=null,y.value=""},F=v(null),j=v(!1);v("");const p=m(()=>r.customer||null),$=m(()=>r.addresses||[]),se=()=>{if(p.value){d.customer_name=p.value.name||"",d.customer_phone=p.value.phone||"",d.customer_email=p.value.email||"";const s=$.value.find(t=>t.is_default);s&&(F.value=s.id,d.customer_address=s.full_address||`${s.address_line_1}, ${s.city}`)}};J(()=>{se()});const re=s=>{if(s){const t=$.value.find(o=>o.id===s);t&&(d.customer_address=t.full_address||`${t.address_line_1}, ${t.city}`,j.value=!1)}},d=ne({customer_name:"",customer_phone:"",customer_email:"",customer_address:"",address_id:null,coupon_code:null}),M=v(!1),H=v(""),le=()=>{d.address_id=F.value,d.coupon_code=c.value?C.value:null,d.post(route("checkout.store",{store:r.store.slug}),{onSuccess:()=>{},onError:s=>{H.value="Hubo un error al procesar tu pedido. Por favor verificá tus datos.",M.value=!0}})};return(s,t)=>(n(),i(z,null,[w(g(ue),{title:"Finalizar Compra"},{default:O(()=>[u.store?.logo_url?(n(),i("link",{key:0,rel:"icon",type:"image/png",href:u.store.logo_url},null,8,we)):b("",!0)]),_:1}),e("header",ke,[e("nav",Ce,[u.store?.logo_url?(n(),i("img",{key:0,src:u.store.logo_url,alt:`Logo de ${u.store.name}`,class:"h-10 w-10 rounded-full object-cover ring-2 ring-gray-100"},null,8,Fe)):b("",!0),e("h1",je,a(u.store.name),1)])]),e("main",{class:"container mx-auto px-6 py-12 min-h-screen",style:x(K.value)},[e("div",$e,[e("div",null,[De,p.value?b("",!0):(n(),i("div",Ne,[e("p",Oe,[_(" ¿Ya tienes cuenta? "),w(g(B),{href:s.route("customer.login",{store:u.store.slug}),class:"font-semibold underline"},{default:O(()=>[_("Inicia sesión")]),_:1},8,["href"]),_(" para prellenar tus datos o "),w(g(B),{href:s.route("customer.register",{store:u.store.slug}),class:"font-semibold underline"},{default:O(()=>[_("regístrate")]),_:1},8,["href"]),_(" para guardar tus direcciones. ")])])),e("form",{onSubmit:ie(le,["prevent"]),class:"space-y-6 bg-white p-8 lg:p-10 shadow-2xl rounded-2xl border border-gray-100 backdrop-blur-sm transform transition-all hover:shadow-3xl"},[e("div",null,[Ie,N(e("input",{id:"customer_name","onUpdate:modelValue":t[0]||(t[0]=o=>g(d).customer_name=o),type:"text",class:h(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",l.value?"bg-gray-50 hover:bg-white":""]),style:x(D.value),required:""},null,6),[[S,g(d).customer_name]])]),e("div",null,[Pe,N(e("input",{id:"customer_phone","onUpdate:modelValue":t[1]||(t[1]=o=>g(d).customer_phone=o),type:"tel",class:h(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",l.value?"bg-gray-50 hover:bg-white":""]),style:x(D.value),required:""},null,6),[[S,g(d).customer_phone]])]),e("div",null,[Se,N(e("input",{id:"customer_email","onUpdate:modelValue":t[2]||(t[2]=o=>g(d).customer_email=o),type:"email",class:h(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",l.value?"bg-gray-50 hover:bg-white":""]),style:x(D.value),required:""},null,6),[[S,g(d).customer_email]])]),p.value&&$.value.length>0?(n(),i("div",Ae,[Ee,N(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>F.value=o),onChange:t[4]||(t[4]=o=>re(F.value)),class:h(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4 mb-3",l.value?"bg-gray-50 hover:bg-white":""]),style:x(D.value)},[Me,(n(!0),i(z,null,T($.value,o=>(n(),i("option",{key:o.id,value:o.id},a(o.label)+" - "+a(o.address_line_1)+", "+a(o.city),9,qe))),128))],38),[[ce,F.value]]),e("button",{type:"button",onClick:t[5]||(t[5]=o=>j.value=!j.value),class:"text-sm text-blue-600 hover:text-blue-700 font-medium"},a(j.value?"Usar dirección guardada":"Usar dirección diferente"),1)])):b("",!0),e("div",null,[e("label",ze,a(p.value&&$.value.length>0&&!j.value?"Dirección (seleccionada arriba)":"Dirección Completa (con ciudad y detalles)"),1),N(e("textarea",{id:"customer_address","onUpdate:modelValue":t[6]||(t[6]=o=>g(d).customer_address=o),disabled:p.value&&$.value.length>0&&!j.value&&F.value,class:h(["block w-full rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4 resize-none",[l.value?"bg-gray-50 hover:bg-white":"",p.value&&$.value.length>0&&!j.value&&F.value?"bg-gray-100 cursor-not-allowed":""]]),style:x(D.value),rows:"3",required:""},null,14,Be),[[S,g(d).customer_address]])]),e("button",{type:"submit",disabled:g(d).processing,class:h(["w-full font-bold py-4 px-6 rounded-xl text-center disabled:opacity-50 transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-lg hover:shadow-xl",l.value?"bg-green-600 text-white hover:bg-green-700":""]),style:x(!l.value&&A.value?A.value:{})},a(g(d).processing?"Procesando...":"Realizar Pedido por WhatsApp"),15,Ue)],32)]),e("div",Ve,[Re,e("div",Te,[(n(!0),i(z,null,T(u.cartItems,o=>(n(),i("div",{key:o.id,class:"flex flex-col sm:flex-row sm:items-start sm:justify-between sm:gap-4 p-3 rounded-lg hover:bg-gray-50 transition-colors"},[e("div",Le,[e("img",{src:o.product.main_image_url,class:"w-16 h-16 object-cover rounded-lg shadow-sm ring-1 ring-gray-200"},null,8,We),e("div",Qe,[e("p",Ge,a(o.product.name),1),o.variant?(n(),i("div",He,[(n(!0),i(z,null,T(o.variant.options,(q,Y)=>(n(),i("span",{key:Y,class:"mr-2 inline-block"},[e("strong",null,a(Y)+":",1),_(" "+a(q),1)]))),128))])):b("",!0),e("p",Ye,"Cantidad: "+a(o.quantity),1)])]),e("p",Je,a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(G(o)*o.quantity)),1)]))),128))]),e("div",Ke,[Xe,e("div",Ze,[N(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>C.value=o),type:"text",placeholder:"Ingresa el código",disabled:P.value||!!c.value,class:h(["flex-1 block rounded-xl shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all py-3 px-4",l.value?"bg-gray-50 hover:bg-white":""]),style:x(D.value)},null,14,et),[[S,C.value]]),c.value?(n(),i("button",{key:1,type:"button",onClick:oe,class:"px-6 py-3 rounded-xl font-medium bg-red-600 text-white hover:bg-red-700 transition-all"}," Quitar ")):(n(),i("button",{key:0,type:"button",onClick:te,disabled:P.value||!C.value.trim(),class:h(["px-6 py-3 rounded-xl font-medium transition-all disabled:opacity-50",l.value?"bg-blue-600 text-white hover:bg-blue-700":""]),style:x(!l.value&&A.value?A.value:{})},a(P.value?"...":"Aplicar"),15,tt))]),y.value?(n(),i("p",ot,a(y.value),1)):b("",!0),c.value?(n(),i("p",st," ✓ Cupón aplicado: "+a(c.value.type==="percentage"?c.value.value+"%":"$"+c.value.value)+" de descuento ",1)):b("",!0)]),e("div",rt,[e("div",lt,[at,e("span",nt,a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(E.value)),1)]),V.value>0?(n(),i("div",ut,[it,e("span",ct,"-"+a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(V.value)),1)])):b("",!0),R.value>0?(n(),i("div",dt,[mt,e("span",gt,a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(R.value)),1)])):b("",!0),e("div",vt,[bt,e("span",ft,a(new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(ee.value)),1)])])])])],4),w(he),w(de,{show:M.value,type:"error",title:"No pudimos procesar tu pedido",message:H.value,"primary-text":"Entendido",onPrimary:t[8]||(t[8]=o=>M.value=!1),onClose:t[9]||(t[9]=o=>M.value=!1)},null,8,["show","message"]),w(xe,{show:U.value,store:u.store,onClose:t[10]||(t[10]=o=>U.value=!1)},null,8,["show","store"])],64))}};export{yt as default};
