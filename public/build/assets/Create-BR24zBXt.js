import{K as j,r as f,c as _,w as S,p as B,a as r,o as n,b as v,u as l,h as F,d as C,e,s as T,f as c,g as d,v as m,L as G,n as w,t as p,F as x,i as h,x as P,k as D}from"./app-DdN1dnwv.js";import{_ as L}from"./AuthenticatedLayout-0XqtQlBh.js";import{_ as M}from"./AlertModal-CWL83k3D.js";import"./DropdownLink-DQGx_2Xf.js";import"./Modal-uE4VJq8H.js";const R={class:"py-12"},W={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},z={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Q={class:"p-6 text-gray-900"},K={class:"mb-4"},X={class:"mb-4"},Y={class:"p-4 border rounded-md bg-gray-50"},H={class:"inline-flex items-center gap-2 mb-3 select-none"},J={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Z=["disabled"],tt={key:0,class:"mt-1 text-sm text-red-600"},et={key:1,class:"text-xs text-gray-500 mt-1"},st=["disabled"],ot={key:0,class:"mt-1 text-sm text-red-600"},lt={key:1,class:"text-xs text-gray-500 mt-1"},rt=["disabled"],nt={class:"mt-4 mb-4"},at=["value"],it={key:0,class:"mb-4"},dt=["value"],mt={key:0,class:"mt-1 text-sm text-red-600"},ut={class:"mb-4"},ct={class:"mb-4"},pt={class:"mb-4"},gt={class:"mb-4"},bt={class:"md:col-span-2 mt-6 border-t pt-6"},yt={class:"hidden md:grid grid-cols-6 gap-4 mb-2 text-sm font-medium text-gray-600"},ft={key:0},vt={key:1},xt={key:2},kt={class:"md:col-span-2"},_t=["onUpdate:modelValue"],wt=["onUpdate:modelValue"],ht={key:0},Vt=["onUpdate:modelValue"],Ut={key:0,class:"mt-1 text-sm text-red-600"},St={key:1},Ct=["onUpdate:modelValue"],Pt={key:0,class:"mt-1 text-sm text-red-600"},Mt={key:2},At=["onUpdate:modelValue"],$t=["onClick"],qt={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},It=["disabled"],Et={key:0,class:"ml-3 text-sm text-red-600"},Nt=2*1024*1024,Dt={__name:"Create",props:{categories:Array},setup(V){const A=V,$=j(),y=f(!!$?.props?.flash?.success),g=f(!1),k=f([]),q=a=>{const t=Array.from(a?.target?.files||[]),o=[],u=[];for(const i of t){if(!(i?.type||"").startsWith("image/")){o.push(`${i.name}: no es una imagen válida.`);continue}if(i.size>Nt){o.push(`${i.name}: supera el límite de 2 MB.`);continue}u.push(i)}if(o.length){k.value=["Problemas con las imágenes seleccionadas:",...o],g.value=!0,a?.target&&(a.target.value=""),s.gallery_files=[];return}s.gallery_files=u},b=f(null),U=_(()=>{if(!b.value)return[];const a=A.categories.find(t=>t.id===b.value);return a?a.children:[]});S(b,()=>{s.category_id=null});const s=B({name:"",price:"",track_inventory:!0,quantity:0,minimum_stock:0,alert:null,category_id:null,short_description:"",long_description:"",specifications:"",gallery_files:[],variants:[]}),I=()=>{s.variants.push({options_text:"",price:"",stock:0,minimum_stock:1,alert:null})},E=a=>{s.variants.splice(a,1)},N=_(()=>s.variants.length===0?Number(s.quantity)||0:s.variants.reduce((a,t)=>a+(Number(t.stock)||0),0));S(N,a=>{s.variants.length>0&&(s.quantity=a)}),_(()=>s.variants.length===0?Number(s.minimum_stock)||0:s.variants.reduce((a,t)=>a+(Number(t.minimum_stock)||0),0));const O=()=>{s.post(route("admin.products.store"),{preserveScroll:!0,onError:async()=>{await D();const a=[];for(const[u,i]of Object.entries(s.errors))u.startsWith("gallery_files.")&&String(i).includes("The gallery files.")?a.push("Una o más imágenes superan el tamaño máximo permitido (2 MB) o no son válidas."):u.startsWith("new_gallery_files.")?a.push("Una o más imágenes nuevas superan el tamaño máximo permitido (2 MB) o no son válidas."):a.push(String(i));k.value=a,g.value=a.length>0;const t=Object.keys(s.errors)[0],o=document.getElementById(t);o&&typeof o.scrollIntoView=="function"&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.focus?.())},onSuccess:()=>{y.value=!0,s.reset()}})};return(a,t)=>(n(),r(x,null,[v(l(F),{title:"Crear Producto"}),v(L,null,{header:C(()=>[...t[16]||(t[16]=[e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear Nuevo Producto",-1)])]),default:C(()=>[e("div",R,[e("div",W,[e("div",z,[e("div",Q,[e("form",{onSubmit:T(O,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,[e("div",K,[t[17]||(t[17]=e("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1)),d(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=o=>l(s).name=o),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[m,l(s).name]])]),e("div",X,[t[18]||(t[18]=e("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1)),d(e("input",{id:"price","onUpdate:modelValue":t[1]||(t[1]=o=>l(s).price=o),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[m,l(s).price]])]),e("div",Y,[e("label",H,[d(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=o=>l(s).track_inventory=o),class:"rounded"},null,512),[[G,l(s).track_inventory]]),t[19]||(t[19]=e("span",{class:"font-semibold"},"Controlar inventario",-1))]),t[24]||(t[24]=e("h4",{class:"font-semibold text-gray-800 mb-2"},"Inventario General",-1)),t[25]||(t[25]=e("p",{class:"text-xs text-gray-500 mb-4"}," Si creas variantes, estos totales se calcularán solos. ",-1)),l(s).track_inventory&&l(s).variants.length===0?(n(),r("div",J,[e("div",null,[t[20]||(t[20]=e("label",{for:"quantity",class:"block font-medium text-sm text-gray-700"},"Inventario (Total)",-1)),d(e("input",{id:"quantity","onUpdate:modelValue":t[3]||(t[3]=o=>l(s).quantity=o),type:"number",class:w(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":l(s).variants.length>0}]),disabled:l(s).variants.length>0},null,10,Z),[[m,l(s).quantity]]),l(s).errors.quantity?(n(),r("p",tt,p(l(s).errors.quantity),1)):(n(),r("p",et,"Stock si no hay variantes."))]),e("div",null,[t[21]||(t[21]=e("label",{for:"minimum_stock",class:"block font-medium text-sm text-gray-700"},"Mínimo en Stock",-1)),d(e("input",{id:"minimum_stock","onUpdate:modelValue":t[4]||(t[4]=o=>l(s).minimum_stock=o),type:"number",class:w(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":l(s).variants.length>0}]),disabled:l(s).variants.length>0},null,10,st),[[m,l(s).minimum_stock]]),l(s).errors.minimum_stock?(n(),r("p",ot,p(l(s).errors.minimum_stock),1)):(n(),r("p",lt,"Alerta de bajo stock (general)."))]),e("div",null,[t[22]||(t[22]=e("label",{for:"alert",class:"block font-medium text-sm text-gray-700"},"Alerta (Opcional)",-1)),d(e("input",{id:"alert","onUpdate:modelValue":t[5]||(t[5]=o=>l(s).alert=o),type:"number",class:w(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":l(s).variants.length>0}]),disabled:l(s).variants.length>0},null,10,rt),[[m,l(s).alert]]),t[23]||(t[23]=e("p",{class:"text-xs text-gray-500 mt-1"},"Para producto único. Con variantes, usá las alertas por variante.",-1))])])):c("",!0)]),e("div",nt,[t[27]||(t[27]=e("label",{for:"parent_category",class:"block font-medium text-sm text-gray-700"},"Categoría Principal",-1)),d(e("select",{id:"parent_category","onUpdate:modelValue":t[6]||(t[6]=o=>b.value=o),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},[t[26]||(t[26]=e("option",{value:null},"Seleccione una categoría",-1)),(n(!0),r(x,null,h(V.categories,o=>(n(),r("option",{key:o.id,value:o.id},p(o.name),9,at))),128))],512),[[P,b.value]])]),U.value.length>0?(n(),r("div",it,[t[29]||(t[29]=e("label",{for:"category_id",class:"block font-medium text-sm text-gray-700"},"Subcategoría",-1)),d(e("select",{id:"category_id","onUpdate:modelValue":t[7]||(t[7]=o=>l(s).category_id=o),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},[t[28]||(t[28]=e("option",{value:null},"Seleccione una subcategoría",-1)),(n(!0),r(x,null,h(U.value,o=>(n(),r("option",{key:o.id,value:o.id},p(o.name),9,dt))),128))],512),[[P,l(s).category_id]]),l(s).errors.category_id?(n(),r("p",mt,p(l(s).errors.category_id),1)):c("",!0)])):c("",!0)]),e("div",null,[e("div",ut,[t[30]||(t[30]=e("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"Descripción Corta",-1)),d(e("textarea",{id:"short_description","onUpdate:modelValue":t[8]||(t[8]=o=>l(s).short_description=o),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[m,l(s).short_description]])]),e("div",ct,[t[31]||(t[31]=e("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"Descripción Larga",-1)),d(e("textarea",{id:"long_description","onUpdate:modelValue":t[9]||(t[9]=o=>l(s).long_description=o),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[m,l(s).long_description]])]),e("div",pt,[t[32]||(t[32]=e("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1)),d(e("input",{id:"specifications","onUpdate:modelValue":t[10]||(t[10]=o=>l(s).specifications=o),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"Alto: 2.30m,Ancho: 1.20m,..."},null,512),[[m,l(s).specifications]])]),e("div",gt,[t[33]||(t[33]=e("label",{for:"gallery_files",class:"block font-medium text-sm text-gray-700"},"Imágenes de la Galería",-1)),e("input",{id:"gallery_files",onInput:t[11]||(t[11]=o=>q(o)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),t[34]||(t[34]=e("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1))])]),e("div",bt,[t[42]||(t[42]=e("h3",{class:"text-lg font-medium text-gray-900"},"Variantes del Producto",-1)),t[43]||(t[43]=e("p",{class:"text-sm text-gray-600 mb-4"}," Añadí cada combinación como una variante separada. ",-1)),e("div",yt,[t[35]||(t[35]=e("div",{class:"col-span-2"},"Opciones (ej: Color:Rojo)",-1)),t[36]||(t[36]=e("div",null,"Precio (Opcional)",-1)),l(s).track_inventory?(n(),r("div",ft,"Stock Actual")):c("",!0),l(s).track_inventory?(n(),r("div",vt,"Stock Mínimo")):c("",!0),l(s).track_inventory?(n(),r("div",xt,"Alerta (Opcional)")):c("",!0)]),(n(!0),r(x,null,h(l(s).variants,(o,u)=>(n(),r("div",{key:u,class:"grid grid-cols-1 md:grid-cols-6 gap-4 items-center mb-2"},[e("div",kt,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Opciones",-1)),d(e("input",{type:"text","onUpdate:modelValue":i=>o.options_text=i,placeholder:"Color:Rojo, Talla:M",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,_t),[[m,o.options_text]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Precio (Opcional)",-1)),d(e("input",{type:"number",step:"0.01","onUpdate:modelValue":i=>o.price=i,placeholder:"Usa precio principal",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,wt),[[m,o.price]])]),l(s).track_inventory?(n(),r("div",ht,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Actual",-1)),d(e("input",{type:"number","onUpdate:modelValue":i=>o.stock=i,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Vt),[[m,o.stock]]),l(s).errors[`variants.${u}.stock`]?(n(),r("p",Ut,p(l(s).errors[`variants.${u}.stock`]),1)):c("",!0)])):c("",!0),l(s).track_inventory?(n(),r("div",St,[t[40]||(t[40]=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Stock Mínimo",-1)),d(e("input",{type:"number","onUpdate:modelValue":i=>o.minimum_stock=i,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Ct),[[m,o.minimum_stock]]),l(s).errors[`variants.${u}.minimum_stock`]?(n(),r("p",Pt,p(l(s).errors[`variants.${u}.minimum_stock`]),1)):c("",!0)])):c("",!0),l(s).track_inventory?(n(),r("div",Mt,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-gray-700 md:hidden"},"Alerta (Opcional)",-1)),d(e("input",{type:"number","onUpdate:modelValue":i=>o.alert=i,placeholder:"Ej: 5",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,At),[[m,o.alert]])])):c("",!0),e("button",{onClick:i=>E(u),type:"button",class:"text-red-600 hover:text-red-800 text-sm self-end pb-2 md:pb-0"}," Quitar ",8,$t)]))),128)),e("button",{onClick:I,type:"button",class:"mt-4 text-sm font-medium text-blue-600 hover:text-blue-800"}," + Añadir Variante ")]),e("div",qt,[e("button",{type:"submit",disabled:l(s).processing,class:"bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-700"}," Guardar Producto ",8,It),Object.keys(l(s).errors).length?(n(),r("span",Et,"Por favor corrige los campos marcados.")):c("",!0)])],32)])])])])]),_:1}),v(M,{show:y.value,type:"success",title:"¡Producto creado con éxito!","primary-text":"Entendido",onPrimary:t[12]||(t[12]=o=>y.value=!1),onClose:t[13]||(t[13]=o=>y.value=!1)},null,8,["show"]),v(M,{show:g.value,type:"error",title:"No pudimos guardar el producto",message:"Revisá los siguientes puntos:",messages:k.value,"primary-text":"Entendido",onPrimary:t[14]||(t[14]=o=>g.value=!1),onClose:t[15]||(t[15]=o=>g.value=!1)},null,8,["show","messages"])],64))}};export{Dt as default};
