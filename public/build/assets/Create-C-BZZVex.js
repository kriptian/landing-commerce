import{B as qe,r as p,q as De,x as Ne,c as K,u as ze,w as Q,C as Fe,a as c,o as d,b,d as i,h as He,e as X,f as e,g as Z,i as v,j as g,l as _,p as $,v as Le,n as D,t as C,F as S,k as P,D as re,E as Re,s as I}from"./app-CILm_tgf.js";import{_ as We}from"./AuthenticatedLayout-gZ2YwyfE.js";import{_ as Y}from"./AlertModal-CRYF0ska.js";import{_ as Ge}from"./Modal-XvV_QRK-.js";import{_ as Ke}from"./SecondaryButton-BYs5IT6S.js";import{u as Qe,S as Xe}from"./useSectionTour-CuwuzyEE.js";const Ye=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear producto",-1),Je={class:"py-12"},Ze={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Ie={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},et={class:"p-6 text-gray-900"},tt={class:"mb-4"},st=e("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1),at={class:"mb-4"},ot=e("label",{for:"barcode",class:"block font-medium text-sm text-gray-700 mb-1"},"CÃ³digo de Barras (Opcional)",-1),nt={class:"flex gap-2"},rt=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})],-1),lt={class:"mb-4"},it=e("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1),ct={class:"p-4 border rounded-md bg-gray-50"},dt={class:"inline-flex items-center gap-2 mb-3 select-none"},ut=e("span",{class:"font-semibold"},"Controlar inventario",-1),mt={key:0,class:"font-semibold text-gray-800 mb-2"},pt={key:1,class:"text-xs text-gray-500 mb-4"},gt={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ht={for:"quantity",class:"block font-medium text-sm text-gray-700 flex items-center"},vt=["disabled"],ft={key:0,class:"mt-1 text-sm text-red-600"},_t={for:"alert",class:"block font-medium text-sm text-gray-700 flex items-center"},bt=["disabled"],yt={for:"purchase_price",class:"block font-medium text-sm text-gray-700 flex items-center"},wt={class:"mt-4 mb-2"},xt=e("label",{class:"block font-medium text-sm text-gray-700"},"CategorÃ­as",-1),kt={key:0,class:"mt-1 text-sm text-amber-600 font-medium"},Ct={class:"space-y-3"},St=["onUpdate:modelValue","onChange","required"],Vt=e("option",{value:null},"Seleccione una categorÃ­a",-1),Pt=["value"],Et={key:0,class:"mt-1 text-sm text-red-600"},jt={key:1,class:"mt-1 text-sm text-red-600"},At={class:"mb-4"},$t=e("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"DescripciÃ³n Corta",-1),Mt={class:"mb-4"},Ot=e("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"DescripciÃ³n Larga",-1),Ut={class:"mb-4"},Bt=e("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1),Tt={class:"mb-4"},qt=e("label",{for:"meta_keywords",class:"block font-medium text-sm text-gray-700"},"Palabras Clave SEO (separadas por comas)",-1),Dt=e("p",{class:"mt-1 text-xs text-gray-500"},"Estas palabras clave ayudan a mejorar el SEO del producto. No son visibles para los clientes.",-1),Nt={class:"md:col-span-2 mt-6 border-t pt-6"},zt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ft={class:"p-6 text-gray-900"},Ht={class:"flex items-center justify-between"},Lt=e("h3",{class:"text-lg font-medium"},"Variantes del Producto",-1),Rt={class:"flex items-center gap-2"},Wt={class:"mt-4 border rounded-lg divide-y"},Gt={key:0,class:"text-sm text-gray-500 p-3"},Kt={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2"},Qt={class:"flex-1 min-w-0"},Xt={class:"flex items-center gap-2"},Yt=["title","onClick"],Jt={key:0},Zt={key:1},It=["onUpdate:modelValue"],es={key:0,class:"flex-shrink-0 text-xs bg-gray-100 text-gray-700 rounded px-2 py-0.5 align-middle"},ts={class:"flex items-center gap-2 flex-shrink-0"},ss=["title","onClick"],as=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),e("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})],-1),os=[as],ns=["onClick"],rs=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("rect",{x:"4",y:"3",width:"11",height:"15",rx:"2",ry:"2","stroke-width":"1.5"}),e("circle",{cx:"18",cy:"18",r:"3","stroke-width":"1.5"}),e("path",{"stroke-linecap":"round","stroke-width":"1.5",d:"M18 16.5v3M16.5 18h3"})],-1),ls=[rs],is=["onClick"],cs=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),ds=[cs],us={key:0,class:"mt-2 pl-2 bg-gray-50 rounded-md p-2"},ms={class:"grid grid-cols-1 md:grid-cols-5 gap-3"},ps={class:"md:col-span-2"},gs=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Depende de",-1),hs=["onUpdate:modelValue"],vs=e("option",{value:""},"(sin dependencia)",-1),fs=["value","disabled"],_s={key:0,class:"md:col-span-3"},bs=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Permitir valores segÃºn el valor del padre",-1),ys={class:"mt-2 space-y-2"},ws={class:"text-xs font-semibold text-gray-700 mb-1"},xs={class:"flex flex-wrap gap-2"},ks=["checked","onChange"],Cs={key:1,class:"mt-2 pl-4 border-l"},Ss={class:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-3"},Vs=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Nombre",-1),Ps=["onUpdate:modelValue"],Es=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Precio (opcional)",-1),js=["onUpdate:modelValue","disabled","onInput"],As={key:0,class:"mt-1 text-xs text-amber-600"},$s={class:"flex items-center gap-2"},Ms=["onChange","id","disabled"],Os={key:0,class:"relative"},Us=["src"],Bs=["onClick"],Ts=["for","title"],qs=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-5 h-5 text-gray-400",fill:"currentColor"},[e("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1),Ds=[qs],Ns={key:2,class:"mt-1 text-xs text-amber-600"},zs={class:"flex items-center gap-2 ml-2"},Fs=["onClick"],Hs=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M16.5 4.5V6h3.75a.75.75 0 010 1.5H3.75A.75.75 0 013 6h3.75V4.5A2.25 2.25 0 019 2.25h6A2.25 2.25 0 0117.25 4.5zM5.625 7.5h12.75l-.701 10.518A2.25 2.25 0 0115.43 20.25H8.57a2.25 2.25 0 01-2.244-2.232L5.625 7.5z","clip-rule":"evenodd"})],-1),Ls=[Hs],Rs=e("label",{class:"block font-medium text-sm text-gray-700"},"AÃ±adir Nueva Variante Principal",-1),Ws={class:"mt-2 flex items-center gap-2"},Gs=e("button",{type:"submit",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-green-500 text-white hover:bg-green-600",title:"AÃ±adir"}," âœ” ",-1),Ks={class:"md:col-span-2 mt-6 border-t pt-6"},Qs=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"ImÃ¡genes Extra de la GalerÃ­a",-1),Xs=e("p",{class:"text-sm text-gray-600 mb-4"}," Estas imÃ¡genes se agregarÃ¡n a la galerÃ­a general del producto. Las imÃ¡genes de las variantes se muestran cuando se selecciona esa opciÃ³n. ",-1),Ys={class:"mb-4"},Js=e("label",{for:"gallery_files",class:"block font-medium text-sm text-gray-700"},"ImÃ¡genes de la GalerÃ­a",-1),Zs=e("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1),Is={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},ea=["disabled"],ta=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M4 4a2 2 0 0 1 2-2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4zm9-1.5V7h4.5L13 2.5z"}),e("path",{d:"M8 13h8v2H8zM8 9h5v2H8z"})],-1),sa=e("span",null,"Crear",-1),aa=[ta,sa],oa={key:0,class:"ml-3 text-sm text-red-600"},na={class:"p-6"},ra=e("h2",{class:"text-lg font-semibold mb-4"},"Escanear CÃ³digo de Barras",-1),la={class:"mb-4"},ia=e("p",{class:"text-sm text-gray-600 mb-4"}," Apunta la cÃ¡mara hacia el cÃ³digo de barras. El cÃ³digo se detectarÃ¡ automÃ¡ticamente. ",-1),ca={class:"relative bg-black rounded-lg overflow-hidden",style:{"aspect-ratio":"16/9"}},da={key:0,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-75 text-white p-4"},ua=e("div",{class:"text-center"},[e("p",{class:"mb-2"},"Tu navegador no soporta escaneo automÃ¡tico."),e("p",{class:"text-sm"},"Ingresa el cÃ³digo de barras manualmente en el campo.")],-1),ma=[ua],pa={class:"flex gap-3"},le=2*1024*1024,ya={__name:"Create",props:{categories:Array},setup(ie){const ce=ie,de=qe(),N=p(!!de?.props?.flash?.success),V=p(!1),M=p([]),z=p(!1),O=p(null),F=p(null),U=p(!1),B=p(null);De(async()=>{if("BarcodeDetector"in window)try{B.value=new BarcodeDetector({formats:["ean_13","ean_8","code_128","code_39","upc_a","upc_e"]})}catch(a){console.warn("BarcodeDetector no disponible:",a)}});const ue=async()=>{try{z.value=!0,U.value=!0,await I();const a=O.value;if(!a)return;const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});F.value=t,a.srcObject=t,a.play(),B.value?ee():console.warn("BarcodeDetector no disponible. Usa el input manual.")}catch(a){console.error("Error accediendo a la cÃ¡mara:",a),alert("No se pudo acceder a la cÃ¡mara. Por favor, permite el acceso a la cÃ¡mara en la configuraciÃ³n del navegador."),z.value=!1,U.value=!1}};let H=null;const ee=async()=>{if(!B.value||!U.value)return;const a=O.value;if(!a||!a.parentNode){E();return}try{const t=await B.value.detect(a);if(t.length>0){const r=t[0].rawValue;n.barcode=r,E(),alert("CÃ³digo de barras escaneado: "+r);return}}catch(t){console.error("Error detectando cÃ³digo de barras:",t),E();return}U.value&&a&&a.parentNode&&(H=requestAnimationFrame(ee))},E=()=>{U.value=!1,H!==null&&(cancelAnimationFrame(H),H=null),F.value&&(F.value.getTracks().forEach(a=>a.stop()),F.value=null),O.value&&(O.value.srcObject=null),z.value=!1};Ne(()=>{E()});const{showTour:me,steps:pe,handleTourComplete:ge}=Qe("products-create"),he=a=>{const t=Array.from(a?.target?.files||[]),r=[],s=[];for(const o of t){if(!(o?.type||"").startsWith("image/")){r.push(`${o.name}: no es una imagen vÃ¡lida.`);continue}if(o.size>le){r.push(`${o.name}: supera el lÃ­mite de 2 MB.`);continue}s.push(o)}if(r.length){M.value=["Problemas con las imÃ¡genes seleccionadas:",...r],V.value=!0,a?.target&&(a.target.value=""),n.gallery_files=[];return}n.gallery_files=s},y=p([{options:ce.categories,selected:null}]),ve=a=>{y.value.splice(a+1)},fe=async a=>{const t=y.value[a].selected;if(ve(a),n.category_id=t,!t)return;const r=await fetch(route("admin.categories.children",t));if(!r.ok)return;const s=await r.json(),o=Array.isArray(s.data)?s.data:[];o.length>0&&(y.value.push({options:o,selected:null}),n.category_id=null)},L=K(()=>{if(y.value.length>1){const a=y.value[y.value.length-1];return a.options.length>0&&!a.selected}return!1}),n=ze({name:"",barcode:"",price:"",purchase_price:null,retail_price:null,track_inventory:!0,quantity:0,alert:null,category_id:null,short_description:"",long_description:"",specifications:"",meta_keywords:"",gallery_files:[],variant_options:[],variants:[],variant_attributes:[]}),u=p([]),T=p(""),w=p({}),_e=a=>{w.value[a]=!(w.value[a]??!1)},te=()=>{const a=T.value.trim()||"",t=u.value.length;u.value.push({id:null,name:a,children:[],order:t,dependsOn:"",rules:{},rulesSelected:{},__showDependency:!1}),w.value[t]=!0,T.value=""},be=a=>{u.value.splice(a,1)},ye=a=>{u.value[a].children||(u.value[a].children=[]),u.value[a].children.push({id:null,name:"",price:null,image:null,imagePreview:null,imagePath:null,order:u.value[a].children.length}),w.value[a]=!0},we=(a,t)=>{u.value[a].children.splice(t,1)},xe=(a,t,r)=>{const s=r?.target?.files?.[0];if(!s)return;if(!A(a)){r?.target&&(r.target.value=""),se.value||(G.value=!0,se.value=!0);return}const o=[];if((s?.type||"").startsWith("image/")||o.push(`${s.name}: no es una imagen vÃ¡lida.`),s.size>le&&o.push(`${s.name}: supera el lÃ­mite de 2 MB.`),o.length){M.value=["Problemas con la imagen de la variante:",...o],V.value=!0,r?.target&&(r.target.value=""),u.value[a].children[t].image=null,u.value[a].children[t].imagePreview=null;return}u.value[a].children[t].image=s;const m=new FileReader;m.onload=h=>{u.value[a].children[t].imagePreview=h.target.result},m.readAsDataURL(s)},ke=(a,t)=>{u.value[a].children[t].image=null,u.value[a].children[t].imagePreview=null},Ce=()=>{const a=[];return u.value.forEach((t,r)=>{if(!t.name.trim())return;const s={name:t.name.trim(),parent_id:null,price:null,image_path:null,order:r,children:[]};t.children&&t.children.length>0&&t.children.forEach((o,l)=>{o.name.trim()&&s.children.push({name:o.name.trim(),parent_id:null,price:o.price?parseFloat(o.price):null,image_file_key:o.image?`variant_option_${r}_${l}`:null,order:l})}),(s.children.length>0||s.name)&&a.push(s)}),a},Se=()=>{const a=[];return u.value.forEach(t=>{if(!t.name.trim())return;const r=(t.children||[]).map(o=>o.name.trim()).filter(Boolean);if(r.length===0)return;const s={name:t.name.trim(),values:r,valuesText:r.join(", "),dependsOn:t.dependsOn||"",rules:t.rules||{},rulesSelected:t.rulesSelected||{}};a.push(s)}),a},Ve=K(()=>u.value.filter(t=>!t.children||t.children.length===0?!1:t.children.some(r=>r.price&&r.price!==""&&r.price!=null)).length>1);K(()=>u.value.find(a=>!a.children||a.children.length===0?!1:a.children.some(t=>t.price&&t.price!==""&&t.price!=null)));const j=p(!1),R=p(!1),Pe=["Has intentado agregar precios a una variante cuando ya existe otra variante principal con precios configurados.","","ðŸ“‹ Regla del Sistema:","Solo puedes asignar precios a las opciones hijas de UNA variante principal. Si ya asignaste precios a una variante (por ejemplo, Color), no podrÃ¡s agregar precios a otra variante (por ejemplo, Equipo).","","ðŸ’¡ CÃ³mo funciona:","Cuando un cliente seleccione una opciÃ³n de la variante que tiene precios, se mostrarÃ¡ el precio de esa opciÃ³n especÃ­fica. Si no selecciona ninguna opciÃ³n o selecciona una opciÃ³n sin precio, se usarÃ¡ el precio principal del producto.","","ðŸ’¡ Sugerencia:","Si necesitas diferentes precios segÃºn mÃºltiples caracterÃ­sticas, considera crear productos separados o usar una sola variante que combine ambas caracterÃ­sticas."],W=a=>!u.value.find((r,s)=>s===a||!r.children||r.children.length===0?!1:r.children.some(o=>o.price&&o.price!==""&&o.price!=null)),A=a=>!u.value.find((r,s)=>s===a||!r.children||r.children.length===0?!1:r.children.some(o=>o.imagePreview||o.image||o.imagePath&&o.imagePath!=="")),Ee=(a,t,r)=>{const s=r?.target?.value;!s||s===""||s==null||W(a)||(r.target.value="",u.value[a].children[t].price=null,R.value||(j.value=!0,R.value=!0))},G=p(!1),se=p(!1),je=["Has intentado agregar imÃ¡genes a una variante cuando ya existe otra variante principal con imÃ¡genes configuradas.","","ðŸ“‹ Regla del Sistema:","Solo puedes asignar imÃ¡genes a las opciones hijas de UNA variante principal. Si ya asignaste imÃ¡genes a una variante (por ejemplo, Color), no podrÃ¡s agregar imÃ¡genes a otra variante (por ejemplo, Equipo).","","ðŸ’¡ CÃ³mo funciona:","Cuando un cliente seleccione una opciÃ³n de la variante que tiene imÃ¡genes, se mostrarÃ¡ la imagen de esa opciÃ³n especÃ­fica en la galerÃ­a. Si no selecciona ninguna opciÃ³n o selecciona una opciÃ³n sin imagen, se mostrarÃ¡n las imÃ¡genes regulares del producto.","","ðŸ’¡ Sugerencia:","Si necesitas diferentes imÃ¡genes segÃºn mÃºltiples caracterÃ­sticas, considera crear productos separados o usar una sola variante que combine ambas caracterÃ­sticas."];Q(()=>u.value,()=>{R.value||setTimeout(()=>{Ve.value&&!j.value&&(j.value=!0,R.value=!0)},1e3)},{deep:!0}),Q(()=>n.track_inventory,a=>{a&&(n.retail_price=n.price)}),Q(()=>n.price,a=>{n.track_inventory&&(n.retail_price=a)});const Ae=p([{name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}}]),ae=a=>String(a||"").split(",").map(t=>t.trim()).filter(Boolean);function $e(a,t,r){return(a.rulesSelected&&Array.isArray(a.rulesSelected[t])?a.rulesSelected[t]:[]).includes(r)}function Me(a,t,r,s){const o=!!s?.target?.checked;a.rulesSelected||(a.rulesSelected={});const l=Array.isArray(a.rulesSelected[t])?[...a.rulesSelected[t]]:[],m=l.indexOf(r);o&&m===-1&&l.push(r),!o&&m!==-1&&l.splice(m,1),a.rulesSelected[t]=l}function Oe(a){a.__showDependency=!a.__showDependency,a.__showDependency||(a.dependsOn="",a.rulesSelected={},a.rules={})}const Ue=K(()=>n.variants.length===0?Number(n.quantity)||0:n.variants.reduce((a,t)=>a+(Number(t.stock)||0),0));Q(Ue,a=>{n.variants.length>0&&(n.quantity=a)});const Be=()=>{if(L.value){M.value=["DebÃ©s seleccionar una subcategorÃ­a. La categorÃ­a principal tiene subcategorÃ­as disponibles y es obligatorio elegir una de ellas."],V.value=!0,I(()=>{const t=document.querySelector(".space-y-3 select");t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus())});return}n.variant_options=Ce();const a=Se();if(a.length>0)n.variant_attributes=a.map(t=>({name:t.name,values:t.values,dependsOn:t.dependsOn||"",rulesSelected:t.rulesSelected||{},rules:t.rules||{}}));else try{const t=Ae.value.map(r=>({name:String(r.name||"").trim(),values:ae(r.valuesText),dependsOn:String(r.dependsOn||"").trim(),rules:r.rules||{},rulesSelected:r.rulesSelected||{}})).filter(r=>r.name&&r.values.length>0);if(n.variant_attributes=t,t.length>0){let l=function(f){o.has(f.name)||(f.dependsOn&&r[f.dependsOn]&&l(r[f.dependsOn]),o.add(f.name),s.push(f))},h=function(f,x){if(f===s.length){m.push({...x});return}const k=s[f];let oe=k.values;if(k.dependsOn){const q=x[k.dependsOn];if(q!=null){const J=k.rulesSelected?.[q]??k.rules?.[q]??[],ne=Array.isArray(J)?J:ae(J);ne.length>0&&(oe=k.values.filter(Te=>ne.includes(Te)))}}for(const q of oe)x[k.name]=q,h(f+1,x);delete x[k.name]};const r=Object.fromEntries(t.map(f=>[f.name,f])),s=[],o=new Set;t.forEach(l);const m=[];h(0,{}),n.variants=m.map(f=>({options_text:s.map(x=>`${x.name}:${f[x.name]}`).join(", "),price:"",purchase_price:null,stock:0,alert:null}))}}catch{n.variant_attributes=[]}n.transform(t=>(u.value.forEach((r,s)=>{r.children&&r.children.length>0&&r.children.forEach((o,l)=>{if(o.image instanceof File){const m=`variant_option_${s}_${l}`;t[m]=o.image}})}),t)),console.log("ðŸ” CREATE - Enviando formulario",{hasVariantOptions:n.variant_options?.length>0,variantOptionsCount:n.variant_options?.length||0,hasVariantAttributes:n.variant_attributes?.length>0,variantAttributesCount:n.variant_attributes?.length||0,hasGalleryFiles:n.gallery_files?.length>0,formKeys:Object.keys(n.data())}),n.post(route("admin.products.store"),{preserveScroll:!0,onError:async()=>{await I();const t=[];for(const[o,l]of Object.entries(n.errors))o.startsWith("gallery_files.")&&String(l).includes("The gallery files.")?t.push("Una o mÃ¡s imÃ¡genes superan el tamaÃ±o mÃ¡ximo permitido (2 MB) o no son vÃ¡lidas."):o.startsWith("new_gallery_files.")?t.push("Una o mÃ¡s imÃ¡genes nuevas superan el tamaÃ±o mÃ¡ximo permitido (2 MB) o no son vÃ¡lidas."):t.push(String(l));M.value=t,V.value=t.length>0;const r=Object.keys(n.errors)[0],s=document.getElementById(r);s&&typeof s.scrollIntoView=="function"&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.focus?.())},onSuccess:()=>{N.value=!0,n.reset()}})};return(a,t)=>{const r=Fe("InfoTip");return d(),c(S,null,[b(i(He),{title:"Crear Producto"}),b(We,null,{header:X(()=>[Ye]),default:X(()=>[e("div",Je,[e("div",Ze,[e("div",Ie,[e("div",et,[e("form",{onSubmit:Z(Be,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,[e("div",tt,[st,g(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=s=>i(n).name=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,i(n).name]])]),e("div",at,[ot,e("div",nt,[g(e("input",{id:"barcode","onUpdate:modelValue":t[1]||(t[1]=s=>i(n).barcode=s),type:"text",class:"flex-1 block mt-1 rounded-md shadow-sm border-gray-300",placeholder:"Ej: 1234567890123"},null,512),[[_,i(n).barcode]]),e("button",{type:"button",onClick:ue,class:"px-4 py-2 mt-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2 whitespace-nowrap",title:"Escanear cÃ³digo de barras"},[rt,$(" Escanear ")])])]),e("div",lt,[it,g(e("input",{id:"price","onUpdate:modelValue":t[2]||(t[2]=s=>i(n).price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,i(n).price]])]),e("div",ct,[e("label",dt,[g(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=s=>i(n).track_inventory=s),class:"rounded"},null,512),[[Le,i(n).track_inventory]]),ut]),i(n).track_inventory?(d(),c("h4",mt,"Inventario y Precios")):v("",!0),i(n).track_inventory?(d(),c("p",pt," Si creas variantes, estos totales se calcularÃ¡n solos. ")):v("",!0),i(n).track_inventory?(d(),c("div",gt,[e("div",null,[e("label",ht,[$("Inventario (Total) "),b(r,{class:"ml-1 md:hidden",text:"Stock si no hay variantes. Con variantes, se suma automÃ¡ticamente."})]),g(e("input",{id:"quantity","onUpdate:modelValue":t[4]||(t[4]=s=>i(n).quantity=s),type:"number",class:D(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":i(n).variants.length>0}]),disabled:i(n).track_inventory===!1||i(n).variants.length>0,title:"Stock si no hay variantes. Con variantes, se suma automÃ¡ticamente."},null,10,vt),[[_,i(n).quantity]]),i(n).errors.quantity?(d(),c("p",ft,C(i(n).errors.quantity),1)):v("",!0)]),e("div",null,[e("label",_t,[$("Alerta (Opcional) "),b(r,{class:"ml-1 md:hidden",text:"Se considera bajo stock cuando cantidad â‰¤ alerta."})]),g(e("input",{id:"alert","onUpdate:modelValue":t[5]||(t[5]=s=>i(n).alert=s),type:"number",class:D(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":i(n).variants.length>0&&i(n).track_inventory}]),disabled:i(n).variants.length>0&&i(n).track_inventory,title:"Se considera bajo stock cuando cantidad â‰¤ alerta."},null,10,bt),[[_,i(n).alert]])]),e("div",null,[e("label",yt,[$("Precio de compra "),b(r,{class:"ml-1 md:hidden",text:"Costo de adquisiciÃ³n del producto."})]),g(e("input",{id:"purchase_price","onUpdate:modelValue":t[6]||(t[6]=s=>i(n).purchase_price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[_,i(n).purchase_price]])])])):v("",!0)]),e("div",wt,[xt,L.value?(d(),c("p",kt," âš ï¸ Es obligatorio seleccionar una subcategorÃ­a ")):v("",!0)]),e("div",Ct,[(d(!0),c(S,null,P(y.value,(s,o)=>(d(),c("div",{key:o,class:"mb-1"},[g(e("select",{class:D(["block w-full rounded-md shadow-sm border-gray-300",{"border-red-500":L.value&&o===y.value.length-1&&!s.selected}]),"onUpdate:modelValue":l=>s.selected=l,onChange:l=>fe(o),required:o===y.value.length-1&&s.options.length>0},[Vt,(d(!0),c(S,null,P(s.options,l=>(d(),c("option",{key:l.id,value:l.id},C(l.name),9,Pt))),128))],42,St),[[re,s.selected]])]))),128))]),i(n).errors.category_id?(d(),c("p",Et,C(i(n).errors.category_id),1)):v("",!0),L.value&&!i(n).errors.category_id?(d(),c("p",jt," DebÃ©s seleccionar una subcategorÃ­a. La categorÃ­a principal tiene subcategorÃ­as disponibles. ")):v("",!0)]),e("div",null,[e("div",At,[$t,g(e("textarea",{id:"short_description","onUpdate:modelValue":t[7]||(t[7]=s=>i(n).short_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[_,i(n).short_description]])]),e("div",Mt,[Ot,g(e("textarea",{id:"long_description","onUpdate:modelValue":t[8]||(t[8]=s=>i(n).long_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[_,i(n).long_description]])]),e("div",Ut,[Bt,g(e("input",{id:"specifications","onUpdate:modelValue":t[9]||(t[9]=s=>i(n).specifications=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"Alto: 2.30m,Ancho: 1.20m,..."},null,512),[[_,i(n).specifications]])]),e("div",Tt,[qt,g(e("input",{id:"meta_keywords","onUpdate:modelValue":t[10]||(t[10]=s=>i(n).meta_keywords=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"palabra1, palabra2, palabra3"},null,512),[[_,i(n).meta_keywords]]),Dt])]),e("div",Nt,[e("div",zt,[e("div",Ft,[e("div",Ht,[Lt,e("div",Rt,[e("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Expandir todo",onClick:t[11]||(t[11]=()=>{u.value.forEach((s,o)=>w.value[o]=!0)})}," + "),e("button",{type:"button",class:"w-7 h-7 inline-flex items-center justify-center rounded border border-gray-300 hover:bg-gray-100 text-gray-700",title:"Colapsar todo",onClick:t[12]||(t[12]=()=>{u.value.forEach((s,o)=>w.value[o]=!1)})}," âˆ’ ")])]),e("div",Wt,[u.value.length===0?(d(),c("p",Gt," AÃºn no hay variantes principales. AgregÃ¡ una usando el botÃ³n de abajo. ")):v("",!0),(d(!0),c(S,null,P(u.value,(s,o)=>(d(),c("div",{key:`parent-${o}`,class:"p-3 hover:bg-gray-50"},[e("div",Kt,[e("div",Qt,[e("div",Xt,[e("button",{type:"button",class:"w-6 h-6 flex-shrink-0 inline-flex items-center justify-center rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100",title:w.value[o]??!1?"Colapsar opciones":"Expandir opciones",onClick:l=>_e(o)},[w.value[o]??!1?(d(),c("span",Zt,"v")):(d(),c("span",Jt,">"))],8,Yt),g(e("input",{"onUpdate:modelValue":l=>s.name=l,type:"text",placeholder:"Ej: Color, Talla, Material",class:"flex-1 min-w-0 font-medium border-0 bg-transparent focus:bg-white focus:border focus:border-gray-300 rounded px-2 py-1 focus:outline-none"},null,8,It),[[_,s.name]]),s.children&&s.children.length>0?(d(),c("span",es," ("+C(s.children.length)+") ",1)):v("",!0)])]),e("div",ts,[e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-indigo-600",title:s.__showDependency?"Ocultar dependencia":"Configurar dependencia",onClick:l=>Oe(s)},os,8,ss),e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded border border-green-500 text-green-600 hover:bg-green-50",title:"AÃ±adir opciÃ³n",onClick:l=>ye(o)},ls,8,ns),e("button",{type:"button",onClick:l=>be(o),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},ds,8,is)])]),s.__showDependency?(d(),c("div",us,[e("div",ms,[e("div",ps,[gs,g(e("select",{"onUpdate:modelValue":l=>s.dependsOn=l,class:"block w-full text-sm border-gray-300 rounded-md shadow-sm"},[vs,(d(!0),c(S,null,P(u.value,(l,m)=>(d(),c("option",{key:`dep-${o}-${m}`,value:l.name,disabled:l===s||!l.name},C(l.name||"(sin nombre)"),9,fs))),128))],8,hs),[[re,s.dependsOn]])]),s.dependsOn?(d(),c("div",_s,[bs,e("div",ys,[(d(!0),c(S,null,P((u.value.find(l=>l.name===s.dependsOn)?.children||[]).map(l=>l.name),l=>(d(),c("div",{key:`pv-${o}-${l}`,class:"border rounded p-2 bg-white"},[e("div",ws,[$(C(s.dependsOn)+" = ",1),e("strong",null,C(l),1)]),e("div",xs,[(d(!0),c(S,null,P((s.children||[]).map(m=>m.name),m=>(d(),c("label",{key:`cv-${o}-${l}-${m}`,class:"inline-flex items-center gap-1 text-xs"},[e("input",{type:"checkbox",checked:$e(s,l,m),onChange:h=>Me(s,l,m,h),class:"rounded"},null,40,ks),e("span",null,C(m),1)]))),128))])]))),128))])])):v("",!0)])])):v("",!0),w.value[o]??!1?(d(),c("div",Cs,[(d(!0),c(S,null,P(s.children,(l,m)=>(d(),c("div",{key:`child-${o}-${m}`,class:"py-2 flex justify-between items-start"},[e("div",Ss,[e("div",null,[Vs,g(e("input",{"onUpdate:modelValue":h=>l.name=h,type:"text",placeholder:"Ej: Rojo, Verde",class:"block w-full text-sm border-gray-300 rounded-md shadow-sm"},null,8,Ps),[[_,l.name]])]),e("div",null,[Es,g(e("input",{"onUpdate:modelValue":h=>l.price=h,type:"number",step:"0.01",placeholder:"Usa precio principal",class:D(["block w-full text-sm border-gray-300 rounded-md shadow-sm",{"bg-gray-100 cursor-not-allowed":!W(o)}]),disabled:!W(o),onInput:h=>Ee(o,m,h)},null,42,js),[[_,l.price]]),W(o)?v("",!0):(d(),c("p",As," Solo puedes agregar precios a una variante principal "))]),e("div",$s,[e("input",{type:"file",accept:"image/*",onChange:h=>xe(o,m,h),class:"hidden",id:`variant-image-input-${o}-${m}`,disabled:!A(o)},null,40,Ms),l.imagePreview?(d(),c("div",Os,[e("img",{src:l.imagePreview,alt:"Preview",class:"w-10 h-10 object-cover rounded border"},null,8,Us),e("button",{type:"button",onClick:Z(h=>ke(o,m),["stop"]),class:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs hover:bg-red-600"}," Ã— ",8,Bs)])):(d(),c("label",{key:1,for:`variant-image-input-${o}-${m}`,class:D(["inline-flex items-center justify-center w-10 h-10 border-2 border-dashed border-gray-300 rounded hover:border-blue-400 hover:bg-blue-50 transition",{"cursor-pointer":A(o),"cursor-not-allowed opacity-50":!A(o)}]),title:A(o)?"Agregar foto":"Solo puedes agregar imÃ¡genes a una variante principal"},Ds,10,Ts)),A(o)?v("",!0):(d(),c("p",Ns," Solo puedes agregar imÃ¡genes a una variante principal "))])]),e("div",zs,[e("button",{type:"button",onClick:h=>we(o,m),class:"w-8 h-8 inline-flex items-center justify-center rounded hover:bg-gray-100 text-red-600",title:"Eliminar"},Ls,8,Fs)])]))),128))])):v("",!0)]))),128))]),e("form",{onSubmit:Z(te,["prevent"]),class:"mt-6 border-t pt-4"},[Rs,e("div",Ws,[g(e("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=s=>T.value=s),class:"block w-full rounded-md shadow-sm border-gray-300",placeholder:"Nombre de la nueva variante principal",onKeyup:Re(te,["enter"])},null,544),[[_,T.value]]),Gs,e("button",{type:"button",class:"w-8 h-8 inline-flex items-center justify-center rounded bg-gray-200 text-gray-800 hover:bg-gray-300",onClick:t[14]||(t[14]=s=>T.value=""),title:"Cancelar"}," âœ– ")])],32)])])]),e("div",Ks,[Qs,Xs,e("div",Ys,[Js,e("input",{id:"gallery_files",onInput:t[15]||(t[15]=s=>he(s)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),Zs])]),e("div",Is,[e("button",{type:"submit",disabled:i(n).processing,class:"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow"},aa,8,ea),Object.keys(i(n).errors).length?(d(),c("span",oa,"Por favor corrige los campos marcados.")):v("",!0)])],32)])])])])]),_:1}),b(Y,{show:N.value,type:"success",title:"Â¡Producto creado con Ã©xito!","primary-text":"Entendido",onPrimary:t[16]||(t[16]=s=>N.value=!1),onClose:t[17]||(t[17]=s=>N.value=!1)},null,8,["show"]),b(Y,{show:V.value,type:"error",title:"No pudimos guardar el producto",message:"RevisÃ¡ los siguientes puntos:",messages:M.value,"primary-text":"Entendido",onPrimary:t[18]||(t[18]=s=>V.value=!1),onClose:t[19]||(t[19]=s=>V.value=!1)},null,8,["show","messages"]),b(Y,{show:j.value,type:"warning",title:"Solo una Variante Puede Tener Precios",messages:Pe,"primary-text":"Entendido",onPrimary:t[20]||(t[20]=s=>j.value=!1),onClose:t[21]||(t[21]=s=>j.value=!1)},null,8,["show"]),b(Y,{show:G.value,type:"warning",title:"Solo una Variante Puede Tener ImÃ¡genes",messages:je,"primary-text":"Entendido",onPrimary:t[22]||(t[22]=s=>G.value=!1),onClose:t[23]||(t[23]=s=>G.value=!1)},null,8,["show"]),b(Xe,{show:i(me),section:"products-create",steps:i(pe),onComplete:i(ge)},null,8,["show","steps","onComplete"]),b(Ge,{show:z.value,onClose:E},{default:X(()=>[e("div",na,[ra,e("div",la,[ia,e("div",ca,[e("video",{ref_key:"barcodeScannerVideo",ref:O,autoplay:"",playsinline:"",class:"w-full h-full object-cover"},null,512),B.value?v("",!0):(d(),c("div",da,ma))])]),e("div",pa,[b(Ke,{onClick:E},{default:X(()=>[$("Cerrar")]),_:1})])])]),_:1},8,["show"])],64)}}};export{ya as default};
