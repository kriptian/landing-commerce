import{N as Z,r as S,z as ee,w as j,c as se,A as te,b as d,d as c,e as v,u as a,h as oe,f as D,g as e,s as le,i as f,j as p,v as _,O as ne,k as $,m as z,t as b,F as y,l as w,B as P,n as ae}from"./app-ijieBWjj.js";import{_ as re}from"./AuthenticatedLayout-CI19mlKC.js";import{_ as E}from"./AlertModal-umKF0p8V.js";import"./Modal-CUzlKsrL.js";const ie=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear producto",-1),de={class:"py-12"},ce={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ue={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},me={class:"p-6 text-gray-900"},pe={class:"mb-4"},_e=e("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1),he={class:"mb-4"},ge=e("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1),fe={class:"p-4 border rounded-md bg-gray-50"},be={class:"inline-flex items-center gap-2 mb-3 select-none"},ve=e("span",{class:"font-semibold"},"Controlar inventario",-1),ye={key:0,class:"font-semibold text-gray-800 mb-2"},xe={key:1,class:"text-xs text-gray-500 mb-4"},we={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ke={for:"quantity",class:"block font-medium text-sm text-gray-700 flex items-center"},Ce=["disabled"],Se={key:0,class:"mt-1 text-sm text-red-600"},Ve={for:"alert",class:"block font-medium text-sm text-gray-700 flex items-center"},Ae=["disabled"],Oe={for:"purchase_price",class:"block font-medium text-sm text-gray-700 flex items-center"},$e=e("div",{class:"mt-4 mb-2"},[e("label",{class:"block font-medium text-sm text-gray-700"},"Categorías")],-1),Me={class:"space-y-3"},Ue=["onUpdate:modelValue","onChange"],je=e("option",{value:null},"Seleccione una categoría",-1),Te=["value"],Be={key:0,class:"mt-1 text-sm text-red-600"},De={class:"mb-4"},ze=e("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"Descripción Corta",-1),Pe={class:"mb-4"},Ee=e("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"Descripción Larga",-1),Ie={class:"mb-4"},qe=e("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1),Ne={class:"mb-4"},He=e("label",{for:"gallery_files",class:"block font-medium text-sm text-gray-700"},"Imágenes de la Galería",-1),Le=e("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1),Fe={class:"md:col-span-2 mt-6 border-t pt-6"},Re=e("h3",{class:"text-lg font-medium text-gray-900"},"Variantes del Producto",-1),Qe=e("p",{class:"text-sm text-gray-600 mb-4"}," Cada fila representa una combinación única. Si usás inventario, el stock total se suma automáticamente. ",-1),Ge={class:"mb-4 p-4 border rounded-md bg-gray-50"},We=e("h4",{class:"font-semibold text-gray-800 mb-2"},"Atributos de variantes",-1),Xe=e("p",{class:"text-xs text-gray-500 mb-3"},'Ejemplos: Nombre "Color" y Valores "Rojo, Verde, Azul". Podés agregar más filas como "Talla" con "S, M, L".',-1),Ye={class:"space-y-2"},Je={class:"md:col-span-2"},Ke=e("label",{class:"block text-sm font-medium text-gray-700"},"Nombre",-1),Ze=["onUpdate:modelValue"],es={class:"md:col-span-3"},ss=e("label",{class:"block text-sm font-medium text-gray-700"},"Valores (separados por coma)",-1),ts=["onUpdate:modelValue"],os={class:"md:col-span-5 flex items-center gap-2"},ls=["onClick","title","aria-label"],ns={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},as=e("path",{d:"M11 11V5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6z"},null,-1),rs=[as],is={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},ds=e("path",{d:"M5 12a1 1 0 0 1 1-1h12a1 1 0 1 1 0 2H6a1 1 0 0 1-1-1z"},null,-1),cs=[ds],us=["textContent"],ms={key:0,class:"md:col-span-5 grid grid-cols-1 md:grid-cols-5 gap-3 items-start"},ps={class:"md:col-span-2"},_s=e("label",{class:"block text-sm font-medium text-gray-700"},"Depende de",-1),hs=["onUpdate:modelValue"],gs=e("option",{value:""},"(sin dependencia)",-1),fs=["value","disabled"],bs={key:0,class:"md:col-span-3"},vs=e("label",{class:"block text-sm font-medium text-gray-700"},"Permitir valores del hijo según el valor del padre",-1),ys={class:"mt-2 space-y-3"},xs={class:"text-xs font-semibold text-gray-700 mb-2"},ws={class:"flex flex-wrap gap-3"},ks=["checked","onChange"],Cs=e("p",{class:"text-xs text-gray-500 mt-2"},"Si no seleccionas nada para un valor del padre, se permiten todos los valores del hijo.",-1),Ss={class:"md:col-span-5 flex items-center gap-4"},Vs=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},[e("path",{d:"M11 11V5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6z"})],-1),As=[Vs],Os=e("span",{class:"text-xs md:hidden"},"Añadir",-1),$s={class:"flex items-center gap-2"},Ms=["onClick"],Us=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},[e("path",{d:"M7 7h10l-1 12a2 2 0 0 1-2 2H10a2 2 0 0 1-2-2L7 7zm9-3a1 1 0 0 1 1 1v1H7V5a1 1 0 0 1 1-1h8zM9 5V4a3 3 0 0 1 3-3 3 3 0 0 1 3 3v1H9z"})],-1),js=[Us],Ts=e("span",{class:"text-xs md:hidden"},"Quitar",-1),Bs={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},Ds=["disabled"],zs=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M4 4a2 2 0 0 1 2-2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4zm9-1.5V7h4.5L13 2.5z"}),e("path",{d:"M8 13h8v2H8zM8 9h5v2H8z"})],-1),Ps=e("span",null,"Crear",-1),Es=[zs,Ps],Is={key:0,class:"ml-3 text-sm text-red-600"},qs=2*1024*1024,Rs={__name:"Create",props:{categories:Array},setup(I){const q=I,N=Z(),V=S(!!N?.props?.flash?.success),k=S(!1),M=S([]),H=l=>{const t=Array.from(l?.target?.files||[]),r=[],s=[];for(const i of t){if(!(i?.type||"").startsWith("image/")){r.push(`${i.name}: no es una imagen válida.`);continue}if(i.size>qs){r.push(`${i.name}: supera el límite de 2 MB.`);continue}s.push(i)}if(r.length){M.value=["Problemas con las imágenes seleccionadas:",...r],k.value=!0,l?.target&&(l.target.value=""),o.gallery_files=[];return}o.gallery_files=s},A=S([{options:q.categories,selected:null}]),L=l=>{A.value.splice(l+1)},F=async l=>{const t=A.value[l].selected;if(L(l),o.category_id=t,!t)return;const r=await fetch(route("admin.categories.children",t));if(!r.ok)return;const s=await r.json(),i=Array.isArray(s.data)?s.data:[];i.length>0&&A.value.push({options:i,selected:null})},o=ee({name:"",price:"",purchase_price:null,retail_price:null,track_inventory:!0,quantity:0,alert:null,category_id:null,short_description:"",long_description:"",specifications:"",gallery_files:[],variants:[],variant_attributes:[]});j(()=>o.track_inventory,l=>{l&&(o.retail_price=o.price)}),j(()=>o.price,l=>{o.track_inventory&&(o.retail_price=l)});const x=S([{name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}}]),R=()=>{x.value.push({name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}})},Q=l=>{x.value.splice(l,1)},O=l=>String(l||"").split(",").map(t=>t.trim()).filter(Boolean);function G(l,t,r){return(l.rulesSelected&&Array.isArray(l.rulesSelected[t])?l.rulesSelected[t]:[]).includes(r)}function W(l,t,r,s){const i=!!s?.target?.checked;l.rulesSelected||(l.rulesSelected={});const n=Array.isArray(l.rulesSelected[t])?[...l.rulesSelected[t]]:[],m=n.indexOf(r);i&&m===-1&&n.push(r),!i&&m!==-1&&n.splice(m,1),l.rulesSelected[t]=n}function X(l){l.__showDependency=!l.__showDependency,l.__showDependency||(l.dependsOn="",l.rulesSelected={},l.rules={})}const Y=se(()=>o.variants.length===0?Number(o.quantity)||0:o.variants.reduce((l,t)=>l+(Number(t.stock)||0),0));j(Y,l=>{o.variants.length>0&&(o.quantity=l)});const J=()=>{try{const l=x.value.map(t=>({name:String(t.name||"").trim(),values:O(t.valuesText),dependsOn:String(t.dependsOn||"").trim(),rules:t.rules||{},rulesSelected:t.rulesSelected||{}})).filter(t=>t.name&&t.values.length>0);if(o.variant_attributes=l,l.length>0){let i=function(u){s.has(u.name)||(u.dependsOn&&t[u.dependsOn]&&i(t[u.dependsOn]),s.add(u.name),r.push(u))},m=function(u,h){if(u===r.length){n.push({...h});return}const g=r[u];let T=g.values;if(g.dependsOn){const C=h[g.dependsOn];if(C!=null){const U=g.rulesSelected?.[C]??g.rules?.[C]??[],B=Array.isArray(U)?U:O(U);B.length>0&&(T=g.values.filter(K=>B.includes(K)))}}for(const C of T)h[g.name]=C,m(u+1,h);delete h[g.name]};const t=Object.fromEntries(l.map(u=>[u.name,u])),r=[],s=new Set;l.forEach(i);const n=[];m(0,{}),o.variants=n.map(u=>({options_text:r.map(h=>`${h.name}:${u[h.name]}`).join(", "),price:"",purchase_price:null,stock:0,alert:null}))}}catch{}o.post(route("admin.products.store"),{preserveScroll:!0,onError:async()=>{await ae();const l=[];for(const[s,i]of Object.entries(o.errors))s.startsWith("gallery_files.")&&String(i).includes("The gallery files.")?l.push("Una o más imágenes superan el tamaño máximo permitido (2 MB) o no son válidas."):s.startsWith("new_gallery_files.")?l.push("Una o más imágenes nuevas superan el tamaño máximo permitido (2 MB) o no son válidas."):l.push(String(i));M.value=l,k.value=l.length>0;const t=Object.keys(o.errors)[0],r=document.getElementById(t);r&&typeof r.scrollIntoView=="function"&&(r.scrollIntoView({behavior:"smooth",block:"center"}),r.focus?.())},onSuccess:()=>{V.value=!0,o.reset()}})};return(l,t)=>{const r=te("InfoTip");return c(),d(y,null,[v(a(oe),{title:"Crear Producto"}),v(re,null,{header:D(()=>[ie]),default:D(()=>[e("div",de,[e("div",ce,[e("div",ue,[e("div",me,[e("form",{onSubmit:le(J,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,[e("div",pe,[_e,p(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=s=>a(o).name=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,a(o).name]])]),e("div",he,[ge,p(e("input",{id:"price","onUpdate:modelValue":t[1]||(t[1]=s=>a(o).price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[_,a(o).price]])]),e("div",fe,[e("label",be,[p(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=s=>a(o).track_inventory=s),class:"rounded"},null,512),[[ne,a(o).track_inventory]]),ve]),a(o).track_inventory?(c(),d("h4",ye,"Inventario y Precios")):f("",!0),a(o).track_inventory?(c(),d("p",xe," Si creas variantes, estos totales se calcularán solos. ")):f("",!0),a(o).track_inventory?(c(),d("div",we,[e("div",null,[e("label",ke,[$("Inventario (Total) "),v(r,{class:"ml-1 md:hidden",text:"Stock si no hay variantes. Con variantes, se suma automáticamente."})]),p(e("input",{id:"quantity","onUpdate:modelValue":t[3]||(t[3]=s=>a(o).quantity=s),type:"number",class:z(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":a(o).variants.length>0}]),disabled:a(o).track_inventory===!1||a(o).variants.length>0,title:"Stock si no hay variantes. Con variantes, se suma automáticamente."},null,10,Ce),[[_,a(o).quantity]]),a(o).errors.quantity?(c(),d("p",Se,b(a(o).errors.quantity),1)):f("",!0)]),e("div",null,[e("label",Ve,[$("Alerta (Opcional) "),v(r,{class:"ml-1 md:hidden",text:"Se considera bajo stock cuando cantidad ≤ alerta."})]),p(e("input",{id:"alert","onUpdate:modelValue":t[4]||(t[4]=s=>a(o).alert=s),type:"number",class:z(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":a(o).variants.length>0&&a(o).track_inventory}]),disabled:a(o).variants.length>0&&a(o).track_inventory,title:"Se considera bajo stock cuando cantidad ≤ alerta."},null,10,Ae),[[_,a(o).alert]])]),e("div",null,[e("label",Oe,[$("Precio de compra "),v(r,{class:"ml-1 md:hidden",text:"Costo de adquisición del producto."})]),p(e("input",{id:"purchase_price","onUpdate:modelValue":t[5]||(t[5]=s=>a(o).purchase_price=s),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[_,a(o).purchase_price]])])])):f("",!0)]),$e,e("div",Me,[(c(!0),d(y,null,w(A.value,(s,i)=>(c(),d("div",{key:i,class:"mb-1"},[p(e("select",{class:"block w-full rounded-md shadow-sm border-gray-300","onUpdate:modelValue":n=>s.selected=n,onChange:n=>F(i)},[je,(c(!0),d(y,null,w(s.options,n=>(c(),d("option",{key:n.id,value:n.id},b(n.name),9,Te))),128))],40,Ue),[[P,s.selected]])]))),128))]),a(o).errors.category_id?(c(),d("p",Be,b(a(o).errors.category_id),1)):f("",!0)]),e("div",null,[e("div",De,[ze,p(e("textarea",{id:"short_description","onUpdate:modelValue":t[6]||(t[6]=s=>a(o).short_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[_,a(o).short_description]])]),e("div",Pe,[Ee,p(e("textarea",{id:"long_description","onUpdate:modelValue":t[7]||(t[7]=s=>a(o).long_description=s),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[_,a(o).long_description]])]),e("div",Ie,[qe,p(e("input",{id:"specifications","onUpdate:modelValue":t[8]||(t[8]=s=>a(o).specifications=s),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"Alto: 2.30m,Ancho: 1.20m,..."},null,512),[[_,a(o).specifications]])]),e("div",Ne,[He,e("input",{id:"gallery_files",onInput:t[9]||(t[9]=s=>H(s)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),Le])]),e("div",Fe,[Re,Qe,e("div",Ge,[We,Xe,e("div",Ye,[(c(!0),d(y,null,w(x.value,(s,i)=>(c(),d("div",{key:`attr-${i}`,class:"grid grid-cols-1 md:grid-cols-5 gap-3 items-center"},[e("div",Je,[Ke,p(e("input",{"onUpdate:modelValue":n=>s.name=n,type:"text",placeholder:"Color",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,Ze),[[_,s.name]])]),e("div",es,[ss,p(e("input",{"onUpdate:modelValue":n=>s.valuesText=n,type:"text",placeholder:"Rojo, Verde, Azul",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,ts),[[_,s.valuesText]])]),e("div",os,[e("button",{type:"button",class:"inline-flex items-center justify-center w-8 h-8 rounded-full border border-blue-200 text-blue-600 hover:bg-blue-50 hover:border-blue-300",onClick:n=>X(s),title:s.__showDependency?"Ocultar dependencia":"Configurar dependencia","aria-label":s.__showDependency?"Ocultar dependencia":"Configurar dependencia"},[s.__showDependency?(c(),d("svg",is,cs)):(c(),d("svg",ns,rs))],8,ls),e("span",{class:"text-xs text-blue-600 md:hidden",textContent:b(s.__showDependency?"Ocultar":"Depend.")},null,8,us)]),s.__showDependency?(c(),d("div",ms,[e("div",ps,[_s,p(e("select",{"onUpdate:modelValue":n=>s.dependsOn=n,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},[gs,(c(!0),d(y,null,w(x.value,(n,m)=>(c(),d("option",{key:`dep-${i}-${m}`,value:n.name,disabled:n===s||!n.name},b(n.name||"(sin nombre)"),9,fs))),128))],8,hs),[[P,s.dependsOn]])]),s.dependsOn?(c(),d("div",bs,[vs,e("div",ys,[(c(!0),d(y,null,w(O(x.value.find(n=>n.name===s.dependsOn)?.valuesText||""),n=>(c(),d("div",{key:`pv-${i}-${n}`,class:"border rounded p-2"},[e("div",xs,[$(b(s.dependsOn)+" = ",1),e("strong",null,b(n),1)]),e("div",ws,[(c(!0),d(y,null,w(O(s.valuesText),m=>(c(),d("label",{key:`cv-${i}-${n}-${m}`,class:"inline-flex items-center gap-1 text-sm"},[e("input",{type:"checkbox",checked:G(s,n,m),onChange:u=>W(s,n,m,u),class:"rounded"},null,40,ks),e("span",null,b(m),1)]))),128))])]))),128))]),Cs])):f("",!0)])):f("",!0),e("div",Ss,[e("div",{class:"flex items-center gap-2"},[e("button",{type:"button",class:"inline-flex items-center justify-center w-8 h-8 rounded-full border border-blue-200 text-blue-600 hover:bg-blue-50 hover:border-blue-300",onClick:R,title:"Añadir atributo","aria-label":"Añadir atributo"},As),Os]),e("div",$s,[e("button",{type:"button",class:"inline-flex items-center justify-center w-8 h-8 rounded-full border border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300",onClick:n=>Q(i),title:"Quitar atributo","aria-label":"Quitar atributo"},js,8,Ms),Ts])])]))),128))])])]),e("div",Bs,[e("button",{type:"submit",disabled:a(o).processing,class:"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow"},Es,8,Ds),Object.keys(a(o).errors).length?(c(),d("span",Is,"Por favor corrige los campos marcados.")):f("",!0)])],32)])])])])]),_:1}),v(E,{show:V.value,type:"success",title:"¡Producto creado con éxito!","primary-text":"Entendido",onPrimary:t[10]||(t[10]=s=>V.value=!1),onClose:t[11]||(t[11]=s=>V.value=!1)},null,8,["show"]),v(E,{show:k.value,type:"error",title:"No pudimos guardar el producto",message:"Revisá los siguientes puntos:",messages:M.value,"primary-text":"Entendido",onPrimary:t[12]||(t[12]=s=>k.value=!1),onClose:t[13]||(t[13]=s=>k.value=!1)},null,8,["show","messages"])],64)}}};export{Rs as default};
