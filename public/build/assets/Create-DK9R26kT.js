import{A as ne,r as V,c as z,z as ae,w as j,B as re,b as d,d as c,e as v,u as n,h as ie,f as E,g as e,s as de,i as _,j as p,v as h,O as ce,k as M,m as D,t as y,F as x,l as C,C as I,n as P}from"./app-C1p7wth_.js";import{_ as ue}from"./AuthenticatedLayout-f39HC9dH.js";import{_ as L}from"./AlertModal-DpSUIOE5.js";import{u as me,S as pe}from"./useSectionTour-C1KfBAUk.js";import"./Modal-BmdD5t2h.js";const _e=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Crear producto",-1),he={class:"py-12"},ge={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},be={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},fe={class:"p-6 text-gray-900"},ve={class:"mb-4"},ye=e("label",{for:"name",class:"block font-medium text-sm text-gray-700"},"Nombre",-1),xe={class:"mb-4"},we=e("label",{for:"price",class:"block font-medium text-sm text-gray-700"},"Precio (Principal)",-1),ke={class:"p-4 border rounded-md bg-gray-50"},Ce={class:"inline-flex items-center gap-2 mb-3 select-none"},Se=e("span",{class:"font-semibold"},"Controlar inventario",-1),Ve={key:0,class:"font-semibold text-gray-800 mb-2"},Ae={key:1,class:"text-xs text-gray-500 mb-4"},Oe={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Te={for:"quantity",class:"block font-medium text-sm text-gray-700 flex items-center"},$e=["disabled"],Me={key:0,class:"mt-1 text-sm text-red-600"},Ue={for:"alert",class:"block font-medium text-sm text-gray-700 flex items-center"},je=["disabled"],De={for:"purchase_price",class:"block font-medium text-sm text-gray-700 flex items-center"},qe={class:"mt-4 mb-2"},Be=e("label",{class:"block font-medium text-sm text-gray-700"},"Categorías",-1),ze={key:0,class:"mt-1 text-sm text-amber-600 font-medium"},Ee={class:"space-y-3"},Ie=["onUpdate:modelValue","onChange","required"],Pe=e("option",{value:null},"Seleccione una categoría",-1),Le=["value"],Ne={key:0,class:"mt-1 text-sm text-red-600"},He={key:1,class:"mt-1 text-sm text-red-600"},Fe={class:"mb-4"},Re=e("label",{for:"short_description",class:"block font-medium text-sm text-gray-700"},"Descripción Corta",-1),Qe={class:"mb-4"},Ge=e("label",{for:"long_description",class:"block font-medium text-sm text-gray-700"},"Descripción Larga",-1),We={class:"mb-4"},Xe=e("label",{for:"specifications",class:"block font-medium text-sm text-gray-700"},"Especificaciones (separadas por comas)",-1),Ye={class:"mb-4"},Je=e("label",{for:"gallery_files",class:"block font-medium text-sm text-gray-700"},"Imágenes de la Galería",-1),Ke=e("p",{class:"mt-1 text-xs text-gray-500"},"Formatos de imagen y hasta 2 MB por archivo.",-1),Ze={class:"md:col-span-2 mt-6 border-t pt-6"},et=e("h3",{class:"text-lg font-medium text-gray-900"},"Variantes del Producto",-1),tt=e("p",{class:"text-sm text-gray-600 mb-4"}," Cada fila representa una combinación única. Si usás inventario, el stock total se suma automáticamente. ",-1),st={class:"mb-4 p-4 border rounded-md bg-gray-50"},ot=e("h4",{class:"font-semibold text-gray-800 mb-2"},"Atributos de variantes",-1),lt=e("p",{class:"text-xs text-gray-500 mb-3"},'Ejemplos: Nombre "Color" y Valores "Rojo, Verde, Azul". Podés agregar más filas como "Talla" con "S, M, L".',-1),nt={class:"space-y-2"},at={class:"md:col-span-2"},rt=e("label",{class:"block text-sm font-medium text-gray-700"},"Nombre",-1),it=["onUpdate:modelValue"],dt={class:"md:col-span-3"},ct=e("label",{class:"block text-sm font-medium text-gray-700"},"Valores (separados por coma)",-1),ut=["onUpdate:modelValue"],mt={class:"md:col-span-5 flex items-center gap-2"},pt=["onClick","title","aria-label"],_t={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},ht=e("path",{d:"M11 11V5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6z"},null,-1),gt=[ht],bt={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},ft=e("path",{d:"M5 12a1 1 0 0 1 1-1h12a1 1 0 1 1 0 2H6a1 1 0 0 1-1-1z"},null,-1),vt=[ft],yt=["textContent"],xt={key:0,class:"md:col-span-5 grid grid-cols-1 md:grid-cols-5 gap-3 items-start"},wt={class:"md:col-span-2"},kt=e("label",{class:"block text-sm font-medium text-gray-700"},"Depende de",-1),Ct=["onUpdate:modelValue"],St=e("option",{value:""},"(sin dependencia)",-1),Vt=["value","disabled"],At={key:0,class:"md:col-span-3"},Ot=e("label",{class:"block text-sm font-medium text-gray-700"},"Permitir valores del hijo según el valor del padre",-1),Tt={class:"mt-2 space-y-3"},$t={class:"text-xs font-semibold text-gray-700 mb-2"},Mt={class:"flex flex-wrap gap-3"},Ut=["checked","onChange"],jt=e("p",{class:"text-xs text-gray-500 mt-2"},"Si no seleccionas nada para un valor del padre, se permiten todos los valores del hijo.",-1),Dt={class:"md:col-span-5 flex items-center gap-4"},qt=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},[e("path",{d:"M11 11V5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6z"})],-1),Bt=[qt],zt=e("span",{class:"text-xs md:hidden"},"Añadir",-1),Et={class:"flex items-center gap-2"},It=["onClick"],Pt=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-4 h-4",fill:"currentColor"},[e("path",{d:"M7 7h10l-1 12a2 2 0 0 1-2 2H10a2 2 0 0 1-2-2L7 7zm9-3a1 1 0 0 1 1 1v1H7V5a1 1 0 0 1 1-1h8zM9 5V4a3 3 0 0 1 3-3 3 3 0 0 1 3 3v1H9z"})],-1),Lt=[Pt],Nt=e("span",{class:"text-xs md:hidden"},"Quitar",-1),Ht={class:"md:col-span-2 flex items-center justify-end mt-6 border-t pt-6"},Ft=["disabled"],Rt=e("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M4 4a2 2 0 0 1 2-2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4zm9-1.5V7h4.5L13 2.5z"}),e("path",{d:"M8 13h8v2H8zM8 9h5v2H8z"})],-1),Qt=e("span",null,"Crear",-1),Gt=[Rt,Qt],Wt={key:0,class:"ml-3 text-sm text-red-600"},Xt=2*1024*1024,ts={__name:"Create",props:{categories:Array},setup(N){const H=N,F=ne(),A=V(!!F?.props?.flash?.success),w=V(!1),O=V([]),{showTour:R,steps:Q,handleTourComplete:G}=me("products-create"),W=o=>{const s=Array.from(o?.target?.files||[]),i=[],t=[];for(const r of s){if(!(r?.type||"").startsWith("image/")){i.push(`${r.name}: no es una imagen válida.`);continue}if(r.size>Xt){i.push(`${r.name}: supera el límite de 2 MB.`);continue}t.push(r)}if(i.length){O.value=["Problemas con las imágenes seleccionadas:",...i],w.value=!0,o?.target&&(o.target.value=""),l.gallery_files=[];return}l.gallery_files=t},g=V([{options:H.categories,selected:null}]),X=o=>{g.value.splice(o+1)},Y=async o=>{const s=g.value[o].selected;if(X(o),l.category_id=s,!s)return;const i=await fetch(route("admin.categories.children",s));if(!i.ok)return;const t=await i.json(),r=Array.isArray(t.data)?t.data:[];r.length>0&&(g.value.push({options:r,selected:null}),l.category_id=null)},T=z(()=>{if(g.value.length>1){const o=g.value[g.value.length-1];return o.options.length>0&&!o.selected}return!1}),l=ae({name:"",price:"",purchase_price:null,retail_price:null,track_inventory:!0,quantity:0,alert:null,category_id:null,short_description:"",long_description:"",specifications:"",gallery_files:[],variants:[],variant_attributes:[]});j(()=>l.track_inventory,o=>{o&&(l.retail_price=l.price)}),j(()=>l.price,o=>{l.track_inventory&&(l.retail_price=o)});const k=V([{name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}}]),J=()=>{k.value.push({name:"",valuesText:"",dependsOn:"",rules:{},rulesSelected:{}})},K=o=>{k.value.splice(o,1)},$=o=>String(o||"").split(",").map(s=>s.trim()).filter(Boolean);function Z(o,s,i){return(o.rulesSelected&&Array.isArray(o.rulesSelected[s])?o.rulesSelected[s]:[]).includes(i)}function ee(o,s,i,t){const r=!!t?.target?.checked;o.rulesSelected||(o.rulesSelected={});const a=Array.isArray(o.rulesSelected[s])?[...o.rulesSelected[s]]:[],m=a.indexOf(i);r&&m===-1&&a.push(i),!r&&m!==-1&&a.splice(m,1),o.rulesSelected[s]=a}function te(o){o.__showDependency=!o.__showDependency,o.__showDependency||(o.dependsOn="",o.rulesSelected={},o.rules={})}const se=z(()=>l.variants.length===0?Number(l.quantity)||0:l.variants.reduce((o,s)=>o+(Number(s.stock)||0),0));j(se,o=>{l.variants.length>0&&(l.quantity=o)});const oe=()=>{if(T.value){O.value=["Debés seleccionar una subcategoría. La categoría principal tiene subcategorías disponibles y es obligatorio elegir una de ellas."],w.value=!0,P(()=>{const o=document.querySelector(".space-y-3 select");o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.focus())});return}try{const o=k.value.map(s=>({name:String(s.name||"").trim(),values:$(s.valuesText),dependsOn:String(s.dependsOn||"").trim(),rules:s.rules||{},rulesSelected:s.rulesSelected||{}})).filter(s=>s.name&&s.values.length>0);if(l.variant_attributes=o,o.length>0){let r=function(u){t.has(u.name)||(u.dependsOn&&s[u.dependsOn]&&r(s[u.dependsOn]),t.add(u.name),i.push(u))},m=function(u,b){if(u===i.length){a.push({...b});return}const f=i[u];let q=f.values;if(f.dependsOn){const S=b[f.dependsOn];if(S!=null){const U=f.rulesSelected?.[S]??f.rules?.[S]??[],B=Array.isArray(U)?U:$(U);B.length>0&&(q=f.values.filter(le=>B.includes(le)))}}for(const S of q)b[f.name]=S,m(u+1,b);delete b[f.name]};const s=Object.fromEntries(o.map(u=>[u.name,u])),i=[],t=new Set;o.forEach(r);const a=[];m(0,{}),l.variants=a.map(u=>({options_text:i.map(b=>`${b.name}:${u[b.name]}`).join(", "),price:"",purchase_price:null,stock:0,alert:null}))}}catch{}l.post(route("admin.products.store"),{preserveScroll:!0,onError:async()=>{await P();const o=[];for(const[t,r]of Object.entries(l.errors))t.startsWith("gallery_files.")&&String(r).includes("The gallery files.")?o.push("Una o más imágenes superan el tamaño máximo permitido (2 MB) o no son válidas."):t.startsWith("new_gallery_files.")?o.push("Una o más imágenes nuevas superan el tamaño máximo permitido (2 MB) o no son válidas."):o.push(String(r));O.value=o,w.value=o.length>0;const s=Object.keys(l.errors)[0],i=document.getElementById(s);i&&typeof i.scrollIntoView=="function"&&(i.scrollIntoView({behavior:"smooth",block:"center"}),i.focus?.())},onSuccess:()=>{A.value=!0,l.reset()}})};return(o,s)=>{const i=re("InfoTip");return c(),d(x,null,[v(n(ie),{title:"Crear Producto"}),v(ue,null,{header:E(()=>[_e]),default:E(()=>[e("div",he,[e("div",ge,[e("div",be,[e("div",fe,[e("form",{onSubmit:de(oe,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,[e("div",ve,[ye,p(e("input",{id:"name","onUpdate:modelValue":s[0]||(s[0]=t=>n(l).name=t),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[h,n(l).name]])]),e("div",xe,[we,p(e("input",{id:"price","onUpdate:modelValue":s[1]||(s[1]=t=>n(l).price=t),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",required:""},null,512),[[h,n(l).price]])]),e("div",ke,[e("label",Ce,[p(e("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=t=>n(l).track_inventory=t),class:"rounded"},null,512),[[ce,n(l).track_inventory]]),Se]),n(l).track_inventory?(c(),d("h4",Ve,"Inventario y Precios")):_("",!0),n(l).track_inventory?(c(),d("p",Ae," Si creas variantes, estos totales se calcularán solos. ")):_("",!0),n(l).track_inventory?(c(),d("div",Oe,[e("div",null,[e("label",Te,[M("Inventario (Total) "),v(i,{class:"ml-1 md:hidden",text:"Stock si no hay variantes. Con variantes, se suma automáticamente."})]),p(e("input",{id:"quantity","onUpdate:modelValue":s[3]||(s[3]=t=>n(l).quantity=t),type:"number",class:D(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(l).variants.length>0}]),disabled:n(l).track_inventory===!1||n(l).variants.length>0,title:"Stock si no hay variantes. Con variantes, se suma automáticamente."},null,10,$e),[[h,n(l).quantity]]),n(l).errors.quantity?(c(),d("p",Me,y(n(l).errors.quantity),1)):_("",!0)]),e("div",null,[e("label",Ue,[M("Alerta (Opcional) "),v(i,{class:"ml-1 md:hidden",text:"Se considera bajo stock cuando cantidad ≤ alerta."})]),p(e("input",{id:"alert","onUpdate:modelValue":s[4]||(s[4]=t=>n(l).alert=t),type:"number",class:D(["block mt-1 w-full rounded-md shadow-sm border-gray-300",{"bg-gray-100":n(l).variants.length>0&&n(l).track_inventory}]),disabled:n(l).variants.length>0&&n(l).track_inventory,title:"Se considera bajo stock cuando cantidad ≤ alerta."},null,10,je),[[h,n(l).alert]])]),e("div",null,[e("label",De,[M("Precio de compra "),v(i,{class:"ml-1 md:hidden",text:"Costo de adquisición del producto."})]),p(e("input",{id:"purchase_price","onUpdate:modelValue":s[5]||(s[5]=t=>n(l).purchase_price=t),type:"number",step:"0.01",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300"},null,512),[[h,n(l).purchase_price]])])])):_("",!0)]),e("div",qe,[Be,T.value?(c(),d("p",ze," ⚠️ Es obligatorio seleccionar una subcategoría ")):_("",!0)]),e("div",Ee,[(c(!0),d(x,null,C(g.value,(t,r)=>(c(),d("div",{key:r,class:"mb-1"},[p(e("select",{class:D(["block w-full rounded-md shadow-sm border-gray-300",{"border-red-500":T.value&&r===g.value.length-1&&!t.selected}]),"onUpdate:modelValue":a=>t.selected=a,onChange:a=>Y(r),required:r===g.value.length-1&&t.options.length>0},[Pe,(c(!0),d(x,null,C(t.options,a=>(c(),d("option",{key:a.id,value:a.id},y(a.name),9,Le))),128))],42,Ie),[[I,t.selected]])]))),128))]),n(l).errors.category_id?(c(),d("p",Ne,y(n(l).errors.category_id),1)):_("",!0),T.value&&!n(l).errors.category_id?(c(),d("p",He," Debés seleccionar una subcategoría. La categoría principal tiene subcategorías disponibles. ")):_("",!0)]),e("div",null,[e("div",Fe,[Re,p(e("textarea",{id:"short_description","onUpdate:modelValue":s[6]||(s[6]=t=>n(l).short_description=t),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"3"},null,512),[[h,n(l).short_description]])]),e("div",Qe,[Ge,p(e("textarea",{id:"long_description","onUpdate:modelValue":s[7]||(s[7]=t=>n(l).long_description=t),class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",rows:"5"},null,512),[[h,n(l).long_description]])]),e("div",We,[Xe,p(e("input",{id:"specifications","onUpdate:modelValue":s[8]||(s[8]=t=>n(l).specifications=t),type:"text",class:"block mt-1 w-full rounded-md shadow-sm border-gray-300",placeholder:"Alto: 2.30m,Ancho: 1.20m,..."},null,512),[[h,n(l).specifications]])]),e("div",Ye,[Je,e("input",{id:"gallery_files",onInput:s[9]||(s[9]=t=>W(t)),type:"file",multiple:"",class:"block mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32),Ke])]),e("div",Ze,[et,tt,e("div",st,[ot,lt,e("div",nt,[(c(!0),d(x,null,C(k.value,(t,r)=>(c(),d("div",{key:`attr-${r}`,class:"grid grid-cols-1 md:grid-cols-5 gap-3 items-center"},[e("div",at,[rt,p(e("input",{"onUpdate:modelValue":a=>t.name=a,type:"text",placeholder:"Color",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,it),[[h,t.name]])]),e("div",dt,[ct,p(e("input",{"onUpdate:modelValue":a=>t.valuesText=a,type:"text",placeholder:"Rojo, Verde, Azul",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,8,ut),[[h,t.valuesText]])]),e("div",mt,[e("button",{type:"button",class:"inline-flex items-center justify-center w-8 h-8 rounded-full border border-blue-200 text-blue-600 hover:bg-blue-50 hover:border-blue-300",onClick:a=>te(t),title:t.__showDependency?"Ocultar dependencia":"Configurar dependencia","aria-label":t.__showDependency?"Ocultar dependencia":"Configurar dependencia"},[t.__showDependency?(c(),d("svg",bt,vt)):(c(),d("svg",_t,gt))],8,pt),e("span",{class:"text-xs text-blue-600 md:hidden",textContent:y(t.__showDependency?"Ocultar":"Depend.")},null,8,yt)]),t.__showDependency?(c(),d("div",xt,[e("div",wt,[kt,p(e("select",{"onUpdate:modelValue":a=>t.dependsOn=a,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},[St,(c(!0),d(x,null,C(k.value,(a,m)=>(c(),d("option",{key:`dep-${r}-${m}`,value:a.name,disabled:a===t||!a.name},y(a.name||"(sin nombre)"),9,Vt))),128))],8,Ct),[[I,t.dependsOn]])]),t.dependsOn?(c(),d("div",At,[Ot,e("div",Tt,[(c(!0),d(x,null,C($(k.value.find(a=>a.name===t.dependsOn)?.valuesText||""),a=>(c(),d("div",{key:`pv-${r}-${a}`,class:"border rounded p-2"},[e("div",$t,[M(y(t.dependsOn)+" = ",1),e("strong",null,y(a),1)]),e("div",Mt,[(c(!0),d(x,null,C($(t.valuesText),m=>(c(),d("label",{key:`cv-${r}-${a}-${m}`,class:"inline-flex items-center gap-1 text-sm"},[e("input",{type:"checkbox",checked:Z(t,a,m),onChange:u=>ee(t,a,m,u),class:"rounded"},null,40,Ut),e("span",null,y(m),1)]))),128))])]))),128))]),jt])):_("",!0)])):_("",!0),e("div",Dt,[e("div",{class:"flex items-center gap-2"},[e("button",{type:"button",class:"inline-flex items-center justify-center w-8 h-8 rounded-full border border-blue-200 text-blue-600 hover:bg-blue-50 hover:border-blue-300",onClick:J,title:"Añadir atributo","aria-label":"Añadir atributo"},Bt),zt]),e("div",Et,[e("button",{type:"button",class:"inline-flex items-center justify-center w-8 h-8 rounded-full border border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300",onClick:a=>K(r),title:"Quitar atributo","aria-label":"Quitar atributo"},Lt,8,It),Nt])])]))),128))])])]),e("div",Ht,[e("button",{type:"submit",disabled:n(l).processing,class:"inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow"},Gt,8,Ft),Object.keys(n(l).errors).length?(c(),d("span",Wt,"Por favor corrige los campos marcados.")):_("",!0)])],32)])])])])]),_:1}),v(L,{show:A.value,type:"success",title:"¡Producto creado con éxito!","primary-text":"Entendido",onPrimary:s[10]||(s[10]=t=>A.value=!1),onClose:s[11]||(s[11]=t=>A.value=!1)},null,8,["show"]),v(L,{show:w.value,type:"error",title:"No pudimos guardar el producto",message:"Revisá los siguientes puntos:",messages:O.value,"primary-text":"Entendido",onPrimary:s[12]||(s[12]=t=>w.value=!1),onClose:s[13]||(s[13]=t=>w.value=!1)},null,8,["show","messages"]),v(pe,{show:n(R),section:"products-create",steps:n(Q),onComplete:n(G)},null,8,["show","steps","onComplete"])],64)}}};export{ts as default};
